
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ë°”ë¡œ ì¨ë¨¹ëŠ” Spring AI</title>
    </head>
    <body>
        
    <div class="cover-page">
        <img src="file:///Users/robin/Downloads/spring-ai-examples/book/images/book-cover.png" alt="Book Cover">
    </div>
    
        
    <div class="copyright-page">
        <h2>ë°”ë¡œ ì¨ë¨¹ëŠ” Spring AI</h2>
        <p><strong>ì‹¤ì „ AI ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ ê°€ì´ë“œ</strong></p>
        <br>
        <p>ì§€ì€ì´: í™©ë¯¼í˜¸(Robin)</p>
        <p>ì¶œíŒì‚¬: RevFactory</p>
        <p>ë°œí–‰ì—°ë„: 2026ë…„</p>
        <br><br>
        <p>ì´ ì±…ì˜ ì €ì‘ê¶Œì€ ì €ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.</p>
        <p>ì´ ì±…ì˜ ë‚´ìš©ì€ í•™ìŠµ ëª©ì ìœ¼ë¡œ ììœ ë¡­ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <br>
        <p>PDF ìƒì„±ì¼: 2026ë…„ 01ì›” 26ì¼</p>
    </div>
    
        
    <div class="toc-page">
        <h1>ëª©ì°¨</h1>
        <ul>
            <li><a href='#part1-foundation.md'>Part 1: Spring AI ì…ë¬¸</a></li><li><a href='#part2-prompt-engineering.md'>Part 2: í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§</a></li><li><a href='#part3-function-calling.md'>Part 3: Function Callingê³¼ ë„êµ¬ í†µí•©</a></li><li><a href='#part4-agentic-patterns.md'>Part 4: Agentic Patterns</a></li><li><a href='#part5-mcp.md'>Part 5: Model Context Protocol (MCP)</a></li>
        </ul>
    </div>
    
        <div class="chapter" id="part1-foundation.md"><h1 id="part-1-spring-ai-foundation">Part 1: Spring AI ì…ë¬¸ (Foundation)</h1>
<blockquote>
<p>AI ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì˜ ì²« ê±¸ìŒì„ í•¨ê»˜ ë–¼ì–´ë´…ì‹œë‹¤</p>
</blockquote>
<p><strong>í•™ìŠµ ê¸°ê°„:</strong> 2ì£¼
<strong>ë‚œì´ë„:</strong> ì´ˆê¸‰
<strong>ì‚¬ì „ ìš”êµ¬ì‚¬í•­:</strong> Spring Boot ê¸°ë³¸ ì§€ì‹, Kotlin ë¬¸ë²• ì´í•´</p>
<hr />
<h2 id="_1">ë“¤ì–´ê°€ë©°</h2>
<p>ì¸ê³µì§€ëŠ¥ì´ ìš°ë¦¬ ì¼ìƒì— ê¹Šìˆ™ì´ ë“¤ì–´ì˜¨ ì‹œëŒ€ì…ë‹ˆë‹¤. ChatGPT, Claudeì™€ ê°™ì€ ëŒ€í™”í˜• AI ì„œë¹„ìŠ¤ë¥¼ í•œ ë²ˆì¯¤ ì‚¬ìš©í•´ë³´ì…¨ì„ í…ë°ìš”, ì´ëŸ° AIì˜ ê°•ë ¥í•œ ëŠ¥ë ¥ì„ ì—¬ëŸ¬ë¶„ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì§ì ‘ í†µí•©í•  ìˆ˜ ìˆë‹¤ë©´ ì–´ë–¨ê¹Œìš”?</p>
<p>Spring AIëŠ” ë°”ë¡œ ì´ëŸ° ê¿ˆì„ í˜„ì‹¤ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. ë§ˆì¹˜ Spring Data JPAê°€ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ì„ ì‰½ê²Œ ë§Œë“¤ì–´ì¤€ ê²ƒì²˜ëŸ¼, Spring AIëŠ” AI ëª¨ë¸ê³¼ì˜ í†µí•©ì„ ë†€ë¼ìš¸ ì •ë„ë¡œ ê°„ë‹¨í•˜ê²Œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>
<p>ì´ ì¥ì—ì„œëŠ” Spring AIì˜ ê¸°ì´ˆë¥¼ íƒ„íƒ„íˆ ë‹¤ì§€ë©°, ì—¬ëŸ¬ë¶„ë§Œì˜ ì²« ë²ˆì§¸ AI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ë³¼ ê²ƒì…ë‹ˆë‹¤.</p>
<hr />
<h2 id="module-11-spring-ai">Module 1.1: Spring AI ì†Œê°œì™€ í™˜ê²½ êµ¬ì„±</h2>
<h3 id="111-spring-ai">1.1.1 Spring AIë€ ë¬´ì—‡ì¸ê°€?</h3>
<h4 id="spring-ai">Spring ìƒíƒœê³„ì—ì„œì˜ AI í†µí•©</h4>
<p>Spring AIëŠ” 2023ë…„ì— ì‹œì‘ëœ ë¹„êµì  ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ê·¸ ë’¤ì—ëŠ” Spring í”„ë ˆì„ì›Œí¬ 20ë…„ì˜ ì² í•™ê³¼ ê²½í—˜ì´ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤.</p>
<p><strong>ê¸°ì¡´ ë°©ì‹ì˜ ì–´ë ¤ì›€:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ê¸°ì¡´ì—ëŠ” ê° AI ì œê³µìë§ˆë‹¤ ë‹¤ë¥¸ SDKë¥¼ ë°°ì›Œì•¼ í–ˆìŠµë‹ˆë‹¤</span>
<span class="c1">// OpenAI SDK</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">openai</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OpenAIClient</span><span class="p">(</span><span class="n">apiKey</span><span class="p">)</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">openai</span><span class="p">.</span><span class="na">createChatCompletion</span><span class="p">(...)</span>

<span class="c1">// Anthropic SDK - ì™„ì „íˆ ë‹¤ë¥¸ API!</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">anthropic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AnthropicClient</span><span class="p">(</span><span class="n">apiKey</span><span class="p">)</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anthropic</span><span class="p">.</span><span class="na">messages</span><span class="p">.</span><span class="na">create</span><span class="p">(...)</span>
</code></pre></div>

<p><strong>Spring AIì˜ ì ‘ê·¼ ë°©ì‹:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Spring AIëŠ” í•˜ë‚˜ì˜ í†µí•©ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤</span>
<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ChatService</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// OpenAIë“  Anthropicì´ë“  ë™ì¼í•œ ì½”ë“œ!</span>
</code></pre></div>

<p>ì´ê²ƒì´ ë°”ë¡œ Spring AIì˜ í•µì‹¬ ê°€ì¹˜ì…ë‹ˆë‹¤. <strong>"í•œ ë²ˆ ë°°ìš°ê³ , ì–´ë””ì„œë‚˜ ì‚¬ìš©í•œë‹¤"</strong>ëŠ” Springì˜ ì² í•™ì´ AI ì˜ì—­ì—ë„ ê·¸ëŒ€ë¡œ ì ìš©ë©ë‹ˆë‹¤.</p>
<h4 id="_2">í•µì‹¬ ê°œë… ì´í•´í•˜ê¸°</h4>
<p>Spring AIë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ ì•Œì•„ì•¼ í•  ë„¤ ê°€ì§€ í•µì‹¬ ê°œë…ì´ ìˆìŠµë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ê°œë…</th>
<th>ì„¤ëª…</th>
<th>ë¹„ìœ </th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ChatModel</strong></td>
<td>AI ëª¨ë¸ê³¼ì˜ ì €ìˆ˜ì¤€ ì¸í„°í˜ì´ìŠ¤</td>
<td>JDBCì˜ DataSource</td>
</tr>
<tr>
<td><strong>ChatClient</strong></td>
<td>í¸ë¦¬í•œ ê³ ìˆ˜ì¤€ Fluent API</td>
<td>Spring Dataì˜ Repository</td>
</tr>
<tr>
<td><strong>Prompt</strong></td>
<td>AIì—ê²Œ ì „ë‹¬í•˜ëŠ” ì…ë ¥</td>
<td>SQL ì¿¼ë¦¬</td>
</tr>
<tr>
<td><strong>ChatResponse</strong></td>
<td>AIë¡œë¶€í„° ë°›ëŠ” ì‘ë‹µ</td>
<td>ResultSet</td>
</tr>
</tbody>
</table>
<h4 id="_3">ì•„í‚¤í…ì²˜ ê°œìš”</h4>
<p>Spring AIì˜ ì•„í‚¤í…ì²˜ë¥¼ ì‹œê°ì ìœ¼ë¡œ ì´í•´í•´ë´…ì‹œë‹¤:</p>
<p><img alt="Spring AI Architecture" src="file:///Users/robin/Downloads/spring-ai-examples/book/images/spring-ai-architecture.png" /></p>
<div class="codehilite"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´                         â”‚
â”‚              (ì—¬ëŸ¬ë¶„ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ìˆëŠ” ê³³)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       ChatClient                             â”‚
â”‚            (í†µí•©ëœ API - ëª¨ë“  ì œê³µìì— ë™ì¼í•˜ê²Œ ì‚¬ìš©)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    OpenAI    â”‚   Anthropic   â”‚   Azure   â”‚   Ollama        â”‚
â”‚   ChatModel  â”‚   ChatModel   â”‚  ChatModel â”‚  ChatModel      â”‚
â”‚   (GPT-4o)   â”‚   (Claude)    â”‚   (Azure)  â”‚   (ë¡œì»¬)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      HTTP/API ë ˆì´ì–´                         â”‚
â”‚              (ê° ì œê³µìì™€ì˜ ì‹¤ì œ í†µì‹  ë‹´ë‹¹)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p>ì´ êµ¬ì¡°ì˜ ì•„ë¦„ë‹¤ì›€ì€ <strong>ChatClient</strong>ë¼ëŠ” ì¶”ìƒí™” ê³„ì¸µì— ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œëŠ” ChatClientë§Œ ì•Œë©´ ë˜ê³ , ì‹¤ì œë¡œ ì–´ë–¤ AI ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ”ì§€ëŠ” ì„¤ì • íŒŒì¼ì—ì„œ ê²°ì •ë©ë‹ˆë‹¤. ë‚˜ì¤‘ì— OpenAIì—ì„œ Claudeë¡œ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´? ì˜ì¡´ì„±ê³¼ ì„¤ì •ë§Œ ë³€ê²½í•˜ë©´ ë©ë‹ˆë‹¤!</p>
<h3 id="112-ai">1.1.2 ì§€ì› AI ëª¨ë¸</h3>
<p>Spring AIëŠ” ë‹¤ì–‘í•œ AI ì œê³µìë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ê°ê°ì˜ íŠ¹ì§•ì„ ì•Œì•„ë´…ì‹œë‹¤.</p>
<h4 id="_4">í´ë¼ìš°ë“œ ëª¨ë¸</h4>
<table>
<thead>
<tr>
<th>Provider</th>
<th>ëª¨ë¸</th>
<th>íŠ¹ì§•</th>
<th>ì¶”ì²œ ìš©ë„</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>OpenAI</strong></td>
<td>GPT-4o, GPT-4, GPT-3.5</td>
<td>ê°€ì¥ ë²”ìš©ì , ê°•ë ¥í•œ ì„±ëŠ¥</td>
<td>ì¼ë°˜ì ì¸ ëŒ€í™”, ì½”ë“œ ìƒì„±</td>
</tr>
<tr>
<td><strong>Anthropic</strong></td>
<td>Claude 3.5 Sonnet/Haiku</td>
<td>200K í† í° ì»¨í…ìŠ¤íŠ¸, ë†’ì€ ì•ˆì „ì„±</td>
<td>ê¸´ ë¬¸ì„œ ë¶„ì„, ì•ˆì „ì´ ì¤‘ìš”í•œ ì„œë¹„ìŠ¤</td>
</tr>
<tr>
<td><strong>Azure OpenAI</strong></td>
<td>GPT ì‹œë¦¬ì¦ˆ</td>
<td>ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë³´ì•ˆ ë° ê·œì • ì¤€ìˆ˜</td>
<td>ê¸°ì—… í™˜ê²½, ë°ì´í„° ì£¼ê¶Œì´ ì¤‘ìš”í•œ ê²½ìš°</td>
</tr>
<tr>
<td><strong>Google Vertex AI</strong></td>
<td>Gemini Pro</td>
<td>ë©€í‹°ëª¨ë‹¬ (í…ìŠ¤íŠ¸+ì´ë¯¸ì§€+ë¹„ë””ì˜¤)</td>
<td>ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ì²˜ë¦¬ê°€ í•„ìš”í•œ ê²½ìš°</td>
</tr>
<tr>
<td><strong>Amazon Bedrock</strong></td>
<td>Claude, Titan ë“±</td>
<td>AWS ìƒíƒœê³„ í†µí•©</td>
<td>AWS ì¸í”„ë¼ ì‚¬ìš© ê¸°ì—…</td>
</tr>
</tbody>
</table>
<h4 id="ollama">ë¡œì»¬ ëª¨ë¸ (Ollama)</h4>
<p>ì¸í„°ë„· ì—°ê²° ì—†ì´, ë¹„ìš© ê±±ì • ì—†ì´ AIë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ Ollamaê°€ ì •ë‹µì…ë‹ˆë‹¤!</p>
<table>
<thead>
<tr>
<th>ëª¨ë¸</th>
<th>í¬ê¸°</th>
<th>ìš©ë„</th>
<th>í•„ìš” RAM</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Llama 3.2</strong></td>
<td>1B/3B</td>
<td>ë¹ ë¥¸ ì‘ë‹µì´ í•„ìš”í•œ ê°„ë‹¨í•œ ì‘ì—…</td>
<td>4GB+</td>
</tr>
<tr>
<td><strong>Llama 3.1</strong></td>
<td>8B/70B</td>
<td>ë²”ìš© ì‘ì—…</td>
<td>8GB+/64GB+</td>
</tr>
<tr>
<td><strong>Mistral</strong></td>
<td>7B</td>
<td>ì¶”ë¡ , ì½”ë”©</td>
<td>8GB+</td>
</tr>
<tr>
<td><strong>CodeLlama</strong></td>
<td>7B/13B</td>
<td>ì½”ë“œ ìƒì„± ì „ë¬¸</td>
<td>8GB+/16GB+</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ğŸ’¡ <strong>íŒ</strong>: ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” Ollamaë¡œ ë¬´ë£Œë¡œ í…ŒìŠ¤íŠ¸í•˜ê³ , í”„ë¡œë•ì…˜ì—ì„œë§Œ ìœ ë£Œ APIë¥¼ ì‚¬ìš©í•˜ëŠ” ì „ëµì„ ì¶”ì²œí•©ë‹ˆë‹¤!</p>
</blockquote>
<h3 id="113">1.1.3 í”„ë¡œì íŠ¸ ì„¤ì •</h3>
<h4 id="spring-initializr">Spring Initializrë¡œ ì‹œì‘í•˜ê¸°</h4>
<p>ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì€ <a href="https://start.spring.io">start.spring.io</a>ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Project</span><span class="o">:</span><span class="w"> </span><span class="n">Gradle</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Kotlin</span>
<span class="n">Language</span><span class="o">:</span><span class="w"> </span><span class="n">Kotlin</span>
<span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span><span class="o">:</span><span class="w"> </span><span class="mf">3.4</span><span class="o">.</span><span class="na">x</span>
<span class="n">Dependencies</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="n">Web</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="n">AI</span><span class="w"> </span><span class="n">OpenAI</span><span class="w"> </span><span class="o">(</span><span class="err">ë˜ëŠ”</span><span class="w"> </span><span class="n">Anthropic</span><span class="o">)</span>
</code></pre></div>

<h4 id="gradle-kotlin-dsl">Gradle ì„¤ì • (Kotlin DSL)</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// build.gradle.kts</span>
<span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">kotlin</span><span class="p">(</span><span class="s">&quot;jvm&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">&quot;1.9.25&quot;</span>
<span class="w">    </span><span class="n">kotlin</span><span class="p">(</span><span class="s">&quot;plugin.spring&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">&quot;1.9.25&quot;</span>
<span class="w">    </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;org.springframework.boot&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">&quot;3.4.5&quot;</span>
<span class="w">    </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;io.spring.dependency-management&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">&quot;1.1.7&quot;</span>
<span class="p">}</span>

<span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Spring AI BOM (Bill of Materials)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="n">platform</span><span class="p">(</span><span class="s">&quot;org.springframework.ai:spring-ai-bom:1.0.0&quot;</span><span class="p">))</span>

<span class="w">    </span><span class="c1">// OpenAI ì‚¬ìš© ì‹œ</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.ai:spring-ai-openai-spring-boot-starter&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// ë˜ëŠ” Anthropic ì‚¬ìš© ì‹œ</span>
<span class="w">    </span><span class="c1">// implementation(&quot;org.springframework.ai:spring-ai-anthropic-spring-boot-starter&quot;)</span>

<span class="w">    </span><span class="c1">// ê¸°ë³¸ ì˜ì¡´ì„±</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-web&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.fasterxml.jackson.module:jackson-module-kotlin&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.jetbrains.kotlin:kotlin-reflect&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="114-api">1.1.4 API í‚¤ ê´€ë¦¬</h3>
<h4 id="_5">í™˜ê²½ ë³€ìˆ˜ ì„¤ì •</h4>
<p>API í‚¤ëŠ” ì ˆëŒ€ë¡œ ì½”ë“œì— ì§ì ‘ ì‘ì„±í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤! í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ì„¸ìš”:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ~/.zshrc ë˜ëŠ” ~/.bashrcì— ì¶”ê°€</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OPENAI_API_KEY</span><span class="o">=</span>sk-proj-xxxxx
<span class="nb">export</span><span class="w"> </span><span class="nv">ANTHROPIC_API_KEY</span><span class="o">=</span>sk-ant-xxxxx
</code></pre></div>

<h4 id="applicationyml">application.yml ì„¤ì •</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ai</span><span class="p">:</span>
<span class="w">    </span><span class="nt">openai</span><span class="p">:</span>
<span class="w">      </span><span class="nt">api-key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${OPENAI_API_KEY}</span>
<span class="w">      </span><span class="nt">chat</span><span class="p">:</span>
<span class="w">        </span><span class="nt">options</span><span class="p">:</span>
<span class="w">          </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpt-4o</span>
<span class="w">          </span><span class="nt">temperature</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.7</span><span class="w">  </span><span class="c1"># 0.0(ê²°ì •ì ) ~ 2.0(ì°½ì˜ì )</span>
</code></pre></div>

<blockquote>
<p>âš ï¸ <strong>ë³´ì•ˆ ê²½ê³ </strong>: API í‚¤ê°€ Gitì— ì»¤ë°‹ë˜ì§€ ì•Šë„ë¡ <code>.gitignore</code>ì— í™˜ê²½ íŒŒì¼ì„ ì¶”ê°€í•˜ì„¸ìš”!</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="c1"># .gitignore</span>
<span class="na">.env</span>
<span class="nf">application-local.yml</span>
</code></pre></div>

<h3 id="115-hello-spring-ai">1.1.5 ì‹¤ìŠµ: Hello Spring AI</h3>
<p>ë“œë””ì–´ ì²« ë²ˆì§¸ Spring AI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ë´…ì‹œë‹¤!</p>
<h4 id="_6">í”„ë¡œì íŠ¸ êµ¬ì¡°</h4>
<div class="codehilite"><pre><span></span><code>src/main/kotlin/com/example/helloai/
â”œâ”€â”€ HelloAiApplication.kt
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ ChatController.kt
â””â”€â”€ service/
    â””â”€â”€ ChatService.kt
</code></pre></div>

<h4 id="_7">ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// HelloAiApplication.kt</span>
<span class="k">package</span><span class="w"> </span><span class="nn">com.example.helloai</span>

<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.boot.runApplication</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HelloAiApplication</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">runApplication</span><span class="o">&lt;</span><span class="n">HelloAiApplication</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="_8">ì„œë¹„ìŠ¤ ë ˆì´ì–´</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// service/ChatService.kt</span>
<span class="k">package</span><span class="w"> </span><span class="nn">com.example.helloai.service</span>

<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ai.chat.client.ChatClient</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ChatService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// ChatClient.Builderë¥¼ ì£¼ì…ë°›ì•„ ChatClientë¥¼ ìƒì„±í•©ë‹ˆë‹¤</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultSystem</span><span class="p">(</span><span class="s">&quot;ë‹¹ì‹ ì€ ì¹œì ˆí•˜ê³  ë„ì›€ì´ ë˜ëŠ” AI ë¹„ì„œì…ë‹ˆë‹¤. í•œêµ­ì–´ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="w">  </span><span class="c1">// ì‚¬ìš©ì ë©”ì‹œì§€ ì„¤ì •</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span><span class="w">         </span><span class="c1">// AI í˜¸ì¶œ</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span><span class="w">      </span><span class="c1">// ì‘ë‹µ ë‚´ìš© ì¶”ì¶œ</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="_9">ì»¨íŠ¸ë¡¤ëŸ¬</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// controller/ChatController.kt</span>
<span class="k">package</span><span class="w"> </span><span class="nn">com.example.helloai.controller</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.example.helloai.service.ChatService</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.*</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/chat&quot;</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ChatController</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatService</span><span class="p">:</span><span class="w"> </span><span class="n">ChatService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@GetMapping</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatService</span><span class="p">.</span><span class="na">chat</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chatPost</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ChatRequest</span><span class="p">):</span><span class="w"> </span><span class="n">ChatResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatService</span><span class="p">.</span><span class="na">chat</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">message</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ChatResponse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ChatRequest</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ChatResponse</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>
</code></pre></div>

<h4 id="_10">í…ŒìŠ¤íŠ¸í•´ë³´ê¸°</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># ì„œë²„ ì‹¤í–‰ í›„</span>
curl<span class="w"> </span><span class="s2">&quot;http://localhost:8080/api/chat?message=ì•ˆë…•í•˜ì„¸ìš”&quot;</span>

<span class="c1"># ë˜ëŠ” POST ìš”ì²­</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/api/chat<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;message&quot;: &quot;Spring AIì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”&quot;}&#39;</span>
</code></pre></div>

<p>ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰ ë°©ê¸ˆ ì—¬ëŸ¬ë¶„ì˜ ì²« ë²ˆì§¸ AI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤!</p>
<hr />
<h2 id="module-12-chatclient">Module 1.2: ChatClient ê¸°ì´ˆ</h2>
<h3 id="121-chatclient">1.2.1 ChatClient ì†Œê°œ</h3>
<h4 id="chatmodel-vs-chatclient">ChatModel vs ChatClient</h4>
<p>Spring AIëŠ” ë‘ ê°€ì§€ ìˆ˜ì¤€ì˜ APIë¥¼ ì œê³µí•©ë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>êµ¬ë¶„</th>
<th>ChatModel</th>
<th>ChatClient</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ìˆ˜ì¤€</strong></td>
<td>Low-level (ì €ìˆ˜ì¤€)</td>
<td>High-level (ê³ ìˆ˜ì¤€)</td>
</tr>
<tr>
<td><strong>API ìŠ¤íƒ€ì¼</strong></td>
<td>ì§ì ‘ì , ëª…ì‹œì </td>
<td>Fluent, ì²´ì´ë‹</td>
</tr>
<tr>
<td><strong>ì‚¬ìš©ì„±</strong></td>
<td>ë³µì¡í•˜ì§€ë§Œ ìœ ì—°</td>
<td>ê°„í¸í•˜ê³  ì§ê´€ì </td>
</tr>
<tr>
<td><strong>ì¶”ì²œ ëŒ€ìƒ</strong></td>
<td>ì„¸ë°€í•œ ì œì–´ í•„ìš” ì‹œ</td>
<td>ëŒ€ë¶€ë¶„ì˜ ê²½ìš°</td>
</tr>
</tbody>
</table>
<p>ëŒ€ë¶€ë¶„ì˜ ê²½ìš° <strong>ChatClient</strong>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì½”ë“œê°€ í›¨ì”¬ ì½ê¸° ì‰½ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° í¸í•©ë‹ˆë‹¤.</p>
<h4 id="chatclient">ChatClient ìƒì„± ë°©ë²•</h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ChatService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// ë°©ë²• 1: Builder ì£¼ì… (ê¶Œì¥)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultSystem</span><span class="p">(</span><span class="s">&quot;ê¸°ë³¸ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// ë°©ë²• 2: ChatModelì—ì„œ ì§ì ‘ ìƒì„± (í•„ìš”í•œ ê²½ìš°ì—ë§Œ)</span>
<span class="w">    </span><span class="c1">// private val chatClient = ChatClient.create(chatModel)</span>
<span class="p">}</span>
</code></pre></div>

<blockquote>
<p>ğŸ’¡ <strong>ì™œ Builderë¥¼ ì£¼ì…ë°›ë‚˜ìš”?</strong></p>
<p><code>ChatClient.Builder</code>ë¥¼ ì£¼ì…ë°›ìœ¼ë©´ Spring Bootì˜ ìë™ ì„¤ì •ì´ ì ìš©ëœ ìƒíƒœì—ì„œ ì‹œì‘í•©ë‹ˆë‹¤.
API í‚¤, ëª¨ë¸ ì„¤ì • ë“±ì´ ì´ë¯¸ êµ¬ì„±ë˜ì–´ ìˆì–´ì„œ ì¶”ê°€ ì„¤ì • ì—†ì´ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</blockquote>
<h3 id="122">1.2.2 ë©”ì‹œì§€ ì—­í•  ì´í•´í•˜ê¸°</h3>
<p>AI ëŒ€í™”ì—ì„œëŠ” ì„¸ ê°€ì§€ ì—­í• ì˜ ë©”ì‹œì§€ê°€ ìˆìŠµë‹ˆë‹¤:</p>
<p><img alt="Message Roles" src="file:///Users/robin/Downloads/spring-ai-examples/book/images/message-roles.png" /></p>
<table>
<thead>
<tr>
<th>ì—­í• </th>
<th>ì„¤ëª…</th>
<th>ì˜ˆì‹œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>System Message</strong></td>
<td>AIì˜ ì„±ê²©, ì—­í• , ì œì•½ì‚¬í•­ì„ ì •ì˜í•©ë‹ˆë‹¤. ëŒ€í™” ì „ì²´ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.</td>
<td>"ë‹¹ì‹ ì€ ì „ë¬¸ ë²ˆì—­ê°€ì…ë‹ˆë‹¤"</td>
</tr>
<tr>
<td><strong>User Message</strong></td>
<td>ì‚¬ìš©ìê°€ AIì—ê²Œ í•˜ëŠ” ì§ˆë¬¸ì´ë‚˜ ìš”ì²­ì…ë‹ˆë‹¤.</td>
<td>"ì´ ë¬¸ì¥ì„ ì˜ì–´ë¡œ ë²ˆì—­í•´ì£¼ì„¸ìš”"</td>
</tr>
<tr>
<td><strong>Assistant Message</strong></td>
<td>AIì˜ ì´ì „ ì‘ë‹µì…ë‹ˆë‹¤. ëŒ€í™” ì´ë ¥ì„ ìœ ì§€í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.</td>
<td>"Here is the translation..."</td>
</tr>
</tbody>
</table>
<h4 id="system-message">System Message í™œìš©</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// AIì˜ ì—­í• ì„ ëª…í™•íˆ ì •ì˜í•©ë‹ˆë‹¤</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;ë‹¹ì‹ ì€ ì „ë¬¸ ë²ˆì—­ê°€ì…ë‹ˆë‹¤. ëª¨ë“  ì…ë ¥ì„ ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´ë¡œ ë²ˆì—­í•´ì£¼ì„¸ìš”.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;Hello, how are you today?&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="c1">// ê²°ê³¼: &quot;ì•ˆë…•í•˜ì„¸ìš”, ì˜¤ëŠ˜ ê¸°ë¶„ì´ ì–´ë– ì„¸ìš”?&quot;</span>
</code></pre></div>

<h4 id="_11">ëŒ€í™” ì´ë ¥ ìœ ì§€í•˜ê¸°</h4>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ai.chat.messages.*</span>

<span class="c1">// ì´ì „ ëŒ€í™” ë‚´ìš©ì„ í¬í•¨ì‹œì¼œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;ë‹¹ì‹ ì€ ì¹œì ˆí•œ AI ë¹„ì„œì…ë‹ˆë‹¤.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">messages</span><span class="p">(</span>
<span class="w">        </span><span class="n">UserMessage</span><span class="p">(</span><span class="s">&quot;ì œ ì´ë¦„ì€ ì² ìˆ˜ì…ë‹ˆë‹¤&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">AssistantMessage</span><span class="p">(</span><span class="s">&quot;ì•ˆë…•í•˜ì„¸ìš” ì² ìˆ˜ë‹˜! ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤.&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">UserMessage</span><span class="p">(</span><span class="s">&quot;ì œ ì´ë¦„ì´ ë­ë¼ê³  í–ˆì£ ?&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="c1">// ê²°ê³¼: &quot;ì² ìˆ˜ë‹˜ì´ë¼ê³  í•˜ì…¨ìŠµë‹ˆë‹¤.&quot;</span>
</code></pre></div>

<h3 id="123">1.2.3 ë‹¤ì–‘í•œ í˜¸ì¶œ ë°©ì‹</h3>
<h4 id="-call">ë™ê¸° í˜¸ì¶œ - call()</h4>
<p>ê°€ì¥ ê¸°ë³¸ì ì¸ í˜¸ì¶œ ë°©ì‹ì…ë‹ˆë‹¤. ì „ì²´ ì‘ë‹µì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ì‘ë‹µ</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;ë†ë‹´ í•˜ë‚˜ í•´ì£¼ì„¸ìš”&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="c1">// ì „ì²´ ChatResponse ê°ì²´ê°€ í•„ìš”í•œ ê²½ìš°</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="p">:</span><span class="w"> </span><span class="n">ChatResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;ì•ˆë…•í•˜ì„¸ìš”&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">chatResponse</span><span class="p">()</span>

<span class="c1">// ë©”íƒ€ë°ì´í„° í™•ì¸ (í† í° ì‚¬ìš©ëŸ‰ ë“±)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;ì‚¬ìš©ëœ í† í°: </span><span class="si">${</span><span class="n">response</span><span class="p">.</span><span class="na">metadata</span><span class="p">.</span><span class="na">usage</span><span class="p">.</span><span class="na">totalTokens</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="-entity">êµ¬ì¡°í™”ëœ ì‘ë‹µ - entity()</h4>
<p>AI ì‘ë‹µì„ ìë™ìœ¼ë¡œ Kotlin ê°ì²´ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! (ì´ ê¸°ëŠ¥ì€ Part 2ì—ì„œ ìì„¸íˆ ë‹¤ë£¹ë‹ˆë‹¤)</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ì‘ë‹µ í˜•ì‹ ì •ì˜</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Joke</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">setup</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w">    </span><span class="c1">// ë†ë‹´ì˜ ì„¤ì •</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">punchline</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="c1">// í€ì¹˜ë¼ì¸</span>
<span class="p">)</span>

<span class="c1">// AIê°€ ìë™ìœ¼ë¡œ JSON í˜•íƒœë¡œ ì‘ë‹µí•˜ê³ , ì´ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">joke</span><span class="p">:</span><span class="w"> </span><span class="n">Joke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;í”„ë¡œê·¸ë˜ë¨¸ ë†ë‹´ í•˜ë‚˜ í•´ì£¼ì„¸ìš”&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">Joke</span><span class="o">&gt;</span><span class="p">()</span><span class="w">  </span><span class="c1">// Kotlinì˜ reified type parameter í™œìš©</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;ì„¤ì •: </span><span class="si">${</span><span class="n">joke</span><span class="p">.</span><span class="na">setup</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;í€ì¹˜ë¼ì¸: </span><span class="si">${</span><span class="n">joke</span><span class="p">.</span><span class="na">punchline</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="124">1.2.4 ëª¨ë¸ ì˜µì…˜ ì„¤ì •</h3>
<h4 id="temperature">Temperature (ì˜¨ë„)</h4>
<p>TemperatureëŠ” AI ì‘ë‹µì˜ ì°½ì˜ì„±ì„ ì¡°ì ˆí•˜ëŠ” ê°€ì¥ ì¤‘ìš”í•œ íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ai.openai.OpenAiChatOptions</span>

<span class="c1">// ì°½ì˜ì ì¸ ì‘ë‹µì´ í•„ìš”í•  ë•Œ (ì˜ˆ: ì†Œì„¤ ì“°ê¸°)</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">creativeResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;ì™¸ê³„ì¸ì´ ì§€êµ¬ì— ì˜¤ëŠ” SF ì†Œì„¤ì˜ ì²« ë¬¸ì¥ì„ ì¨ì£¼ì„¸ìš”&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">options</span><span class="p">(</span><span class="n">OpenAiChatOptions</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">temperature</span><span class="p">(</span><span class="m">0.9</span><span class="p">)</span><span class="w">  </span><span class="c1">// ë†’ì„ìˆ˜ë¡ ì°½ì˜ì </span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="c1">// ì •í™•í•œ ì‘ë‹µì´ í•„ìš”í•  ë•Œ (ì˜ˆ: ì½”ë“œ ìƒì„±)</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">preciseResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;í€µì†ŒíŠ¸ ì•Œê³ ë¦¬ì¦˜ì„ Kotlinìœ¼ë¡œ êµ¬í˜„í•´ì£¼ì„¸ìš”&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">options</span><span class="p">(</span><span class="n">OpenAiChatOptions</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">temperature</span><span class="p">(</span><span class="m">0.1</span><span class="p">)</span><span class="w">  </span><span class="c1">// ë‚®ì„ìˆ˜ë¡ ê²°ì •ì </span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
</code></pre></div>

<h4 id="_12">ì£¼ìš” ì˜µì…˜ë“¤</h4>
<table>
<thead>
<tr>
<th>ì˜µì…˜</th>
<th>ì„¤ëª…</th>
<th>ë²”ìœ„</th>
<th>ì‚¬ìš© ì˜ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>temperature</code></td>
<td>ì‘ë‹µì˜ ë¬´ì‘ìœ„ì„±</td>
<td>0.0 ~ 2.0</td>
<td>ì°½ì˜ì  ê¸€ì“°ê¸° vs ì½”ë“œ ìƒì„±</td>
</tr>
<tr>
<td><code>maxTokens</code></td>
<td>ìµœëŒ€ ì‘ë‹µ ê¸¸ì´</td>
<td>1 ~ ëª¨ë¸ ìµœëŒ€</td>
<td>ì§§ì€ ë‹µë³€ vs ê¸´ ì„¤ëª…</td>
</tr>
<tr>
<td><code>topP</code></td>
<td>ëˆ„ì  í™•ë¥  ìƒ˜í”Œë§</td>
<td>0.0 ~ 1.0</td>
<td>ë‹¤ì–‘ì„± ì¡°ì ˆ</td>
</tr>
<tr>
<td><code>frequencyPenalty</code></td>
<td>ë°˜ë³µ ì–µì œ</td>
<td>-2.0 ~ 2.0</td>
<td>ê°™ì€ ë‹¨ì–´ ë°˜ë³µ ë°©ì§€</td>
</tr>
<tr>
<td><code>presencePenalty</code></td>
<td>ìƒˆ í† í”½ ìœ ë„</td>
<td>-2.0 ~ 2.0</td>
<td>ë‹¤ì–‘í•œ ì£¼ì œ íƒìƒ‰</td>
</tr>
</tbody>
</table>
<h3 id="125">1.2.5 ì—ëŸ¬ ì²˜ë¦¬</h3>
<p>AI API í˜¸ì¶œì€ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ë‹¤ì–‘í•œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ai.retry.*</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">RobustChatService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">NonTransientAiException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ì¬ì‹œë„í•´ë„ í•´ê²°ë˜ì§€ ì•ŠëŠ” ì˜¤ë¥˜ (ì˜ëª»ëœ API í‚¤, ì˜ëª»ëœ ìš”ì²­ ë“±)</span>
<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;AI API ì˜¤ë¥˜: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="s">&quot;ì£„ì†¡í•©ë‹ˆë‹¤. ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.&quot;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">TransientAiException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ì¼ì‹œì  ì˜¤ë¥˜ (ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ, ì„œë²„ ê³¼ë¶€í•˜ ë“±) - ì¬ì‹œë„ ê°€ëŠ¥</span>
<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;ì¼ì‹œì  ì˜¤ë¥˜ ë°œìƒ, ì¬ì‹œë„ ì¤‘...&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="w">  </span><span class="c1">// Spring Retryê°€ ì²˜ë¦¬í•˜ë„ë¡ ìœ„ì„</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">RobustChatService</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="_13">ìë™ ì¬ì‹œë„ ì„¤ì •</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># application.yml</span>
<span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ai</span><span class="p">:</span>
<span class="w">    </span><span class="nt">retry</span><span class="p">:</span>
<span class="w">      </span><span class="nt">max-attempts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">                    </span><span class="c1"># ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜</span>
<span class="w">      </span><span class="nt">backoff</span><span class="p">:</span>
<span class="w">        </span><span class="nt">initial-interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span><span class="w">           </span><span class="c1"># ì²« ì¬ì‹œë„ê¹Œì§€ ëŒ€ê¸° ì‹œê°„ (ms)</span>
<span class="w">        </span><span class="nt">multiplier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">                    </span><span class="c1"># ëŒ€ê¸° ì‹œê°„ ì¦ê°€ ë°°ìˆ˜</span>
<span class="w">        </span><span class="nt">max-interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class="w">              </span><span class="c1"># ìµœëŒ€ ëŒ€ê¸° ì‹œê°„ (ms)</span>
</code></pre></div>

<h3 id="126">1.2.6 ì‹¤ìŠµ: ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ë¥¼ ìœ ì§€í•˜ëŠ” ì±—ë´‡</h3>
<p>ì‹¤ì œ ì±—ë´‡ì²˜ëŸ¼ ì´ì „ ëŒ€í™” ë‚´ìš©ì„ ê¸°ì–µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤!</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// service/ConversationService.kt</span>
<span class="k">package</span><span class="w"> </span><span class="nn">com.example.helloai.service</span>

<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ai.chat.client.ChatClient</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ai.chat.messages.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.util.concurrent.ConcurrentHashMap</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ConversationService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultSystem</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            ë‹¹ì‹ ì€ ì¹œì ˆí•˜ê³  ë„ì›€ì´ ë˜ëŠ” AI ë¹„ì„œì…ë‹ˆë‹¤.</span>
<span class="s">            ì‚¬ìš©ìì˜ ì´ì „ ëŒ€í™” ë‚´ìš©ì„ ê¸°ì–µí•˜ê³  ì°¸ì¡°í•˜ì—¬ ì‘ë‹µí•´ì£¼ì„¸ìš”.</span>
<span class="s">            í•œêµ­ì–´ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€í™”í•©ë‹ˆë‹¤.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// ì„¸ì…˜ë³„ ëŒ€í™” ì´ë ¥ ì €ì¥ì†Œ</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">conversations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">MutableList</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// ìµœëŒ€ ì €ì¥í•  ë©”ì‹œì§€ ìˆ˜ (ë©”ëª¨ë¦¬ ê´€ë¦¬)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">maxHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span><span class="n">sessionId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">userMessage</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. í•´ë‹¹ ì„¸ì…˜ì˜ ëŒ€í™” ì´ë ¥ ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">history</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conversations</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">sessionId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mutableListOf</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 2. ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€</span>
<span class="w">        </span><span class="n">history</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">UserMessage</span><span class="p">(</span><span class="n">userMessage</span><span class="p">))</span>

<span class="w">        </span><span class="c1">// 3. ì´ë ¥ì´ ë„ˆë¬´ ê¸¸ë©´ ì˜¤ë˜ëœ ë©”ì‹œì§€ ì œê±°</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="na">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxHistory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">history</span><span class="p">.</span><span class="na">removeAt</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 4. AI í˜¸ì¶œ (ì „ì²´ ëŒ€í™” ì´ë ¥ í¬í•¨)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">messages</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// 5. AI ì‘ë‹µë„ ì´ë ¥ì— ì¶”ê°€</span>
<span class="w">        </span><span class="n">history</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">AssistantMessage</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">response</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ëŒ€í™” ì´ë ¥ ì´ˆê¸°í™”</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">clearHistory</span><span class="p">(</span><span class="n">sessionId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">conversations</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">sessionId</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// íŠ¹ì • ì„¸ì…˜ì˜ ëŒ€í™” ì´ë ¥ ì¡°íšŒ</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getHistory</span><span class="p">(</span><span class="n">sessionId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">conversations</span><span class="o">[</span><span class="n">sessionId</span><span class="o">]?.</span><span class="na">toList</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">emptyList</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="_14">ì»¨íŠ¸ë¡¤ëŸ¬ ì—…ë°ì´íŠ¸</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// controller/ConversationController.kt</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/conversation&quot;</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ConversationController</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">conversationService</span><span class="p">:</span><span class="w"> </span><span class="n">ConversationService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{sessionId}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">sessionId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ChatRequest</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">ChatResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conversationService</span><span class="p">.</span><span class="na">chat</span><span class="p">(</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">message</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ChatResponse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@DeleteMapping</span><span class="p">(</span><span class="s">&quot;/{sessionId}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">clearHistory</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">sessionId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">conversationService</span><span class="p">.</span><span class="na">clearHistory</span><span class="p">(</span><span class="n">sessionId</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="_15">í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># ì²« ë²ˆì§¸ ëŒ€í™”</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/api/conversation/user123<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;message&quot;: &quot;ì•ˆë…•! ë‚´ ì´ë¦„ì€ ë¯¼ìˆ˜ì•¼&quot;}&#39;</span>
<span class="c1"># ì‘ë‹µ: &quot;ì•ˆë…•í•˜ì„¸ìš” ë¯¼ìˆ˜ë‹˜! ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤...&quot;</span>

<span class="c1"># ë‘ ë²ˆì§¸ ëŒ€í™” - AIê°€ ì´ë¦„ì„ ê¸°ì–µí•©ë‹ˆë‹¤!</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/api/conversation/user123<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;message&quot;: &quot;ë‚´ ì´ë¦„ì´ ë­ë¼ê³  í–ˆì§€?&quot;}&#39;</span>
<span class="c1"># ì‘ë‹µ: &quot;ë¯¼ìˆ˜ë¼ê³  í•˜ì…¨ìŠµë‹ˆë‹¤!&quot;</span>

<span class="c1"># ëŒ€í™” ì´ˆê¸°í™”</span>
curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>http://localhost:8080/api/conversation/user123
</code></pre></div>

<hr />
<h2 id="module-13-streaming">Module 1.3: Streaming ì‘ë‹µ ì²˜ë¦¬</h2>
<h3 id="131-streaming">1.3.1 Streamingì´ í•„ìš”í•œ ì´ìœ </h3>
<p>ChatGPTë¥¼ ì‚¬ìš©í•´ë³´ì…¨ë‹¤ë©´, ì‘ë‹µì´ í•œ ê¸€ìì”© íƒ€ì´í•‘ë˜ë“¯ì´ ë‚˜íƒ€ë‚˜ëŠ” ê²ƒì„ ë³´ì…¨ì„ ê²ë‹ˆë‹¤. ì´ê²ƒì´ ë°”ë¡œ <strong>ìŠ¤íŠ¸ë¦¬ë°</strong>ì…ë‹ˆë‹¤.</p>
<h4 id="_16">ì™œ ìŠ¤íŠ¸ë¦¬ë°ì„ ì‚¬ìš©í• ê¹Œìš”?</h4>
<p><img alt="Streaming Comparison" src="file:///Users/robin/Downloads/spring-ai-examples/book/images/streaming-comparison.png" /></p>
<table>
<thead>
<tr>
<th>ë°©ì‹</th>
<th>ë™ì‘</th>
<th>ì‚¬ìš©ì ê²½í—˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ë™ê¸° ë°©ì‹ (call)</strong></td>
<td>ì „ì²´ ì‘ë‹µì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°</td>
<td>10ì´ˆ ë™ì•ˆ ì•„ë¬´ê²ƒë„ ì•ˆ ë³´ì´ë‹¤ê°€ í•œêº¼ë²ˆì— í‘œì‹œ</td>
</tr>
<tr>
<td><strong>ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ (stream)</strong></td>
<td>ì‘ë‹µì´ ìƒì„±ë˜ëŠ” ëŒ€ë¡œ ì¦‰ì‹œ ì „ì†¡</td>
<td>ì¦‰ì‹œ ì‘ë‹µ ì‹œì‘, ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”ê°</td>
</tr>
</tbody>
</table>
<p><strong>ìŠ¤íŠ¸ë¦¬ë°ì˜ ì¥ì :</strong>
1. <strong>ì¦‰ê°ì ì¸ í”¼ë“œë°±</strong>: ì‚¬ìš©ìê°€ ê¸°ë‹¤ë¦¬ëŠ” ëŠë‚Œì´ ì¤„ì–´ë“­ë‹ˆë‹¤
2. <strong>ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”ê°</strong>: ì‹¤ì œ ëŒ€í™”ì²˜ëŸ¼ ëŠê»´ì§‘ë‹ˆë‹¤
3. <strong>íƒ€ì„ì•„ì›ƒ ë°©ì§€</strong>: ê¸´ ì‘ë‹µë„ ì—°ê²°ì´ ëŠê¸°ì§€ ì•ŠìŠµë‹ˆë‹¤
4. <strong>ì¡°ê¸° ì¤‘ë‹¨ ê°€ëŠ¥</strong>: ì›í•˜ì§€ ì•ŠëŠ” ì‘ë‹µì€ ì¤‘ê°„ì— ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
<h3 id="132-flux">1.3.2 Flux ê¸°ë°˜ ìŠ¤íŠ¸ë¦¬ë°</h3>
<p>Spring AIì—ì„œ ìŠ¤íŠ¸ë¦¬ë°ì€ Reactorì˜ <code>Flux</code>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">reactor.core.publisher.Flux</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">StreamingChatService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// í…ìŠ¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">streamChat</span><span class="p">(</span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">          </span><span class="c1">// call() ëŒ€ì‹  stream() ì‚¬ìš©!</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span><span class="w">         </span><span class="c1">// Flux&lt;String&gt; ë°˜í™˜</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ChatResponse ìŠ¤íŠ¸ë¦¬ë° (ë©”íƒ€ë°ì´í„° í¬í•¨)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">streamChatWithMetadata</span><span class="p">(</span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">ChatResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">chatResponse</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="133-server-sent-events-sse">1.3.3 Server-Sent Events (SSE)</h3>
<p>ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ìŠ¤íŠ¸ë¦¬ë°ì„ ë°›ìœ¼ë ¤ë©´ SSEë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// controller/StreamingController.kt</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.http.MediaType</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.http.codec.ServerSentEvent</span>
<span class="k">import</span><span class="w"> </span><span class="nn">reactor.core.publisher.Flux</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/stream&quot;</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">StreamingController</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">streamingService</span><span class="p">:</span><span class="w"> </span><span class="n">StreamingChatService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// ê¸°ë³¸ SSE ìŠ¤íŠ¸ë¦¬ë°</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">MediaType</span><span class="p">.</span><span class="na">TEXT_EVENT_STREAM_VALUE</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">streamChat</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">streamingService</span><span class="p">.</span><span class="na">streamChat</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ServerSentEvent ê°ì²´ë¡œ ê°ì‹¸ì„œ ë” ë§ì€ ì •ë³´ ì „ë‹¬</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/sse&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">MediaType</span><span class="p">.</span><span class="na">TEXT_EVENT_STREAM_VALUE</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">streamChatSSE</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">ServerSentEvent</span><span class="o">&lt;</span><span class="n">StreamChunk</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">tokenCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">streamingService</span><span class="p">.</span><span class="na">streamChat</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">tokenCount</span><span class="o">++</span>
<span class="w">                </span><span class="n">ServerSentEvent</span><span class="p">.</span><span class="na">builder</span><span class="o">&lt;</span><span class="n">StreamChunk</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">event</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">data</span><span class="p">(</span><span class="n">StreamChunk</span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">tokenCount</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">concatWith</span><span class="p">(</span>
<span class="w">                </span><span class="n">Flux</span><span class="p">.</span><span class="na">just</span><span class="p">(</span>
<span class="w">                    </span><span class="n">ServerSentEvent</span><span class="p">.</span><span class="na">builder</span><span class="o">&lt;</span><span class="n">StreamChunk</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">event</span><span class="p">(</span><span class="s">&quot;complete&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">data</span><span class="p">(</span><span class="n">StreamChunk</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tokenCount</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">StreamChunk</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tokenCount</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">done</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="sse-javascript">í”„ë¡ íŠ¸ì—”ë“œì—ì„œ SSE ë°›ê¸° (JavaScript)</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// ê¸°ë³¸ì ì¸ EventSource ì‚¬ìš©</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">startChat</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">eventSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">EventSource</span><span class="p">(</span>
<span class="w">        </span><span class="sb">`/api/stream/sse?message=</span><span class="si">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">responseDiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">fullResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ë©”ì‹œì§€ ì´ë²¤íŠ¸ ì²˜ë¦¬</span>
<span class="w">    </span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">fullResponse</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
<span class="w">        </span><span class="nx">responseDiv</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fullResponse</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// ì™„ë£Œ ì´ë²¤íŠ¸ ì²˜ë¦¬</span>
<span class="w">    </span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ì™„ë£Œ! ì´ </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">tokenCount</span><span class="si">}</span><span class="sb">ê°œ ì²­í¬ ìˆ˜ì‹ `</span><span class="p">);</span>
<span class="w">        </span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// ì—ëŸ¬ ì²˜ë¦¬</span>
<span class="w">    </span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;SSE ì—°ê²° ì˜¤ë¥˜&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="134">1.3.4 íƒ€ì„ì•„ì›ƒ ë° ì—ëŸ¬ ì²˜ë¦¬</h3>
<p>ìŠ¤íŠ¸ë¦¬ë°ì—ì„œë„ ì—ëŸ¬ ì²˜ë¦¬ëŠ” ì¤‘ìš”í•©ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">java.time.Duration</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.util.concurrent.TimeoutException</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">RobustStreamingService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">streamWithTimeout</span><span class="p">(</span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">            </span><span class="c1">// 30ì´ˆ íƒ€ì„ì•„ì›ƒ</span>
<span class="w">            </span><span class="p">.</span><span class="na">timeout</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofSeconds</span><span class="p">(</span><span class="m">30</span><span class="p">))</span>
<span class="w">            </span><span class="c1">// íƒ€ì„ì•„ì›ƒ ë°œìƒ ì‹œ ëŒ€ì²´ ë©”ì‹œì§€</span>
<span class="w">            </span><span class="p">.</span><span class="na">onErrorResume</span><span class="p">(</span><span class="n">TimeoutException</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">Flux</span><span class="p">.</span><span class="na">just</span><span class="p">(</span><span class="s">&quot;[ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤]&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// ê¸°íƒ€ ì—ëŸ¬ ì²˜ë¦¬</span>
<span class="w">            </span><span class="p">.</span><span class="na">onErrorResume</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">Flux</span><span class="p">.</span><span class="na">just</span><span class="p">(</span><span class="s">&quot;[ì˜¤ë¥˜ ë°œìƒ: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">]&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// ì™„ë£Œ ë° ì·¨ì†Œ ë¡œê¹…</span>
<span class="w">            </span><span class="p">.</span><span class="na">doOnComplete</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">doOnCancel</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ìŠ¤íŠ¸ë¦¬ë° ì·¨ì†Œë¨&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="135">1.3.5 ì‹¤ìŠµ: ì‹¤ì‹œê°„ íƒ€ì´í•‘ íš¨ê³¼ ì±—ë´‡</h3>
<p>ì‹¤ì œ ChatGPTì²˜ëŸ¼ ë™ì‘í•˜ëŠ” ì›¹ ì±—ë´‡ì„ ë§Œë“¤ì–´ë´…ì‹œë‹¤!</p>
<h4 id="kotlin">ë°±ì—”ë“œ (Kotlin)</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// controller/RealtimeChatController.kt</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/realtime&quot;</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">RealtimeChatController</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultSystem</span><span class="p">(</span><span class="s">&quot;ì¹œì ˆí•˜ê³  ìì„¸í•˜ê²Œ ë‹µë³€í•˜ëŠ” AI ë¹„ì„œì…ë‹ˆë‹¤.&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/chat&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">MediaType</span><span class="p">.</span><span class="na">TEXT_EVENT_STREAM_VALUE</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">realtimeChat</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">sessionId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">ServerSentEvent</span><span class="o">&lt;</span><span class="n">ChatChunk</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">chunkCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">chunkCount</span><span class="o">++</span>
<span class="w">                </span><span class="n">ServerSentEvent</span><span class="p">.</span><span class="na">builder</span><span class="o">&lt;</span><span class="n">ChatChunk</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">event</span><span class="p">(</span><span class="s">&quot;chunk&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">data</span><span class="p">(</span><span class="n">ChatChunk</span><span class="p">(</span>
<span class="w">                        </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">content</span><span class="p">,</span>
<span class="w">                        </span><span class="n">chunkIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chunkCount</span><span class="p">,</span>
<span class="w">                        </span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">                    </span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">concatWith</span><span class="p">(</span><span class="n">Flux</span><span class="p">.</span><span class="na">defer</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span>
<span class="w">                </span><span class="n">Flux</span><span class="p">.</span><span class="na">just</span><span class="p">(</span>
<span class="w">                    </span><span class="n">ServerSentEvent</span><span class="p">.</span><span class="na">builder</span><span class="o">&lt;</span><span class="n">ChatChunk</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">event</span><span class="p">(</span><span class="s">&quot;done&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">data</span><span class="p">(</span><span class="n">ChatChunk</span><span class="p">(</span>
<span class="w">                            </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">chunkIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chunkCount</span><span class="p">,</span>
<span class="w">                            </span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                            </span><span class="n">totalChunks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chunkCount</span><span class="p">,</span>
<span class="w">                            </span><span class="n">durationMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duration</span>
<span class="w">                        </span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="na">onErrorResume</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">Flux</span><span class="p">.</span><span class="na">just</span><span class="p">(</span>
<span class="w">                    </span><span class="n">ServerSentEvent</span><span class="p">.</span><span class="na">builder</span><span class="o">&lt;</span><span class="n">ChatChunk</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">event</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">data</span><span class="p">(</span><span class="n">ChatChunk</span><span class="p">(</span>
<span class="w">                            </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì˜¤ë¥˜: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">chunkIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span>
<span class="w">                            </span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                            </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                        </span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ChatChunk</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">chunkIndex</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">done</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">totalChunks</span><span class="p">:</span><span class="w"> </span><span class="kt">Int?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">durationMs</span><span class="p">:</span><span class="w"> </span><span class="kt">Long?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="html-javascript">í”„ë¡ íŠ¸ì—”ë“œ (HTML + JavaScript)</h4>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;ko&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Spring AI ì‹¤ì‹œê°„ ì±—ë´‡<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">        </span><span class="o">*</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">box-sizing</span><span class="p">:</span><span class="w"> </span><span class="kc">border-box</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="n">apple-system</span><span class="p">,</span><span class="w"> </span><span class="n">BlinkMacSystemFont</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Segoe UI&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<span class="w">            </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">            </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#f5f5f5</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">.</span><span class="nc">chat-container</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">            </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">box-shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">.</span><span class="nc">input-area</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">            </span><span class="k">gap</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">#</span><span class="nn">messageInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">flex</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="w"> </span><span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="mh">#ddd</span><span class="p">;</span>
<span class="w">            </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nt">button</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="w"> </span><span class="mi">24</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">            </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
<span class="w">            </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="kc">all</span><span class="w"> </span><span class="mf">0.2</span><span class="kt">s</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">#</span><span class="nn">sendBtn</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#007AFF</span><span class="p">;</span>
<span class="w">            </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">#</span><span class="nn">sendBtn</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#0056b3</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">#</span><span class="nn">sendBtn</span><span class="p">:</span><span class="nd">disabled</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#ccc</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">#</span><span class="nn">stopBtn</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#FF3B30</span><span class="p">;</span>
<span class="w">            </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">#</span><span class="nn">stopBtn</span><span class="p">:</span><span class="nd">disabled</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#ccc</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">.</span><span class="nc">response-area</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">min-height</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#f9f9f9</span><span class="p">;</span>
<span class="w">            </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">white-space</span><span class="p">:</span><span class="w"> </span><span class="kc">pre-wrap</span><span class="p">;</span>
<span class="w">            </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">line-height</span><span class="p">:</span><span class="w"> </span><span class="mf">1.6</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">.</span><span class="nc">typing-indicator</span><span class="p">::</span><span class="nd">after</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">content</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;â–Œ&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="k">animation</span><span class="p">:</span><span class="w"> </span><span class="kc">blink</span><span class="w"> </span><span class="mi">1</span><span class="kt">s</span><span class="w"> </span><span class="kc">infinite</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">@</span><span class="k">keyframes</span><span class="w"> </span><span class="nt">blink</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">50</span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">opacity</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">.</span><span class="nc">status</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#666</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;chat-container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>ğŸ¤– Spring AI ì±—ë´‡<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;input-area&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;messageInput&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...&quot;</span>
                   <span class="na">onkeypress</span><span class="o">=</span><span class="s">&quot;if(event.key===&#39;Enter&#39;) sendMessage()&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;sendBtn&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;sendMessage()&quot;</span><span class="p">&gt;</span>ì „ì†¡<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;stopBtn&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;stopStream()&quot;</span> <span class="na">disabled</span><span class="p">&gt;</span>ì¤‘ë‹¨<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;response&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;response-area&quot;</span><span class="p">&gt;</span>
            AIì˜ ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;status&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;status&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">eventSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">fullResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="w">        </span><span class="kd">function</span><span class="w"> </span><span class="nx">sendMessage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;messageInput&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">responseDiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">statusDiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// UI ì´ˆê¸°í™”</span>
<span class="w">            </span><span class="nx">responseDiv</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="nx">responseDiv</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;typing-indicator&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">fullResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// ë²„íŠ¼ ìƒíƒœ ë³€ê²½</span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;sendBtn&#39;</span><span class="p">).</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;stopBtn&#39;</span><span class="p">).</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">            </span><span class="nx">statusDiv</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ì‘ë‹µ ìƒì„± ì¤‘...&#39;</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// SSE ì—°ê²°</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">encodedMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="w">            </span><span class="nx">eventSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">EventSource</span><span class="p">(</span><span class="sb">`/api/realtime/chat?message=</span><span class="si">${</span><span class="nx">encodedMessage</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">            </span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;chunk&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">                </span><span class="nx">fullResponse</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
<span class="w">                </span><span class="nx">responseDiv</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fullResponse</span><span class="p">;</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">                </span><span class="nx">responseDiv</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;typing-indicator&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="nx">statusDiv</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span>
<span class="w">                    </span><span class="sb">`ì™„ë£Œ! </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">totalChunks</span><span class="si">}</span><span class="sb">ê°œ ì²­í¬, </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">durationMs</span><span class="si">}</span><span class="sb">ms ì†Œìš”`</span><span class="p">;</span>
<span class="w">                </span><span class="nx">cleanup</span><span class="p">();</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{};</span>
<span class="w">                </span><span class="nx">responseDiv</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;typing-indicator&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="nx">responseDiv</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`\n\nâš ï¸ </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">content</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;ì—°ê²° ì˜¤ë¥˜&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">                </span><span class="nx">statusDiv</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ì˜¤ë¥˜ ë°œìƒ&#39;</span><span class="p">;</span>
<span class="w">                </span><span class="nx">cleanup</span><span class="p">();</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">EventSource</span><span class="p">.</span><span class="nx">CLOSED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">cleanup</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">function</span><span class="w"> </span><span class="nx">stopStream</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">eventSource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">                </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">).</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;typing-indicator&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">).</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ì‚¬ìš©ìê°€ ì¤‘ë‹¨í•¨&#39;</span><span class="p">;</span>
<span class="w">                </span><span class="nx">cleanup</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">function</span><span class="w"> </span><span class="nx">cleanup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">eventSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;sendBtn&#39;</span><span class="p">).</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;stopBtn&#39;</span><span class="p">).</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;messageInput&#39;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;messageInput&#39;</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>ì´ HTML íŒŒì¼ì„ <code>src/main/resources/static/index.html</code>ì— ì €ì¥í•˜ê³  ì„œë²„ë¥¼ ì‹¤í–‰í•œ í›„ <code>http://localhost:8080</code>ì— ì ‘ì†í•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì‘ë‹µì´ íƒ€ì´í•‘ë˜ëŠ” ì±—ë´‡ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
<hr />
<h2 id="part-1">Part 1 ìš”ì•½</h2>
<h3 id="_17">ì´ íŒŒíŠ¸ì—ì„œ ë°°ìš´ ê²ƒ</h3>
<h4 id="ai">ì¶”ìƒí™”ë¥¼ í†µí•œ AI í†µí•©ì˜ ë‹¨ìˆœí™”</h4>
<p>Spring AIëŠ” ë‹¤ì–‘í•œ AI ì œê³µì(OpenAI, Anthropic, Ollama ë“±)ë¥¼ ë‹¨ì¼ ì¸í„°í˜ì´ìŠ¤ë¡œ ì¶”ìƒí™”í•©ë‹ˆë‹¤. ì´ ì„¤ê³„ ì² í•™ì€ Springì˜ í•µì‹¬ ì›ì¹™ì¸ <strong>"ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ í”„ë¡œê·¸ë˜ë°"</strong>ì„ AI ì˜ì—­ì— ì ìš©í•œ ê²ƒì…ë‹ˆë‹¤. ê°œë°œìëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì§‘ì¤‘í•˜ê³ , AI ì œê³µì ë³€ê²½ì€ ì„¤ì • íŒŒì¼ ìˆ˜ì •ë§Œìœ¼ë¡œ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.</p>
<h4 id="chatclient-ai">ChatClient: ì„ ì–¸ì  AI ìƒí˜¸ì‘ìš©</h4>
<p>ChatClientëŠ” Spring WebClientì˜ ì„¤ê³„ íŒ¨í„´ì„ ê³„ìŠ¹í•˜ì—¬ <strong>ë¹Œë” íŒ¨í„´ ê¸°ë°˜ì˜ Fluent API</strong>ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í”„ë¡¬í”„íŠ¸ êµ¬ì„±, API í˜¸ì¶œ, ì‘ë‹µ ì²˜ë¦¬ë¥¼ ì²´ì´ë‹ ë°©ì‹ìœ¼ë¡œ ì§ê´€ì ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë©”ì‹œì§€ ì—­í• (System, User, Assistant)ì„ í™œìš©í•œ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ëŠ” AIì˜ í–‰ë™ì„ ì œì–´í•˜ê³  ì¼ê´€ëœ ì‘ë‹µì„ ìœ ë„í•˜ëŠ” í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.</p>
<h4 id="_18">ë¦¬ì•¡í‹°ë¸Œ ìŠ¤íŠ¸ë¦¬ë°ê³¼ ì‚¬ìš©ì ê²½í—˜</h4>
<p>ë™ê¸° ë°©ì‹(<code>call()</code>)ê³¼ ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹(<code>stream()</code>)ì˜ ì„ íƒì€ ë‹¨ìˆœí•œ ê¸°ìˆ ì  ê²°ì •ì´ ì•„ë‹ˆë¼ <strong>ì‚¬ìš©ì ê²½í—˜ ì„¤ê³„</strong>ì˜ ë¬¸ì œì…ë‹ˆë‹¤. Project Reactorì˜ Fluxë¥¼ í™œìš©í•œ ìŠ¤íŠ¸ë¦¬ë°ì€ ì²« í† í° ì‘ë‹µ ì‹œê°„(TTFT, Time To First Token)ì„ ìµœì†Œí™”í•˜ì—¬ ì²´ê° ì§€ì—°ì„ ì¤„ì…ë‹ˆë‹¤. SSE(Server-Sent Events)ì™€ WebSocketì€ ê°ê° ë‹¨ë°©í–¥/ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹ ì˜ í‘œì¤€ êµ¬í˜„ì²´ë¡œ, ì• í”Œë¦¬ì¼€ì´ì…˜ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ì ì ˆíˆ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.</p>
<h3 id="_19">í•µì‹¬ ê°œë… ì •ë¦¬</h3>
<table>
<thead>
<tr>
<th>ê°œë…</th>
<th>ì„¤ëª…</th>
<th>í•µì‹¬ ì½”ë“œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ChatClient</strong></td>
<td>AI ëª¨ë¸ê³¼ ìƒí˜¸ì‘ìš©í•˜ëŠ” ê³ ìˆ˜ì¤€ API. Springì˜ ë¹Œë” íŒ¨í„´ì„ ë”°ë¥´ë©°, ë³µì¡í•œ AI í†µì‹ ì„ ê°„ë‹¨í•˜ê²Œ ì¶”ìƒí™”í•©ë‹ˆë‹¤.</td>
<td><code>chatClient.prompt().user(msg).call().content()</code></td>
</tr>
<tr>
<td><strong>Prompt</strong></td>
<td>AIì—ê²Œ ì „ë‹¬í•˜ëŠ” ë©”ì‹œì§€ êµ¬ì¡°. System(ì—­í•  ì •ì˜), User(ì‚¬ìš©ì ì…ë ¥), Assistant(AI ì‘ë‹µ) ì„¸ ê°€ì§€ ì—­í• ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.</td>
<td><code>.system("ì—­í• ").user("ì§ˆë¬¸")</code></td>
</tr>
<tr>
<td><strong>call()</strong></td>
<td>ë™ê¸° ë°©ì‹ í˜¸ì¶œ. ì „ì²´ ì‘ë‹µì´ ì™„ë£Œë  ë•Œê¹Œì§€ ë¸”ë¡œí‚¹ë©ë‹ˆë‹¤. ê°„ë‹¨í•œ ìš”ì²­ì´ë‚˜ ë°°ì¹˜ ì²˜ë¦¬ì— ì í•©í•©ë‹ˆë‹¤.</td>
<td><code>.call().content()</code></td>
</tr>
<tr>
<td><strong>stream()</strong></td>
<td>ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹. Project Reactorì˜ Fluxë¥¼ ë°˜í™˜í•˜ë©°, ì‘ë‹µì´ ìƒì„±ë˜ëŠ” ì¦‰ì‹œ ì „ë‹¬ë©ë‹ˆë‹¤.</td>
<td><code>.stream().content()</code></td>
</tr>
</tbody>
</table>
<h3 id="_20">ì‹¤ì „ í™œìš© íŒ</h3>
<h4 id="chatclient_1">ChatClient ì‚¬ìš© ì‹œ</h4>
<ul>
<li><strong>System ë©”ì‹œì§€ëŠ” í•œ ë²ˆë§Œ</strong>: ëŒ€í™” ì‹œì‘ ì‹œ AIì˜ ì—­í• ì„ ì •ì˜í•˜ê³ , ì´í›„ ëŒ€í™”ì—ì„œëŠ” ë³€ê²½í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤</li>
<li><strong>ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬</strong>: ëŒ€í™” ì´ë ¥ì´ ê¸¸ì–´ì§€ë©´ í† í° ë¹„ìš©ì´ ì¦ê°€í•©ë‹ˆë‹¤. í•„ìš”í•œ ì´ë ¥ë§Œ ìœ ì§€í•˜ì„¸ìš”</li>
<li><strong>ì—ëŸ¬ ì²˜ë¦¬</strong>: API í˜¸ì¶œ ì‹¤íŒ¨ì— ëŒ€ë¹„í•´ ì ì ˆí•œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ êµ¬í˜„í•˜ì„¸ìš”</li>
</ul>
<h4 id="streaming">Streaming ì‚¬ìš© ì‹œ</h4>
<ul>
<li><strong>SSE vs WebSocket</strong>: ë‹¨ë°©í–¥ ì‹¤ì‹œê°„ ì „ì†¡ì—ëŠ” SSEê°€ ì í•©í•˜ê³ , ì–‘ë°©í–¥ í†µì‹ ì´ í•„ìš”í•˜ë©´ WebSocketì„ ì„ íƒí•˜ì„¸ìš”</li>
<li><strong>íƒ€ì„ì•„ì›ƒ ì„¤ì •</strong>: ê¸´ ì‘ë‹µì— ëŒ€ë¹„í•´ ì¶©ë¶„í•œ íƒ€ì„ì•„ì›ƒì„ ì„¤ì •í•˜ì„¸ìš”</li>
<li><strong>ì—°ê²° ê´€ë¦¬</strong>: í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ì´ ëŠì–´ì¡Œì„ ë•Œ ë¦¬ì†ŒìŠ¤ê°€ ì •ë¦¬ë˜ë„ë¡ êµ¬í˜„í•˜ì„¸ìš”</li>
</ul>
<h3 id="_21">ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜</h3>
<table>
<thead>
<tr>
<th>ì‹¤ìˆ˜</th>
<th>ë¬¸ì œì </th>
<th>í•´ê²° ë°©ë²•</th>
</tr>
</thead>
<tbody>
<tr>
<td>API í‚¤ í•˜ë“œì½”ë”©</td>
<td>ë³´ì•ˆ ìœ„í—˜, í‚¤ ìœ ì¶œ ê°€ëŠ¥ì„±</td>
<td>í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” Spring Config ì‚¬ìš©</td>
</tr>
<tr>
<td>ëŒ€í™” ì´ë ¥ ë¬´í•œ ì¦ê°€</td>
<td>í† í° í•œë„ ì´ˆê³¼, ë¹„ìš© ì¦ê°€</td>
<td>ìµœê·¼ Nê°œ ë©”ì‹œì§€ë§Œ ìœ ì§€</td>
</tr>
<tr>
<td>ë™ê¸° í˜¸ì¶œë¡œ ê¸´ ì‘ë‹µ ì²˜ë¦¬</td>
<td>UX ì €í•˜, ì‚¬ìš©ì ì´íƒˆ</td>
<td>Streaming ë°©ì‹ ì‚¬ìš©</td>
</tr>
<tr>
<td>System ë©”ì‹œì§€ ëˆ„ë½</td>
<td>AI ì‘ë‹µ í’ˆì§ˆ ì €í•˜</td>
<td>ì—­í• ê³¼ ì œì•½ì‚¬í•­ ëª…í™•íˆ ì •ì˜</td>
</tr>
</tbody>
</table>
<h3 id="_22">í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
<ul>
<li>[ ] Spring AI í”„ë¡œì íŠ¸ ìƒì„± ë° ì˜ì¡´ì„± ì„¤ì •</li>
<li>[ ] API í‚¤ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •</li>
<li>[ ] ChatClient ê¸°ë³¸ ì‚¬ìš©ë²• ì´í•´</li>
<li>[ ] ë©”ì‹œì§€ ì—­í•  (System, User, Assistant) í™œìš©</li>
<li>[ ] ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ìœ ì§€ êµ¬í˜„</li>
<li>[ ] Streaming ì‘ë‹µ ì²˜ë¦¬</li>
<li>[ ] SSE ê¸°ë°˜ ì‹¤ì‹œê°„ ì±„íŒ… êµ¬í˜„</li>
</ul>
<h3 id="_23">ë‹¤ìŒ ë‹¨ê³„</h3>
<p>Part 1ì—ì„œ ChatClientì˜ ê¸°ë³¸ ì‚¬ìš©ë²•ì„ ìµí˜”ë‹¤ë©´, ì´ì œ AIì˜ ì‘ë‹µ í’ˆì§ˆì„ ë†’ì¼ ì°¨ë¡€ì…ë‹ˆë‹¤.</p>
<p><strong>Part 2: í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§</strong>ì—ì„œ ë°°ìš¸ ë‚´ìš©:</p>
<table>
<thead>
<tr>
<th>ì£¼ì œ</th>
<th>ì„¤ëª…</th>
<th>í™œìš© ì˜ˆì‹œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</strong></td>
<td>ë³€ìˆ˜ë¥¼ í¬í•¨í•œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í”„ë¡¬í”„íŠ¸ ì‘ì„±</td>
<td>ë‹¤êµ­ì–´ ë²ˆì—­, í¬ë§· ë³€í™˜</td>
</tr>
<tr>
<td><strong>Structured Output</strong></td>
<td>AI ì‘ë‹µì„ Java/Kotlin ê°ì²´ë¡œ ì§ì ‘ ë§¤í•‘</td>
<td>JSON API ì‘ë‹µ, ë°ì´í„° ì¶”ì¶œ</td>
</tr>
<tr>
<td><strong>Few-shot Learning</strong></td>
<td>ì˜ˆì‹œë¥¼ í†µí•´ AIì—ê²Œ ì›í•˜ëŠ” í˜•ì‹ í•™ìŠµì‹œí‚¤ê¸°</td>
<td>ì¼ê´€ëœ ì‘ë‹µ í˜•ì‹ ìœ ì§€</td>
</tr>
<tr>
<td><strong>Chain-of-Thought</strong></td>
<td>AIê°€ ë‹¨ê³„ë³„ë¡œ ì¶”ë¡ í•˜ë„ë¡ ìœ ë„</td>
<td>ë³µì¡í•œ ë¬¸ì œ í•´ê²°, ìˆ˜í•™ ê³„ì‚°</td>
</tr>
</tbody>
</table>
<p>Part 1ì—ì„œ ë‹¤ì§„ ê¸°ì´ˆ ìœ„ì— í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ê¸°ë²•ì„ ë”í•˜ë©´, AI ì‘ë‹µì˜ ì •í™•ë„ì™€ ì¼ê´€ì„±ì„ í¬ê²Œ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
<hr />
<h2 id="_24">ì°¸ê³  ì˜ˆì œ ì½”ë“œ</h2>
<p>ì´ ì¥ì˜ ê°œë…ë“¤ì„ ì‹¤ì œë¡œ êµ¬í˜„í•œ ì˜ˆì œ ì½”ë“œ:</p>
<div class="codehilite"><pre><span></span><code>spring-ai-examples/
â”œâ”€â”€ kotlin/kotlin-hello-world          â†’ ChatClient ê¸°ë³¸ ì‚¬ìš©
â”œâ”€â”€ models/chat/helloworld             â†’ Java ë²„ì „ ê¸°ë³¸ ì˜ˆì œ
â””â”€â”€ misc/openai-streaming-response     â†’ Streaming ì‘ë‹µ ì²˜ë¦¬
</code></pre></div>

<p>ê° ì˜ˆì œë¥¼ ì§ì ‘ ì‹¤í–‰í•´ë³´ë©° í•™ìŠµí•œ ë‚´ìš©ì„ í™•ì¸í•´ë³´ì„¸ìš”!</p></div>
<div class="chapter" id="part2-prompt-engineering.md"><h1 id="part-2-prompt-engineering">Part 2: í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ (Prompt Engineering)</h1>
<blockquote>
<p>íš¨ê³¼ì ì¸ AI í™œìš©ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ ì„¤ê³„ ê¸°ìˆ </p>
</blockquote>
<p><strong>í•™ìŠµ ê¸°ê°„:</strong> 2ì£¼
<strong>ë‚œì´ë„:</strong> ì´ˆê¸‰ ~ ì¤‘ê¸‰
<strong>ì‚¬ì „ ìš”êµ¬ì‚¬í•­:</strong> Part 1 ì™„ë£Œ</p>
<hr />
<h2 id="_1">ë“¤ì–´ê°€ë©°</h2>
<p>"AIì—ê²Œ ì–´ë–»ê²Œ ë¬¼ì–´ë³´ëŠëƒì— ë”°ë¼ ë‹µì´ ì™„ì „íˆ ë‹¬ë¼ì§‘ë‹ˆë‹¤."</p>
<p>ì´ ë§ì´ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ê°™ì€ AI ëª¨ë¸ì´ë¼ë„ ì§ˆë¬¸í•˜ëŠ” ë°©ë²•ì— ë”°ë¼ í‰ë²”í•œ ë‹µë³€ì„ ë°›ì„ ìˆ˜ë„ ìˆê³ , ì „ë¬¸ê°€ ìˆ˜ì¤€ì˜ í†µì°°ì„ ì–»ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>
<p>ì´ ì¥ì—ì„œëŠ” AIì˜ ì ì¬ë ¥ì„ ìµœëŒ€í•œ ëŒì–´ë‚´ëŠ” í”„ë¡¬í”„íŠ¸ ê¸°ë²•ë“¤ì„ ë°°ì›Œë´…ë‹ˆë‹¤. í…œí”Œë¦¿ í™œìš©ë¶€í„° êµ¬ì¡°í™”ëœ ì¶œë ¥, ê³ ê¸‰ ì¶”ë¡  ê¸°ë²•ê¹Œì§€ - ì—¬ëŸ¬ë¶„ì˜ AI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í•œ ë‹¨ê³„ ì—…ê·¸ë ˆì´ë“œí•  ì¤€ë¹„ë¥¼ í•´ë´…ì‹œë‹¤!</p>
<p><img alt="Prompt Engineering Patterns" src="file:///Users/robin/Downloads/spring-ai-examples/book/images/prompt-engineering-patterns.png" /></p>
<hr />
<h2 id="module-21">Module 2.1: í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ê³¼ ë³€ìˆ˜</h2>
<h3 id="211-prompttemplate">2.1.1 PromptTemplate ê°œìš”</h3>
<h4 id="_2">ì™œ í…œí”Œë¦¿ì´ í•„ìš”í• ê¹Œ?</h4>
<p>í”„ë¡¬í”„íŠ¸ë¥¼ ë¬¸ìì—´ë¡œ ì§ì ‘ ì‘ì„±í•˜ë©´ ì´ëŸ° ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// âŒ ì•ˆ ì¢‹ì€ ì˜ˆ: í•˜ë“œì½”ë”©ëœ í”„ë¡¬í”„íŠ¸</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">translate</span><span class="p">(</span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">language</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Translate &#39;</span><span class="si">$</span><span class="n">text</span><span class="s">&#39; to </span><span class="si">$</span><span class="n">language</span><span class="s">&quot;</span><span class="w">  </span><span class="c1">// SQL Injectionê³¼ ë¹„ìŠ·í•œ ìœ„í—˜!</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">().</span><span class="na">user</span><span class="p">(</span><span class="n">prompt</span><span class="p">).</span><span class="na">call</span><span class="p">().</span><span class="na">content</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>ë¬¸ì œì :</strong>
- ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µìŠµë‹ˆë‹¤
- í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤
- ë‹¤êµ­ì–´ ì§€ì›ì´ ë³µì¡í•´ì§‘ë‹ˆë‹¤
- ë³´ì•ˆ ìœ„í—˜ (í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜)</p>
<p><strong>PromptTemplateì˜ í•´ê²°ì±…:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// âœ… ì¢‹ì€ ì˜ˆ: í…œí”Œë¦¿ ì‚¬ìš©</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PromptTemplate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    You are a professional translator.</span>
<span class="s">    Translate the following text to {language}:</span>

<span class="s">    Text: {text}</span>

<span class="s">    Translation:</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">template</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;language&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;Korean&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;Hello, World!&quot;</span>
<span class="p">))</span>
</code></pre></div>

<h3 id="212">2.1.2 ê¸°ë³¸ ë³€ìˆ˜ ë°”ì¸ë”©</h3>
<h4 id="map">Map ê¸°ë°˜ ë°”ì¸ë”©</h4>
<p>ê°€ì¥ ê¸°ë³¸ì ì¸ ë°©ë²•ì…ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ai.chat.prompt.PromptTemplate</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">TranslatorService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">translate</span><span class="p">(</span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">targetLanguage</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// í…œí”Œë¦¿ ì •ì˜</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PromptTemplate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            You are an expert translator specializing in natural, fluent translations.</span>

<span class="s">            Translate the following text to {targetLanguage}.</span>
<span class="s">            Maintain the original tone, style, and meaning.</span>

<span class="s">            Original text:</span>
<span class="s">            {text}</span>

<span class="s">            Translation:</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>

<span class="w">        </span><span class="c1">// ë³€ìˆ˜ ë°”ì¸ë”©</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;targetLanguage&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">targetLanguage</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">text</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="c1">// í”„ë¡¬í”„íŠ¸ ìƒì„± ë° í˜¸ì¶œ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">template</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">(</span><span class="n">prompt</span><span class="p">).</span><span class="na">call</span><span class="p">().</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="_3">ë³µì¡í•œ ë°ì´í„° ë°”ì¸ë”©</h4>
<p>ë¦¬ìŠ¤íŠ¸ë‚˜ ë³µì¡í•œ ê°ì²´ë„ ë°”ì¸ë”©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ProductInfo</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">features</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">targetAudience</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">maxWords</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ProductDescriptionService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateDescription</span><span class="p">(</span><span class="n">product</span><span class="p">:</span><span class="w"> </span><span class="n">ProductInfo</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PromptTemplate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            Write a compelling product description for {name}.</span>

<span class="s">            Key Features:</span>
<span class="s">            {features}</span>

<span class="s">            Target Audience: {targetAudience}</span>
<span class="s">            Maximum Length: {maxWords} words</span>

<span class="s">            The description should be engaging, highlight benefits,</span>
<span class="s">            and speak directly to the target audience.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;name&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;features&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">features</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;- </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;targetAudience&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">targetAudience</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;maxWords&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">maxWords</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">(</span><span class="n">template</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ì‚¬ìš© ì˜ˆ</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProductInfo</span><span class="p">(</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Galaxy S24 Ultra&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;AI ê¸°ë°˜ ì‚¬ì§„ í¸ì§‘&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;Síœ ë‚´ì¥&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;í‹°íƒ€ëŠ„ í”„ë ˆì„&quot;</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="n">targetAudience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ê¸°ìˆ ì„ ì‚¬ë‘í•˜ëŠ” í”„ë¡œí˜ì…”ë„&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">maxWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">150</span>
<span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">generateDescription</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
</code></pre></div>

<h3 id="213">2.1.3 ì™¸ë¶€ íŒŒì¼ ê¸°ë°˜ í…œí”Œë¦¿</h3>
<p>í”„ë¡¬í”„íŠ¸ê°€ ê¸¸ì–´ì§€ë©´ ì½”ë“œì—ì„œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>
<h4 id="_4">í”„ë¡œì íŠ¸ êµ¬ì¡°</h4>
<div class="codehilite"><pre><span></span><code>src/main/resources/
â””â”€â”€ prompts/
    â”œâ”€â”€ system/
    â”‚   â”œâ”€â”€ translator.st
    â”‚   â”œâ”€â”€ summarizer.st
    â”‚   â””â”€â”€ analyzer.st
    â””â”€â”€ user/
        â”œâ”€â”€ translate-request.st
        â””â”€â”€ analyze-request.st
</code></pre></div>

<h4 id="stringtemplate">StringTemplate íŒŒì¼ ì‘ì„±</h4>
<div class="codehilite"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="n">prompts</span><span class="o">/</span><span class="k">system</span><span class="o">/</span><span class="n">translator</span><span class="p">.</span><span class="n">st</span>
<span class="n">You</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">professional</span><span class="w"> </span><span class="n">translator</span><span class="w"> </span><span class="n">specializing</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="err">{</span><span class="k">domain</span><span class="err">}</span><span class="w"> </span><span class="n">content</span><span class="p">.</span>

<span class="n">Your</span><span class="w"> </span><span class="n">expertise</span><span class="w"> </span><span class="nl">includes</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="err">{</span><span class="n">sourceLanguage</span><span class="err">}</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="err">{</span><span class="n">targetLanguage</span><span class="err">}</span><span class="w"> </span><span class="k">translation</span>
<span class="o">-</span><span class="w"> </span><span class="n">Maintaining</span><span class="w"> </span><span class="n">technical</span><span class="w"> </span><span class="n">accuracy</span>
<span class="o">-</span><span class="w"> </span><span class="n">Preserving</span><span class="w"> </span><span class="n">cultural</span><span class="w"> </span><span class="n">nuances</span>

<span class="nl">Guidelines</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="k">Translate</span><span class="w"> </span><span class="n">naturally</span><span class="p">,</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">word</span><span class="o">-</span><span class="k">by</span><span class="o">-</span><span class="n">word</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Keep</span><span class="w"> </span><span class="n">technical</span><span class="w"> </span><span class="n">terms</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">appropriate</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Maintain</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">original</span><span class="w"> </span><span class="n">formatting</span>
<span class="mf">4.</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">unsure</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">provide</span><span class="w"> </span><span class="n">alternatives</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">[</span><span class="n">brackets</span><span class="o">]</span>
</code></pre></div>

<h4 id="_5">ë¦¬ì†ŒìŠ¤ íŒŒì¼ ë¡œë”©</h4>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Value</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.core.io.Resource</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AdvancedTranslatorService</span><span class="p">(</span>
<span class="w">    </span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;classpath:/prompts/system/translator.st&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">translatorPromptResource</span><span class="p">:</span><span class="w"> </span><span class="n">Resource</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">translate</span><span class="p">(</span>
<span class="w">        </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">domain</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;general&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">sourceLanguage</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;English&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">targetLanguage</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Korean&quot;</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ë¦¬ì†ŒìŠ¤ì—ì„œ í…œí”Œë¦¿ ë¡œë“œ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PromptTemplate</span><span class="p">(</span><span class="n">translatorPromptResource</span><span class="p">)</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">systemPrompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">template</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;domain&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">domain</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;sourceLanguage&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">sourceLanguage</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;targetLanguage&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">targetLanguage</span>
<span class="w">        </span><span class="p">))</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="n">systemPrompt</span><span class="p">.</span><span class="na">contents</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;Translate this: </span><span class="si">$</span><span class="n">text</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="214">2.1.4 í”„ë¡¬í”„íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒ¨í„´</h3>
<p>ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ë‹¤ì–‘í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">PromptLibrary</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">templates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableMapOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">PromptTemplate</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@PostConstruct</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">initialize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ë²ˆì—­ê¸°</span>
<span class="w">        </span><span class="n">templates</span><span class="o">[</span><span class="s">&quot;translator&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PromptTemplate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            You are a {domain} translator.</span>
<span class="s">            Translate from {sourceLanguage} to {targetLanguage}.</span>

<span class="s">            Text: {text}</span>

<span class="s">            Translation:</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>

<span class="w">        </span><span class="c1">// ìš”ì•½ê¸°</span>
<span class="w">        </span><span class="n">templates</span><span class="o">[</span><span class="s">&quot;summarizer&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PromptTemplate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            Summarize the following text in {style} style.</span>
<span class="s">            Maximum {maxSentences} sentences.</span>

<span class="s">            Text: {text}</span>

<span class="s">            Summary:</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>

<span class="w">        </span><span class="c1">// ê°ì • ë¶„ì„ê¸°</span>
<span class="w">        </span><span class="n">templates</span><span class="o">[</span><span class="s">&quot;sentiment_analyzer&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PromptTemplate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            Analyze the sentiment of the following text.</span>

<span class="s">            Text: {text}</span>

<span class="s">            Provide:</span>
<span class="s">            1. Overall sentiment (positive/negative/neutral)</span>
<span class="s">            2. Confidence score (0-100)</span>
<span class="s">            3. Key emotional indicators</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>

<span class="w">        </span><span class="c1">// ì½”ë“œ ë¦¬ë·°ì–´</span>
<span class="w">        </span><span class="n">templates</span><span class="o">[</span><span class="s">&quot;code_reviewer&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PromptTemplate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            Review the following {language} code.</span>

<span class="s">            Focus on:</span>
<span class="s">            - Code quality and best practices</span>
<span class="s">            - Potential bugs or issues</span>
<span class="s">            - Performance considerations</span>
<span class="s">            - Security vulnerabilities</span>

<span class="s">            Code:</span>
<span class="s">            ```{language}</span>
<span class="s">            {code}</span>
<span class="s">            ```</span>

<span class="s">            Provide specific, actionable feedback.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getPrompt</span><span class="p">(</span><span class="n">templateName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">variables</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">Prompt</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">templates</span><span class="o">[</span><span class="n">templateName</span><span class="o">]</span>
<span class="w">            </span><span class="o">?:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Unknown template: </span><span class="si">$</span><span class="n">templateName</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Any íƒ€ì…ì„ Stringìœ¼ë¡œ ë³€í™˜</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">stringVariables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variables</span><span class="p">.</span><span class="na">mapValues</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">template</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">stringVariables</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listTemplates</span><span class="p">():</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">templates</span><span class="p">.</span><span class="na">keys</span>
<span class="p">}</span>

<span class="c1">// ì‚¬ìš© ì˜ˆ</span>
<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MultiPurposeAiService</span><span class="p">(</span>
<span class="w">    </span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">promptLibrary</span><span class="p">:</span><span class="w"> </span><span class="n">PromptLibrary</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">style</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;concise&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">maxSentences</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">promptLibrary</span><span class="p">.</span><span class="na">getPrompt</span><span class="p">(</span><span class="s">&quot;summarizer&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">text</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;style&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">style</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;maxSentences&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">maxSentences</span>
<span class="w">        </span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">(</span><span class="n">prompt</span><span class="p">).</span><span class="na">call</span><span class="p">().</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">reviewCode</span><span class="p">(</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">language</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;kotlin&quot;</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">promptLibrary</span><span class="p">.</span><span class="na">getPrompt</span><span class="p">(</span><span class="s">&quot;code_reviewer&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;code&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">code</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;language&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">language</span>
<span class="w">        </span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">(</span><span class="n">prompt</span><span class="p">).</span><span class="na">call</span><span class="p">().</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-22-structured-output">Module 2.2: Structured Output (êµ¬ì¡°í™”ëœ ì¶œë ¥)</h2>
<h3 id="221">2.2.1 ì™œ êµ¬ì¡°í™”ëœ ì¶œë ¥ì´ í•„ìš”í•œê°€?</h3>
<p>AIì˜ ììœ ë¡œìš´ í…ìŠ¤íŠ¸ ì‘ë‹µì€ ì‚¬ëŒì—ê²ŒëŠ” ì¢‹ì§€ë§Œ, í”„ë¡œê·¸ë¨ì—ì„œ ì²˜ë¦¬í•˜ê¸°ëŠ” ì–´ë µìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// âŒ ë¹„êµ¬ì¡°í™”ëœ ì‘ë‹µì˜ ë¬¸ì œ</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&#39;ì´ ì œí’ˆ ì •ë§ ì¢‹ì•„ìš”!&#39; ë¬¸ì¥ì˜ ê°ì •ì„ ë¶„ì„í•´ì£¼ì„¸ìš”&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="c1">// ì‘ë‹µ: &quot;ì´ ë¬¸ì¥ì€ ê¸ì •ì ì¸ ê°ì •ì„ í‘œí˜„í•˜ê³  ìˆìŠµë‹ˆë‹¤.</span>
<span class="c1">//        ì‚¬ìš©ìê°€ ì œí’ˆì— ë§Œì¡±í•˜ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆìœ¼ë©°,</span>
<span class="c1">//        &#39;ì •ë§&#39;ì´ë¼ëŠ” ê°•ì¡°ì–´ë¥¼ í†µí•´ ê°•í•œ ê¸ì •ì„ ë‚˜íƒ€ë‚´ê³  ìˆìŠµë‹ˆë‹¤...&quot;</span>

<span class="c1">// ì´ í…ìŠ¤íŠ¸ì—ì„œ &quot;ê¸ì •&quot;ì´ë¼ëŠ” ì •ë³´ë¥¼ ì¶”ì¶œí•˜ë ¤ë©´? ë³µì¡í•œ íŒŒì‹± í•„ìš”!</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// âœ… êµ¬ì¡°í™”ëœ ì‘ë‹µì˜ ì¥ì </span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SentimentAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sentiment</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w">      </span><span class="c1">// &quot;positive&quot;, &quot;negative&quot;, &quot;neutral&quot;</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span><span class="w">     </span><span class="c1">// 0.0 ~ 1.0</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">keywords</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="p">:</span><span class="w"> </span><span class="n">SentimentAnalysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&#39;ì´ ì œí’ˆ ì •ë§ ì¢‹ì•„ìš”!&#39; ë¬¸ì¥ì˜ ê°ì •ì„ ë¶„ì„í•´ì£¼ì„¸ìš”&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">SentimentAnalysis</span><span class="o">&gt;</span><span class="p">()</span>

<span class="c1">// ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥!</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;ê°ì •: </span><span class="si">${</span><span class="n">result</span><span class="p">.</span><span class="na">sentiment</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span><span class="w">     </span><span class="c1">// &quot;positive&quot;</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;ì‹ ë¢°ë„: </span><span class="si">${</span><span class="n">result</span><span class="p">.</span><span class="na">confidence</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// 0.95</span>
</code></pre></div>

<h3 id="222-entity">2.2.2 entity() ë©”ì„œë“œ í™œìš©</h3>
<p>Spring AIì˜ <code>entity()</code> ë©”ì„œë“œëŠ” AI ì‘ë‹µì„ ìë™ìœ¼ë¡œ ê°ì²´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
<h4 id="_6">ê¸°ë³¸ ì‚¬ìš©ë²•</h4>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ai.chat.client.entity</span>

<span class="c1">// ì‘ë‹µ í˜•ì‹ ì •ì˜</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MovieReview</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">rating</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w">           </span><span class="c1">// 1-5</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">pros</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cons</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">recommended</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MovieReviewService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeReview</span><span class="p">(</span><span class="n">reviewText</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">MovieReview</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                Analyze this movie review and extract structured information:</span>

<span class="s">                Review: &quot;</span><span class="si">$</span><span class="n">reviewText</span><span class="s">&quot;</span>

<span class="s">                Extract: title, rating (1-5), summary, pros, cons, and recommendation.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">MovieReview</span><span class="o">&gt;</span><span class="p">()</span><span class="w">  </span><span class="c1">// Kotlinì˜ reified type í™œìš©</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ì‚¬ìš© ì˜ˆ</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">review</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">analyzeReview</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    ì¸ì…‰ì…˜ì€ ì •ë§ ëŒ€ì‘ì…ë‹ˆë‹¤! ì‹œê° íš¨ê³¼ê°€ ì••ë„ì ì´ê³ ,</span>
<span class="s">    ìŠ¤í† ë¦¬ê°€ ë³µì¡í•˜ì§€ë§Œ ë³´ëŒ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ì²˜ìŒ ë³¼ ë•ŒëŠ”</span>
<span class="s">    ì¢€ í˜¼ë€ìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆì–´ìš”. 10ì  ë§Œì ì— 9ì !</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>

<span class="n">println</span><span class="p">(</span><span class="n">review</span><span class="p">.</span><span class="na">title</span><span class="p">)</span><span class="w">        </span><span class="c1">// &quot;ì¸ì…‰ì…˜&quot;</span>
<span class="n">println</span><span class="p">(</span><span class="n">review</span><span class="p">.</span><span class="na">rating</span><span class="p">)</span><span class="w">       </span><span class="c1">// 5 (ë˜ëŠ” 4-5 ì‚¬ì´)</span>
<span class="n">println</span><span class="p">(</span><span class="n">review</span><span class="p">.</span><span class="na">pros</span><span class="p">)</span><span class="w">         </span><span class="c1">// [&quot;ì••ë„ì ì¸ ì‹œê° íš¨ê³¼&quot;, &quot;ë³´ëŒ ìˆëŠ” ìŠ¤í† ë¦¬&quot;]</span>
<span class="n">println</span><span class="p">(</span><span class="n">review</span><span class="p">.</span><span class="na">cons</span><span class="p">)</span><span class="w">         </span><span class="c1">// [&quot;ì²˜ìŒ ë³¼ ë•Œ í˜¼ë€ìŠ¤ëŸ¬ì›€&quot;]</span>
<span class="n">println</span><span class="p">(</span><span class="n">review</span><span class="p">.</span><span class="na">recommended</span><span class="p">)</span><span class="w">  </span><span class="c1">// true</span>
</code></pre></div>

<h4 id="_7">ë¦¬ìŠ¤íŠ¸ ì‘ë‹µ ì²˜ë¦¬</h4>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.core.ParameterizedTypeReference</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">priority</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w">  </span><span class="c1">// HIGH, MEDIUM, LOW</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">deadline</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">TaskExtractorService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">extractTasks</span><span class="p">(</span><span class="n">emailContent</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                Extract all tasks mentioned in this email:</span>

<span class="s">                </span><span class="si">$</span><span class="n">emailContent</span>

<span class="s">                For each task, identify the title, priority level, and deadline if mentioned.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">ParameterizedTypeReference</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{})</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="223">2.2.3 ìŠ¤í‚¤ë§ˆ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì •í™•ë„ ë†’ì´ê¸°</h3>
<p><code>@JsonPropertyDescription</code>ì„ ì‚¬ìš©í•˜ë©´ AIê°€ ê° í•„ë“œì˜ ì˜ë¯¸ë¥¼ ë” ì˜ ì´í•´í•©ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.annotation.JsonProperty</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.annotation.JsonPropertyDescription</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ProductAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Product name extracted from the review&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">productName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Overall rating from 1 to 5 stars&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@JsonProperty</span><span class="p">(</span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">rating</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;List of positive aspects mentioned by the reviewer&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">positives</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;List of negative aspects or complaints&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">negatives</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Whether the reviewer recommends this product to others&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">recommended</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Key phrases that indicate the reviewer&#39;s sentiment&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sentimentIndicators</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="enum">Enum í™œìš©ìœ¼ë¡œ ê°’ ì œí•œ</h4>
<div class="codehilite"><pre><span></span><code><span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Priority</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">LOW</span><span class="p">,</span>
<span class="w">    </span><span class="n">MEDIUM</span><span class="p">,</span>
<span class="w">    </span><span class="n">HIGH</span><span class="p">,</span>
<span class="w">    </span><span class="n">URGENT</span>
<span class="p">}</span>

<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">IssueCategory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">BUG</span><span class="p">,</span>
<span class="w">    </span><span class="n">FEATURE_REQUEST</span><span class="p">,</span>
<span class="w">    </span><span class="n">IMPROVEMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">QUESTION</span><span class="p">,</span>
<span class="w">    </span><span class="n">DOCUMENTATION</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">IssueClassification</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;The type of issue being reported&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">category</span><span class="p">:</span><span class="w"> </span><span class="n">IssueCategory</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;How urgent this issue is&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">priority</span><span class="p">:</span><span class="w"> </span><span class="n">Priority</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Brief one-line summary of the issue&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Suggested tags for this issue&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tags</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Estimated effort: SMALL (&lt; 1 day), MEDIUM (1-3 days), LARGE (&gt; 3 days)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">estimatedEffort</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="c1">// AIëŠ” ìë™ìœ¼ë¡œ enum ê°’ ì¤‘ì—ì„œ ì„ íƒí•©ë‹ˆë‹¤</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">classification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Classify this GitHub issue:</span>

<span class="s">        Title: App crashes when clicking submit button</span>
<span class="s">        Description: When I click the submit button on the registration form,</span>
<span class="s">        the app crashes with a NullPointerException. This started after the</span>
<span class="s">        latest update. Very frustrating as I can&#39;t complete registration!</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">IssueClassification</span><span class="o">&gt;</span><span class="p">()</span>

<span class="c1">// classification.category == IssueCategory.BUG</span>
<span class="c1">// classification.priority == Priority.HIGH</span>
</code></pre></div>

<h3 id="224">2.2.4 ë³µì¡í•œ ì¤‘ì²© êµ¬ì¡°</h3>
<p>ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ì—ì„œëŠ” ë³µì¡í•œ ë°ì´í„° êµ¬ì¡°ê°€ í•„ìš”í•©ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ì¤‘ì²©ëœ ë°ì´í„° í´ë˜ìŠ¤ ì •ì˜</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Author</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">affiliation</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Chapter</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">number</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">pageCount</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">topics</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">BookAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">authors</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">chapters</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Chapter</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">genre</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">publicationYear</span><span class="p">:</span><span class="w"> </span><span class="kt">Int?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">targetAudience</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">keyTakeaways</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">BookAnalyzerService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeBook</span><span class="p">(</span><span class="n">bookDescription</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">BookAnalysis</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                You are a professional book analyst.</span>
<span class="s">                Extract detailed structured information from book descriptions.</span>
<span class="s">                Be thorough but accurate - only include information that is clearly stated or can be reasonably inferred.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;Analyze this book: </span><span class="si">$</span><span class="n">bookDescription</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">BookAnalysis</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="225">2.2.5 ìœ íš¨ì„± ê²€ì¦</h3>
<p>AI ì‘ë‹µë„ ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">jakarta.validation.Validator</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">RegistrationForm</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@field</span><span class="p">:</span><span class="n">NotBlank</span><span class="p">(</span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@field</span><span class="p">:</span><span class="n">Size</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì´ë¦„ì€ 2-50ìì—¬ì•¼ í•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@field</span><span class="p">:</span><span class="n">Email</span><span class="p">(</span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ìœ íš¨í•œ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@field</span><span class="p">:</span><span class="n">Min</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">18</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;18ì„¸ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@field</span><span class="p">:</span><span class="n">Max</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">120</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ìœ íš¨í•œ ë‚˜ì´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">age</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@field</span><span class="p">:</span><span class="n">Pattern</span><span class="p">(</span>
<span class="w">        </span><span class="n">regexp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;^010-\\d{4}-\\d{4}</span><span class="err">$</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì „í™”ë²ˆí˜¸ í˜•ì‹: 010-XXXX-XXXX&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">phone</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">FormExtractionService</span><span class="p">(</span>
<span class="w">    </span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">validator</span><span class="p">:</span><span class="w"> </span><span class="n">Validator</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">extractForm</span><span class="p">(</span><span class="n">naturalLanguageInput</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">RegistrationForm</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. AIë¡œ ì •ë³´ ì¶”ì¶œ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                Extract registration information from this text:</span>
<span class="s">                &quot;</span><span class="si">$</span><span class="n">naturalLanguageInput</span><span class="s">&quot;</span>

<span class="s">                If phone number is mentioned, format it as 010-XXXX-XXXX.</span>
<span class="s">                If age is not explicitly mentioned, make a reasonable inference if possible.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">RegistrationForm</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// 2. ìœ íš¨ì„± ê²€ì¦</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">violations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validator</span><span class="p">.</span><span class="na">validate</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">violations</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">violations</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">message</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">ValidationException</span><span class="p">(</span><span class="s">&quot;Form validation failed: </span><span class="si">$</span><span class="n">errors</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">form</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ì‚¬ìš© ì˜ˆ</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">extractForm</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    ì•ˆë…•í•˜ì„¸ìš”, ì €ëŠ” ê¹€ì² ìˆ˜ì…ë‹ˆë‹¤.</span>
<span class="s">    ì´ë©”ì¼ì€ chulsoo@gmail.comì´ê³ ,</span>
<span class="s">    ì˜¬í•´ 25ì‚´ì´ì—ìš”.</span>
<span class="s">    ì—°ë½ì²˜ëŠ” 010-1234-5678ì…ë‹ˆë‹¤.</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
</code></pre></div>

<h3 id="226">2.2.6 ì‹¤ìŠµ: ì´ë ¥ì„œ íŒŒì„œ</h3>
<p>ì‹¤ì œ ì—…ë¬´ì—ì„œ ìœ ìš©í•œ ì´ë ¥ì„œ ë¶„ì„ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ë°ì´í„° ëª¨ë¸ ì •ì˜</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">PersonalInfo</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">phone</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">linkedIn</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">github</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Education</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">institution</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">degree</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">field</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">graduationYear</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">gpa</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Experience</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">company</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">position</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">startDate</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">endDate</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span><span class="w">  </span><span class="c1">// nullì´ë©´ í˜„ì¬ ì¬ì§ ì¤‘</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">responsibilities</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">achievements</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Resume</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">personal</span><span class="p">:</span><span class="w"> </span><span class="n">PersonalInfo</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">education</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Education</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">experience</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Experience</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">skills</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">certifications</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">languages</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ResumeParserService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultSystem</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            You are an expert resume parser with extensive experience in HR and recruiting.</span>

<span class="s">            Your task is to extract structured information from resumes.</span>

<span class="s">            Guidelines:</span>
<span class="s">            - Extract all available information accurately</span>
<span class="s">            - Use null for fields that are not mentioned</span>
<span class="s">            - Parse dates in YYYY-MM format when possible</span>
<span class="s">            - List skills as individual items, not grouped</span>
<span class="s">            - Separate achievements from responsibilities in work experience</span>
<span class="s">            - Be thorough but don&#39;t make up information</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">parseResume</span><span class="p">(</span><span class="n">resumeText</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Resume</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                Parse this resume and extract all information:</span>

<span class="s">                ---</span>
<span class="s">                </span><span class="si">$</span><span class="n">resumeText</span>
<span class="s">                ---</span>

<span class="s">                Extract: personal info, professional summary, education history,</span>
<span class="s">                work experience (with responsibilities and achievements separated),</span>
<span class="s">                skills, certifications, and language proficiencies.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">Resume</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// íŠ¹ì • ì •ë³´ë§Œ ì¶”ì¶œ</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">extractSkills</span><span class="p">(</span><span class="n">resumeText</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SkillsOnly</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">skills</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;Extract all technical and soft skills from this resume: </span><span class="si">$</span><span class="n">resumeText</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">SkillsOnly</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">skills</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ê²½ë ¥ ìš”ì•½</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">summarizeExperience</span><span class="p">(</span><span class="n">resumeText</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                Based on this resume, write a brief (2-3 sentences)</span>
<span class="s">                professional summary highlighting key qualifications:</span>

<span class="s">                </span><span class="si">$</span><span class="n">resumeText</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-23">Module 2.3: ê³ ê¸‰ í”„ë¡¬í”„íŠ¸ ê¸°ë²•</h2>
<h3 id="231-zero-shot-vs-few-shot">2.3.1 Zero-shot vs Few-shot</h3>
<h4 id="zero-shot">Zero-shot: ì˜ˆì‹œ ì—†ì´ ë°”ë¡œ ì§ˆë¬¸</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// Zero-shot - ì˜ˆì‹œ ì—†ì´ ì§ì ‘ ìš”ì²­</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Classify the following text into one of these categories:</span>
<span class="s">        [Technology, Sports, Politics, Entertainment, Science]</span>

<span class="s">        Text: &quot;Apple announced the new iPhone 16 with AI features at their annual event.&quot;</span>

<span class="s">        Category:</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="c1">// ê²°ê³¼: &quot;Technology&quot;</span>
</code></pre></div>

<p><strong>ì¥ì :</strong> ë¹ ë¥´ê³  ê°„ë‹¨
<strong>ë‹¨ì :</strong> ë³µì¡í•œ ì‘ì—…ì—ì„œëŠ” ì •í™•ë„ê°€ ë‚®ì„ ìˆ˜ ìˆìŒ</p>
<h4 id="few-shot">Few-shot: ì˜ˆì‹œë¡œ íŒ¨í„´ í•™ìŠµ</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// Few-shot - ì˜ˆì‹œë¥¼ í†µí•´ íŒ¨í„´ í•™ìŠµ</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Classify texts into categories.</span>

<span class="s">        Examples:</span>
<span class="s">        ---</span>
<span class="s">        Text: &quot;The Lakers dominated the championship game with a 30-point lead.&quot;</span>
<span class="s">        Category: Sports</span>

<span class="s">        Text: &quot;The new tax bill passed in Congress with bipartisan support.&quot;</span>
<span class="s">        Category: Politics</span>

<span class="s">        Text: &quot;Marvel&#39;s latest movie broke all box office records this weekend.&quot;</span>
<span class="s">        Category: Entertainment</span>

<span class="s">        Text: &quot;Scientists discovered a new species of deep-sea fish near the Mariana Trench.&quot;</span>
<span class="s">        Category: Science</span>
<span class="s">        ---</span>

<span class="s">        Now classify:</span>
<span class="s">        Text: &quot;Apple announced the new iPhone 16 with AI features at their annual event.&quot;</span>
<span class="s">        Category:</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
</code></pre></div>

<p><strong>Few-shotì´ íš¨ê³¼ì ì¸ ê²½ìš°:</strong>
- íŠ¹ì • í˜•ì‹ì˜ ì¶œë ¥ì´ í•„ìš”í•  ë•Œ
- ë„ë©”ì¸ íŠ¹í™” ë¶„ë¥˜ê°€ í•„ìš”í•  ë•Œ
- AIê°€ ìƒˆë¡œìš´ ê°œë…ì„ ì´í•´í•´ì•¼ í•  ë•Œ</p>
<h3 id="232-chain-of-thought-cot">2.3.2 Chain-of-Thought (CoT) ì¶”ë¡ </h3>
<p>ë³µì¡í•œ ë¬¸ì œëŠ” ë‹¨ê³„ë³„ë¡œ ìƒê°í•˜ê²Œ í•˜ë©´ ì •í™•ë„ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤.</p>
<h4 id="cot">ê¸°ë³¸ CoT</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// ë‹¨ìˆœ ì§ˆë¬¸ - ì˜¤ë‹µ ê°€ëŠ¥ì„± ë†’ìŒ</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">simpleAnswer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        ìƒì ì— ì‚¬ê³¼ê°€ 45ê°œ ìˆìŠµë‹ˆë‹¤.</span>
<span class="s">        ì˜¤ì „ì— 12ê°œë¥¼ íŒ”ê³ , 30ê°œë¥¼ ì¶”ê°€ë¡œ ë°›ì•˜ìŠµë‹ˆë‹¤.</span>
<span class="s">        ì˜¤í›„ì— 18ê°œë¥¼ ë” íŒ”ì•˜ìŠµë‹ˆë‹¤.</span>
<span class="s">        ë‚¨ì€ ì‚¬ê³¼ëŠ” ëª‡ ê°œì¸ê°€ìš”?</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="c1">// CoT ì ìš© - ë‹¨ê³„ë³„ ì¶”ë¡ ìœ¼ë¡œ ì •í™•ë„ í–¥ìƒ</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">cotAnswer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        ìƒì ì— ì‚¬ê³¼ê°€ 45ê°œ ìˆìŠµë‹ˆë‹¤.</span>
<span class="s">        ì˜¤ì „ì— 12ê°œë¥¼ íŒ”ê³ , 30ê°œë¥¼ ì¶”ê°€ë¡œ ë°›ì•˜ìŠµë‹ˆë‹¤.</span>
<span class="s">        ì˜¤í›„ì— 18ê°œë¥¼ ë” íŒ”ì•˜ìŠµë‹ˆë‹¤.</span>
<span class="s">        ë‚¨ì€ ì‚¬ê³¼ëŠ” ëª‡ ê°œì¸ê°€ìš”?</span>

<span class="s">        ë‹¨ê³„ë³„ë¡œ ìƒê°í•´ë´…ì‹œë‹¤:</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="c1">// AI ì‘ë‹µ:</span>
<span class="c1">// ë‹¨ê³„ë³„ë¡œ ìƒê°í•´ë´…ì‹œë‹¤:</span>
<span class="c1">// 1. ì´ˆê¸° ì‚¬ê³¼ ìˆ˜: 45ê°œ</span>
<span class="c1">// 2. ì˜¤ì „ì— 12ê°œ íŒë§¤: 45 - 12 = 33ê°œ</span>
<span class="c1">// 3. 30ê°œ ì¶”ê°€ ì…ê³ : 33 + 30 = 63ê°œ</span>
<span class="c1">// 4. ì˜¤í›„ì— 18ê°œ íŒë§¤: 63 - 18 = 45ê°œ</span>
<span class="c1">// ë”°ë¼ì„œ ë‚¨ì€ ì‚¬ê³¼ëŠ” 45ê°œì…ë‹ˆë‹¤.</span>
</code></pre></div>

<h4 id="zero-shot-cot">Zero-shot CoT</h4>
<p>ê°„ë‹¨íˆ "ë‹¨ê³„ë³„ë¡œ ìƒê°í•´ë´…ì‹œë‹¤"ë§Œ ì¶”ê°€í•´ë„ íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">solveWithReasoning</span><span class="p">(</span><span class="n">problem</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            </span><span class="si">$</span><span class="n">problem</span>

<span class="s">            Let&#39;s think step by step.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="cot_1">êµ¬ì¡°í™”ëœ CoT</h4>
<p>ì¶”ë¡  ê³¼ì •ì„ ê°ì²´ë¡œ ë°›ì•„ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ReasoningStep</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">stepNumber</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">calculation</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ReasoningResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">steps</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ReasoningStep</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalAnswer</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ReasoningService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultSystem</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            You are a logical reasoning assistant.</span>
<span class="s">            Always break down problems into clear, numbered steps.</span>
<span class="s">            Show your work and explain each step.</span>
<span class="s">            Provide a confidence score (0-1) for your final answer.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">solveWithStructuredReasoning</span><span class="p">(</span><span class="n">problem</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">ReasoningResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                Solve this problem with detailed step-by-step reasoning:</span>

<span class="s">                </span><span class="si">$</span><span class="n">problem</span>

<span class="s">                Provide each step with:</span>
<span class="s">                - Step number</span>
<span class="s">                - Description of what you&#39;re doing</span>
<span class="s">                - Calculation (if applicable)</span>
<span class="s">                - Intermediate result</span>

<span class="s">                Then provide the final answer and your confidence level.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">ReasoningResult</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="233-self-consistency">2.3.3 Self-Consistency (ìê¸° ì¼ê´€ì„±)</h3>
<p>ë™ì¼í•œ ì§ˆë¬¸ì„ ì—¬ëŸ¬ ë²ˆ í•˜ê³ , ê°€ì¥ ë§ì´ ë‚˜ì˜¨ ë‹µì„ ì„ íƒí•˜ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ai.openai.OpenAiChatOptions</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">SelfConsistencyService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">solveWithConsistency</span><span class="p">(</span><span class="n">problem</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">samples</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">):</span><span class="w"> </span><span class="n">ConsistencyResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">answers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableMapOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">allResponses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableListOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">        </span><span class="n">repeat</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    </span><span class="si">$</span><span class="n">problem</span>

<span class="s">                    Think step by step, then provide your final answer on the last line</span>
<span class="s">                    starting with &quot;ANSWER: &quot;</span>
<span class="s">                &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">options</span><span class="p">(</span><span class="n">OpenAiChatOptions</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">temperature</span><span class="p">(</span><span class="m">0.7</span><span class="p">)</span><span class="w">  </span><span class="c1">// ë‹¤ì–‘í•œ ì¶”ë¡  ê²½ë¡œë¥¼ ìœ„í•´ ì•½ê°„ì˜ ëœë¤ì„±</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">            </span><span class="n">allResponses</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="w">            </span><span class="c1">// ìµœì¢… ë‹µë³€ ì¶”ì¶œ</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractFinalAnswer</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="w">            </span><span class="n">answers</span><span class="o">[</span><span class="n">answer</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answers</span><span class="p">.</span><span class="na">getOrDefault</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ê°€ì¥ ë§ì´ ë‚˜ì˜¨ ë‹µë³€ ì„ íƒ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">bestAnswer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answers</span><span class="p">.</span><span class="na">maxByOrNull</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="p">}</span><span class="o">!!</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bestAnswer</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">toDouble</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">samples</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ConsistencyResult</span><span class="p">(</span>
<span class="w">            </span><span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bestAnswer</span><span class="p">.</span><span class="na">key</span><span class="p">,</span>
<span class="w">            </span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confidence</span><span class="p">,</span>
<span class="w">            </span><span class="n">voteDistribution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answers</span><span class="p">,</span>
<span class="w">            </span><span class="n">allResponses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">allResponses</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">extractFinalAnswer</span><span class="p">(</span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">answerLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">lines</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">lastOrNull</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;ANSWER:&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">answerLine</span><span class="o">?.</span><span class="na">substringAfter</span><span class="p">(</span><span class="s">&quot;ANSWER:&quot;</span><span class="p">)</span><span class="o">?.</span><span class="na">trim</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;Unknown&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ConsistencyResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">answer</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">voteDistribution</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">allResponses</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="234-role-playing">2.3.4 ì—­í•  ê¸°ë°˜ í”„ë¡¬í”„íŒ… (Role-Playing)</h3>
<p>AIì—ê²Œ ì „ë¬¸ê°€ ì—­í• ì„ ë¶€ì—¬í•˜ë©´ ë” ì „ë¬¸ì ì¸ ë‹µë³€ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ExpertPanelService</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// ë‹¨ì¼ ì „ë¬¸ê°€ í˜ë¥´ì†Œë‚˜</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getSecurityReview</span><span class="p">(</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                You are a senior security engineer with 15 years of experience</span>
<span class="s">                in application security. You have:</span>

<span class="s">                - CISSP, CEH, and OSCP certifications</span>
<span class="s">                - Extensive experience with OWASP Top 10 vulnerabilities</span>
<span class="s">                - Background in penetration testing and secure code review</span>
<span class="s">                - Worked at major tech companies on security-critical systems</span>

<span class="s">                Your review style is:</span>
<span class="s">                - Thorough and systematic</span>
<span class="s">                - Practical, focusing on real-world exploitability</span>
<span class="s">                - Educational, explaining why issues are problematic</span>
<span class="s">                - Prioritized by severity</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;Review this code for security vulnerabilities:\n</span><span class="si">$</span><span class="n">code</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ë‹¤ì¤‘ ì „ë¬¸ê°€ í˜‘ì—… (Multi-Expert Panel)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getComprehensiveReview</span><span class="p">(</span><span class="n">proposal</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">ComprehensiveReview</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ê¸°ìˆ  ì „ë¬¸ê°€ ê´€ì </span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">technicalView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;You are a senior software architect focusing on technical feasibility, scalability, and implementation complexity.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;Evaluate this proposal from a technical perspective:\n</span><span class="si">$</span><span class="n">proposal</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// ë¹„ì¦ˆë‹ˆìŠ¤ ì „ë¬¸ê°€ ê´€ì </span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">businessView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;You are a business analyst focusing on ROI, market fit, competitive advantage, and revenue potential.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;Evaluate this proposal from a business perspective:\n</span><span class="si">$</span><span class="n">proposal</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// ë³´ì•ˆ ì „ë¬¸ê°€ ê´€ì </span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">securityView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;You are a security expert focusing on data privacy, compliance requirements, and potential vulnerabilities.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;Evaluate this proposal from a security perspective:\n</span><span class="si">$</span><span class="n">proposal</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// ì¢…í•© (í”„ë¡œì íŠ¸ ë§¤ë‹ˆì € ì—­í• )</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">synthesis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                You are an experienced project manager who synthesizes expert opinions.</span>
<span class="s">                Your role is to:</span>
<span class="s">                - Identify areas of agreement and disagreement</span>
<span class="s">                - Balance technical, business, and security concerns</span>
<span class="s">                - Provide actionable recommendations</span>
<span class="s">                - Highlight key risks and opportunities</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                Based on these expert analyses, provide a balanced recommendation:</span>

<span class="s">                ## Technical Analysis</span>
<span class="s">                </span><span class="si">$</span><span class="n">technicalView</span>

<span class="s">                ## Business Analysis</span>
<span class="s">                </span><span class="si">$</span><span class="n">businessView</span>

<span class="s">                ## Security Analysis</span>
<span class="s">                </span><span class="si">$</span><span class="n">securityView</span>

<span class="s">                Synthesize these perspectives into a final recommendation.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ComprehensiveReview</span><span class="p">(</span>
<span class="w">            </span><span class="n">technical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">technicalView</span><span class="p">,</span>
<span class="w">            </span><span class="n">business</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">businessView</span><span class="p">,</span>
<span class="w">            </span><span class="n">security</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">securityView</span><span class="p">,</span>
<span class="w">            </span><span class="n">synthesis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">synthesis</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ComprehensiveReview</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">technical</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">business</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">security</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">synthesis</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="235">2.3.5 ì‹¤ìŠµ: ë³µì¡í•œ ì¶”ë¡  ë¬¸ì œ í•´ê²° ë´‡</h3>
<p>ëª¨ë“  ê¸°ë²•ì„ ì¢…í•©í•œ ê³ ê¸‰ ì¶”ë¡  ë´‡ì„ ë§Œë“¤ì–´ë´…ì‹œë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AdvancedReasoningBot</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="n">problem</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">ReasoningResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1ë‹¨ê³„: ë¬¸ì œ ë¶„ì„</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">analysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analyzeProblem</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ“‹ ë¬¸ì œ ë¶„ì„ ì™„ë£Œ: </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">problemType</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 2ë‹¨ê³„: ë‹¨ê³„ë³„ í•´ê²° (Chain-of-Thought)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">steps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solveStepByStep</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="w"> </span><span class="n">analysis</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ”¢ </span><span class="si">${</span><span class="n">steps</span><span class="p">.</span><span class="na">size</span><span class="si">}</span><span class="s">ê°œ ë‹¨ê³„ë¡œ í•´ê²° ì‹œë„&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 3ë‹¨ê³„: ìê¸° ê²€ì¦ (Self-Verification)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">verification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verifySolution</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="w"> </span><span class="n">steps</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… ê²€ì¦ ê²°ê³¼: </span><span class="si">${</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">verification</span><span class="p">.</span><span class="na">isCorrect</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;</span><span class="err">ì •í™•</span><span class="s">&quot;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&quot;</span><span class="err">ì¬ê²€í† </span><span class="w"> </span><span class="err">í•„ìš”</span><span class="s">&quot;</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 4ë‹¨ê³„: í•„ìš”ì‹œ ì¬ì‹œë„</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalSteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">verification</span><span class="p">.</span><span class="na">isCorrect</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">verification</span><span class="p">.</span><span class="na">confidence</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ”„ ì‹ ë¢°ë„ ë‚®ìŒ, ë‹¤ë¥¸ ì ‘ê·¼ë²•ìœ¼ë¡œ ì¬ì‹œë„...&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">solveStepByStep</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="w"> </span><span class="n">analysis</span><span class="p">,</span><span class="w"> </span><span class="n">alternativeApproach</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">steps</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalVerification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verifySolution</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="w"> </span><span class="n">finalSteps</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ReasoningResponse</span><span class="p">(</span>
<span class="w">            </span><span class="n">problemAnalysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis</span><span class="p">,</span>
<span class="w">            </span><span class="n">solutionSteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finalSteps</span><span class="p">,</span>
<span class="w">            </span><span class="n">finalAnswer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finalSteps</span><span class="p">.</span><span class="na">lastOrNull</span><span class="p">()</span><span class="o">?.</span><span class="na">result</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;í•´ê²° ì‹¤íŒ¨&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">verification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finalVerification</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeProblem</span><span class="p">(</span><span class="n">problem</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">ProblemAnalysis</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                You are a problem analysis expert.</span>
<span class="s">                Analyze the given problem and identify:</span>
<span class="s">                - Problem type (math, logic, word problem, etc.)</span>
<span class="s">                - Key information provided</span>
<span class="s">                - What is being asked</span>
<span class="s">                - Potential approaches to solve it</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">ProblemAnalysis</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">solveStepByStep</span><span class="p">(</span>
<span class="w">        </span><span class="n">problem</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">analysis</span><span class="p">:</span><span class="w"> </span><span class="n">ProblemAnalysis</span><span class="p">,</span>
<span class="w">        </span><span class="n">alternativeApproach</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SolutionStep</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">approachHint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">alternativeApproach</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;Try a different approach than the obvious one. Consider working backwards or using a different method.&quot;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;Use the most straightforward approach.&quot;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                You are a methodical problem solver.</span>
<span class="s">                Solve problems step by step, showing all work.</span>

<span class="s">                For each step:</span>
<span class="s">                1. State what you&#39;re doing</span>
<span class="s">                2. Show the calculation or reasoning</span>
<span class="s">                3. State the intermediate result</span>

<span class="s">                </span><span class="si">$</span><span class="n">approachHint</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                Problem: </span><span class="si">$</span><span class="n">problem</span>

<span class="s">                Analysis: </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">problemType</span><span class="si">}</span><span class="s"> - </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">goal</span><span class="si">}</span>
<span class="s">                Key info: </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">givenInfo</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="p">)</span><span class="si">}</span>

<span class="s">                Solve step by step:</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">SolutionSteps</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">steps</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">verifySolution</span><span class="p">(</span><span class="n">problem</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">steps</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SolutionStep</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">Verification</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                You are a verification expert.</span>
<span class="s">                Check if the solution is correct by:</span>
<span class="s">                1. Reviewing each step&#39;s logic</span>
<span class="s">                2. Checking calculations</span>
<span class="s">                3. Verifying the answer makes sense</span>
<span class="s">                4. Testing with the original problem constraints</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                Original problem: </span><span class="si">$</span><span class="n">problem</span>

<span class="s">                Solution steps:</span>
<span class="s">                </span><span class="si">${</span><span class="n">steps</span><span class="p">.</span><span class="na">mapIndexed</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;</span><span class="si">${</span><span class="n">i</span><span class="o">+</span><span class="m">1</span><span class="si">}</span><span class="s">. </span><span class="si">${</span><span class="n">s</span><span class="p">.</span><span class="na">description</span><span class="si">}</span><span class="s">: </span><span class="si">${</span><span class="n">s</span><span class="p">.</span><span class="na">result</span><span class="si">}</span><span class="s">&quot;</span><span class="w"> </span><span class="p">}.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span><span class="p">)</span><span class="si">}</span>

<span class="s">                Verify this solution:</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="o">&lt;</span><span class="n">Verification</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ë°ì´í„° í´ë˜ìŠ¤ë“¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ProblemAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">problemType</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">givenInfo</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">goal</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">suggestedApproaches</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SolutionStep</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">stepNumber</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">calculation</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SolutionSteps</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">steps</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SolutionStep</span><span class="o">&gt;</span><span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Verification</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isCorrect</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">explanation</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">issues</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ReasoningResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">problemAnalysis</span><span class="p">:</span><span class="w"> </span><span class="n">ProblemAnalysis</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">solutionSteps</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SolutionStep</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalAnswer</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">verification</span><span class="p">:</span><span class="w"> </span><span class="n">Verification</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="part-2">Part 2 ìš”ì•½</h2>
<h3 id="_8">ì´ íŒŒíŠ¸ì—ì„œ ë°°ìš´ ê²ƒ</h3>
<h4 id="ai">í”„ë¡¬í”„íŠ¸ëŠ” AI ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í•µì‹¬ ì¸í„°í˜ì´ìŠ¤</h4>
<p>í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì€ ë‹¨ìˆœí•œ ë¬¸ìì—´ ì¡°í•©ì´ ì•„ë‹ˆë¼ <strong>AIì™€ì˜ ê³„ì•½(Contract)</strong>ì„ ì„¤ê³„í•˜ëŠ” ì‘ì—…ì…ë‹ˆë‹¤. PromptTemplateì„ í†µí•´ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì •ì˜í•˜ê³ , ë³€ìˆ˜ ë°”ì¸ë”©ìœ¼ë¡œ ë™ì  ì»¨í…ìŠ¤íŠ¸ë¥¼ ì£¼ì…í•˜ëŠ” íŒ¨í„´ì€ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í…ŒìŠ¤íŠ¸ ìš©ì´ì„±ì„ í¬ê²Œ í–¥ìƒì‹œí‚µë‹ˆë‹¤. í”„ë¡¬í”„íŠ¸ë¥¼ ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ë¡œ ë¶„ë¦¬í•˜ë©´ ì½”ë“œ ë³€ê²½ ì—†ì´ AI ë™ì‘ì„ ì¡°ì •í•  ìˆ˜ ìˆì–´ ìš´ì˜ ìœ ì—°ì„±ì´ í™•ë³´ë©ë‹ˆë‹¤.</p>
<h4 id="structured-output">Structured Output: ë¹„ì •í˜•ì—ì„œ ì •í˜•ìœ¼ë¡œ</h4>
<p>AIì˜ ìì—°ì–´ ì‘ë‹µì„ í”„ë¡œê·¸ë˜ë° ê°€ëŠ¥í•œ ë°ì´í„°ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì€ ì‹¤ìš©ì ì¸ AI ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í•„ìˆ˜ ìš”ì†Œì…ë‹ˆë‹¤. Spring AIì˜ <code>entity()</code> ë©”ì„œë“œì™€ Kotlin data classë¥¼ ê²°í•©í•˜ë©´ <strong>íƒ€ì… ì•ˆì „ì„±</strong>ì„ ìœ ì§€í•˜ë©´ì„œ AI ì‘ë‹µì„ ë„ë©”ì¸ ê°ì²´ë¡œ ì§ì ‘ ë§¤í•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” JSON íŒŒì‹±ì˜ ë³µì¡ì„±ì„ ì¶”ìƒí™”í•˜ê³ , ì»´íŒŒì¼ íƒ€ì„ì— ì‘ë‹µ êµ¬ì¡°ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</p>
<h4 id="_9">ê³ ê¸‰ í”„ë¡¬í”„íŒ… ê¸°ë²•ì˜ ì „ëµì  í™œìš©</h4>
<p>Few-shot Learningì€ ì˜ˆì‹œë¥¼ í†µí•´ AIì—ê²Œ ì•”ë¬µì  ê·œì¹™ì„ í•™ìŠµì‹œí‚¤ëŠ” ê¸°ë²•ìœ¼ë¡œ, ì¼ê´€ëœ ì¶œë ¥ í˜•ì‹ì´ í•„ìš”í•œ ê²½ìš°ì— íš¨ê³¼ì ì…ë‹ˆë‹¤. Chain-of-Thought(CoT)ëŠ” AIê°€ ì¤‘ê°„ ì¶”ë¡  ê³¼ì •ì„ ëª…ì‹œí•˜ë„ë¡ ìœ ë„í•˜ì—¬ ë³µì¡í•œ ë¬¸ì œì˜ ì •í™•ë„ë¥¼ ë†’ì…ë‹ˆë‹¤. Self-ConsistencyëŠ” ë‹¤ì¤‘ ìƒ˜í”Œë§ê³¼ ì•™ìƒë¸” íˆ¬í‘œë¡œ ì‹ ë¢°ë„ë¥¼ í–¥ìƒì‹œí‚¤ë©°, ë¹„ìš©ê³¼ ì •í™•ë„ ì‚¬ì´ì˜ íŠ¸ë ˆì´ë“œì˜¤í”„ë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê¸°ë²•ë“¤ì€ ìƒí˜¸ ë°°íƒ€ì ì´ì§€ ì•Šìœ¼ë©°, ë¬¸ì œì˜ íŠ¹ì„±ì— ë”°ë¼ ì¡°í•©í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h3 id="_10">í•µì‹¬ ê°œë… ì •ë¦¬</h3>
<table>
<thead>
<tr>
<th>ê¸°ë²•</th>
<th>ì„¤ëª…</th>
<th>ì‚¬ìš© ì‹œì </th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PromptTemplate</strong></td>
<td>ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿. ë³€ìˆ˜ ì¹˜í™˜ê³¼ ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ ë¡œë”© ì§€ì›</td>
<td>ë™ì  í”„ë¡¬í”„íŠ¸, ë‹¤êµ­ì–´ ì§€ì›, A/B í…ŒìŠ¤íŠ¸</td>
</tr>
<tr>
<td><strong>Structured Output</strong></td>
<td>AI ì‘ë‹µì„ íƒ€ì… ì•ˆì „í•œ ê°ì²´ë¡œ ë³€í™˜. JSON Schema ê¸°ë°˜ ê²€ì¦</td>
<td>API ì‘ë‹µ, ë°ì´í„° íŒŒì´í”„ë¼ì¸, í¼ ìë™ ì™„ì„±</td>
</tr>
<tr>
<td><strong>Few-shot</strong></td>
<td>ì˜ˆì‹œ ê¸°ë°˜ In-context Learning. íŒ¨í„´ ì¸ì‹ì„ í†µí•œ í˜•ì‹ í•™ìŠµ</td>
<td>ì¼ê´€ëœ í˜•ì‹, ë„ë©”ì¸ íŠ¹í™” ì–´íœ˜, ìŠ¤íƒ€ì¼ ëª¨ë°©</td>
</tr>
<tr>
<td><strong>Chain-of-Thought</strong></td>
<td>ë‹¨ê³„ë³„ ì¶”ë¡  ìœ ë„. "Let's think step by step" íŒ¨í„´</td>
<td>ìˆ˜í•™/ë…¼ë¦¬ ë¬¸ì œ, ë³µì¡í•œ ì˜ì‚¬ê²°ì •, ë””ë²„ê¹…</td>
</tr>
<tr>
<td><strong>Self-Consistency</strong></td>
<td>ë‹¤ì¤‘ ìƒ˜í”Œë§ í›„ ë‹¤ìˆ˜ê²° íˆ¬í‘œ. ì•™ìƒë¸” ê¸°ë²•ì˜ LLM ì ìš©</td>
<td>ë†’ì€ ì •í™•ë„ í•„ìˆ˜, ëª¨í˜¸í•œ ë¬¸ì œ, ê²€ì¦ í•„ìš” ì‹œ</td>
</tr>
<tr>
<td><strong>Role-Playing</strong></td>
<td>ì „ë¬¸ê°€ í˜ë¥´ì†Œë‚˜ ë¶€ì—¬. ë„ë©”ì¸ ì§€ì‹ í™œì„±í™”</td>
<td>ì „ë¬¸ ë¶„ì•¼ ìƒë‹´, ì‹œë®¬ë ˆì´ì…˜, êµìœ¡ ì½˜í…ì¸ </td>
</tr>
</tbody>
</table>
<h3 id="_11">ì‹¤ì „ í™œìš© íŒ</h3>
<h4 id="_12">í”„ë¡¬í”„íŠ¸ ì„¤ê³„ ì›ì¹™</h4>
<ul>
<li><strong>ëª…í™•ì„±(Clarity)</strong>: ëª¨í˜¸í•œ í‘œí˜„ì„ í”¼í•˜ê³  êµ¬ì²´ì ì¸ ì§€ì‹œë¥¼ ì œê³µí•˜ì„¸ìš”</li>
<li><strong>êµ¬ì¡°í™”(Structure)</strong>: ë³µì¡í•œ ìš”êµ¬ì‚¬í•­ì€ ë²ˆí˜¸ ë§¤ê¸°ê¸°ë‚˜ ì„¹ì…˜ìœ¼ë¡œ êµ¬ë¶„í•˜ì„¸ìš”</li>
<li><strong>ì œì•½ ì¡°ê±´(Constraints)</strong>: ì›í•˜ì§€ ì•ŠëŠ” ë™ì‘ì„ ëª…ì‹œì ìœ¼ë¡œ ê¸ˆì§€í•˜ì„¸ìš”</li>
</ul>
<h4 id="structured-output_1">Structured Output ì‚¬ìš© ì‹œ</h4>
<ul>
<li><strong>ì¤‘ì²© ê°ì²´ í™œìš©</strong>: ë³µì¡í•œ ì‘ë‹µì€ ê³„ì¸µì  data classë¡œ ëª¨ë¸ë§í•˜ì„¸ìš”</li>
<li><strong>Optional í•„ë“œ</strong>: ì„ íƒì  ì •ë³´ëŠ” nullable íƒ€ì…ìœ¼ë¡œ ì •ì˜í•˜ì„¸ìš”</li>
<li><strong>ê²€ì¦ ë¡œì§ ë¶„ë¦¬</strong>: ë¹„ì¦ˆë‹ˆìŠ¤ ê²€ì¦ì€ ë§¤í•‘ í›„ ë³„ë„ ë ˆì´ì–´ì—ì„œ ìˆ˜í–‰í•˜ì„¸ìš”</li>
</ul>
<h3 id="_13">ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜</h3>
<table>
<thead>
<tr>
<th>ì‹¤ìˆ˜</th>
<th>ë¬¸ì œì </th>
<th>í•´ê²° ë°©ë²•</th>
</tr>
</thead>
<tbody>
<tr>
<td>í”„ë¡¬í”„íŠ¸ í•˜ë“œì½”ë”©</td>
<td>ìˆ˜ì • ì‹œ ì¬ë°°í¬ í•„ìš”, ë²„ì „ ê´€ë¦¬ ì–´ë ¤ì›€</td>
<td>ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ íŒŒì¼ë¡œ ë¶„ë¦¬</td>
</tr>
<tr>
<td>ê³¼ë„í•œ Few-shot ì˜ˆì‹œ</td>
<td>í† í° ë‚­ë¹„, ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš° ì´ˆê³¼</td>
<td>2-3ê°œì˜ ëŒ€í‘œì ì¸ ì˜ˆì‹œë§Œ ì‚¬ìš©</td>
</tr>
<tr>
<td>CoT ë‚¨ìš©</td>
<td>ë‹¨ìˆœ ë¬¸ì œì— ë¶ˆí•„ìš”í•œ ì˜¤ë²„í—¤ë“œ</td>
<td>ë³µì¡ë„ì— ë”°ë¼ ì„ íƒì  ì ìš©</td>
</tr>
<tr>
<td>Structured Output ê³¼ì‹ </td>
<td>AIê°€ í•­ìƒ ìœ íš¨í•œ JSONì„ ë°˜í™˜í•œë‹¤ê³  ê°€ì •</td>
<td>íŒŒì‹± ì‹¤íŒ¨ ëŒ€ë¹„ ì˜ˆì™¸ ì²˜ë¦¬ êµ¬í˜„</td>
</tr>
</tbody>
</table>
<h3 id="_14">í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
<ul>
<li>[ ] PromptTemplate ìƒì„± ë° ë³€ìˆ˜ ë°”ì¸ë”©</li>
<li>[ ] ì™¸ë¶€ íŒŒì¼ ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ê´€ë¦¬</li>
<li>[ ] entity()ë¥¼ í†µí•œ êµ¬ì¡°í™”ëœ ì¶œë ¥</li>
<li>[ ] data class ê¸°ë°˜ ì‘ë‹µ ëª¨ë¸ë§</li>
<li>[ ] Few-shot í”„ë¡¬í”„íŒ… êµ¬í˜„</li>
<li>[ ] Chain-of-Thought ì¶”ë¡ </li>
<li>[ ] ë‹¤ì¤‘ ì „ë¬¸ê°€ íŒ¨ë„ êµ¬í˜„</li>
</ul>
<h3 id="_15">ë‹¤ìŒ ë‹¨ê³„</h3>
<p>Part 2ì—ì„œ AIì˜ ì‘ë‹µ í’ˆì§ˆì„ ë†’ì´ëŠ” í”„ë¡¬í”„íŠ¸ ê¸°ë²•ì„ ìµí˜”ë‹¤ë©´, ì´ì œ AIì—ê²Œ <strong>ì‹¤í–‰ ëŠ¥ë ¥</strong>ì„ ë¶€ì—¬í•  ì°¨ë¡€ì…ë‹ˆë‹¤.</p>
<p><strong>Part 3: Function Callingê³¼ ë„êµ¬ í†µí•©</strong>ì—ì„œ ë°°ìš¸ ë‚´ìš©:</p>
<table>
<thead>
<tr>
<th>ì£¼ì œ</th>
<th>ì„¤ëª…</th>
<th>í™œìš© ì˜ˆì‹œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Function Callback</strong></td>
<td>AIê°€ ì™¸ë¶€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ì •ì˜</td>
<td>ë‚ ì”¨ ì¡°íšŒ, í™˜ìœ¨ ê³„ì‚°, DB ê²€ìƒ‰</td>
</tr>
<tr>
<td><strong>@Description ì–´ë…¸í…Œì´ì…˜</strong></td>
<td>í•¨ìˆ˜ ë©”íƒ€ë°ì´í„°ë¥¼ AIì—ê²Œ ì „ë‹¬</td>
<td>íŒŒë¼ë¯¸í„° ì„¤ëª…, ì‚¬ìš© ì¡°ê±´ ëª…ì‹œ</td>
</tr>
<tr>
<td><strong>ë©€í‹° í•¨ìˆ˜ ì‹œë‚˜ë¦¬ì˜¤</strong></td>
<td>ì—¬ëŸ¬ ë„êµ¬ë¥¼ ì¡°í•©í•œ ë³µì¡í•œ ì‘ì—…</td>
<td>ì˜ˆì•½ ì‹œìŠ¤í…œ, ì£¼ë¬¸ ì²˜ë¦¬ ì›Œí¬í”Œë¡œìš°</td>
</tr>
<tr>
<td><strong>Advisors íŒ¨í„´</strong></td>
<td>ìš”ì²­/ì‘ë‹µ íŒŒì´í”„ë¼ì¸ ì»¤ìŠ¤í„°ë§ˆì´ì§•</td>
<td>ë¡œê¹…, ê²€ì¦, ìºì‹±, ì»¨í…ìŠ¤íŠ¸ ì£¼ì…</td>
</tr>
</tbody>
</table>
<p>Function Callingì€ AIë¥¼ ë‹¨ìˆœí•œ í…ìŠ¤íŠ¸ ìƒì„±ê¸°ì—ì„œ <strong>ììœ¨ì ì¸ ì—ì´ì „íŠ¸</strong>ë¡œ ì „í™˜ì‹œí‚¤ëŠ” í•µì‹¬ ê¸°ìˆ ì…ë‹ˆë‹¤!</p>
<hr />
<h2 id="_16">ì°¸ê³  ì˜ˆì œ ì½”ë“œ</h2>
<div class="codehilite"><pre><span></span><code>spring-ai-examples/
â”œâ”€â”€ prompt-engineering/prompt-engineering-patterns  â†’ ë‹¤ì–‘í•œ í”„ë¡¬í”„íŠ¸ ê¸°ë²•
â”œâ”€â”€ agentic-patterns/routing-workflow              â†’ Structured Output í™œìš©
â””â”€â”€ agentic-patterns/evaluator-optimizer           â†’ í‰ê°€ ê¸°ë°˜ ê°œì„  íŒ¨í„´
</code></pre></div></div>
<div class="chapter" id="part3-function-calling.md"><h1 id="part-3-function-calling-tool-integration">Part 3: Function Callingê³¼ ë„êµ¬ í†µí•© (Tool Integration)</h1>
<blockquote>
<p>AIì—ê²Œ ì‹¤ì œ í–‰ë™ ëŠ¥ë ¥ ë¶€ì—¬í•˜ê¸°</p>
</blockquote>
<p><strong>í•™ìŠµ ê¸°ê°„:</strong> 2ì£¼
<strong>ë‚œì´ë„:</strong> ì¤‘ê¸‰
<strong>ì‚¬ì „ ìš”êµ¬ì‚¬í•­:</strong> Part 1, 2 ì™„ë£Œ</p>
<hr />
<h2 id="_1">ë“¤ì–´ê°€ë©°</h2>
<p>ì§€ê¸ˆê¹Œì§€ AIëŠ” í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ë° ê·¸ì³¤ìŠµë‹ˆë‹¤. "ì„œìš¸ ë‚ ì”¨ê°€ ì–´ë•Œ?"ë¼ê³  ë¬¼ìœ¼ë©´ "ì œê°€ ì‹¤ì‹œê°„ ì •ë³´ì— ì ‘ê·¼í•  ìˆ˜ ì—†ì–´ì„œ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"ë¼ëŠ” ë‹µë³€ì„ ë°›ì•˜ì£ .</p>
<p>í•˜ì§€ë§Œ <strong>Function Calling</strong>ì„ ì‚¬ìš©í•˜ë©´ ì™„ì „íˆ ë‹¬ë¼ì§‘ë‹ˆë‹¤. AIê°€ "ì„œìš¸ ë‚ ì”¨ë¥¼ ì•Œê¸° ìœ„í•´ weather() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ê² ë‹¤"ê³  íŒë‹¨í•˜ê³ , ì‹¤ì œë¡œ ë‚ ì”¨ APIë¥¼ í˜¸ì¶œí•œ í›„, ê·¸ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ "ì„œìš¸ì€ í˜„ì¬ 5ë„ì´ê³  ë§‘ìŠµë‹ˆë‹¤"ë¼ê³  ë‹µë³€í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.</p>
<p>ì´ê²ƒì´ AI ì—ì´ì „íŠ¸ì˜ ì‹œì‘ì…ë‹ˆë‹¤!</p>
<p><img alt="Function Calling Flow" src="file:///Users/robin/Downloads/spring-ai-examples/book/images/function-calling-flow.png" /></p>
<hr />
<h2 id="module-31-function-calling">Module 3.1: Function Calling ê¸°ì´ˆ</h2>
<h3 id="311-function-calling">3.1.1 Function Callingì´ë€?</h3>
<h4 id="_2">í•µì‹¬ ê°œë…</h4>
<p>Function Callingì€ AIê°€ <strong>ì–¸ì œ ì–´ë–¤ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí• ì§€ ê²°ì •</strong>í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.</p>
<p>ì¤‘ìš”í•œ ì : AIê°€ í•¨ìˆ˜ë¥¼ ì§ì ‘ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤!
- AIëŠ” "ì´ í•¨ìˆ˜ë¥¼ ì´ ì¸ìë¡œ í˜¸ì¶œí•´ì•¼ í•œë‹¤"ëŠ” <strong>ê²°ì •</strong>ë§Œ í•©ë‹ˆë‹¤
- ì‹¤ì œ í•¨ìˆ˜ ì‹¤í–‰ì€ <strong>ì—¬ëŸ¬ë¶„ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜</strong>ì—ì„œ ìˆ˜í–‰í•©ë‹ˆë‹¤
- ê²°ê³¼ë¥¼ ë‹¤ì‹œ AIì—ê²Œ ì „ë‹¬í•˜ë©´ AIê°€ ìµœì¢… ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤</p>
<p><img alt="Function Calling Concept" src="file:///Users/robin/Downloads/spring-ai-examples/book/images/function-calling-concept.png" /></p>
<table>
<thead>
<tr>
<th>ë‹¨ê³„</th>
<th>í–‰ìœ„ì</th>
<th>ë™ì‘</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>ì‚¬ìš©ì â†’ AI</td>
<td>"ì„œìš¸ ë‚ ì”¨ ì•Œë ¤ì¤˜" ì§ˆë¬¸ ì „ì†¡</td>
</tr>
<tr>
<td>2</td>
<td>AI</td>
<td><code>weather("Seoul")</code> í•¨ìˆ˜ í˜¸ì¶œì´ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨</td>
</tr>
<tr>
<td>3</td>
<td>AI â†’ ì• í”Œë¦¬ì¼€ì´ì…˜</td>
<td>í•¨ìˆ˜ í˜¸ì¶œ ìš”ì²­ ì „ë‹¬</td>
</tr>
<tr>
<td>4</td>
<td>ì• í”Œë¦¬ì¼€ì´ì…˜ â†’ ì™¸ë¶€ API</td>
<td>ì‹¤ì œ ë‚ ì”¨ API í˜¸ì¶œ</td>
</tr>
<tr>
<td>5</td>
<td>ì™¸ë¶€ API â†’ ì• í”Œë¦¬ì¼€ì´ì…˜</td>
<td>ë‚ ì”¨ ë°ì´í„° ë°˜í™˜ <code>{temp: 5Â°C}</code></td>
</tr>
<tr>
<td>6</td>
<td>ì• í”Œë¦¬ì¼€ì´ì…˜ â†’ AI</td>
<td>í•¨ìˆ˜ ì‹¤í–‰ ê²°ê³¼ ì „ë‹¬</td>
</tr>
<tr>
<td>7</td>
<td>AI â†’ ì‚¬ìš©ì</td>
<td>ê²°ê³¼ ê¸°ë°˜ ìì—°ì–´ ì‘ë‹µ ìƒì„±</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>í•µì‹¬ í¬ì¸íŠ¸</strong>: AIëŠ” í•¨ìˆ˜ í˜¸ì¶œì„ <strong>ê²°ì •</strong>ë§Œ í•˜ê³ , ì‹¤ì œ ì‹¤í–‰ì€ <strong>ì• í”Œë¦¬ì¼€ì´ì…˜</strong>ì´ ë‹´ë‹¹í•©ë‹ˆë‹¤.</p>
</blockquote>
<h4 id="function-calling-vs-rag">Function Calling vs RAG ë¹„êµ</h4>
<table>
<thead>
<tr>
<th>êµ¬ë¶„</th>
<th>Function Calling</th>
<th>RAG</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ëª©ì </strong></td>
<td>í–‰ë™ ìˆ˜í–‰ (Do Something)</td>
<td>ì •ë³´ ê²€ìƒ‰ (Find Something)</td>
</tr>
<tr>
<td><strong>ë°ì´í„°</strong></td>
<td>ì‹¤ì‹œê°„, ë™ì </td>
<td>ì‚¬ì „ ìƒ‰ì¸, ì •ì </td>
</tr>
<tr>
<td><strong>ì˜ˆì‹œ</strong></td>
<td>API í˜¸ì¶œ, DB ì¿¼ë¦¬, ì´ë©”ì¼ ë°œì†¡</td>
<td>ë¬¸ì„œ ê²€ìƒ‰, FAQ ë‹µë³€</td>
</tr>
<tr>
<td><strong>ë¹„ìš©</strong></td>
<td>í•¨ìˆ˜ í˜¸ì¶œ ë¹„ìš© ë°œìƒ</td>
<td>ë²¡í„° ê²€ìƒ‰ ë¹„ìš© ë°œìƒ</td>
</tr>
</tbody>
</table>
<h3 id="312-spring-ai-function-callback">3.1.2 Spring AIì˜ Function Callback</h3>
<p>Spring AIì—ì„œëŠ” í•¨ìˆ˜ë¥¼ <code>ToolCallback</code> ë˜ëŠ” <code>Function&lt;Input, Output&gt;</code> í˜•íƒœë¡œ ì •ì˜í•©ë‹ˆë‹¤.</p>
<h4 id="_3">ìš”ì²­/ì‘ë‹µ ë°ì´í„° í´ë˜ìŠ¤ ì •ì˜</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// í•¨ìˆ˜ ì…ë ¥ ìŠ¤í‚¤ë§ˆ</span>
<span class="c1">// AIê°€ ì´ êµ¬ì¡°ë¥¼ ë³´ê³  ì–´ë–¤ ë°ì´í„°ë¥¼ ì „ë‹¬í•´ì•¼ í•˜ëŠ”ì§€ ì´í•´í•©ë‹ˆë‹¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WeatherRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;City name, e.g., &#39;Seoul&#39;, &#39;New York&#39;, &#39;Tokyo&#39;&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Temperature unit: &#39;celsius&#39; or &#39;fahrenheit&#39;. Default is celsius.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">unit</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;celsius&quot;</span>
<span class="p">)</span>

<span class="c1">// í•¨ìˆ˜ ì¶œë ¥ ìŠ¤í‚¤ë§ˆ</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WeatherResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">temperature</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">unit</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">condition</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">humidity</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">timestamp</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">time</span><span class="p">.</span><span class="na">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">toString</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="bean">í•¨ìˆ˜ Bean ì •ì˜</h4>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Description</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.util.function.Function</span>

<span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherFunctionConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Get current weather information for a specific location. Returns temperature, humidity, and weather conditions.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherService</span><span class="p">):</span><span class="w"> </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">WeatherRequest</span><span class="p">,</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Function</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">unit</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<blockquote>
<p>ğŸ’¡ <strong>@Description ì–´ë…¸í…Œì´ì…˜ì˜ ì¤‘ìš”ì„±</strong></p>
<p>ì´ ì„¤ëª…ì€ AIê°€ í•¨ìˆ˜ë¥¼ ì´í•´í•˜ëŠ” ë° í•µì‹¬ì ì¸ ì—­í• ì„ í•©ë‹ˆë‹¤.
ëª…í™•í•˜ê³  ìƒì„¸í• ìˆ˜ë¡ AIê°€ ì ì ˆí•œ ìƒí™©ì—ì„œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p>
</blockquote>
<h3 id="313-chatclient">3.1.3 ChatClientì— í•¨ìˆ˜ ì—°ê²°</h3>
<h4 id="1">ë°©ë²• 1: ê¸°ë³¸ í•¨ìˆ˜ ë“±ë¡</h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/weather-chat&quot;</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherChatController</span><span class="p">(</span>
<span class="w">    </span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Bean ì´ë¦„ìœ¼ë¡œ í•¨ìˆ˜ ë“±ë¡ (ì „ì—­ ì„¤ì •)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultFunctions</span><span class="p">(</span><span class="s">&quot;getWeather&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// Bean ì´ë¦„</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultSystem</span><span class="p">(</span><span class="s">&quot;You are a helpful weather assistant. Use the weather function to get real-time weather data.&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@GetMapping</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="2">ë°©ë²• 2: í˜¸ì¶œ ì‹œ ë™ì  í•¨ìˆ˜ ì§€ì •</h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/dynamic&quot;</span><span class="p">)</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">chatWithDynamicFunctions</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">functions</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;?</span>
<span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">().</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// ìš”ì²­ì— ë”°ë¼ ë‹¤ë¥¸ í•¨ìˆ˜ ì„¸íŠ¸ í™œì„±í™”</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">functions</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">functions</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">prompt</span><span class="p">.</span><span class="na">functions</span><span class="p">(</span><span class="o">*</span><span class="n">functions</span><span class="p">.</span><span class="na">toTypedArray</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">prompt</span><span class="p">.</span><span class="na">call</span><span class="p">().</span><span class="na">content</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="314-kotlin">3.1.4 Kotlin ìŠ¤íƒ€ì¼ í•¨ìˆ˜ ì •ì˜</h3>
<p>Kotlinì˜ ëŒë‹¤ì™€ í•¨ìˆ˜ íƒ€ì…ì„ í™œìš©í•œ ë” ê°„ê²°í•œ ì •ì˜:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">KotlinFunctionConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Find the weather conditions, forecasts, and temperatures for a location&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">weatherFunction</span><span class="p">(</span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">MockWeatherService</span><span class="p">):</span><span class="w"> </span><span class="p">(</span><span class="n">WeatherRequest</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ToolCallback ë¹Œë” ì‚¬ìš©</span>
<span class="nd">@Bean</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">weatherToolCallback</span><span class="p">(</span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">MockWeatherService</span><span class="p">):</span><span class="w"> </span><span class="n">ToolCallback</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;WeatherInfo&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherRequest</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">        </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;Get current weather for any city worldwide&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">inputType</span><span class="p">(</span><span class="n">WeatherRequest</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="315">3.1.5 ë©€í‹° í•¨ìˆ˜ ì‹œë‚˜ë¦¬ì˜¤</h3>
<p>ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì—¬ëŸ¬ í•¨ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MultiFunctionConfig</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherService</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">restaurantService</span><span class="p">:</span><span class="w"> </span><span class="n">RestaurantService</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">reservationService</span><span class="p">:</span><span class="w"> </span><span class="n">ReservationService</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Get current weather for a location&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">():</span><span class="w"> </span><span class="p">(</span><span class="n">WeatherRequest</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">location</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">unit</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Search for restaurants by cuisine type and location&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">searchRestaurants</span><span class="p">():</span><span class="w"> </span><span class="p">(</span><span class="n">RestaurantSearchRequest</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Restaurant</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">restaurantService</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">cuisine</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">location</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">maxResults</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Make a restaurant reservation&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">makeReservation</span><span class="p">():</span><span class="w"> </span><span class="p">(</span><span class="n">ReservationRequest</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ReservationResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">reservationService</span><span class="p">.</span><span class="na">book</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">restaurantId</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">partySize</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">dateTime</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ë°ì´í„° í´ë˜ìŠ¤ë“¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">RestaurantSearchRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Type of cuisine, e.g., &#39;Italian&#39;, &#39;Korean&#39;, &#39;Japanese&#39;&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cuisine</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;City or area to search in&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Maximum number of results to return (default: 5)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">maxResults</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Restaurant</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cuisine</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">rating</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">priceRange</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">address</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ReservationRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Restaurant ID from search results&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">restaurantId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Number of people&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">partySize</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Desired date and time in ISO format&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">dateTime</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ReservationResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">success</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confirmationNumber</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="ai">AIì˜ ìë™ í•¨ìˆ˜ ì„ íƒ</h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@RestController</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">TravelAssistantController</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultFunctions</span><span class="p">(</span><span class="s">&quot;getWeather&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;searchRestaurants&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;makeReservation&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultSystem</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            You are a helpful travel assistant.</span>
<span class="s">            You can check weather, find restaurants, and make reservations.</span>
<span class="s">            Always confirm with the user before making reservations.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/travel-assistant&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">assist</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">AssistantRequest</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ì‚¬ìš© ì˜ˆ: &quot;ì„œìš¸ ê°•ë‚¨ì— ìˆëŠ” ì´íƒˆë¦¬ì•ˆ ë ˆìŠ¤í† ë‘ ì°¾ì•„ì„œ ë‚´ì¼ ì €ë… 7ì‹œì— 4ëª… ì˜ˆì•½í•´ì¤˜&quot;</span>
<span class="c1">// AI ë™ì‘:</span>
<span class="c1">// 1. searchRestaurants(cuisine=&quot;Italian&quot;, location=&quot;ê°•ë‚¨&quot;, maxResults=5) í˜¸ì¶œ</span>
<span class="c1">// 2. ê²°ê³¼ ì¤‘ ì í•©í•œ ë ˆìŠ¤í† ë‘ ì„ íƒ</span>
<span class="c1">// 3. makeReservation(restaurantId=&quot;...&quot;, partySize=4, dateTime=&quot;...&quot;) í˜¸ì¶œ</span>
<span class="c1">// 4. ì˜ˆì•½ ê²°ê³¼ë¥¼ ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´</span>
</code></pre></div>

<h3 id="316">3.1.6 ì‹¤ìŠµ: ë‚ ì”¨ ì •ë³´ ì±—ë´‡</h3>
<p>ì‹¤ì œ ë‚ ì”¨ APIì™€ ì—°ë™í•˜ëŠ” ì™„ì „í•œ ì˜ˆì œ:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// service/WeatherService.kt</span>
<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherService</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">restTemplate</span><span class="p">:</span><span class="w"> </span><span class="n">RestTemplate</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;\</span><span class="si">${</span><span class="n">weather</span><span class="p">.</span><span class="na">api</span><span class="p">.</span><span class="na">key</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">apiKey</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">baseUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://api.openweathermap.org/data/2.5&quot;</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span><span class="n">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;fahrenheit&quot;</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;imperial&quot;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&quot;metric&quot;</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">$</span><span class="n">baseUrl</span><span class="s">/weather?q=</span><span class="si">$</span><span class="n">location</span><span class="s">&amp;appid=</span><span class="si">$</span><span class="n">apiKey</span><span class="s">&amp;units=</span><span class="si">$</span><span class="n">units</span><span class="s">&quot;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">getForObject</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">OpenWeatherApiResponse</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">                </span><span class="o">?:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">WeatherApiException</span><span class="p">(</span><span class="s">&quot;No response from weather API&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="n">WeatherResponse</span><span class="p">(</span>
<span class="w">                </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">                </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">main</span><span class="p">.</span><span class="na">temp</span><span class="p">,</span>
<span class="w">                </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">,</span>
<span class="w">                </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">weather</span><span class="p">.</span><span class="na">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="na">description</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;Unknown&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">main</span><span class="p">.</span><span class="na">humidity</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ AIê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì‘ë‹µ ë°˜í™˜</span>
<span class="w">            </span><span class="n">WeatherResponse</span><span class="p">(</span>
<span class="w">                </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">location</span><span class="p">,</span>
<span class="w">                </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0</span><span class="p">,</span>
<span class="w">                </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">,</span>
<span class="w">                </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Error: Unable to fetch weather data - </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getForecast</span><span class="p">(</span><span class="n">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">days</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">ForecastResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">$</span><span class="n">baseUrl</span><span class="s">/forecast?q=</span><span class="si">$</span><span class="n">location</span><span class="s">&amp;appid=</span><span class="si">$</span><span class="n">apiKey</span><span class="s">&amp;units=metric&amp;cnt=</span><span class="si">${</span><span class="n">days</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">8</span><span class="si">}</span><span class="s">&quot;</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">getForObject</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">OpenWeatherForecastResponse</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="o">?:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">WeatherApiException</span><span class="p">(</span><span class="s">&quot;No response from forecast API&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ForecastResponse</span><span class="p">(</span>
<span class="w">            </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">location</span><span class="p">,</span>
<span class="w">            </span><span class="n">forecasts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">list</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">DailyForecast</span><span class="p">(</span>
<span class="w">                    </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">dt_txt</span><span class="p">,</span>
<span class="w">                    </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">main</span><span class="p">.</span><span class="na">temp</span><span class="p">,</span>
<span class="w">                    </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">weather</span><span class="p">.</span><span class="na">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="na">description</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;Unknown&quot;</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// API ì‘ë‹µ ë§¤í•‘ í´ë˜ìŠ¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">OpenWeatherApiResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">main</span><span class="p">:</span><span class="w"> </span><span class="n">MainData</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">weather</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WeatherData</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MainData</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">temp</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">humidity</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WeatherData</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>

<span class="c1">// ì˜ˆë³´ ê´€ë ¨</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ForecastResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">forecasts</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DailyForecast</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">DailyForecast</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">date</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">temperature</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">condition</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// config/WeatherFunctionConfig.kt</span>
<span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherFunctionConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Get current weather conditions for a city. Returns temperature, humidity, and weather description.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">currentWeather</span><span class="p">(</span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherService</span><span class="p">):</span><span class="w"> </span><span class="p">(</span><span class="n">WeatherRequest</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">unit</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Get weather forecast for the next several days. Specify the city and number of days (1-5).&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">weatherForecast</span><span class="p">(</span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherService</span><span class="p">):</span><span class="w"> </span><span class="p">(</span><span class="n">ForecastRequest</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ForecastResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getForecast</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">days</span><span class="p">.</span><span class="na">coerceIn</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Compare weather between two cities&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">compareWeather</span><span class="p">(</span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherService</span><span class="p">):</span><span class="w"> </span><span class="p">(</span><span class="n">CompareRequest</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">CompareResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">weather1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">city1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;celsius&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">weather2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">city2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;celsius&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">CompareResponse</span><span class="p">(</span>
<span class="w">            </span><span class="n">city1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weather1</span><span class="p">,</span>
<span class="w">            </span><span class="n">city2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weather2</span><span class="p">,</span>
<span class="w">            </span><span class="n">temperatureDifference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weather1</span><span class="p">.</span><span class="na">temperature</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">weather2</span><span class="p">.</span><span class="na">temperature</span><span class="p">,</span>
<span class="w">            </span><span class="n">warmerCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">weather1</span><span class="p">.</span><span class="na">temperature</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">weather2</span><span class="p">.</span><span class="na">temperature</span><span class="p">)</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">city1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">city2</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ForecastRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;City name&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Number of days for forecast (1-5)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">days</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CompareRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;First city to compare&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">city1</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Second city to compare&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">city2</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CompareResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">city1</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">city2</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">temperatureDifference</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">warmerCity</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="module-32-function-calling">Module 3.2: ì‹¤ì „ Function Calling íŒ¨í„´</h2>
<h3 id="321">3.2.1 ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ í•¨ìˆ˜</h3>
<div class="codehilite"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">DatabaseFunctionConfig</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">customerRepository</span><span class="p">:</span><span class="w"> </span><span class="n">CustomerRepository</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">orderRepository</span><span class="p">:</span><span class="w"> </span><span class="n">OrderRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Look up customer information by ID or email&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">lookupCustomer</span><span class="p">():</span><span class="w"> </span><span class="p">(</span><span class="n">CustomerLookupRequest</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">CustomerInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="na">customerId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">customerId</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">orElseThrow</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CustomerNotFoundException</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">customerId</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="na">email</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">findByEmail</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">email</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">orElseThrow</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CustomerNotFoundException</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">email</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Either customerId or email must be provided&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">CustomerInfo</span><span class="p">(</span>
<span class="w">            </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">            </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">email</span><span class="p">,</span>
<span class="w">            </span><span class="n">memberSince</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">createdAt</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">            </span><span class="n">tier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">membershipTier</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Get customer&#39;s recent order history&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getOrderHistory</span><span class="p">():</span><span class="w"> </span><span class="p">(</span><span class="n">OrderHistoryRequest</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderSummary</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">findByCustomerIdOrderByCreatedAtDesc</span><span class="p">(</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="na">customerId</span><span class="p">,</span>
<span class="w">            </span><span class="n">PageRequest</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">limit</span><span class="p">)</span>
<span class="w">        </span><span class="p">).</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">OrderSummary</span><span class="p">(</span>
<span class="w">                </span><span class="n">orderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">                </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">createdAt</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">total</span><span class="p">,</span>
<span class="w">                </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">status</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">                </span><span class="n">itemCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">items</span><span class="p">.</span><span class="na">size</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ë°ì´í„° í´ë˜ìŠ¤ë“¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CustomerLookupRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Customer ID (numeric)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">customerId</span><span class="p">:</span><span class="w"> </span><span class="kt">Long?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Customer email address&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CustomerInfo</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">memberSince</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tier</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">OrderHistoryRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Customer ID to look up orders for&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">customerId</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Maximum number of orders to return (default: 10)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">limit</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">OrderSummary</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">orderId</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">date</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">total</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">status</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">itemCount</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="322">3.2.2 ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´</h3>
<p>í•¨ìˆ˜ í˜¸ì¶œ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•´ë„ AIê°€ ì ì ˆíˆ ëŒ€ì‘í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Bean</span>
<span class="nd">@Description</span><span class="p">(</span><span class="s">&quot;Transfer money between accounts&quot;</span><span class="p">)</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">transferMoney</span><span class="p">(</span><span class="n">bankingService</span><span class="p">:</span><span class="w"> </span><span class="n">BankingService</span><span class="p">):</span><span class="w"> </span><span class="p">(</span><span class="n">TransferRequest</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">TransferResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ì…ë ¥ ê²€ì¦</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">amount</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="nd">@Function</span><span class="w"> </span><span class="n">TransferResult</span><span class="p">.</span><span class="na">error</span><span class="p">(</span>
<span class="w">                </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;INVALID_AMOUNT&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Transfer amount must be positive&quot;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ì”ì•¡ í™•ì¸</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bankingService</span><span class="p">.</span><span class="na">getBalance</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">fromAccount</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">balance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="nd">@Function</span><span class="w"> </span><span class="n">TransferResult</span><span class="p">.</span><span class="na">error</span><span class="p">(</span>
<span class="w">                </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;INSUFFICIENT_FUNDS&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Insufficient balance. Available: </span><span class="err">$</span><span class="si">${</span><span class="kt">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;</span><span class="o">%</span><span class="p">.</span><span class="m">2f</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ì´ì²´ ì‹¤í–‰</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">transactionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bankingService</span><span class="p">.</span><span class="na">transfer</span><span class="p">(</span>
<span class="w">            </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">fromAccount</span><span class="p">,</span>
<span class="w">            </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">toAccount</span><span class="p">,</span>
<span class="w">            </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">amount</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">TransferResult</span><span class="p">.</span><span class="na">success</span><span class="p">(</span>
<span class="w">            </span><span class="n">transactionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transactionId</span><span class="p">,</span>
<span class="w">            </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">amount</span><span class="p">,</span>
<span class="w">            </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Transfer completed successfully&quot;</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">AccountNotFoundException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TransferResult</span><span class="p">.</span><span class="na">error</span><span class="p">(</span>
<span class="w">            </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ACCOUNT_NOT_FOUND&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;Account not found&quot;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TransferResult</span><span class="p">.</span><span class="na">error</span><span class="p">(</span>
<span class="w">            </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SYSTEM_ERROR&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Transfer failed. Please try again later.&quot;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">TransferRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Source account number&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">fromAccount</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Destination account number&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">toAccount</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;Amount to transfer&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">amount</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">TransferResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">success</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">transactionId</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">amount</span><span class="p">:</span><span class="w"> </span><span class="kt">Double?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">errorCode</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">success</span><span class="p">(</span><span class="n">transactionId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">TransferResult</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">transactionId</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>

<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">TransferResult</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="323">3.2.3 í•¨ìˆ˜ ì²´ì´ë‹</h3>
<p>AIê°€ ë³µì¡í•œ ì‘ì—…ì„ ìœ„í•´ ì—¬ëŸ¬ í•¨ìˆ˜ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@RestController</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">TravelPlannerController</span><span class="p">(</span><span class="n">chatClientBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClientBuilder</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultFunctions</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;getWeather&quot;</span><span class="p">,</span><span class="w">      </span><span class="c1">// ë‚ ì”¨ í™•ì¸</span>
<span class="w">            </span><span class="s">&quot;searchFlights&quot;</span><span class="p">,</span><span class="w">   </span><span class="c1">// í•­ê³µí¸ ê²€ìƒ‰</span>
<span class="w">            </span><span class="s">&quot;searchHotels&quot;</span><span class="p">,</span><span class="w">    </span><span class="c1">// í˜¸í…” ê²€ìƒ‰</span>
<span class="w">            </span><span class="s">&quot;getActivities&quot;</span><span class="w">    </span><span class="c1">// ê´€ê´‘ì§€/í™œë™ ì¶”ì²œ</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">defaultSystem</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            You are an expert travel planner. When planning a trip:</span>
<span class="s">            1. First check the weather at the destination</span>
<span class="s">            2. Search for suitable flights</span>
<span class="s">            3. Find hotels that match the budget</span>
<span class="s">            4. Suggest activities based on weather and interests</span>

<span class="s">            Always explain your reasoning and provide options.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/plan-trip&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">planTrip</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">TripRequest</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                Plan a </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">duration</span><span class="si">}</span><span class="s">-day trip to </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">destination</span><span class="si">}</span>
<span class="s">                departing from </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">origin</span><span class="si">}</span><span class="s"> on </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">departureDate</span><span class="si">}</span><span class="s">.</span>

<span class="s">                Budget: </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">budget</span><span class="si">}</span>
<span class="s">                Interests: </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">interests</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="p">)</span><span class="si">}</span>

<span class="s">                Please provide a complete travel plan.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">TripRequest</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">destination</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">origin</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">departureDate</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">duration</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">budget</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">interests</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="module-33-advisors">Module 3.3: Advisors íŒ¨í„´</h2>
<h3 id="331-advisor">3.3.1 Advisorë€?</h3>
<p>AdvisorëŠ” AI ìš”ì²­/ì‘ë‹µì„ ê°€ë¡œì±„ì„œ ì²˜ë¦¬í•˜ëŠ” ì¸í„°ì…‰í„°ì…ë‹ˆë‹¤. Spring AOPì™€ ë¹„ìŠ·í•œ ê°œë…ì…ë‹ˆë‹¤.</p>
<p><img alt="Advisor Pattern" src="file:///Users/robin/Downloads/spring-ai-examples/book/images/advisor-pattern.png" /></p>
<table>
<thead>
<tr>
<th>ì²˜ë¦¬ ë‹¨ê³„</th>
<th>ìš”ì²­ ì‹œ (â†“)</th>
<th>ì‘ë‹µ ì‹œ (â†‘)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Advisor 1</strong></td>
<td>ìš”ì²­ ë¡œê¹…</td>
<td>ì‘ë‹µ ë¡œê¹…, ì†Œìš” ì‹œê°„ ê¸°ë¡</td>
</tr>
<tr>
<td><strong>Advisor 2</strong></td>
<td>ìºì‹œ í™•ì¸</td>
<td>ìºì‹œ ì €ì¥</td>
</tr>
<tr>
<td><strong>Advisor 3</strong></td>
<td>ì…ë ¥ ê²€ì¦</td>
<td>ì‘ë‹µ í•„í„°ë§</td>
</tr>
<tr>
<td><strong>ChatModel</strong></td>
<td>AI ì²˜ë¦¬</td>
<td>-</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>í•µì‹¬ í¬ì¸íŠ¸</strong>: AdvisorëŠ” ì²´ì¸ í˜•íƒœë¡œ ì—°ê²°ë˜ë©°, ìš”ì²­ì€ ìˆœë°©í–¥(1â†’2â†’3), ì‘ë‹µì€ ì—­ë°©í–¥(3â†’2â†’1)ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.</p>
</blockquote>
<h3 id="332-requestresponseadvisor">3.3.2 RequestResponseAdvisor êµ¬í˜„</h3>
<p>ìš”ì²­ê³¼ ì‘ë‹µì„ ê°ê° ì²˜ë¦¬í•˜ëŠ” Advisor:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ai.chat.client.advisor.api.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.core.Ordered</span>

<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">LoggingAdvisor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">RequestResponseAdvisor</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">LoggingAdvisor</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">adviseRequest</span><span class="p">(</span>
<span class="w">        </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">AdvisedRequest</span><span class="p">,</span>
<span class="w">        </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">MutableMap</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">AdvisedRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;ğŸ”µ Request: </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">userText</span><span class="p">.</span><span class="na">take</span><span class="p">(</span><span class="m">100</span><span class="p">)</span><span class="si">}</span><span class="s">...&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;ğŸ”§ Functions: </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">functionNames</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">context</span><span class="o">[</span><span class="s">&quot;requestTime&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">adviseResponse</span><span class="p">(</span>
<span class="w">        </span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="n">ChatResponse</span><span class="p">,</span>
<span class="w">        </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">MutableMap</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">ChatResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="o">[</span><span class="s">&quot;requestTime&quot;</span><span class="o">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">Long</span><span class="p">)</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;ğŸŸ¢ Response: </span><span class="si">${</span><span class="n">response</span><span class="p">.</span><span class="na">result</span><span class="p">.</span><span class="na">output</span><span class="p">.</span><span class="na">content</span><span class="p">.</span><span class="na">take</span><span class="p">(</span><span class="m">100</span><span class="p">)</span><span class="si">}</span><span class="s">...&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;â±ï¸ Duration: </span><span class="si">${</span><span class="n">duration</span><span class="si">}</span><span class="s">ms&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;ğŸ“Š Tokens: </span><span class="si">${</span><span class="n">response</span><span class="p">.</span><span class="na">metadata</span><span class="p">.</span><span class="na">usage</span><span class="o">?.</span><span class="na">totalTokens</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">response</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getOrder</span><span class="p">():</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ordered</span><span class="p">.</span><span class="na">HIGHEST_PRECEDENCE</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="advisor">ì»¨í…ìŠ¤íŠ¸ ë³´ê°• Advisor</h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">UserContextAdvisor</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">userContextService</span><span class="p">:</span><span class="w"> </span><span class="n">UserContextService</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">RequestResponseAdvisor</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">adviseRequest</span><span class="p">(</span>
<span class="w">        </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">AdvisedRequest</span><span class="p">,</span>
<span class="w">        </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">MutableMap</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">AdvisedRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ì‚¬ìš©ì ID ì¶”ì¶œ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="o">[</span><span class="s">&quot;userId&quot;</span><span class="o">]</span><span class="w"> </span><span class="k">as?</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">request</span>

<span class="w">        </span><span class="c1">// ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ ë¡œë“œ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">userContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userContextService</span><span class="p">.</span><span class="na">getContext</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ë³´ê°•</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">enrichedSystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">systemText</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;</span><span class="n">You</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">helpful</span><span class="w"> </span><span class="n">assistant</span><span class="p">.</span><span class="s">&quot;</span><span class="si">}</span>

<span class="s">            ## User Context</span>
<span class="s">            - Name: </span><span class="si">${</span><span class="n">userContext</span><span class="p">.</span><span class="na">name</span><span class="si">}</span>
<span class="s">            - Preferences: </span><span class="si">${</span><span class="n">userContext</span><span class="p">.</span><span class="na">preferences</span><span class="si">}</span>
<span class="s">            - Previous interactions: </span><span class="si">${</span><span class="n">userContext</span><span class="p">.</span><span class="na">interactionCount</span><span class="si">}</span>
<span class="s">            - Language preference: </span><span class="si">${</span><span class="n">userContext</span><span class="p">.</span><span class="na">language</span><span class="si">}</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">()</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">AdvisedRequest</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withSystemText</span><span class="p">(</span><span class="n">enrichedSystem</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getOrder</span><span class="p">():</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="333-callaroundadvisor">3.3.3 CallAroundAdvisor êµ¬í˜„</h3>
<p>ì „ì²´ í˜¸ì¶œ íë¦„ì„ ì œì–´í•˜ëŠ” Advisor:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">CachingAdvisor</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">cache</span><span class="p">:</span><span class="w"> </span><span class="n">Cache</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">ChatResponse</span><span class="o">&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">CallAroundAdvisor</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">aroundCall</span><span class="p">(</span>
<span class="w">        </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">AdvisedRequest</span><span class="p">,</span>
<span class="w">        </span><span class="n">chain</span><span class="p">:</span><span class="w"> </span><span class="n">CallAroundAdvisorChain</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">AdvisedResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ìºì‹œ í‚¤ ìƒì„±</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">cacheKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateCacheKey</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// ìºì‹œ í™•ì¸</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="na">getIfPresent</span><span class="p">(</span><span class="n">cacheKey</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cached</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">AdvisedResponse</span><span class="p">(</span><span class="n">cached</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">adviseContext</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ì‹¤ì œ AI í˜¸ì¶œ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="na">nextAroundCall</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// ìºì‹œ ì €ì¥ (í•¨ìˆ˜ í˜¸ì¶œì´ ì—†ëŠ” ê²½ìš°ì—ë§Œ)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">response</span><span class="p">.</span><span class="na">result</span><span class="p">.</span><span class="na">output</span><span class="p">.</span><span class="na">toolCalls</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">cache</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">cacheKey</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">response</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">response</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateCacheKey</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">AdvisedRequest</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">userText</span><span class="si">}</span><span class="s">|</span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">systemText</span><span class="si">}</span><span class="s">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DigestUtils</span><span class="p">.</span><span class="na">sha256Hex</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getOrder</span><span class="p">():</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="advisor_1">ì¬ì‹œë„ Advisor</h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">RetryAdvisor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">CallAroundAdvisor</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">RetryAdvisor</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">maxRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">backoffMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000L</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">aroundCall</span><span class="p">(</span>
<span class="w">        </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">AdvisedRequest</span><span class="p">,</span>
<span class="w">        </span><span class="n">chain</span><span class="p">:</span><span class="w"> </span><span class="n">CallAroundAdvisorChain</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">AdvisedResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">lastException</span><span class="p">:</span><span class="w"> </span><span class="n">Exception? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">        </span><span class="n">repeat</span><span class="p">(</span><span class="n">maxRetries</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="na">nextAroundCall</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">TransientAiException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">lastException</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span>
<span class="w">                </span><span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Attempt </span><span class="si">${</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="si">}</span><span class="s"> failed: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attempt</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">maxRetries</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">backoffMs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Max retries exceeded&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lastException</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getOrder</span><span class="p">():</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ordered</span><span class="p">.</span><span class="na">HIGHEST_PRECEDENCE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">10</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="334-advisor">3.3.4 Advisor ì²´ì´ë‹</h3>
<p>ì—¬ëŸ¬ Advisorë¥¼ ì¡°í•©í•˜ì—¬ ì‚¬ìš©:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AdvisorConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chatClient</span><span class="p">(</span>
<span class="w">        </span><span class="n">builder</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">,</span>
<span class="w">        </span><span class="n">loggingAdvisor</span><span class="p">:</span><span class="w"> </span><span class="n">LoggingAdvisor</span><span class="p">,</span>
<span class="w">        </span><span class="n">cachingAdvisor</span><span class="p">:</span><span class="w"> </span><span class="n">CachingAdvisor</span><span class="p">,</span>
<span class="w">        </span><span class="n">retryAdvisor</span><span class="p">:</span><span class="w"> </span><span class="n">RetryAdvisor</span><span class="p">,</span>
<span class="w">        </span><span class="n">userContextAdvisor</span><span class="p">:</span><span class="w"> </span><span class="n">UserContextAdvisor</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">ChatClient</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span>
<span class="w">            </span><span class="p">.</span><span class="na">defaultAdvisors</span><span class="p">(</span>
<span class="w">                </span><span class="n">retryAdvisor</span><span class="p">,</span><span class="w">        </span><span class="c1">// 1. ì¬ì‹œë„ (ê°€ì¥ ë°”ê¹¥)</span>
<span class="w">                </span><span class="n">loggingAdvisor</span><span class="p">,</span><span class="w">      </span><span class="c1">// 2. ë¡œê¹…</span>
<span class="w">                </span><span class="n">cachingAdvisor</span><span class="p">,</span><span class="w">      </span><span class="c1">// 3. ìºì‹±</span>
<span class="w">                </span><span class="n">userContextAdvisor</span><span class="w">   </span><span class="c1">// 4. ì»¨í…ìŠ¤íŠ¸ ë³´ê°• (ê°€ì¥ ì•ˆìª½)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="335">3.3.5 ì‹¤ì „: ëŒ€í™” ë¶„ì„ ì‹œìŠ¤í…œ</h3>
<p>ëª¨ë“  ëŒ€í™”ë¥¼ ë¡œê¹…í•˜ê³  ë¶„ì„í•˜ëŠ” ì¢…í•© Advisor:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ConversationAnalyticsAdvisor</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">conversationRepository</span><span class="p">:</span><span class="w"> </span><span class="n">ConversationRepository</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">analyticsService</span><span class="p">:</span><span class="w"> </span><span class="n">AnalyticsService</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">CallAroundAdvisor</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">aroundCall</span><span class="p">(</span>
<span class="w">        </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">AdvisedRequest</span><span class="p">,</span>
<span class="w">        </span><span class="n">chain</span><span class="p">:</span><span class="w"> </span><span class="n">CallAroundAdvisorChain</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">AdvisedResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">conversationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">()</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// ëŒ€í™” ë¡œê·¸ ì´ˆê¸°í™”</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConversationLog</span><span class="p">(</span>
<span class="w">            </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conversationId</span><span class="p">,</span>
<span class="w">            </span><span class="n">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">adviseContext</span><span class="o">[</span><span class="s">&quot;userId&quot;</span><span class="o">]</span><span class="w"> </span><span class="k">as?</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">            </span><span class="n">userMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">userText</span><span class="p">,</span>
<span class="w">            </span><span class="n">systemPrompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">systemText</span><span class="p">,</span>
<span class="w">            </span><span class="n">functions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">functionNames</span><span class="p">.</span><span class="na">toList</span><span class="p">(),</span>
<span class="w">            </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// AI í˜¸ì¶œ</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="na">nextAroundCall</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">response</span>

<span class="w">            </span><span class="c1">// ì„±ê³µ ë¡œê¹…</span>
<span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">assistantMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatResponse</span><span class="p">.</span><span class="na">result</span><span class="p">.</span><span class="na">output</span><span class="p">.</span><span class="na">content</span>
<span class="w">                </span><span class="n">tokensUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatResponse</span><span class="p">.</span><span class="na">metadata</span><span class="p">.</span><span class="na">usage</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">TokenUsage</span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">promptTokens</span><span class="p">,</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">generationTokens</span><span class="p">,</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">totalTokens</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">latencyMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span>
<span class="w">                </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SUCCESS&quot;</span>
<span class="w">                </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateCost</span><span class="p">(</span><span class="n">tokensUsed</span><span class="p">)</span>
<span class="w">                </span><span class="n">toolCalls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractToolCalls</span><span class="p">(</span><span class="n">chatResponse</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">conversationRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
<span class="w">            </span><span class="n">analyticsService</span><span class="p">.</span><span class="na">trackConversation</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>

<span class="w">            </span><span class="n">response</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ì—ëŸ¬ ë¡œê¹…</span>
<span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ERROR&quot;</span>
<span class="w">                </span><span class="n">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">message</span>
<span class="w">                </span><span class="n">latencyMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">conversationRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">calculateCost</span><span class="p">(</span><span class="n">usage</span><span class="p">:</span><span class="w"> </span><span class="n">TokenUsage?)</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">usage</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0.0</span>
<span class="w">        </span><span class="c1">// GPT-4 ê¸°ì¤€ ê°€ê²© (ì˜ˆì‹œ)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">inputCost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usage</span><span class="p">.</span><span class="na">promptTokens</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.00003</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">outputCost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usage</span><span class="p">.</span><span class="na">completionTokens</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.00006</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">inputCost</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">outputCost</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">extractToolCalls</span><span class="p">(</span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="n">ChatResponse</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">result</span><span class="p">.</span><span class="na">output</span><span class="p">.</span><span class="na">toolCalls</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getOrder</span><span class="p">():</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="p">}</span>

<span class="c1">// ë°ì´í„° í´ë˜ìŠ¤ë“¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ConversationLog</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">userMessage</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">systemPrompt</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">functions</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">timestamp</span><span class="p">:</span><span class="w"> </span><span class="n">Instant</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">assistantMessage</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">tokensUsed</span><span class="p">:</span><span class="w"> </span><span class="n">TokenUsage? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">latencyMs</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">status</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PENDING&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">errorMessage</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">cost</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">toolCalls</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">emptyList</span><span class="p">()</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">TokenUsage</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">promptTokens</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">completionTokens</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">totalTokens</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="part-3">Part 3 ìš”ì•½</h2>
<h3 id="_4">ì´ íŒŒíŠ¸ì—ì„œ ë°°ìš´ ê²ƒ</h3>
<h4 id="function-calling-ai">Function Calling: AIì—ê²Œ í–‰ë™ ëŠ¥ë ¥ ë¶€ì—¬</h4>
<p>Function Callingì€ AIë¥¼ ë‹¨ìˆœí•œ í…ìŠ¤íŠ¸ ìƒì„±ê¸°ì—ì„œ <strong>ì‹¤í–‰ ê°€ëŠ¥í•œ ì—ì´ì „íŠ¸</strong>ë¡œ ì „í™˜ì‹œí‚¤ëŠ” í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. AIê°€ ì§ì ‘ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì–´ë–¤ í•¨ìˆ˜ë¥¼ ì–´ë–¤ ì¸ìë¡œ í˜¸ì¶œí•´ì•¼ í•˜ëŠ”ì§€ë¥¼ ê²°ì •í•˜ê³ , ì‹¤ì œ ì‹¤í–‰ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹´ë‹¹í•©ë‹ˆë‹¤. ì´ ë¶„ë¦¬ëœ êµ¬ì¡°ëŠ” ë³´ì•ˆì„±ì„ ìœ ì§€í•˜ë©´ì„œë„ AIì—ê²Œ ì™¸ë¶€ ì„¸ê³„ì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
<h4 id="_5">ë©”íƒ€ë°ì´í„° ê¸°ë°˜ í•¨ìˆ˜ ì„¤ê³„</h4>
<p><code>@Description</code> ì–´ë…¸í…Œì´ì…˜ì€ ë‹¨ìˆœí•œ ì£¼ì„ì´ ì•„ë‹ˆë¼ AIê°€ í•¨ìˆ˜ë¥¼ ì´í•´í•˜ëŠ” <strong>ìœ ì¼í•œ ì¸í„°í˜ì´ìŠ¤</strong>ì…ë‹ˆë‹¤. í•¨ìˆ˜ì˜ ëª©ì , íŒŒë¼ë¯¸í„°ì˜ ì˜ë¯¸, ë°˜í™˜ê°’ì˜ í˜•ì‹ì„ ëª…í™•í•˜ê²Œ ê¸°ìˆ í•´ì•¼ AIê°€ ì ì ˆí•œ ìƒí™©ì—ì„œ ì˜¬ë°”ë¥¸ í•¨ìˆ˜ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ ì„¤ê³„ëœ í•¨ìˆ˜ ì„¤ëª…ì€ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì˜ ì—°ì¥ì„ ìƒì— ìˆìœ¼ë©°, AIì˜ ë„êµ¬ ì‚¬ìš© ì •í™•ë„ë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì¢Œìš°í•©ë‹ˆë‹¤.</p>
<h4 id="advisor_2">Advisor íŒ¨í„´: íš¡ë‹¨ ê´€ì‹¬ì‚¬ì˜ ìš°ì•„í•œ ì²˜ë¦¬</h4>
<p>AdvisorëŠ” AOP(Aspect-Oriented Programming)ì˜ ê°œë…ì„ AI í˜¸ì¶œ íŒŒì´í”„ë¼ì¸ì— ì ìš©í•œ ê²ƒì…ë‹ˆë‹¤. <code>CallAroundAdvisor</code>ëŠ” ì „ì²´ ìš”ì²­-ì‘ë‹µ ì‚¬ì´í´ì„ ê°ì‹¸ ìºì‹±, ì¬ì‹œë„, ì¸ì¦ ë“±ì˜ íš¡ë‹¨ ê´€ì‹¬ì‚¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. <code>RequestResponseAdvisor</code>ëŠ” ìš”ì²­ê³¼ ì‘ë‹µì„ ê°œë³„ì ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¡œê¹…, ê²€ì¦, í•„í„°ë§ ë“±ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. Advisor ì²´ì´ë‹ì„ í†µí•´ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ë©´ì„œë„ ìœ ì—°í•œ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h3 id="_6">í•µì‹¬ ê°œë… ì •ë¦¬</h3>
<table>
<thead>
<tr>
<th>ê°œë…</th>
<th>ì„¤ëª…</th>
<th>ì‚¬ìš© ì‹œì </th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Function Calling</strong></td>
<td>AIê°€ í•¨ìˆ˜ í˜¸ì¶œ ì‹œì ê³¼ ì¸ìë¥¼ ê²°ì •í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜. ì‹¤í–‰ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹´ë‹¹</td>
<td>ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒ, CRUD ì‘ì—…, ì™¸ë¶€ API ì—°ë™</td>
</tr>
<tr>
<td><strong>@Description</strong></td>
<td>í•¨ìˆ˜ì™€ íŒŒë¼ë¯¸í„°ì— ëŒ€í•œ ìì—°ì–´ ì„¤ëª…. AIì˜ í•¨ìˆ˜ ì„ íƒ ì •í™•ë„ì— ì§ì ‘ ì˜í–¥</td>
<td>ëª¨ë“  Function ì •ì˜ ì‹œ í•„ìˆ˜. ìƒì„¸í• ìˆ˜ë¡ ì¢‹ìŒ</td>
</tr>
<tr>
<td><strong>CallAroundAdvisor</strong></td>
<td>ì „ì²´ AI í˜¸ì¶œ íë¦„ì„ ê°ì‹¸ëŠ” ë˜í¼. Interceptor íŒ¨í„´ì˜ AI ì ìš©</td>
<td>ìºì‹±, ì¬ì‹œë„, ì¸ì¦, íŠ¸ëœì­ì…˜, ì„±ëŠ¥ ì¸¡ì •</td>
</tr>
<tr>
<td><strong>RequestResponseAdvisor</strong></td>
<td>ìš”ì²­/ì‘ë‹µì„ ê°œë³„ì ìœ¼ë¡œ ë³€í™˜. ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì¤€ìˆ˜</td>
<td>ë¡œê¹…, ì…ë ¥ ê²€ì¦, ì¶œë ¥ í•„í„°ë§, ì»¨í…ìŠ¤íŠ¸ ì£¼ì…</td>
</tr>
</tbody>
</table>
<h3 id="_7">ì‹¤ì „ í™œìš© íŒ</h3>
<h4 id="function">Function ì„¤ê³„ ì›ì¹™</h4>
<ul>
<li><strong>ë‹¨ì¼ ì±…ì„</strong>: í•˜ë‚˜ì˜ í•¨ìˆ˜ëŠ” í•˜ë‚˜ì˜ ëª…í™•í•œ ì‘ì—…ë§Œ ìˆ˜í–‰í•˜ì„¸ìš”</li>
<li><strong>ëª…í™•í•œ ë„¤ì´ë°</strong>: í•¨ìˆ˜ëª…ë§Œìœ¼ë¡œ ëª©ì ì´ ë“œëŸ¬ë‚˜ì•¼ í•©ë‹ˆë‹¤ (<code>getWeather</code> &gt; <code>process</code>)</li>
<li><strong>ì ì ˆí•œ ì„¸ë¶„í™”</strong>: ë„ˆë¬´ ë§ì€ í•¨ìˆ˜ëŠ” AIë¥¼ í˜¼ë€ìŠ¤ëŸ½ê²Œ, ë„ˆë¬´ ì ìœ¼ë©´ ìœ ì—°ì„±ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤</li>
</ul>
<h4 id="description">@Description ì‘ì„± ì‹œ</h4>
<ul>
<li><strong>ì‚¬ìš© ì‹œì  ëª…ì‹œ</strong>: "ì‚¬ìš©ìê°€ ë‚ ì”¨ë¥¼ ë¬¼ì–´ë³¼ ë•Œ ì‚¬ìš©"ì²˜ëŸ¼ í˜¸ì¶œ ì¡°ê±´ì„ ëª…í™•íˆ</li>
<li><strong>íŒŒë¼ë¯¸í„° ì œì•½ ì¡°ê±´</strong>: í—ˆìš©ë˜ëŠ” ê°’ì˜ ë²”ìœ„ë‚˜ í˜•ì‹ì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ </li>
<li><strong>ì˜ˆì‹œ í¬í•¨</strong>: ë³µì¡í•œ íŒŒë¼ë¯¸í„°ëŠ” ì˜ˆì‹œë¥¼ í†µí•´ ì´í•´ë„ í–¥ìƒ</li>
</ul>
<h4 id="advisor_3">Advisor í™œìš© ì‹œ</h4>
<ul>
<li><strong>ìˆœì„œ ì¤‘ìš”</strong>: Advisor ì²´ì¸ì˜ ì‹¤í–‰ ìˆœì„œê°€ ê²°ê³¼ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤</li>
<li><strong>ìƒíƒœ ê´€ë¦¬ ì£¼ì˜</strong>: AdvisorëŠ” statelessí•˜ê²Œ ì„¤ê³„í•˜ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤</li>
<li><strong>ì—ëŸ¬ ì „íŒŒ ê³ ë ¤</strong>: ì¤‘ê°„ Advisorì˜ ì˜ˆì™¸ê°€ ì „ì²´ ì²´ì¸ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ê³ ë ¤í•˜ì„¸ìš”</li>
</ul>
<h3 id="_8">ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜</h3>
<table>
<thead>
<tr>
<th>ì‹¤ìˆ˜</th>
<th>ë¬¸ì œì </th>
<th>í•´ê²° ë°©ë²•</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Description ëˆ„ë½</td>
<td>AIê°€ í•¨ìˆ˜ ëª©ì ì„ ì´í•´í•˜ì§€ ëª»í•´ ì˜ëª»ëœ í˜¸ì¶œ</td>
<td>ëª¨ë“  í•¨ìˆ˜ì™€ íŒŒë¼ë¯¸í„°ì— ìƒì„¸í•œ ì„¤ëª… ì¶”ê°€</td>
</tr>
<tr>
<td>ê³¼ë„í•œ í•¨ìˆ˜ ê°œìˆ˜</td>
<td>AI ì„ íƒ ì •í™•ë„ ì €í•˜, í† í° ë‚­ë¹„</td>
<td>ìœ ì‚¬ ê¸°ëŠ¥ í†µí•©, ê³„ì¸µì  êµ¬ì¡°í™”</td>
</tr>
<tr>
<td>ë™ê¸° í•¨ìˆ˜ë¡œ ì¥ì‹œê°„ ì‘ì—…</td>
<td>ì‘ë‹µ ì§€ì—°, íƒ€ì„ì•„ì›ƒ ë°œìƒ</td>
<td>ë¹„ë™ê¸° ì²˜ë¦¬ ë˜ëŠ” ì‘ì—… ë¶„í• </td>
</tr>
<tr>
<td>ë¯¼ê°í•œ ì‘ì—… ê²€ì¦ ëˆ„ë½</td>
<td>ë³´ì•ˆ ì·¨ì•½ì , ì˜ë„ì¹˜ ì•Šì€ ë°ì´í„° ë³€ê²½</td>
<td>Advisorì—ì„œ ê¶Œí•œ ê²€ì¦, í™•ì¸ ë¡œì§ ì¶”ê°€</td>
</tr>
</tbody>
</table>
<h3 id="_9">í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
<ul>
<li>[ ] Function Bean ì •ì˜ ë° ë“±ë¡</li>
<li>[ ] ìš”ì²­/ì‘ë‹µ ë°ì´í„° í´ë˜ìŠ¤ ì„¤ê³„</li>
<li>[ ] @Descriptionìœ¼ë¡œ ëª…í™•í•œ ì„¤ëª… ì œê³µ</li>
<li>[ ] ë©€í‹° í•¨ìˆ˜ ì‹œë‚˜ë¦¬ì˜¤ ì²˜ë¦¬</li>
<li>[ ] ì—ëŸ¬ ì²˜ë¦¬ êµ¬í˜„</li>
<li>[ ] ì™¸ë¶€ API/DB ì—°ë™</li>
<li>[ ] Advisor êµ¬í˜„ ë° ì²´ì´ë‹</li>
<li>[ ] ëŒ€í™” ë¶„ì„ ì‹œìŠ¤í…œ êµ¬ì¶•</li>
</ul>
<h3 id="_10">ë‹¤ìŒ ë‹¨ê³„</h3>
<p>Part 3ì—ì„œ AIì—ê²Œ ë„êµ¬ ì‚¬ìš© ëŠ¥ë ¥ì„ ë¶€ì—¬í–ˆë‹¤ë©´, ì´ì œ ì´ ë„êµ¬ë“¤ì„ <strong>ì§€ëŠ¥ì ìœ¼ë¡œ ì¡°í•©</strong>í•˜ëŠ” ë°©ë²•ì„ ë°°ìš¸ ì°¨ë¡€ì…ë‹ˆë‹¤.</p>
<p><strong>Part 4: Agentic Patterns</strong>ì—ì„œ ë°°ìš¸ ë‚´ìš©:</p>
<table>
<thead>
<tr>
<th>íŒ¨í„´</th>
<th>ì„¤ëª…</th>
<th>í™œìš© ì˜ˆì‹œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Chain Workflow</strong></td>
<td>ìˆœì°¨ì  ë‹¨ê³„ ì²˜ë¦¬ë¡œ ë³µì¡í•œ ì‘ì—… ë¶„í•´</td>
<td>ì½˜í…ì¸  ìƒì„± íŒŒì´í”„ë¼ì¸, ë°ì´í„° ì²˜ë¦¬</td>
</tr>
<tr>
<td><strong>Parallelization</strong></td>
<td>ë…ë¦½ì  ì‘ì—…ì˜ ë™ì‹œ ì‹¤í–‰ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒ</td>
<td>ë‹¤êµ­ì–´ ë²ˆì—­, ë‹¤ì¤‘ ë¶„ì„</td>
</tr>
<tr>
<td><strong>Routing</strong></td>
<td>ì…ë ¥ ìœ í˜•ì— ë”°ë¥¸ ì „ë¬¸í™”ëœ ì²˜ë¦¬ ë¶„ê¸°</td>
<td>FAQ ë´‡, í‹°ì¼“ ë¶„ë¥˜ ì‹œìŠ¤í…œ</td>
</tr>
<tr>
<td><strong>Orchestrator-Workers</strong></td>
<td>ë™ì  ì‘ì—… ë¶„í•´ì™€ ìœ„ì„</td>
<td>ë³µì¡í•œ í”„ë¡œì íŠ¸ ê´€ë¦¬, ì—°êµ¬ ì—ì´ì „íŠ¸</td>
</tr>
<tr>
<td><strong>Evaluator-Optimizer</strong></td>
<td>ë°˜ë³µì  í’ˆì§ˆ ê°œì„ </td>
<td>ì½˜í…ì¸  í’ˆì§ˆ ë³´ì¥, ì½”ë“œ ë¦¬ë·°</td>
</tr>
<tr>
<td><strong>Reflection Agent</strong></td>
<td>ìê¸° ê²€ì¦ê³¼ ê°œì„ </td>
<td>ê³ ì •ë°€ ì‘ì—…, ì˜ì‚¬ê²°ì • ì§€ì›</td>
</tr>
</tbody>
</table>
<p>Agentic PatternsëŠ” Function Callingì„ ê¸°ë°˜ìœ¼ë¡œ <strong>ììœ¨ì ì¸ AI ì‹œìŠ¤í…œ</strong>ì„ êµ¬ì¶•í•˜ëŠ” ì„¤ê³„ ì›ì¹™ì…ë‹ˆë‹¤!</p>
<hr />
<h2 id="_11">ì°¸ê³  ì˜ˆì œ ì½”ë“œ</h2>
<div class="codehilite"><pre><span></span><code>spring-ai-examples/
â”œâ”€â”€ kotlin/kotlin-function-callback         â†’ Kotlin Function Calling
â”œâ”€â”€ misc/spring-ai-java-function-callback   â†’ Java Function Calling
â”œâ”€â”€ advisors/recursive-advisor-demo         â†’ Recursive Advisor
â””â”€â”€ model-context-protocol/sqlite/chatbot   â†’ DB ì—°ë™ Function
</code></pre></div></div>
<div class="chapter" id="part4-agentic-patterns.md"><h1 id="part-4-agentic-patterns">Part 4: Agentic Patterns (ì—ì´ì „íŠ¸ íŒ¨í„´)</h1>
<blockquote>
<p>ììœ¨ì ìœ¼ë¡œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” AI ì—ì´ì „íŠ¸ êµ¬ì¶•</p>
</blockquote>
<p><strong>í•™ìŠµ ê¸°ê°„:</strong> 3ì£¼
<strong>ë‚œì´ë„:</strong> ì¤‘ê¸‰ ~ ê³ ê¸‰
<strong>ì‚¬ì „ ìš”êµ¬ì‚¬í•­:</strong> Part 1, 2, 3 ì™„ë£Œ</p>
<hr />
<h2 id="_1">ë“¤ì–´ê°€ë©°</h2>
<p>ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ” Spring AIì˜ ê¸°ì´ˆ, í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§, ê·¸ë¦¬ê³  Function Callingì„ ë°°ì› ìŠµë‹ˆë‹¤. ì´ì œ í•œ ë‹¨ê³„ ë” ë‚˜ì•„ê°€ <strong>AI ì—ì´ì „íŠ¸</strong>ì˜ ì„¸ê³„ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
<p>AI ì—ì´ì „íŠ¸ë€ ë¬´ì—‡ì¼ê¹Œìš”? ë‹¨ìˆœíˆ ì§ˆë¬¸ì— ë‹µí•˜ëŠ” ì±—ë´‡ì„ ë„˜ì–´, <strong>ìŠ¤ìŠ¤ë¡œ ìƒê°í•˜ê³ , ê³„íší•˜ê³ , ì‹¤í–‰í•˜ëŠ”</strong> AI ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ë§ˆì¹˜ ìˆ™ë ¨ëœ ì§ì›ì²˜ëŸ¼ ë³µì¡í•œ ì‘ì—…ì„ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ë‚˜ëˆ„ê³ , ê° ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•˜ë©°, í•„ìš”í•˜ë©´ ë‹¤ì‹œ ê³„íšì„ ìˆ˜ì •í•˜ê¸°ë„ í•©ë‹ˆë‹¤.</p>
<p><img alt="Agentic Patterns" src="file:///Users/robin/Downloads/spring-ai-examples/book/images/agentic-patterns.png" /></p>
<p>ì´ë²ˆ íŒŒíŠ¸ì—ì„œëŠ” 6ê°€ì§€ í•µì‹¬ ì—ì´ì „íŠ¸ íŒ¨í„´ì„ ë°°ì›ë‹ˆë‹¤:</p>
<ol>
<li><strong>Chain Workflow</strong> - ìˆœì°¨ì  ì‘ì—… ì²˜ë¦¬</li>
<li><strong>Parallelization</strong> - ë³‘ë ¬ ì‘ì—… ì²˜ë¦¬</li>
<li><strong>Routing</strong> - ì¡°ê±´ì— ë”°ë¥¸ ë¶„ê¸° ì²˜ë¦¬</li>
<li><strong>Orchestrator-Workers</strong> - ë™ì  ì‘ì—… ë¶„ë°°</li>
<li><strong>Evaluator-Optimizer</strong> - ë°˜ë³µì  í’ˆì§ˆ ê°œì„ </li>
<li><strong>Reflection</strong> - ìê¸° ë°˜ì„±ì„ í†µí•œ ê°œì„ </li>
</ol>
<hr />
<h2 id="module-41-chain-workflow">Module 4.1: Chain Workflow (ì²´ì¸ ì›Œí¬í”Œë¡œìš°)</h2>
<h3 id="411-chain-workflow">4.1.1 Chain Workflow ê°œë…</h3>
<p><strong>ì²´ì¸ ì›Œí¬í”Œë¡œìš°</strong>ëŠ” ê°€ì¥ ì§ê´€ì ì¸ ì—ì´ì „íŠ¸ íŒ¨í„´ì…ë‹ˆë‹¤. ë³µì¡í•œ ì‘ì—…ì„ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ë‚˜ëˆ„ê³ , ê° ë‹¨ê³„ë¥¼ <strong>ìˆœì°¨ì ìœ¼ë¡œ</strong> ì‹¤í–‰í•©ë‹ˆë‹¤. ì• ë‹¨ê³„ì˜ ì¶œë ¥ì´ ë‹¤ìŒ ë‹¨ê³„ì˜ ì…ë ¥ì´ ë©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code>Input â†’ [Step 1] â†’ [Step 2] â†’ [Step 3] â†’ Output
           â†“          â†“          â†“
        Output 1   Output 2   Output 3
        (Input 2)  (Input 3)  (Final)
</code></pre></div>

<h4 id="_2">ì™œ ì²´ì¸ì´ í•„ìš”í• ê¹Œìš”?</h4>
<p>í•˜ë‚˜ì˜ ë³µì¡í•œ í”„ë¡¬í”„íŠ¸ë¡œ ëª¨ë“  ê²ƒì„ ì²˜ë¦¬í•˜ë ¤ í•˜ë©´ AIê°€ í˜¼ë€ìŠ¤ëŸ¬ì›Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ì‹  ì‘ì—…ì„ ë‹¨ìˆœí•œ ë‹¨ê³„ë¡œ ë‚˜ëˆ„ë©´:</p>
<ul>
<li><strong>ì •í™•ë„ í–¥ìƒ</strong>: ê° ë‹¨ê³„ì—ì„œ í•˜ë‚˜ì˜ ëª…í™•í•œ ëª©í‘œë§Œ ìˆ˜í–‰</li>
<li><strong>ë””ë²„ê¹… ìš©ì´</strong>: ì–´ë–¤ ë‹¨ê³„ì—ì„œ ë¬¸ì œê°€ ìƒê²¼ëŠ”ì§€ ì‰½ê²Œ íŒŒì•…</li>
<li><strong>ìœ ì—°ì„±</strong>: í•„ìš”ì— ë”°ë¼ ë‹¨ê³„ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±° ê°€ëŠ¥</li>
</ul>
<h4 id="_3">ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€</h4>
<ul>
<li><strong>ë¬¸ì„œ ìƒì„±</strong>: ì£¼ì œ ë¶„ì„ â†’ ê°œìš” ì‘ì„± â†’ ë³¸ë¬¸ ì‘ì„± â†’ í¸ì§‘</li>
<li><strong>ì½”ë“œ ë¦¬ë·°</strong>: ì½”ë“œ ë¶„ì„ â†’ ë¬¸ì œì  ì‹ë³„ â†’ ê°œì„ ì•ˆ ì œì‹œ</li>
<li><strong>ë²ˆì—­</strong>: ì›ë¬¸ ë¶„ì„ â†’ ì´ˆë²Œ ë²ˆì—­ â†’ ë¬¸ë§¥ ë‹¤ë“¬ê¸° â†’ ìµœì¢… ê²€ìˆ˜</li>
</ul>
<h3 id="412">4.1.2 ê¸°ë³¸ êµ¬í˜„</h3>
<p>ê°€ì¥ ê°„ë‹¨í•œ í˜•íƒœì˜ ì²´ì¸ ì›Œí¬í”Œë¡œìš°ë¥¼ Kotlinìœ¼ë¡œ êµ¬í˜„í•´ ë´…ì‹œë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">SimpleChainWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Step 1: í…ìŠ¤íŠ¸ ë¶„ì„</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">analysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;ì£¼ì–´ì§„ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ê³  í•µì‹¬ ì£¼ì œë¥¼ íŒŒì•…í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// Step 2: êµ¬ì¡°í™”</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">structured</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;ë¶„ì„ ê²°ê³¼ë¥¼ êµ¬ì¡°í™”ëœ ê°œìš”ë¡œ ë³€í™˜í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">analysis</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// Step 3: ìµœì¢… ë¬¸ì„œ ìƒì„±</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;ê°œìš”ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì™„ì „í•œ ë¬¸ì„œë¥¼ ì‘ì„±í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">structured</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">document</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>ì´ ì½”ë“œë¥¼ ë³´ë©´ ì„¸ ë²ˆì˜ LLM í˜¸ì¶œì´ ì²´ì¸ì²˜ëŸ¼ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê° ë‹¨ê³„ëŠ” ëª…í™•í•œ ì—­í• ì„ ê°€ì§€ê³  ìˆê³ , ì• ë‹¨ê³„ì˜ ê²°ê³¼ë¥¼ ë°›ì•„ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.</p>
<h3 id="413">4.1.3 íƒ€ì… ì•ˆì „í•œ ì²´ì¸</h3>
<p>ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ê° ë‹¨ê³„ì˜ ê²°ê³¼ë¥¼ <strong>êµ¬ì¡°í™”ëœ íƒ€ì…</strong>ìœ¼ë¡œ ë°›ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë°ì´í„°ì˜ í˜•íƒœê°€ ëª…í™•í•´ì§€ê³ , ì»´íŒŒì¼ íƒ€ì„ì— ì˜¤ë¥˜ë¥¼ ì¡ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ê° ë‹¨ê³„ì˜ ê²°ê³¼ë¥¼ í‘œí˜„í•˜ëŠ” ë°ì´í„° í´ë˜ìŠ¤ë“¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">AnalysisResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">mainTopic</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">themes</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tone</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">complexity</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w">  </span><span class="c1">// 1-10</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">OutlineResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sections</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Section</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Section</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">heading</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">points</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Document</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">wordCount</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">TypedChainWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">objectMapper</span><span class="p">:</span><span class="w"> </span><span class="n">ObjectMapper</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Step 1: ë¶„ì„ (êµ¬ì¡°í™”ëœ ì¶œë ¥)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">analysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ ë‹¤ìŒ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì„¸ìš”:</span>
<span class="s">                - mainTopic: í•µì‹¬ ì£¼ì œ</span>
<span class="s">                - themes: ì£¼ìš” í…Œë§ˆ ëª©ë¡ (3-5ê°œ)</span>
<span class="s">                - tone: ê¸€ì˜ í†¤ (formal, casual, academic ë“±)</span>
<span class="s">                - complexity: ë³µì¡ë„ (1-10)</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">AnalysisResult</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Step 2: ê°œìš” ìƒì„±</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">outline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë¬¸ì„œ ê°œìš”ë¥¼ ì‘ì„±í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">analysis</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">OutlineResult</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Step 3: ë¬¸ì„œ ìƒì„± (ë¶„ì„ ê²°ê³¼ì˜ í†¤ê³¼ ë³µì¡ë„ ë°˜ì˜)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ê°œìš”ë¥¼ ë”°ë¼ ì™„ì „í•œ ë¬¸ì„œë¥¼ ì‘ì„±í•˜ì„¸ìš”.</span>
<span class="s">                - í†¤: </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">tone</span><span class="si">}</span>
<span class="s">                - ëª©í‘œ ë³µì¡ë„: </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">complexity</span><span class="si">}</span><span class="s">/10</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">outline</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">Document</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">document</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<blockquote>
<p><strong>Tip</strong>: <code>entity()</code> ë©”ì„œë“œëŠ” Part 2ì—ì„œ ë°°ìš´ Structured Output ê¸°ëŠ¥ì…ë‹ˆë‹¤. AI ì‘ë‹µì„ ìë™ìœ¼ë¡œ ì§€ì •í•œ í´ë˜ìŠ¤ë¡œ ë³€í™˜í•´ì¤ë‹ˆë‹¤.</p>
</blockquote>
<h3 id="414">4.1.4 ì¡°ê±´ë¶€ íë¦„ (ê²Œì´íŠ¸)</h3>
<p>í•­ìƒ ëª¨ë“  ë‹¨ê³„ë¥¼ ì‹¤í–‰í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ê²½ë¡œë¥¼ íƒˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ContentType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TECHNICAL</span><span class="p">,</span><span class="w"> </span><span class="n">CREATIVE</span><span class="p">,</span><span class="w"> </span><span class="n">BUSINESS</span><span class="p">,</span><span class="w"> </span><span class="n">GENERAL</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ContentClassification</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">type</span><span class="p">:</span><span class="w"> </span><span class="n">ContentType</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">reason</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">QualityCheck</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">score</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span><span class="w">  </span><span class="c1">// 0.0 ~ 1.0</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">feedback</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">passedCriteria</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">failedCriteria</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ConditionalChainWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">ProcessingResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Step 1: ì½˜í…ì¸  ë¶„ë¥˜</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">classification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">classifyContent</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Step 2: ë¶„ë¥˜ì— ë”°ë¥¸ ì¡°ê±´ë¶€ ì²˜ë¦¬</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">processed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">classification</span><span class="p">.</span><span class="na">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ContentType</span><span class="p">.</span><span class="na">TECHNICAL</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">processTechnical</span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">)</span>
<span class="w">            </span><span class="n">ContentType</span><span class="p">.</span><span class="na">CREATIVE</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">processCreative</span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">)</span>
<span class="w">            </span><span class="n">ContentType</span><span class="p">.</span><span class="na">BUSINESS</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">processBusiness</span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">)</span>
<span class="w">            </span><span class="n">ContentType</span><span class="p">.</span><span class="na">GENERAL</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">processGeneral</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Step 3: í’ˆì§ˆ ê²€ì¦ ê²Œì´íŠ¸</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">quality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">checkQuality</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">quality</span><span class="p">.</span><span class="na">score</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// í’ˆì§ˆ ë¯¸ë‹¬ ì‹œ ê°œì„  ë‹¨ê³„ ì¶”ê°€</span>
<span class="w">            </span><span class="n">improveQuality</span><span class="p">(</span><span class="n">processed</span><span class="p">,</span><span class="w"> </span><span class="n">quality</span><span class="p">.</span><span class="na">feedback</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">processed</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ProcessingResult</span><span class="p">(</span><span class="n">finalContent</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">,</span><span class="w"> </span><span class="n">quality</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">classifyContent</span><span class="p">(</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">ContentClassification</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì½˜í…ì¸ ë¥¼ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”:</span>
<span class="s">                - TECHNICAL: ê¸°ìˆ  ë¬¸ì„œ, ì½”ë“œ, íŠœí† ë¦¬ì–¼</span>
<span class="s">                - CREATIVE: ì°½ì‘ë¬¼, ì´ì•¼ê¸°, ì‹œ</span>
<span class="s">                - BUSINESS: ë¹„ì¦ˆë‹ˆìŠ¤ ë¬¸ì„œ, ë³´ê³ ì„œ, ì œì•ˆì„œ</span>
<span class="s">                - GENERAL: ì¼ë°˜ì ì¸ ì •ë³´ì„± ê¸€</span>

<span class="s">                confidenceëŠ” 0.0~1.0 ì‚¬ì´ ê°’ìœ¼ë¡œ í‘œì‹œí•˜ì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">ContentClassification</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">checkQuality</span><span class="p">(</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">QualityCheck</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì½˜í…ì¸ ì˜ í’ˆì§ˆì„ í‰ê°€í•˜ì„¸ìš”:</span>
<span class="s">                - ì™„ì„±ë„</span>
<span class="s">                - ëª…í™•ì„±</span>
<span class="s">                - êµ¬ì¡°</span>
<span class="s">                - ë¬¸ë²•</span>

<span class="s">                scoreëŠ” 0.0~1.0 ì‚¬ì´ ê°’ìœ¼ë¡œ ì¢…í•© ì ìˆ˜ë¥¼ ë§¤ê¸°ì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">QualityCheck</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">improveQuality</span><span class="p">(</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">feedback</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì—¬ ì½˜í…ì¸ ë¥¼ ê°œì„ í•˜ì„¸ìš”.</span>

<span class="s">                í”¼ë“œë°±: </span><span class="si">$</span><span class="n">feedback</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ê° ìœ í˜•ë³„ ì²˜ë¦¬ ë©”ì„œë“œë“¤...</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">processTechnical</span><span class="p">(</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">:</span><span class="w"> </span><span class="n">ContentClassification</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">processWithPrompt</span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ê¸°ìˆ  ë¬¸ì„œ ìŠ¤íƒ€ì¼ë¡œ ëª…í™•í•˜ê³  ì •í™•í•˜ê²Œ ë‹¤ì‹œ ì‘ì„±í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">processCreative</span><span class="p">(</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">:</span><span class="w"> </span><span class="n">ContentClassification</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">processWithPrompt</span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ì°½ì˜ì ì´ê³  í¥ë¯¸ë¡œìš´ ìŠ¤íƒ€ì¼ë¡œ ë‹¤ì‹œ ì‘ì„±í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">processBusiness</span><span class="p">(</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">:</span><span class="w"> </span><span class="n">ContentClassification</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">processWithPrompt</span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ë¹„ì¦ˆë‹ˆìŠ¤ ì „ë¬¸ê°€ í†¤ìœ¼ë¡œ ë‹¤ì‹œ ì‘ì„±í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">processGeneral</span><span class="p">(</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">processWithPrompt</span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ì½ê¸° ì‰½ê³  ì´í•´í•˜ê¸° ì‰½ê²Œ ë‹¤ì‹œ ì‘ì„±í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">processWithPrompt</span><span class="p">(</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">instruction</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="415">4.1.5 ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬</h3>
<p>ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ê° ë‹¨ê³„ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²¬ê³ í•œ ì²´ì¸ì„ ë§Œë“¤ë ¤ë©´ ì¬ì‹œë„ì™€ í´ë°± ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">StepResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">stepName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">output</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">success</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ChainResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalOutput</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">stepResults</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">StepResult</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">success</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">success</span><span class="p">(</span><span class="n">output</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">steps</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">StepResult</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">ChainResult</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">steps</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>

<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">failed</span><span class="p">(</span><span class="n">steps</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">StepResult</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">ChainResult</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">steps</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nc">ChainStep</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isRequired</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span>
<span class="p">}</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ResilientChainWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">maxRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">steps</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ChainStep</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">ChainResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">stepResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableListOf</span><span class="o">&lt;</span><span class="n">StepResult</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">currentInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">step</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">steps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">executeWithRetry</span><span class="p">(</span><span class="n">step</span><span class="p">,</span><span class="w"> </span><span class="n">currentInput</span><span class="p">)</span>
<span class="w">            </span><span class="n">stepResults</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="na">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// ì‹¤íŒ¨ ì‹œ í´ë°± ë˜ëŠ” ì¤‘ë‹¨</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">step</span><span class="p">.</span><span class="na">isRequired</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">ChainResult</span><span class="p">.</span><span class="na">failed</span><span class="p">(</span><span class="n">stepResults</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">error</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;Unknown error&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// ì„ íƒì  ë‹¨ê³„ëŠ” ìŠ¤í‚µí•˜ê³  ê³„ì† ì§„í–‰</span>
<span class="w">                    </span><span class="k">continue</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">currentInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">output</span><span class="o">!!</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ChainResult</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">currentInput</span><span class="p">,</span><span class="w"> </span><span class="n">stepResults</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">executeWithRetry</span><span class="p">(</span><span class="n">step</span><span class="p">:</span><span class="w"> </span><span class="n">ChainStep</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">StepResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">lastError</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">        </span><span class="n">repeat</span><span class="p">(</span><span class="n">maxRetries</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">step</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">StepResult</span><span class="p">(</span><span class="n">step</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">lastError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">message</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attempt</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">maxRetries</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// ì§€ìˆ˜ ë°±ì˜¤í”„</span>
<span class="w">                    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="m">1000L</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">StepResult</span><span class="p">(</span><span class="n">step</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">lastError</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="416">4.1.6 ì‹¤ìŠµ: ì½˜í…ì¸  ìƒì„± íŒŒì´í”„ë¼ì¸</h3>
<p>ì‹¤ì œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì™„ì „í•œ ì½˜í…ì¸  ìƒì„± íŒŒì´í”„ë¼ì¸ì„ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// íŒŒì´í”„ë¼ì¸ ê° ë‹¨ê³„ì˜ ê²°ê³¼ í´ë˜ìŠ¤ë“¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">TopicExpansion</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">thesis</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">subtopics</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">targetAudience</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">uniqueAngle</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ResearchPoints</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">keyFacts</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">statistics</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">quotes</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">DetailedOutline</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">introduction</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sections</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OutlineSection</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">conclusion</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">OutlineSection</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">heading</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">keyPoints</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">targetWordCount</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Draft</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sectionCount</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">wordCount</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">EditedContent</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">improvements</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">FinalContent</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ContentRequest</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">topic</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">style</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;informative&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">requirements</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">emptyList</span><span class="p">()</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">PipelineContext</span><span class="p">(</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">request</span><span class="p">:</span><span class="w"> </span><span class="n">ContentRequest</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">topicExpansion</span><span class="p">:</span><span class="w"> </span><span class="n">TopicExpansion? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">research</span><span class="p">:</span><span class="w"> </span><span class="n">ResearchPoints? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">outline</span><span class="p">:</span><span class="w"> </span><span class="n">DetailedOutline? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">draft</span><span class="p">:</span><span class="w"> </span><span class="n">Draft? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">edited</span><span class="p">:</span><span class="w"> </span><span class="n">EditedContent? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">final</span><span class="p">:</span><span class="w"> </span><span class="n">FinalContent? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ContentResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="n">FinalContent</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">metadata</span><span class="p">:</span><span class="w"> </span><span class="n">PipelineContext</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ContentCreationPipeline</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">objectMapper</span><span class="p">:</span><span class="w"> </span><span class="n">ObjectMapper</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createContent</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ContentRequest</span><span class="p">):</span><span class="w"> </span><span class="n">ContentResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PipelineContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Stage 1: ì£¼ì œ í™•ì¥</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">expansion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expandTopic</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">topic</span><span class="p">)</span>
<span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">topicExpansion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expansion</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… Stage 1 ì™„ë£Œ: ì£¼ì œ í™•ì¥&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Stage 2: ë¦¬ì„œì¹˜ í¬ì¸íŠ¸ ìƒì„±</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">research</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateResearchPoints</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
<span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">research</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">research</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… Stage 2 ì™„ë£Œ: ë¦¬ì„œì¹˜&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Stage 3: ìƒì„¸ ê°œìš”</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">outline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createOutline</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span><span class="w"> </span><span class="n">research</span><span class="p">)</span>
<span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">outline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outline</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… Stage 3 ì™„ë£Œ: ê°œìš” ì‘ì„±&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Stage 4: ì´ˆì•ˆ ì‘ì„±</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">draft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">writeDraft</span><span class="p">(</span><span class="n">outline</span><span class="p">)</span>
<span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">draft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">draft</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… Stage 4 ì™„ë£Œ: ì´ˆì•ˆ ì‘ì„± (</span><span class="si">${</span><span class="n">draft</span><span class="p">.</span><span class="na">wordCount</span><span class="si">}</span><span class="s"> ë‹¨ì–´)&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Stage 5: í¸ì§‘ ë° ê°œì„ </span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">edited</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editAndImprove</span><span class="p">(</span><span class="n">draft</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">style</span><span class="p">)</span>
<span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">edited</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">edited</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… Stage 5 ì™„ë£Œ: í¸ì§‘&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Stage 6: ìµœì¢… ê²€í† </span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finalReview</span><span class="p">(</span><span class="n">edited</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">requirements</span><span class="p">)</span>
<span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">final</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finalContent</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… Stage 6 ì™„ë£Œ: ìµœì¢…ë³¸ ì™„ì„±!&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ContentResult</span><span class="p">(</span><span class="n">finalContent</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">expandTopic</span><span class="p">(</span><span class="n">topic</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">TopicExpansion</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì£¼ì–´ì§„ ì£¼ì œë¥¼ ë‹¤ìŒ ìš”ì†Œë¡œ í™•ì¥í•˜ì„¸ìš”:</span>
<span class="s">                1. thesis: í•µì‹¬ ë…¼ì œ (í•œ ë¬¸ì¥)</span>
<span class="s">                2. subtopics: í•˜ìœ„ ì£¼ì œ (3-5ê°œ)</span>
<span class="s">                3. targetAudience: ëŒ€ìƒ ë…ì</span>
<span class="s">                4. uniqueAngle: ì°¨ë³„í™”ëœ ê´€ì </span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;ì£¼ì œ: </span><span class="si">$</span><span class="n">topic</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">TopicExpansion</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateResearchPoints</span><span class="p">(</span><span class="n">expansion</span><span class="p">:</span><span class="w"> </span><span class="n">TopicExpansion</span><span class="p">):</span><span class="w"> </span><span class="n">ResearchPoints</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì£¼ì œì— ëŒ€í•œ ë¦¬ì„œì¹˜ í¬ì¸íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”:</span>
<span class="s">                - keyFacts: í•µì‹¬ ì‚¬ì‹¤ (5-7ê°œ)</span>
<span class="s">                - statistics: ê´€ë ¨ í†µê³„ (3-5ê°œ)</span>
<span class="s">                - quotes: ì¸ìš©í•  ë§Œí•œ ë¬¸êµ¬ (2-3ê°œ)</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">expansion</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">ResearchPoints</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createOutline</span><span class="p">(</span>
<span class="w">        </span><span class="n">expansion</span><span class="p">:</span><span class="w"> </span><span class="n">TopicExpansion</span><span class="p">,</span>
<span class="w">        </span><span class="n">research</span><span class="p">:</span><span class="w"> </span><span class="n">ResearchPoints</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">DetailedOutline</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ìƒì„¸í•œ ë¬¸ì„œ ê°œìš”ë¥¼ ì‘ì„±í•˜ì„¸ìš”.</span>
<span class="s">                ê° ì„¹ì…˜ë³„ë¡œ í•µì‹¬ í¬ì¸íŠ¸ì™€ ëª©í‘œ ë‹¨ì–´ ìˆ˜ë¥¼ í¬í•¨í•˜ì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì£¼ì œ í™•ì¥: </span><span class="si">${</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span><span class="si">}</span>
<span class="s">                ë¦¬ì„œì¹˜: </span><span class="si">${</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">research</span><span class="p">)</span><span class="si">}</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">DetailedOutline</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">writeDraft</span><span class="p">(</span><span class="n">outline</span><span class="p">:</span><span class="w"> </span><span class="n">DetailedOutline</span><span class="p">):</span><span class="w"> </span><span class="n">Draft</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">contentParts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableListOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// ë„ì…ë¶€</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">intro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;ë¬¸ì„œì˜ ë„ì…ë¶€ë¥¼ ì‘ì„±í•˜ì„¸ìš”. ë…ìì˜ ê´€ì‹¬ì„ ëŒì–´ì•¼ í•©ë‹ˆë‹¤.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;ì œëª©: </span><span class="si">${</span><span class="n">outline</span><span class="p">.</span><span class="na">title</span><span class="si">}</span><span class="s">\nê°œìš”: </span><span class="si">${</span><span class="n">outline</span><span class="p">.</span><span class="na">introduction</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">        </span><span class="n">contentParts</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">intro</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// ê° ì„¹ì…˜ ì‘ì„±</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">section</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">outline</span><span class="p">.</span><span class="na">sections</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">sectionContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    ë‹¤ìŒ ì„¹ì…˜ì„ ì‘ì„±í•˜ì„¸ìš”.</span>
<span class="s">                    - í•µì‹¬ í¬ì¸íŠ¸ë¥¼ ëª¨ë‘ í¬í•¨í•˜ì„¸ìš”</span>
<span class="s">                    - ëª©í‘œ: </span><span class="si">${</span><span class="n">section</span><span class="p">.</span><span class="na">targetWordCount</span><span class="si">}</span><span class="s"> ë‹¨ì–´ ë‚´ì™¸</span>
<span class="s">                &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    ì œëª©: </span><span class="si">${</span><span class="n">section</span><span class="p">.</span><span class="na">heading</span><span class="si">}</span>
<span class="s">                    í¬ì¸íŠ¸: </span><span class="si">${</span><span class="n">section</span><span class="p">.</span><span class="na">keyPoints</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="err">\</span><span class="n">n</span><span class="o">-</span><span class="w"> </span><span class="s">&quot;</span><span class="p">)</span><span class="si">}</span>
<span class="s">                &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">            </span><span class="n">contentParts</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;\n\n## </span><span class="si">${</span><span class="n">section</span><span class="p">.</span><span class="na">heading</span><span class="si">}</span><span class="s">\n\n</span><span class="si">$</span><span class="n">sectionContent</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ê²°ë¡ </span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">conclusion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;ë¬¸ì„œì˜ ê²°ë¡ ì„ ì‘ì„±í•˜ì„¸ìš”. í•µì‹¬ ë‚´ìš©ì„ ìš”ì•½í•˜ê³  í–‰ë™ ì´‰êµ¬ë¥¼ í¬í•¨í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;ê°œìš”: </span><span class="si">${</span><span class="n">outline</span><span class="p">.</span><span class="na">conclusion</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">        </span><span class="n">contentParts</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;\n\n## ê²°ë¡ \n\n</span><span class="si">$</span><span class="n">conclusion</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">fullContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contentParts</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">wordCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fullContent</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;\\s+&quot;</span><span class="p">.</span><span class="na">toRegex</span><span class="p">()).</span><span class="na">size</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Draft</span><span class="p">(</span><span class="n">fullContent</span><span class="p">,</span><span class="w"> </span><span class="n">outline</span><span class="p">.</span><span class="na">sections</span><span class="p">.</span><span class="na">size</span><span class="p">,</span><span class="w"> </span><span class="n">wordCount</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">editAndImprove</span><span class="p">(</span><span class="n">draft</span><span class="p">:</span><span class="w"> </span><span class="n">Draft</span><span class="p">,</span><span class="w"> </span><span class="n">style</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">EditedContent</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì´ˆì•ˆì„ í¸ì§‘í•˜ê³  ê°œì„ í•˜ì„¸ìš”:</span>
<span class="s">                - ë¬¸ì²´: </span><span class="si">$</span><span class="n">style</span>
<span class="s">                - ë¬¸ë²• ë° ë§ì¶¤ë²• êµì •</span>
<span class="s">                - ê°€ë…ì„± í–¥ìƒ</span>
<span class="s">                - íë¦„ ê°œì„ </span>

<span class="s">                improvementsì— ì£¼ìš” ë³€ê²½ì‚¬í•­ì„ ê¸°ë¡í•˜ì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">draft</span><span class="p">.</span><span class="na">content</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">EditedContent</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">finalReview</span><span class="p">(</span>
<span class="w">        </span><span class="n">edited</span><span class="p">:</span><span class="w"> </span><span class="n">EditedContent</span><span class="p">,</span>
<span class="w">        </span><span class="n">requirements</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">FinalContent</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">reqText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">requirements</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;ìš”êµ¬ì‚¬í•­:\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">requirements</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;- </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;íŠ¹ë³„í•œ ìš”êµ¬ì‚¬í•­ ì—†ìŒ&quot;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ìµœì¢… ê²€í† ë¥¼ ìˆ˜í–‰í•˜ì„¸ìš”:</span>
<span class="s">                1. ìš”êµ¬ì‚¬í•­ ì¶©ì¡± ì—¬ë¶€ í™•ì¸</span>
<span class="s">                2. ì œëª© í™•ì •</span>
<span class="s">                3. ìš”ì•½ë¬¸ ì‘ì„± (2-3ë¬¸ì¥)</span>

<span class="s">                </span><span class="si">$</span><span class="n">reqText</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">edited</span><span class="p">.</span><span class="na">content</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">FinalContent</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="_4">ì‚¬ìš© ì˜ˆì‹œ</h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/content&quot;</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ContentController</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">pipeline</span><span class="p">:</span><span class="w"> </span><span class="n">ContentCreationPipeline</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/generate&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateContent</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ContentRequest</span><span class="p">):</span><span class="w"> </span><span class="n">ContentResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">pipeline</span><span class="p">.</span><span class="na">createContent</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// í˜¸ì¶œ ì˜ˆì‹œ</span>
<span class="c1">// POST /api/content/generate</span>
<span class="c1">// {</span>
<span class="c1">//   &quot;topic&quot;: &quot;Spring AIë¡œ ì‹œì‘í•˜ëŠ” AI ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ&quot;,</span>
<span class="c1">//   &quot;style&quot;: &quot;tutorial&quot;,</span>
<span class="c1">//   &quot;requirements&quot;: [&quot;ì´ˆë³´ìë„ ì´í•´í•  ìˆ˜ ìˆê²Œ&quot;, &quot;ì‹¤ì œ ì½”ë“œ ì˜ˆì‹œ í¬í•¨&quot;]</span>
<span class="c1">// }</span>
</code></pre></div>

<hr />
<h2 id="module-42-parallelization-workflow">Module 4.2: Parallelization Workflow (ë³‘ë ¬í™” ì›Œí¬í”Œë¡œìš°)</h2>
<h3 id="421">4.2.1 ë³‘ë ¬í™” íŒ¨í„´ ê°œìš”</h3>
<p>ì²´ì¸ ì›Œí¬í”Œë¡œìš°ê°€ <strong>ìˆœì°¨ì </strong>ì´ë¼ë©´, ë³‘ë ¬í™” ì›Œí¬í”Œë¡œìš°ëŠ” <strong>ë™ì‹œì—</strong> ì—¬ëŸ¬ ì‘ì—…ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì„œë¡œ ë…ë¦½ì ì¸ ì‘ì—…ë“¤ì´ë¼ë©´ êµ³ì´ ê¸°ë‹¤ë¦´ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
<h4 id="sectioning">Sectioning (ë¶„í• ) íŒ¨í„´</h4>
<p>í•˜ë‚˜ì˜ ì…ë ¥ì„ ì—¬ëŸ¬ ê´€ì ì—ì„œ ë™ì‹œì— ë¶„ì„í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="w">         </span><span class="err">â”Œâ”€â”€â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Task</span><span class="w"> </span><span class="n">A</span><span class="p">]</span><span class="w"> </span><span class="err">â”€â”€â”</span>
<span class="n">Input</span><span class="w"> </span><span class="err">â”€â”€â”€â”¼â”€â”€â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Task</span><span class="w"> </span><span class="n">B</span><span class="p">]</span><span class="w"> </span><span class="err">â”€â”€â”¼â”€â”€â†’</span><span class="w"> </span><span class="n">Aggregate</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Output</span>
<span class="w">         </span><span class="err">â””â”€â”€â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Task</span><span class="w"> </span><span class="n">C</span><span class="p">]</span><span class="w"> </span><span class="err">â”€â”€â”˜</span>
</code></pre></div>

<h4 id="voting">Voting (íˆ¬í‘œ) íŒ¨í„´</h4>
<p>ê°™ì€ ì§ˆë¬¸ì„ ì—¬ëŸ¬ ë²ˆ ë¬¼ì–´ë³´ê³  ë‹¤ìˆ˜ê²°ë¡œ ê²°ì •í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code>         â”Œâ”€â”€â†’ [Model 1] â”€â”€â”
Input â”€â”€â”€â”¼â”€â”€â†’ [Model 2] â”€â”€â”¼â”€â”€â†’ Vote/Consensus â†’ Output
         â””â”€â”€â†’ [Model 3] â”€â”€â”˜
</code></pre></div>

<h3 id="422-coroutine-kotlin">4.2.2 Coroutine ê¸°ë°˜ êµ¬í˜„ (Kotlin)</h3>
<p>Kotlinì˜ <strong>ì½”ë£¨í‹´</strong>ì„ í™œìš©í•˜ë©´ ë¹„ë™ê¸° ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìš°ì•„í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ë¶„ì„ ê²°ê³¼ ë°ì´í„° í´ë˜ìŠ¤ë“¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SentimentResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sentiment</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w">  </span><span class="c1">// POSITIVE, NEGATIVE, NEUTRAL</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">emotions</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">KeywordsResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">keywords</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">phrases</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Summary</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">keyPoints</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Entity</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">type</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w">  </span><span class="c1">// PERSON, ORGANIZATION, LOCATION, DATE</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">mentions</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ParallelAnalysisResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sentiment</span><span class="p">:</span><span class="w"> </span><span class="n">SentimentResult</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">keywords</span><span class="p">:</span><span class="w"> </span><span class="n">KeywordsResult</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="p">:</span><span class="w"> </span><span class="n">Summary</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">entities</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">processingTimeMs</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ParallelWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeDocument</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">ParallelAnalysisResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// ë³‘ë ¬ ì‘ì—… ì‹œì‘</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">coroutineScope</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">sentimentDeferred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">analyzeSentiment</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">keywordsDeferred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">extractKeywords</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">summaryDeferred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">summarize</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">entitiesDeferred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">extractEntities</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// ëª¨ë“  ê²°ê³¼ ëŒ€ê¸° (ë™ì‹œì— ì‹¤í–‰ë¨)</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">sentiment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sentimentDeferred</span><span class="p">.</span><span class="na">await</span><span class="p">()</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">keywords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keywordsDeferred</span><span class="p">.</span><span class="na">await</span><span class="p">()</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summaryDeferred</span><span class="p">.</span><span class="na">await</span><span class="p">()</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entitiesDeferred</span><span class="p">.</span><span class="na">await</span><span class="p">()</span>

<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">processingTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span>

<span class="w">            </span><span class="n">ParallelAnalysisResult</span><span class="p">(</span>
<span class="w">                </span><span class="n">sentiment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sentiment</span><span class="p">,</span>
<span class="w">                </span><span class="n">keywords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keywords</span><span class="p">,</span>
<span class="w">                </span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">,</span>
<span class="w">                </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entities</span><span class="p">,</span>
<span class="w">                </span><span class="n">processingTimeMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processingTime</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeSentiment</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">SentimentResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë¬¸ì„œì˜ ê°ì„±ì„ ë¶„ì„í•˜ì„¸ìš”:</span>
<span class="s">                - sentiment: POSITIVE, NEGATIVE, NEUTRAL ì¤‘ í•˜ë‚˜</span>
<span class="s">                - confidence: í™•ì‹ ë„ (0.0~1.0)</span>
<span class="s">                - emotions: ê°ì§€ëœ ê°ì •ë“¤ (joy, sadness, anger, fear ë“±)</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">SentimentResult</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">extractKeywords</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">KeywordsResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë¬¸ì„œì—ì„œ í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•˜ì„¸ìš”:</span>
<span class="s">                - keywords: ë‹¨ì¼ í‚¤ì›Œë“œ (10ê°œ ì´ë‚´)</span>
<span class="s">                - phrases: í•µì‹¬ êµ¬ë¬¸ (5ê°œ ì´ë‚´)</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">KeywordsResult</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Summary</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë¬¸ì„œë¥¼ ìš”ì•½í•˜ì„¸ìš”:</span>
<span class="s">                - title: ì œëª© (10ë‹¨ì–´ ì´ë‚´)</span>
<span class="s">                - summary: ìš”ì•½ë¬¸ (2-3ë¬¸ì¥)</span>
<span class="s">                - keyPoints: í•µì‹¬ í¬ì¸íŠ¸ (3-5ê°œ)</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">Summary</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">extractEntities</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">EntityList</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">entities</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë¬¸ì„œì—ì„œ ê°œì²´ëª…ì„ ì¶”ì¶œí•˜ì„¸ìš”:</span>
<span class="s">                - ì¸ë¬¼ (PERSON)</span>
<span class="s">                - ì¡°ì§ (ORGANIZATION)</span>
<span class="s">                - ì¥ì†Œ (LOCATION)</span>
<span class="s">                - ë‚ ì§œ (DATE)</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">EntityList</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">entities</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="423-reactor-webflux">4.2.3 Reactor ê¸°ë°˜ êµ¬í˜„ (WebFlux)</h3>
<p>Spring WebFluxë¥¼ ì‚¬ìš©í•œë‹¤ë©´ <strong>Reactor</strong>ì˜ <code>Mono</code>ì™€ <code>Flux</code>ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ReactiveParallelWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeReactive</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Mono</span><span class="o">&lt;</span><span class="n">AnalysisResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">sentiment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mono</span><span class="p">.</span><span class="na">fromCallable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">analyzeSentiment</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">boundedElastic</span><span class="p">())</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">keywords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mono</span><span class="p">.</span><span class="na">fromCallable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">extractKeywords</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">boundedElastic</span><span class="p">())</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mono</span><span class="p">.</span><span class="na">fromCallable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">summarize</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">boundedElastic</span><span class="p">())</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Mono</span><span class="p">.</span><span class="na">zip</span><span class="p">(</span><span class="n">sentiment</span><span class="p">,</span><span class="w"> </span><span class="n">keywords</span><span class="p">,</span><span class="w"> </span><span class="n">summary</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tuple</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">AnalysisResult</span><span class="p">(</span>
<span class="w">                    </span><span class="n">sentiment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tuple</span><span class="p">.</span><span class="na">t1</span><span class="p">,</span>
<span class="w">                    </span><span class="n">keywords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tuple</span><span class="p">.</span><span class="na">t2</span><span class="p">,</span>
<span class="w">                    </span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tuple</span><span class="p">.</span><span class="na">t3</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ì—¬ëŸ¬ ë¬¸ì„œ ë°°ì¹˜ ì²˜ë¦¬</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeBatch</span><span class="p">(</span><span class="n">documents</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">DocumentAnalysis</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Flux</span><span class="p">.</span><span class="na">fromIterable</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span>
<span class="w">                </span><span class="p">{</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">analyzeReactive</span><span class="p">(</span><span class="n">doc</span><span class="p">).</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">DocumentAnalysis</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="m">5</span><span class="w">  </span><span class="c1">// ë™ì‹œì„± ì œí•œ: ìµœëŒ€ 5ê°œ ë™ì‹œ ì²˜ë¦¬</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">onErrorContinue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ë¶„ì„ ì‹¤íŒ¨: </span><span class="si">$</span><span class="n">doc</span><span class="s"> - </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="424-voting">4.2.4 Voting íŒ¨í„´</h3>
<p>ê°™ì€ ì§ˆë¬¸ì„ ì—¬ëŸ¬ ë²ˆ ë¬¼ì–´ë³´ê³  <strong>ë‹¤ìˆ˜ê²°</strong>ë¡œ ê²°ì •í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. AIì˜ ì‘ë‹µì´ í™•ë¥ ì ì´ê¸° ë•Œë¬¸ì—, ì—¬ëŸ¬ ë²ˆ ë¬¼ì–´ì„œ ê°€ì¥ ë§ì´ ë‚˜ì˜¨ ë‹µì„ ì„ íƒí•˜ë©´ ì‹ ë¢°ë„ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">VotingResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">winner</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">votes</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">totalVotes</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">VotingWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">classifyWithVoting</span><span class="p">(</span>
<span class="w">        </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">samples</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">VotingResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coroutineScope</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// ì—¬ëŸ¬ ë²ˆ ë™ì‹œì— ë¶„ë¥˜ ìš”ì²­</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">deferredResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1.</span><span class="p">.</span><span class="na">samples</span><span class="p">).</span><span class="na">map</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                        í…ìŠ¤íŠ¸ë¥¼ ì •í™•íˆ í•˜ë‚˜ì˜ ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”:</span>
<span class="s">                        POSITIVE, NEGATIVE, NEUTRAL</span>

<span class="s">                        ì¹´í…Œê³ ë¦¬ ì´ë¦„ë§Œ ì‘ë‹µí•˜ì„¸ìš”.</span>
<span class="s">                    &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">options</span><span class="p">(</span><span class="n">ChatOptionsBuilder</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">withTemperature</span><span class="p">(</span><span class="m">0.7f</span><span class="p">)</span><span class="w">  </span><span class="c1">// ì•½ê°„ì˜ ë³€ë™ì„± ë¶€ì—¬</span>
<span class="w">                        </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">trim</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">uppercase</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ê²°ê³¼ ì§‘ê³„</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deferredResults</span><span class="p">.</span><span class="na">awaitAll</span><span class="p">()</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">groupingBy</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="w"> </span><span class="p">}.</span><span class="na">eachCount</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// ìµœë‹¤ ë“í‘œ ì„ íƒ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">winner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">votes</span><span class="p">.</span><span class="na">maxByOrNull</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="p">}</span><span class="o">?.</span><span class="na">key</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;UNKNOWN&quot;</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">votes</span><span class="o">[</span><span class="n">winner</span><span class="o">]?.</span><span class="na">toDouble</span><span class="p">()</span><span class="o">?.</span><span class="na">div</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0.0</span>

<span class="w">        </span><span class="n">VotingResult</span><span class="p">(</span>
<span class="w">            </span><span class="n">winner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">winner</span><span class="p">,</span>
<span class="w">            </span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confidence</span><span class="p">,</span>
<span class="w">            </span><span class="n">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">votes</span><span class="p">,</span>
<span class="w">            </span><span class="n">totalVotes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">samples</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="425">4.2.5 ê²°ê³¼ ì§‘ê³„ ì „ëµ</h3>
<p>ë³‘ë ¬ ì‘ì—…ì˜ ê²°ê³¼ë¥¼ í•©ì¹˜ëŠ” ë‹¤ì–‘í•œ ì „ëµì´ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ì§‘ê³„ ì „ëµ ì¸í„°í˜ì´ìŠ¤</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AggregationStrategy</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">T?</span>
<span class="p">}</span>

<span class="c1">// ë‹¤ìˆ˜ê²° ì „ëµ</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MajorityVoteStrategy</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AggregationStrategy</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">results</span>
<span class="w">            </span><span class="p">.</span><span class="na">groupingBy</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">eachCount</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">maxByOrNull</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="o">?.</span><span class="na">key</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// í‰ê·  ì „ëµ (ìˆ«ììš©)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AverageStrategy</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AggregationStrategy</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="kt">Double?</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">average</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ìµœê³  ì‹ ë¢°ë„ ì „ëµ</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ScoredResult</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">value</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">)</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">HighestConfidenceStrategy</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AggregationStrategy</span><span class="o">&lt;</span><span class="n">ScoredResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ScoredResult</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">ScoredResult? </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">maxByOrNull</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">confidence</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ë§Œì¥ì¼ì¹˜ ì „ëµ (ëª¨ë‘ ê°™ì•„ì•¼ í•¨)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ConsensusStrategy</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AggregationStrategy</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">unique</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">toSet</span><span class="p">()</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unique</span><span class="p">.</span><span class="na">size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">first</span><span class="p">()</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ê°€ì¤‘ í‰ê·  ì „ëµ</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WeightedResult</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">value</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">weight</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">)</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">WeightedAverageStrategy</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AggregationStrategy</span><span class="o">&lt;</span><span class="n">WeightedResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WeightedResult</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">WeightedResult? </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">totalWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">sumOf</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">weight</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">weightedSum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">sumOf</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">weight</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">WeightedResult</span><span class="p">(</span>
<span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weightedSum</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">totalWeight</span><span class="p">,</span>
<span class="w">            </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">totalWeight</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="426">4.2.6 ì‹¤ìŠµ: ë‹¤ì¤‘ ê´€ì  ë¬¸ì„œ ë¶„ì„ê¸°</h3>
<p>í•˜ë‚˜ì˜ ë¬¸ì„œë¥¼ ì—¬ëŸ¬ ì „ë¬¸ê°€ì˜ ê´€ì ì—ì„œ ë™ì‹œì— ë¶„ì„í•˜ëŠ” ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ê° ê´€ì ë³„ ë¶„ì„ ê²°ê³¼</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">TechnicalAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">architectureConsiderations</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">technologyImplications</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">scalabilityConcerns</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">technicalDebtPotential</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">BusinessAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">marketOpportunities</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">competitiveAdvantages</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">revenueImplications</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">resourceRequirements</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">LegalAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">complianceIssues</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">riskFactors</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">recommendations</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">RiskAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">identifiedRisks</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Risk</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">overallRiskLevel</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w">  </span><span class="c1">// LOW, MEDIUM, HIGH, CRITICAL</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">mitigationStrategies</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Risk</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">likelihood</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">impact</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ComprehensiveAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">executiveSummary</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">keyAgreements</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">conflictingViewpoints</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">priorityRecommendations</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">actionItems</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MultiPerspectiveResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">technical</span><span class="p">:</span><span class="w"> </span><span class="n">TechnicalAnalysis</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">business</span><span class="p">:</span><span class="w"> </span><span class="n">BusinessAnalysis</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">legal</span><span class="p">:</span><span class="w"> </span><span class="n">LegalAnalysis</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">risk</span><span class="p">:</span><span class="w"> </span><span class="n">RiskAnalysis</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">synthesis</span><span class="p">:</span><span class="w"> </span><span class="n">ComprehensiveAnalysis</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">processingTimeMs</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MultiPerspectiveAnalyzer</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">objectMapper</span><span class="p">:</span><span class="w"> </span><span class="n">ObjectMapper</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyze</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">MultiPerspectiveResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// ë³‘ë ¬ ë¶„ì„ ì‹¤í–‰</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="nv">tech</span><span class="p">,</span><span class="w"> </span><span class="nv">biz</span><span class="p">,</span><span class="w"> </span><span class="nv">legal</span><span class="p">,</span><span class="w"> </span><span class="nv">risk</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coroutineScope</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">techDeferred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">analyzeTechnical</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">bizDeferred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">analyzeBusiness</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">legalDeferred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">analyzeLegal</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">riskDeferred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">analyzeRisk</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">            </span><span class="n">listOf</span><span class="p">(</span>
<span class="w">                </span><span class="n">techDeferred</span><span class="p">.</span><span class="na">await</span><span class="p">(),</span>
<span class="w">                </span><span class="n">bizDeferred</span><span class="p">.</span><span class="na">await</span><span class="p">(),</span>
<span class="w">                </span><span class="n">legalDeferred</span><span class="p">.</span><span class="na">await</span><span class="p">(),</span>
<span class="w">                </span><span class="n">riskDeferred</span><span class="p">.</span><span class="na">await</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ì¢…í•© ë³´ê³ ì„œ ìƒì„± (ë¶„ì„ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">synthesis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">synthesize</span><span class="p">(</span>
<span class="w">            </span><span class="n">tech</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TechnicalAnalysis</span><span class="p">,</span>
<span class="w">            </span><span class="n">biz</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">BusinessAnalysis</span><span class="p">,</span>
<span class="w">            </span><span class="n">legal</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">LegalAnalysis</span><span class="p">,</span>
<span class="w">            </span><span class="n">risk</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">RiskAnalysis</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">processingTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MultiPerspectiveResult</span><span class="p">(</span>
<span class="w">            </span><span class="n">technical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tech</span><span class="p">,</span>
<span class="w">            </span><span class="n">business</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">biz</span><span class="p">,</span>
<span class="w">            </span><span class="n">legal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">legal</span><span class="p">,</span>
<span class="w">            </span><span class="n">risk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">risk</span><span class="p">,</span>
<span class="w">            </span><span class="n">synthesis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">synthesis</span><span class="p">,</span>
<span class="w">            </span><span class="n">processingTimeMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processingTime</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeTechnical</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">TechnicalAnalysis</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¹ì‹ ì€ ì‹œë‹ˆì–´ ê¸°ìˆ  ì•„í‚¤í…íŠ¸ì…ë‹ˆë‹¤.</span>
<span class="s">                ê¸°ìˆ ì  ê´€ì ì—ì„œ ë¬¸ì„œë¥¼ ë¶„ì„í•˜ì„¸ìš”:</span>
<span class="s">                - ì•„í‚¤í…ì²˜ ê³ ë ¤ì‚¬í•­</span>
<span class="s">                - ê¸°ìˆ  ìŠ¤íƒ ì‹œì‚¬ì </span>
<span class="s">                - í™•ì¥ì„± ìš°ë ¤</span>
<span class="s">                - ê¸°ìˆ  ë¶€ì±„ ê°€ëŠ¥ì„±</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">TechnicalAnalysis</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeBusiness</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">BusinessAnalysis</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¹ì‹ ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ì „ëµ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.</span>
<span class="s">                ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì ì—ì„œ ë¬¸ì„œë¥¼ ë¶„ì„í•˜ì„¸ìš”:</span>
<span class="s">                - ì‹œì¥ ê¸°íšŒ</span>
<span class="s">                - ê²½ìŸ ìš°ìœ„</span>
<span class="s">                - ìˆ˜ìµ ì˜í–¥</span>
<span class="s">                - í•„ìš” ë¦¬ì†ŒìŠ¤</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">BusinessAnalysis</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeLegal</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">LegalAnalysis</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¹ì‹ ì€ ë²•ë¥  ìë¬¸ê°€ì…ë‹ˆë‹¤.</span>
<span class="s">                ë²•ì  ê´€ì ì—ì„œ ë¬¸ì„œë¥¼ ë¶„ì„í•˜ì„¸ìš”:</span>
<span class="s">                - ê·œì • ì¤€ìˆ˜ ì´ìŠˆ</span>
<span class="s">                - ë¦¬ìŠ¤í¬ ìš”ì†Œ</span>
<span class="s">                - ê¶Œê³ ì‚¬í•­</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">LegalAnalysis</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeRisk</span><span class="p">(</span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">RiskAnalysis</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¹ì‹ ì€ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.</span>
<span class="s">                ë¦¬ìŠ¤í¬ ê´€ì ì—ì„œ ë¬¸ì„œë¥¼ ë¶„ì„í•˜ì„¸ìš”:</span>
<span class="s">                - ì‹ë³„ëœ ë¦¬ìŠ¤í¬ (ê°ê°ì˜ ê°€ëŠ¥ì„±ê³¼ ì˜í–¥ë„ í¬í•¨)</span>
<span class="s">                - ì „ì²´ ë¦¬ìŠ¤í¬ ìˆ˜ì¤€</span>
<span class="s">                - ì™„í™” ì „ëµ</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">RiskAnalysis</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">synthesize</span><span class="p">(</span>
<span class="w">        </span><span class="n">tech</span><span class="p">:</span><span class="w"> </span><span class="n">TechnicalAnalysis</span><span class="p">,</span>
<span class="w">        </span><span class="n">biz</span><span class="p">:</span><span class="w"> </span><span class="n">BusinessAnalysis</span><span class="p">,</span>
<span class="w">        </span><span class="n">legal</span><span class="p">:</span><span class="w"> </span><span class="n">LegalAnalysis</span><span class="p">,</span>
<span class="w">        </span><span class="n">risk</span><span class="p">:</span><span class="w"> </span><span class="n">RiskAnalysis</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">ComprehensiveAnalysis</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¤ì–‘í•œ ê´€ì ì˜ ë¶„ì„ì„ ì¢…í•©í•˜ì—¬ ê²½ì˜ì§„ ìš”ì•½ì„ ì‘ì„±í•˜ì„¸ìš”.</span>

<span class="s">                í¬í•¨í•  ë‚´ìš©:</span>
<span class="s">                - í•µì‹¬ ìš”ì•½ (2-3ë¬¸ì¥)</span>
<span class="s">                - ê´€ì  ê°„ ì¼ì¹˜ ì‚¬í•­</span>
<span class="s">                - ìƒì¶©ë˜ëŠ” ì˜ê²¬ê³¼ í•´ê²° ë°©ì•ˆ</span>
<span class="s">                - ìš°ì„ ìˆœìœ„ ê¶Œê³ ì‚¬í•­</span>
<span class="s">                - êµ¬ì²´ì  ì•¡ì…˜ ì•„ì´í…œ</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ê¸°ìˆ  ë¶„ì„: </span><span class="si">${</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">tech</span><span class="p">)</span><span class="si">}</span>
<span class="s">                ë¹„ì¦ˆë‹ˆìŠ¤ ë¶„ì„: </span><span class="si">${</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">biz</span><span class="p">)</span><span class="si">}</span>
<span class="s">                ë²•ë¥  ë¶„ì„: </span><span class="si">${</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">legal</span><span class="p">)</span><span class="si">}</span>
<span class="s">                ë¦¬ìŠ¤í¬ ë¶„ì„: </span><span class="si">${</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">risk</span><span class="p">)</span><span class="si">}</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">ComprehensiveAnalysis</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-43-routing-workflow">Module 4.3: Routing Workflow (ë¼ìš°íŒ… ì›Œí¬í”Œë¡œìš°)</h2>
<h3 id="431">4.3.1 ë¼ìš°íŒ… ê°œë…</h3>
<p><strong>ë¼ìš°íŒ… ì›Œí¬í”Œë¡œìš°</strong>ëŠ” ì…ë ¥ì„ ë¶„ë¥˜í•˜ê³ , ë¶„ë¥˜ ê²°ê³¼ì— ë”°ë¼ ì ì ˆí•œ ì²˜ë¦¬ê¸°ë¡œ ë³´ë‚´ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. ê³ ê° ë¬¸ì˜ë¥¼ ë‹´ë‹¹ ë¶€ì„œë¡œ ì—°ê²°í•˜ëŠ” ì½œì„¼í„°ì™€ ë¹„ìŠ·í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="w">              </span><span class="err">â”Œâ”€â”€â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Handler</span><span class="w"> </span><span class="n">A</span><span class="p">]</span>
<span class="n">Input</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Classifier</span><span class="p">]</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Handler</span><span class="w"> </span><span class="n">B</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Output</span>
<span class="w">              </span><span class="err">â””â”€â”€â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Handler</span><span class="w"> </span><span class="n">C</span><span class="p">]</span>
</code></pre></div>

<h4 id="_5">ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€</h4>
<ul>
<li><strong>ê³ ê° ì§€ì›</strong>: ë¬¸ì˜ ìœ í˜•ë³„ ì „ë¬¸ ìƒë‹´ì‚¬ ì—°ê²°</li>
<li><strong>ì½˜í…ì¸  ì²˜ë¦¬</strong>: ì½˜í…ì¸  ìœ í˜•ë³„ ë‹¤ë¥¸ ì²˜ë¦¬ ë¡œì§</li>
<li><strong>ëª¨ë¸ ì„ íƒ</strong>: ë³µì¡ë„ì— ë”°ë¼ ë‹¤ë¥¸ AI ëª¨ë¸ ì‚¬ìš©</li>
</ul>
<h3 id="432">4.3.2 ê¸°ë³¸ ë¼ìš°íŒ… êµ¬í˜„</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// ë¶„ë¥˜ ê²°ê³¼</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Classification</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">category</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">urgency</span><span class="p">:</span><span class="w"> </span><span class="n">Urgency</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sentiment</span><span class="p">:</span><span class="w"> </span><span class="n">Sentiment</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">reasoning</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Urgency</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">LOW</span><span class="p">,</span><span class="w"> </span><span class="n">MEDIUM</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">,</span><span class="w"> </span><span class="n">CRITICAL</span><span class="w"> </span><span class="p">}</span>
<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Sentiment</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">POSITIVE</span><span class="p">,</span><span class="w"> </span><span class="n">NEUTRAL</span><span class="p">,</span><span class="w"> </span><span class="n">NEGATIVE</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// í•¸ë“¤ëŸ¬ ì¸í„°í˜ì´ìŠ¤</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">Handler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">:</span><span class="w"> </span><span class="n">Classification</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">canHandle</span><span class="p">(</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">Boolean</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">RoutingResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">classification</span><span class="p">:</span><span class="w"> </span><span class="n">Classification</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">handlerUsed</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">RoutingWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">handlers</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">Handler</span><span class="o">&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">route</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">RoutingResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Step 1: ë¶„ë¥˜</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">classification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">classify</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Step 2: í•¸ë“¤ëŸ¬ ì„ íƒ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handlers</span><span class="o">[</span><span class="n">classification</span><span class="p">.</span><span class="na">category</span><span class="o">]</span>
<span class="w">            </span><span class="o">?:</span><span class="w"> </span><span class="n">handlers</span><span class="o">[</span><span class="s">&quot;default&quot;</span><span class="o">]</span>
<span class="w">            </span><span class="o">?:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;No handler available&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Step 3: ì²˜ë¦¬</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handler</span><span class="p">.</span><span class="na">handle</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RoutingResult</span><span class="p">(</span><span class="n">classification</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">.</span><span class="na">category</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">classify</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Classification</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì‚¬ìš©ì ì…ë ¥ì„ ë‹¤ìŒ ì¹´í…Œê³ ë¦¬ ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”:</span>

<span class="s">                ì¹´í…Œê³ ë¦¬:</span>
<span class="s">                - TECHNICAL_SUPPORT: ê¸°ìˆ ì  ë¬¸ì œ, ë²„ê·¸, ì—ëŸ¬</span>
<span class="s">                - BILLING: ê²°ì œ, êµ¬ë…, í™˜ë¶ˆ ë¬¸ì˜</span>
<span class="s">                - GENERAL_INQUIRY: ì œí’ˆ ì •ë³´, ê¸°ëŠ¥ ë¬¸ì˜</span>
<span class="s">                - FEEDBACK: ì œì•ˆ, ë¶ˆë§Œ, ì¹­ì°¬</span>

<span class="s">                ê¸´ê¸‰ë„ í‰ê°€:</span>
<span class="s">                - LOW: ì¼ë°˜ ë¬¸ì˜</span>
<span class="s">                - MEDIUM: ì—…ë¬´ì— ë¶ˆí¸í•¨</span>
<span class="s">                - HIGH: ì„œë¹„ìŠ¤ ì‚¬ìš© ë¶ˆê°€</span>
<span class="s">                - CRITICAL: ë°ì´í„° ì†ì‹¤ ìœ„í—˜</span>

<span class="s">                ê°ì„± í‰ê°€:</span>
<span class="s">                - POSITIVE, NEUTRAL, NEGATIVE</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">Classification</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="433">4.3.3 ì „ë¬¸í™”ëœ í•¸ë“¤ëŸ¬</h3>
<p>ê° ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì „ë¬¸í™”ëœ í•¸ë“¤ëŸ¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">TechnicalSupportHandler</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">:</span><span class="w"> </span><span class="n">Classification</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¹ì‹ ì€ ê¸°ìˆ  ì§€ì› ì „ë¬¸ê°€ì…ë‹ˆë‹¤.</span>

<span class="s">                ì‘ë‹µ ì§€ì¹¨:</span>
<span class="s">                1. ë¬¸ì œë¥¼ ëª…í™•íˆ ì´í•´í–ˆìŒì„ í™•ì¸</span>
<span class="s">                2. ë‹¨ê³„ë³„ í•´ê²° ë°©ë²• ì œì‹œ</span>
<span class="s">                3. ì¶”ê°€ ë„ì›€ì´ í•„ìš”í•œ ê²½ìš° ì•ˆë‚´</span>

<span class="s">                ê¸´ê¸‰ë„: </span><span class="si">${</span><span class="n">classification</span><span class="p">.</span><span class="na">urgency</span><span class="si">}</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">canHandle</span><span class="p">(</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;TECHNICAL_SUPPORT&quot;</span>
<span class="p">}</span>

<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">BillingHandler</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">:</span><span class="w"> </span><span class="n">Classification</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¹ì‹ ì€ ê²°ì œ ë° êµ¬ë… ë‹´ë‹¹ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.</span>

<span class="s">                ì‘ë‹µ ì§€ì¹¨:</span>
<span class="s">                1. ì •ì±…ì„ ëª…í™•íˆ ì„¤ëª…</span>
<span class="s">                2. ê°€ëŠ¥í•œ ì˜µì…˜ ì œì‹œ</span>
<span class="s">                3. í•„ìš” ì‹œ ë‹´ë‹¹ ë¶€ì„œ ì—°ê²° ì•ˆë‚´</span>

<span class="s">                ê³ ê° ê°ì„±: </span><span class="si">${</span><span class="n">classification</span><span class="p">.</span><span class="na">sentiment</span><span class="si">}</span>
<span class="s">                (ë¶€ì •ì ì¸ ê²½ìš° ë” ê³µê°í•˜ëŠ” íƒœë„ë¡œ)</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">canHandle</span><span class="p">(</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;BILLING&quot;</span>
<span class="p">}</span>

<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">DefaultHandler</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">:</span><span class="w"> </span><span class="n">Classification</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì¹œì ˆí•˜ê³  ë„ì›€ì´ ë˜ëŠ” ê³ ê° ìƒë‹´ì‚¬ë¡œì„œ ì‘ë‹µí•˜ì„¸ìš”.</span>
<span class="s">                ë¶„ë¥˜í•  ìˆ˜ ì—†ëŠ” ë¬¸ì˜ì— ëŒ€í•´ ì¼ë°˜ì ì¸ ì•ˆë‚´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">canHandle</span><span class="p">(</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="434">4.3.4 í•¸ë“¤ëŸ¬ ìë™ ë“±ë¡</h3>
<p>Springì˜ ì˜ì¡´ì„± ì£¼ì…ì„ í™œìš©í•˜ë©´ í•¸ë“¤ëŸ¬ë¥¼ ìë™ìœ¼ë¡œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">RoutingConfiguration</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handlerMap</span><span class="p">(</span><span class="n">handlers</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Handler</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">Handler</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableMapOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">Handler</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">        </span><span class="n">handlers</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">TechnicalSupportHandler</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">map</span><span class="o">[</span><span class="s">&quot;TECHNICAL_SUPPORT&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handler</span>
<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">BillingHandler</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">map</span><span class="o">[</span><span class="s">&quot;BILLING&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handler</span>
<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">GeneralInquiryHandler</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">map</span><span class="o">[</span><span class="s">&quot;GENERAL_INQUIRY&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handler</span>
<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">FeedbackHandler</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">map</span><span class="o">[</span><span class="s">&quot;FEEDBACK&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handler</span>
<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">DefaultHandler</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">map</span><span class="o">[</span><span class="s">&quot;default&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handler</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">map</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="435">4.3.5 ë©€í‹°ë ˆë²¨ ë¼ìš°íŒ…</h3>
<p>ë³µì¡í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” <strong>ê³„ì¸µì  ë¼ìš°íŒ…</strong>ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Level1Classification</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">domain</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w">  </span><span class="c1">// SALES, SUPPORT, ADMIN</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Level2Classification</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">subCategory</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">specificIssue</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">needsDetailedClassification</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Level3Classification</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">detailedType</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">suggestedHandler</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HierarchicalRouter</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">handlers</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">Handler</span><span class="o">&gt;&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">route</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">RoutingResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Level 1: ëŒ€ë¶„ë¥˜</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">l1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">classifyLevel1</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;L1 ë¶„ë¥˜: </span><span class="si">${</span><span class="n">l1</span><span class="p">.</span><span class="na">domain</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Level 2: ì¤‘ë¶„ë¥˜</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">l2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">classifyLevel2</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">l1</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;L2 ë¶„ë¥˜: </span><span class="si">${</span><span class="n">l2</span><span class="p">.</span><span class="na">subCategory</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Level 3: ì†Œë¶„ë¥˜ (í•„ìš”ì‹œ)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">l3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l2</span><span class="p">.</span><span class="na">needsDetailedClassification</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">classifyLevel3</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">l2</span><span class="p">).</span><span class="na">also</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;L3 ë¶„ë¥˜: </span><span class="si">${</span><span class="nb">it</span><span class="p">.</span><span class="na">detailedType</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="kc">null</span>

<span class="w">        </span><span class="c1">// ìµœì¢… í•¸ë“¤ëŸ¬ ì„ íƒ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selectHandler</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="w"> </span><span class="n">l2</span><span class="p">,</span><span class="w"> </span><span class="n">l3</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">handler</span><span class="p">.</span><span class="na">process</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">selectHandler</span><span class="p">(</span>
<span class="w">        </span><span class="n">l1</span><span class="p">:</span><span class="w"> </span><span class="n">Level1Classification</span><span class="p">,</span>
<span class="w">        </span><span class="n">l2</span><span class="p">:</span><span class="w"> </span><span class="n">Level2Classification</span><span class="p">,</span>
<span class="w">        </span><span class="n">l3</span><span class="p">:</span><span class="w"> </span><span class="n">Level3Classification?</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">domainHandlers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handlers</span><span class="o">[</span><span class="n">l1</span><span class="p">.</span><span class="na">domain</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">handlers</span><span class="o">[</span><span class="s">&quot;default&quot;</span><span class="o">]!!</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l3</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">domainHandlers</span><span class="o">[</span><span class="n">l3</span><span class="p">.</span><span class="na">detailedType</span><span class="o">]</span>
<span class="w">                </span><span class="o">?:</span><span class="w"> </span><span class="n">domainHandlers</span><span class="o">[</span><span class="n">l2</span><span class="p">.</span><span class="na">subCategory</span><span class="o">]</span>
<span class="w">                </span><span class="o">?:</span><span class="w"> </span><span class="n">domainHandlers</span><span class="o">[</span><span class="s">&quot;default&quot;</span><span class="o">]!!</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">domainHandlers</span><span class="o">[</span><span class="n">l2</span><span class="p">.</span><span class="na">subCategory</span><span class="o">]</span>
<span class="w">                </span><span class="o">?:</span><span class="w"> </span><span class="n">domainHandlers</span><span class="o">[</span><span class="s">&quot;default&quot;</span><span class="o">]!!</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="436">4.3.6 í´ë°± ì „ëµ</h3>
<p>í•¸ë“¤ëŸ¬ ì‹¤íŒ¨ ì‹œ ëŒ€ì•ˆì„ ì œê³µí•˜ëŠ” <strong>í´ë°± ì „ëµ</strong>ì€ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ResilientRoutingWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">handlers</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">Handler</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">defaultHandler</span><span class="p">:</span><span class="w"> </span><span class="n">Handler</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">javaClass</span><span class="p">)</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">route</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">classification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">classify</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 1ì°¨: ì „ë¬¸ í•¸ë“¤ëŸ¬ ì‹œë„</span>
<span class="w">        </span><span class="n">handlers</span><span class="o">[</span><span class="n">classification</span><span class="p">.</span><span class="na">category</span><span class="o">]?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">handler</span><span class="p">.</span><span class="na">handle</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Primary handler failed: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 2ì°¨: ìœ ì‚¬ ì¹´í…Œê³ ë¦¬ í•¸ë“¤ëŸ¬</span>
<span class="w">        </span><span class="n">findSimilarHandler</span><span class="p">(</span><span class="n">classification</span><span class="p">)</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">handler</span><span class="p">.</span><span class="na">handle</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Similar handler failed: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 3ì°¨: ê¸°ë³¸ í•¸ë“¤ëŸ¬</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">defaultHandler</span><span class="p">.</span><span class="na">handle</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">classification</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">findSimilarHandler</span><span class="p">(</span><span class="n">classification</span><span class="p">:</span><span class="w"> </span><span class="n">Classification</span><span class="p">):</span><span class="w"> </span><span class="n">Handler? </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ì¹´í…Œê³ ë¦¬ ìœ ì‚¬ë„ ë§¤í•‘</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">similarCategories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;TECHNICAL_SUPPORT&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="s">&quot;GENERAL_INQUIRY&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="s">&quot;BILLING&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="s">&quot;GENERAL_INQUIRY&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="s">&quot;FEEDBACK&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="s">&quot;GENERAL_INQUIRY&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">similar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">similarCategories</span><span class="o">[</span><span class="n">classification</span><span class="p">.</span><span class="na">category</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">emptyList</span><span class="p">()</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">similar</span>
<span class="w">            </span><span class="p">.</span><span class="na">mapNotNull</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">handlers</span><span class="o">[</span><span class="nb">it</span><span class="o">]</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">firstOrNull</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="437">4.3.7 ì‹¤ìŠµ: ê³ ê° ë¬¸ì˜ ìë™ ë¶„ë¥˜ ì‹œìŠ¤í…œ</h3>
<p>ì‹¤ì œ ê³ ê° ì§€ì› ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì™„ì „í•œ ë¼ìš°íŒ… ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ê³ ê° ì»¨í…ìŠ¤íŠ¸</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CustomerContext</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">customerId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">accountType</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w">  </span><span class="c1">// FREE, PREMIUM, ENTERPRISE</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">ticketCount</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">lastInteraction</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="c1">// ë¬¸ì˜ ë¶„ì„ ê²°ê³¼</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">InquiryAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">category</span><span class="p">:</span><span class="w"> </span><span class="n">SupportCategory</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">urgency</span><span class="p">:</span><span class="w"> </span><span class="n">Urgency</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sentiment</span><span class="p">:</span><span class="w"> </span><span class="n">Sentiment</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">specificIssueType</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">requiredInformation</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">suggestedApproach</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SupportCategory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">BILLING</span><span class="p">,</span><span class="w"> </span><span class="n">TECHNICAL</span><span class="p">,</span><span class="w"> </span><span class="n">SHIPPING</span><span class="p">,</span><span class="w"> </span><span class="n">RETURNS</span><span class="p">,</span><span class="w"> </span><span class="n">GENERAL</span>
<span class="p">}</span>

<span class="c1">// ì§€ì› ì—ì´ì „íŠ¸ ì¸í„°í˜ì´ìŠ¤</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">SupportAgent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateResponse</span><span class="p">(</span>
<span class="w">        </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">analysis</span><span class="p">:</span><span class="w"> </span><span class="n">InquiryAnalysis</span><span class="p">,</span>
<span class="w">        </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">CustomerContext</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// í’ˆì§ˆ ê²€ì¦</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">QualityCheck</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">passed</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">score</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">feedback</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="p">)</span>

<span class="c1">// ìµœì¢… ì‘ë‹µ</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SupportResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">category</span><span class="p">:</span><span class="w"> </span><span class="n">SupportCategory</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">urgency</span><span class="p">:</span><span class="w"> </span><span class="n">Urgency</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">escalated</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">CustomerSupportRouter</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">agents</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">SupportCategory</span><span class="p">,</span><span class="w"> </span><span class="n">SupportAgent</span><span class="o">&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">javaClass</span><span class="p">)</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handleInquiry</span><span class="p">(</span>
<span class="w">        </span><span class="n">customerMessage</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">CustomerContext</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">SupportResponse</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// 1. ì¸í…íŠ¸ ë¶„ì„</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">analysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analyzeInquiry</span><span class="p">(</span><span class="n">customerMessage</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;ë¬¸ì˜ ë¶„ì„ ì™„ë£Œ: </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">category</span><span class="si">}</span><span class="s">, ê¸´ê¸‰ë„: </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">urgency</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 2. ê¸´ê¸‰ë„ í‰ê°€ - CRITICALì€ ì¸ê°„ ìƒë‹´ì‚¬ì—ê²Œ ì—ìŠ¤ì»¬ë ˆì´ì…˜</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">analysis</span><span class="p">.</span><span class="na">urgency</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Urgency</span><span class="p">.</span><span class="na">CRITICAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">escalateToHuman</span><span class="p">(</span><span class="n">customerMessage</span><span class="p">,</span><span class="w"> </span><span class="n">analysis</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 3. ì ì ˆí•œ ì—ì´ì „íŠ¸ ë¼ìš°íŒ…</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">agent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selectAgent</span><span class="p">(</span><span class="n">analysis</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 4. ì‘ë‹µ ìƒì„±</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">agent</span><span class="p">.</span><span class="na">generateResponse</span><span class="p">(</span><span class="n">customerMessage</span><span class="p">,</span><span class="w"> </span><span class="n">analysis</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 5. ì‘ë‹µ í’ˆì§ˆ ê²€ì¦</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">quality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validateResponse</span><span class="p">(</span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">analysis</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">quality</span><span class="p">.</span><span class="na">passed</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">quality</span><span class="p">.</span><span class="na">feedback</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">improveResponse</span><span class="p">(</span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">quality</span><span class="p">.</span><span class="na">feedback</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">SupportResponse</span><span class="p">(</span>
<span class="w">            </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">,</span>
<span class="w">            </span><span class="n">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis</span><span class="p">.</span><span class="na">category</span><span class="p">,</span>
<span class="w">            </span><span class="n">urgency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis</span><span class="p">.</span><span class="na">urgency</span><span class="p">,</span>
<span class="w">            </span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quality</span><span class="p">.</span><span class="na">score</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeInquiry</span><span class="p">(</span>
<span class="w">        </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">CustomerContext</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">InquiryAnalysis</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ê³ ê° ì§€ì› ë¬¸ì˜ë¥¼ ë¶„ì„í•˜ì„¸ìš”.</span>

<span class="s">                ê³ ê° ì •ë³´:</span>
<span class="s">                - ê³„ì • ìœ í˜•: </span><span class="si">${</span><span class="n">context</span><span class="p">.</span><span class="na">accountType</span><span class="si">}</span>
<span class="s">                - ì´ì „ í‹°ì¼“ ìˆ˜: </span><span class="si">${</span><span class="n">context</span><span class="p">.</span><span class="na">ticketCount</span><span class="si">}</span>
<span class="s">                - ë§ˆì§€ë§‰ ì—°ë½: </span><span class="si">${</span><span class="n">context</span><span class="p">.</span><span class="na">lastInteraction</span><span class="si">}</span>

<span class="s">                ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬: BILLING, TECHNICAL, SHIPPING, RETURNS, GENERAL</span>
<span class="s">                ê¸´ê¸‰ë„: LOW, MEDIUM, HIGH, CRITICAL</span>
<span class="s">                ê°ì„±: POSITIVE, NEUTRAL, NEGATIVE</span>

<span class="s">                ë˜í•œ ë‹¤ìŒì„ ì‹ë³„í•˜ì„¸ìš”:</span>
<span class="s">                - specificIssueType: êµ¬ì²´ì ì¸ ì´ìŠˆ ìœ í˜•</span>
<span class="s">                - requiredInformation: í•´ê²°ì— í•„ìš”í•œ ì •ë³´</span>
<span class="s">                - suggestedApproach: ì¶”ì²œ í•´ê²° ì ‘ê·¼ë²•</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">InquiryAnalysis</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">selectAgent</span><span class="p">(</span><span class="n">analysis</span><span class="p">:</span><span class="w"> </span><span class="n">InquiryAnalysis</span><span class="p">):</span><span class="w"> </span><span class="n">SupportAgent</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">agents</span><span class="o">[</span><span class="n">analysis</span><span class="p">.</span><span class="na">category</span><span class="o">]</span>
<span class="w">            </span><span class="o">?:</span><span class="w"> </span><span class="n">agents</span><span class="o">[</span><span class="n">SupportCategory</span><span class="p">.</span><span class="na">GENERAL</span><span class="o">]</span>
<span class="w">            </span><span class="o">?:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;No agent available&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">validateResponse</span><span class="p">(</span>
<span class="w">        </span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">analysis</span><span class="p">:</span><span class="w"> </span><span class="n">InquiryAnalysis</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">QualityCheck</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì‘ë‹µì˜ í’ˆì§ˆì„ í‰ê°€í•˜ì„¸ìš”:</span>
<span class="s">                - ê³ ê° ë¬¸ì˜ì— ì ì ˆíˆ ë‹µë³€í–ˆëŠ”ê°€?</span>
<span class="s">                - í†¤ì´ ì ì ˆí•œê°€?</span>
<span class="s">                - ëª…í™•í•˜ê³  ì‹¤í–‰ ê°€ëŠ¥í•œê°€?</span>

<span class="s">                score: 0.0~1.0</span>
<span class="s">                passed: score &gt;= 0.7</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë¶„ì„: </span><span class="si">${</span><span class="n">analysis</span><span class="si">}</span>
<span class="s">                ì‘ë‹µ: </span><span class="si">$</span><span class="n">response</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">QualityCheck</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">improveResponse</span><span class="p">(</span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">feedback</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì—¬ ì‘ë‹µì„ ê°œì„ í•˜ì„¸ìš”.</span>
<span class="s">                í”¼ë“œë°±: </span><span class="si">$</span><span class="n">feedback</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">escalateToHuman</span><span class="p">(</span>
<span class="w">        </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">analysis</span><span class="p">:</span><span class="w"> </span><span class="n">InquiryAnalysis</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">SupportResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">SupportResponse</span><span class="p">(</span>
<span class="w">            </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ê³ ê°ë‹˜ì˜ ë¬¸ì˜ê°€ ê¸´ê¸‰ ì²˜ë¦¬ê°€ í•„ìš”í•œ ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.</span>

<span class="s">                ì „ë¬¸ ìƒë‹´ì‚¬ê°€ ê³§ ì—°ë½ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.</span>
<span class="s">                ì˜ˆìƒ ëŒ€ê¸° ì‹œê°„: 5ë¶„ ì´ë‚´</span>

<span class="s">                ê¸´ê¸‰í•œ ê²½ìš° ì§í†µ ì „í™” 1588-0000ìœ¼ë¡œ ì—°ë½ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">(),</span>
<span class="w">            </span><span class="n">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis</span><span class="p">.</span><span class="na">category</span><span class="p">,</span>
<span class="w">            </span><span class="n">urgency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis</span><span class="p">.</span><span class="na">urgency</span><span class="p">,</span>
<span class="w">            </span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.0</span><span class="p">,</span>
<span class="w">            </span><span class="n">escalated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-44-orchestrator-workers-">Module 4.4: Orchestrator-Workers (ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°-ì›Œì»¤)</h2>
<h3 id="441">4.4.1 íŒ¨í„´ ê°œìš”</h3>
<p><strong>ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°-ì›Œì»¤</strong> íŒ¨í„´ì€ ë³µì¡í•œ ì‘ì—…ì„ ë™ì ìœ¼ë¡œ ë¶„í•´í•˜ê³  ì „ë¬¸í™”ëœ ì›Œì»¤ì—ê²Œ ë¶„ë°°í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°ê°€ <strong>ì§€íœ˜ì</strong> ì—­í• ì„, ì›Œì»¤ë“¤ì´ <strong>ì—°ì£¼ì</strong> ì—­í• ì„ í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="w">                    </span><span class="err">â”Œâ”€â”€â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Worker 1</span><span class="o">]</span><span class="w"> </span><span class="err">â”€â”€â”</span>
<span class="o">[</span><span class="n">Input</span><span class="o">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Orchestrator</span><span class="o">]</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Worker 2</span><span class="o">]</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Orchestrator</span><span class="o">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Output</span><span class="o">]</span>
<span class="w">                    </span><span class="err">â””â”€â”€â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Worker 3</span><span class="o">]</span><span class="w"> </span><span class="err">â”€â”€â”˜</span>
</code></pre></div>

<h4 id="_6">íŠ¹ì§•</h4>
<ul>
<li><strong>ë™ì  ì‘ì—… ë¶„í•´</strong>: ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°ê°€ ìƒí™©ì— ë§ê²Œ ì‘ì—…ì„ ë‚˜ëˆ”</li>
<li><strong>ì „ë¬¸í™”</strong>: ê° ì›Œì»¤ëŠ” íŠ¹ì • ìœ í˜•ì˜ ì‘ì—…ì— íŠ¹í™”</li>
<li><strong>ì ì‘ì </strong>: ì¤‘ê°„ ê²°ê³¼ì— ë”°ë¼ ê³„íš ìˆ˜ì • ê°€ëŠ¥</li>
</ul>
<h3 id="442">4.4.2 ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° êµ¬í˜„</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// ì‘ì—… ê³„íš</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">TaskPlan</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">taskId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">subTasks</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SubTask</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SubTask</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">workerType</span><span class="p">:</span><span class="w"> </span><span class="n">WorkerType</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">dependencies</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w">  </span><span class="c1">// ì˜ì¡´í•˜ëŠ” subTask IDë“¤</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">priority</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w">  </span><span class="c1">// 1ì´ ê°€ì¥ ë†’ìŒ</span>
<span class="p">)</span>

<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WorkerType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">RESEARCHER</span><span class="p">,</span><span class="w"> </span><span class="n">WRITER</span><span class="p">,</span><span class="w"> </span><span class="n">ANALYST</span><span class="p">,</span><span class="w"> </span><span class="n">CODER</span><span class="p">,</span><span class="w"> </span><span class="n">REVIEWER</span>
<span class="p">}</span>

<span class="c1">// ì›Œì»¤ ê²°ê³¼</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WorkerResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">taskId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">output</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">success</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">requiresReplanning</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">metadata</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">emptyMap</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1">// ìµœì¢… ê²°ê³¼</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">OrchestratorResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalOutput</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">plan</span><span class="p">:</span><span class="w"> </span><span class="n">TaskPlan</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">workerResults</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">iterations</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">OrchestratorWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">workers</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">WorkerType</span><span class="p">,</span><span class="w"> </span><span class="n">Worker</span><span class="o">&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">OrchestratorResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. ì‘ì—… ë¶„í•´</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">plan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">planTasks</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ“‹ ì‘ì—… ê³„íš ìˆ˜ë¦½: </span><span class="si">${</span><span class="n">plan</span><span class="p">.</span><span class="na">subTasks</span><span class="p">.</span><span class="na">size</span><span class="si">}</span><span class="s">ê°œì˜ í•˜ìœ„ ì‘ì—…&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableMapOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>

<span class="w">        </span><span class="c1">// 2. ì›Œì»¤ ì‹¤í–‰ (ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ)</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="na">size</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">plan</span><span class="p">.</span><span class="na">subTasks</span><span class="p">.</span><span class="na">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">iterations</span><span class="o">++</span>

<span class="w">            </span><span class="c1">// ì‹¤í–‰ ê°€ëŠ¥í•œ ì‘ì—… ì°¾ê¸°</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">readyTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plan</span><span class="p">.</span><span class="na">subTasks</span><span class="p">.</span><span class="na">filter</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">subTask</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="c1">// ì•„ì§ ì‹¤í–‰ ì•ˆ ë¨ + ì˜ì¡´ì„± ëª¨ë‘ ì™„ë£Œ</span>
<span class="w">                </span><span class="o">!</span><span class="n">results</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">subTask</span><span class="p">.</span><span class="na">id</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                </span><span class="n">subTask</span><span class="p">.</span><span class="na">dependencies</span><span class="p">.</span><span class="na">all</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">readyTasks</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;ìˆœí™˜ ì˜ì¡´ì„± ë˜ëŠ” ë§‰íŒ ì‘ì—… ë°œê²¬&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// ë³‘ë ¬ ì‹¤í–‰</span>
<span class="w">            </span><span class="n">coroutineScope</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">readyTasks</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">subTask</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="kd">val</span><span class="w"> </span><span class="nv">worker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workers</span><span class="o">[</span><span class="n">subTask</span><span class="p">.</span><span class="na">workerType</span><span class="o">]</span>
<span class="w">                            </span><span class="o">?:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Worker not found: </span><span class="si">${</span><span class="n">subTask</span><span class="p">.</span><span class="na">workerType</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">                        </span><span class="c1">// ì˜ì¡´ ì‘ì—… ê²°ê³¼ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ì „ë‹¬</span>
<span class="w">                        </span><span class="kd">val</span><span class="w"> </span><span class="nv">dependencyResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subTask</span><span class="p">.</span><span class="na">dependencies</span>
<span class="w">                            </span><span class="p">.</span><span class="na">associateWith</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">results</span><span class="o">[</span><span class="nb">it</span><span class="o">]!!</span><span class="w"> </span><span class="p">}</span>

<span class="w">                        </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">worker</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">subTask</span><span class="p">,</span><span class="w"> </span><span class="n">dependencyResults</span><span class="p">)</span>

<span class="w">                        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… </span><span class="si">${</span><span class="n">subTask</span><span class="p">.</span><span class="na">id</span><span class="si">}</span><span class="s"> ì™„ë£Œ (</span><span class="si">${</span><span class="n">subTask</span><span class="p">.</span><span class="na">workerType</span><span class="si">}</span><span class="s">)&quot;</span><span class="p">)</span>

<span class="w">                        </span><span class="n">subTask</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">result</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}.</span><span class="na">awaitAll</span><span class="p">().</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">results</span><span class="o">[</span><span class="n">id</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>

<span class="w">                    </span><span class="c1">// ì¬ê³„íš í•„ìš” ì—¬ë¶€ í™•ì¸</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">requiresReplanning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">plan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replan</span><span class="p">(</span><span class="n">plan</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 3. ê²°ê³¼ í†µí•©</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">synthesizeResults</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">plan</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">OrchestratorResult</span><span class="p">(</span><span class="n">finalOutput</span><span class="p">,</span><span class="w"> </span><span class="n">plan</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">planTasks</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">TaskPlan</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¹ì‹ ì€ ì‘ì—… ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°ì…ë‹ˆë‹¤.</span>
<span class="s">                ì‘ì—…ì„ ë¶„ì„í•˜ê³  í•˜ìœ„ ì‘ì—…ìœ¼ë¡œ ë¶„í•´í•˜ì„¸ìš”.</span>

<span class="s">                ê° í•˜ìœ„ ì‘ì—…ì— ëŒ€í•´ ì§€ì •:</span>
<span class="s">                - id: ê³ ìœ  ì‹ë³„ì (ì˜ˆ: &quot;task-1&quot;)</span>
<span class="s">                - description: ìˆ˜í–‰í•  ì‘ì—… ì„¤ëª…</span>
<span class="s">                - workerType: RESEARCHER, WRITER, ANALYST, CODER, REVIEWER ì¤‘ í•˜ë‚˜</span>
<span class="s">                - dependencies: ì´ ì‘ì—…ì´ ì˜ì¡´í•˜ëŠ” ë‹¤ë¥¸ ì‘ì—… ID ëª©ë¡</span>
<span class="s">                - priority: 1-5 (1ì´ ê°€ì¥ ë†’ìŒ)</span>

<span class="s">                ê°€ëŠ¥í•œ ë³‘ë ¬ ì‹¤í–‰ì„ ìµœì í™”í•˜ì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">TaskPlan</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">replan</span><span class="p">(</span>
<span class="w">        </span><span class="n">currentPlan</span><span class="p">:</span><span class="w"> </span><span class="n">TaskPlan</span><span class="p">,</span>
<span class="w">        </span><span class="n">completedResults</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">TaskPlan</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                í˜„ì¬ ì§„í–‰ ìƒí™©ì„ ë³´ê³  ê³„íšì„ ìˆ˜ì •í•˜ì„¸ìš”.</span>
<span class="s">                ì™„ë£Œëœ ì‘ì—…ì€ ìœ ì§€í•˜ê³ , ë‚¨ì€ ì‘ì—…ì„ ì¡°ì •í•˜ì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                í˜„ì¬ ê³„íš: </span><span class="si">$</span><span class="n">currentPlan</span>
<span class="s">                ì™„ë£Œëœ ê²°ê³¼: </span><span class="si">$</span><span class="n">completedResults</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">TaskPlan</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">synthesizeResults</span><span class="p">(</span>
<span class="w">        </span><span class="n">originalTask</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">plan</span><span class="p">:</span><span class="w"> </span><span class="n">TaskPlan</span><span class="p">,</span>
<span class="w">        </span><span class="n">results</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ëª¨ë“  ì›Œì»¤ì˜ ê²°ê³¼ë¥¼ í†µí•©í•˜ì—¬ ìµœì¢… ì¶œë ¥ì„ ìƒì„±í•˜ì„¸ìš”.</span>
<span class="s">                ì¼ê´€ì„± ìˆê³  ì™„ì „í•œ ê²°ê³¼ë¬¼ì„ ë§Œë“œì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì›ë³¸ ì‘ì—…: </span><span class="si">$</span><span class="n">originalTask</span>
<span class="s">                ê³„íš: </span><span class="si">$</span><span class="n">plan</span>
<span class="s">                ê²°ê³¼ë“¤: </span><span class="si">$</span><span class="n">results</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="443">4.4.3 ì „ë¬¸í™”ëœ ì›Œì»¤</h3>
<p>ê° ì›Œì»¤ëŠ” íŠ¹ì • ìœ í˜•ì˜ ì‘ì—…ì— íŠ¹í™”ë©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nc">Worker</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">type</span><span class="p">:</span><span class="w"> </span><span class="n">WorkerType</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="n">SubTask</span><span class="p">,</span><span class="w"> </span><span class="n">dependencyResults</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">WorkerResult</span>
<span class="p">}</span>

<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ResearchWorker</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Worker</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WorkerType</span><span class="p">.</span><span class="na">RESEARCHER</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
<span class="w">        </span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="n">SubTask</span><span class="p">,</span>
<span class="w">        </span><span class="n">dependencyResults</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">WorkerResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dependencyResults</span><span class="p">.</span><span class="na">values</span>
<span class="w">            </span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">output</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¹ì‹ ì€ ë¦¬ì„œì¹˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.</span>
<span class="s">                ì£¼ì–´ì§„ ì£¼ì œì— ëŒ€í•´ ì² ì €íˆ ì¡°ì‚¬í•˜ì„¸ìš”.</span>

<span class="s">                ì œê³µí•  ë‚´ìš©:</span>
<span class="s">                - í•µì‹¬ ë°œê²¬ì‚¬í•­ (ê¸€ë¨¸ë¦¬ ê¸°í˜¸)</span>
<span class="s">                - ì¶œì²˜/ì°¸ê³ ìë£Œ</span>
<span class="s">                - ì‹ ë¢°ë„</span>
<span class="s">                - ì¶”ê°€ ì¡°ì‚¬ í•„ìš” ì˜ì—­</span>

<span class="s">                </span><span class="si">${</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">())</span><span class="w"> </span><span class="s">&quot;</span><span class="err">ì´ì „</span><span class="w"> </span><span class="err">ì‘ì—…</span><span class="w"> </span><span class="err">ì»¨í…ìŠ¤íŠ¸</span><span class="p">:</span><span class="err">\</span><span class="n">n</span><span class="err">$</span><span class="n">context</span><span class="s">&quot;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="si">}</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="na">description</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">WorkerResult</span><span class="p">(</span>
<span class="w">            </span><span class="n">taskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">,</span>
<span class="w">            </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">CoderWorker</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Worker</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WorkerType</span><span class="p">.</span><span class="na">CODER</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
<span class="w">        </span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="n">SubTask</span><span class="p">,</span>
<span class="w">        </span><span class="n">dependencyResults</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">WorkerResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dependencyResults</span><span class="p">.</span><span class="na">values</span>
<span class="w">            </span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">output</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¹ì‹ ì€ ìˆ™ë ¨ëœ í”„ë¡œê·¸ë˜ë¨¸ì…ë‹ˆë‹¤.</span>
<span class="s">                ê¹”ë”í•˜ê³  íš¨ìœ¨ì ì´ë©° ë¬¸ì„œí™”ëœ ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.</span>

<span class="s">                í¬í•¨í•  ë‚´ìš©:</span>
<span class="s">                - êµ¬í˜„ ì½”ë“œ</span>
<span class="s">                - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸</span>
<span class="s">                - ë¬¸ì„œ/ì£¼ì„</span>
<span class="s">                - ì—ëŸ¬ ì²˜ë¦¬</span>

<span class="s">                </span><span class="si">${</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">())</span><span class="w"> </span><span class="s">&quot;</span><span class="err">ì´ì „</span><span class="w"> </span><span class="err">ì‘ì—…</span><span class="w"> </span><span class="err">ì»¨í…ìŠ¤íŠ¸</span><span class="p">:</span><span class="err">\</span><span class="n">n</span><span class="err">$</span><span class="n">context</span><span class="s">&quot;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="si">}</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="na">description</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">WorkerResult</span><span class="p">(</span>
<span class="w">            </span><span class="n">taskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">,</span>
<span class="w">            </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ReviewerWorker</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Worker</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WorkerType</span><span class="p">.</span><span class="na">REVIEWER</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
<span class="w">        </span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="n">SubTask</span><span class="p">,</span>
<span class="w">        </span><span class="n">dependencyResults</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">WorkerResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">toReview</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dependencyResults</span><span class="p">.</span><span class="na">values</span>
<span class="w">            </span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;\n---\n&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">output</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¹ì‹ ì€ í’ˆì§ˆ ê²€í†  ì „ë¬¸ê°€ì…ë‹ˆë‹¤.</span>
<span class="s">                ì œê³µëœ ì‘ì—…ë¬¼ì„ ê²€í† í•˜ê³  í”¼ë“œë°±ì„ ì œê³µí•˜ì„¸ìš”.</span>

<span class="s">                ê²€í†  í•­ëª©:</span>
<span class="s">                - ì •í™•ì„±</span>
<span class="s">                - ì™„ì„±ë„</span>
<span class="s">                - í’ˆì§ˆ</span>
<span class="s">                - ê°œì„  ì œì•ˆ</span>

<span class="s">                ì‹¬ê°í•œ ë¬¸ì œê°€ ìˆìœ¼ë©´ requiresReplanningì„ trueë¡œ ì„¤ì •í•˜ì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;ê²€í†  ëŒ€ìƒ:\n</span><span class="si">$</span><span class="n">toReview</span><span class="s">\n\nê²€í†  ìš”ì²­: </span><span class="si">${</span><span class="n">task</span><span class="p">.</span><span class="na">description</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">hasIssues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;ì‹¬ê°í•œ ë¬¸ì œ&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">                        </span><span class="n">output</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;ì¬ì‘ì—… í•„ìš”&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">WorkerResult</span><span class="p">(</span>
<span class="w">            </span><span class="n">taskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">,</span>
<span class="w">            </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="n">requiresReplanning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hasIssues</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Writer, Analyst ë“±ë„ ìœ ì‚¬í•˜ê²Œ êµ¬í˜„...</span>
</code></pre></div>

<h3 id="444">4.4.4 ì˜ì¡´ì„± ê´€ë¦¬ ë° ë³‘ë ¬ ì‹¤í–‰</h3>
<p>ì˜ì¡´ì„± ê·¸ë˜í”„ë¥¼ ë¶„ì„í•˜ì—¬ ê°€ëŠ¥í•œ ë§ì€ ì‘ì—…ì„ ë³‘ë ¬ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">DependencyAwareOrchestrator</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">workers</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">WorkerType</span><span class="p">,</span><span class="w"> </span><span class="n">Worker</span><span class="o">&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">plan</span><span class="p">:</span><span class="w"> </span><span class="n">TaskPlan</span><span class="p">):</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">completedTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">completedTasks</span><span class="p">.</span><span class="na">size</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">plan</span><span class="p">.</span><span class="na">subTasks</span><span class="p">.</span><span class="na">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ì‹¤í–‰ ê°€ëŠ¥í•œ íƒœìŠ¤í¬ ì°¾ê¸°</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">readyTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plan</span><span class="p">.</span><span class="na">subTasks</span><span class="p">.</span><span class="na">filter</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="o">!</span><span class="n">completedTasks</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="na">id</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                </span><span class="n">task</span><span class="p">.</span><span class="na">dependencies</span><span class="p">.</span><span class="na">all</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">completedTasks</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">}.</span><span class="na">sortedBy</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">priority</span><span class="w"> </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">readyTasks</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">completedTasks</span><span class="p">.</span><span class="na">size</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">plan</span><span class="p">.</span><span class="na">subTasks</span><span class="p">.</span><span class="na">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Deadlock detected in task dependencies&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">break</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// ë³‘ë ¬ ì‹¤í–‰</span>
<span class="w">            </span><span class="n">coroutineScope</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">readyTasks</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="kd">val</span><span class="w"> </span><span class="nv">dependencyResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="na">dependencies</span>
<span class="w">                            </span><span class="p">.</span><span class="na">associateWith</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">completedTasks</span><span class="o">[</span><span class="nb">it</span><span class="o">]!!</span><span class="w"> </span><span class="p">}</span>

<span class="w">                        </span><span class="kd">val</span><span class="w"> </span><span class="nv">worker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workers</span><span class="o">[</span><span class="n">task</span><span class="p">.</span><span class="na">workerType</span><span class="o">]!!</span>
<span class="w">                        </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">worker</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">dependencyResults</span><span class="p">)</span>

<span class="w">                        </span><span class="n">completedTasks</span><span class="o">[</span><span class="n">task</span><span class="p">.</span><span class="na">id</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}.</span><span class="na">awaitAll</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">completedTasks</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ì˜ì¡´ì„± ê·¸ë˜í”„ ì‹œê°í™” (ë””ë²„ê¹…ìš©)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">visualizeDependencies</span><span class="p">(</span><span class="n">plan</span><span class="p">:</span><span class="w"> </span><span class="n">TaskPlan</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableListOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">        </span><span class="n">lines</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;ì‘ì—… ì˜ì¡´ì„± ê·¸ë˜í”„:&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">lines</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="w"> </span><span class="p">.</span><span class="na">repeat</span><span class="p">(</span><span class="m">40</span><span class="p">))</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">task</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">plan</span><span class="p">.</span><span class="na">subTasks</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">deps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="na">dependencies</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;ì—†ìŒ (ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥)&quot;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">task</span><span class="p">.</span><span class="na">dependencies</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">lines</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;</span><span class="si">${</span><span class="n">task</span><span class="p">.</span><span class="na">id</span><span class="si">}</span><span class="s"> (</span><span class="si">${</span><span class="n">task</span><span class="p">.</span><span class="na">workerType</span><span class="si">}</span><span class="s">)&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">lines</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;  â””â”€ ì˜ì¡´: </span><span class="si">$</span><span class="n">deps</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="445">4.4.5 ì‹¤ìŠµ: ì½”ë“œ ìƒì„± ì—ì´ì „íŠ¸</h3>
<p>ìš”êµ¬ì‚¬í•­ì„ ë°›ì•„ ì„¤ê³„, êµ¬í˜„, í…ŒìŠ¤íŠ¸, ë¦¬ë·°ê¹Œì§€ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ì—ì´ì „íŠ¸ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">RequirementAnalysis</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">functionalRequirements</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">nonFunctionalRequirements</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">constraints</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CodeGenerationResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">code</span><span class="p">:</span><span class="w"> </span><span class="n">IntegratedCode</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">analysis</span><span class="p">:</span><span class="w"> </span><span class="n">RequirementAnalysis</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">validation</span><span class="p">:</span><span class="w"> </span><span class="n">ValidationResult</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">IntegratedCode</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">mainCode</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tests</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">documentation</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ValidationResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">passed</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">issues</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">suggestions</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">CodeGenerationOrchestrator</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">orchestrator</span><span class="p">:</span><span class="w"> </span><span class="n">OrchestratorWorkflow</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateCode</span><span class="p">(</span><span class="n">requirement</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">CodeGenerationResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. ìš”êµ¬ì‚¬í•­ ë¶„ì„</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">analysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analyzeRequirement</span><span class="p">(</span><span class="n">requirement</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ“‹ ìš”êµ¬ì‚¬í•­ ë¶„ì„ ì™„ë£Œ&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 2. íƒœìŠ¤í¬ ê³„íš (ìë™ ìƒì„±)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">enhancedTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            ë‹¤ìŒ ìš”êµ¬ì‚¬í•­ì— ë§ëŠ” ì½”ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”:</span>

<span class="s">            ìš”êµ¬ì‚¬í•­ ìš”ì•½: </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">summary</span><span class="si">}</span>

<span class="s">            ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­:</span>
<span class="s">            </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">functionalRequirements</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;- </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="w"> </span><span class="p">}</span><span class="si">}</span>

<span class="s">            ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­:</span>
<span class="s">            </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">nonFunctionalRequirements</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;- </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="w"> </span><span class="p">}</span><span class="si">}</span>

<span class="s">            ì œì•½ì‚¬í•­:</span>
<span class="s">            </span><span class="si">${</span><span class="n">analysis</span><span class="p">.</span><span class="na">constraints</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;- </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="w"> </span><span class="p">}</span><span class="si">}</span>

<span class="s">            í•„ìš”í•œ ì‘ì—…:</span>
<span class="s">            1. ì•„í‚¤í…ì²˜ ì„¤ê³„ (ANALYST)</span>
<span class="s">            2. ì½”ë“œ êµ¬í˜„ (CODER) - ì„¤ê³„ ì˜ì¡´</span>
<span class="s">            3. í…ŒìŠ¤íŠ¸ ì‘ì„± (CODER) - êµ¬í˜„ ì˜ì¡´</span>
<span class="s">            4. ì½”ë“œ ë¦¬ë·° (REVIEWER) - êµ¬í˜„, í…ŒìŠ¤íŠ¸ ì˜ì¡´</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// 3. ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°ë¡œ ì‹¤í–‰</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orchestrator</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">enhancedTask</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… ì½”ë“œ ìƒì„± ì™„ë£Œ (</span><span class="si">${</span><span class="n">result</span><span class="p">.</span><span class="na">iterations</span><span class="si">}</span><span class="s"> ë°˜ë³µ)&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 4. ê²°ê³¼ í†µí•©</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integrateCode</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">workerResults</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 5. ìµœì¢… ê²€ì¦</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validateCode</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">finalCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">code</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">validation</span><span class="p">.</span><span class="na">passed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âš ï¸ ê²€ì¦ ì‹¤íŒ¨, ì´ìŠˆ ìˆ˜ì • ì¤‘...&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">finalCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixIssues</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">validation</span><span class="p">.</span><span class="na">issues</span><span class="p">)</span>
<span class="w">            </span><span class="n">validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validateCode</span><span class="p">(</span><span class="n">finalCode</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CodeGenerationResult</span><span class="p">(</span><span class="n">finalCode</span><span class="p">,</span><span class="w"> </span><span class="n">analysis</span><span class="p">,</span><span class="w"> </span><span class="n">validation</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">analyzeRequirement</span><span class="p">(</span><span class="n">requirement</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">RequirementAnalysis</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ìš”êµ¬ì‚¬í•­ì„ ë¶„ì„í•˜ê³  êµ¬ì¡°í™”í•˜ì„¸ìš”:</span>
<span class="s">                - summary: í•œ ì¤„ ìš”ì•½</span>
<span class="s">                - functionalRequirements: ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ ëª©ë¡</span>
<span class="s">                - nonFunctionalRequirements: ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (ì„±ëŠ¥, ë³´ì•ˆ ë“±)</span>
<span class="s">                - constraints: ì œì•½ì‚¬í•­</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">requirement</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">RequirementAnalysis</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">integrateCode</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">WorkerResult</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">IntegratedCode</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ê²°ê³¼ì—ì„œ ì½”ë“œ, í…ŒìŠ¤íŠ¸, ë¬¸ì„œ ì¶”ì¶œ</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">coderResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">filterKeys</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;coder&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;impl&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">testResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">filterKeys</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">reviewResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">filterKeys</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;review&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">IntegratedCode</span><span class="p">(</span>
<span class="w">            </span><span class="n">mainCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coderResults</span><span class="p">.</span><span class="na">values</span><span class="p">.</span><span class="na">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="na">output</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testResults</span><span class="p">.</span><span class="na">values</span><span class="p">.</span><span class="na">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="na">output</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">documentation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reviewResults</span><span class="p">.</span><span class="na">values</span>
<span class="w">                </span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">output</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">validateCode</span><span class="p">(</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">IntegratedCode</span><span class="p">):</span><span class="w"> </span><span class="n">ValidationResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì½”ë“œë¥¼ ê²€ì¦í•˜ì„¸ìš”:</span>
<span class="s">                - ë¬¸ë²• ì˜¤ë¥˜</span>
<span class="s">                - ë…¼ë¦¬ì  ë¬¸ì œ</span>
<span class="s">                - ë³´ì•ˆ ì·¨ì•½ì </span>
<span class="s">                - ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ì¤€ìˆ˜</span>

<span class="s">                passed: ì‹¬ê°í•œ ì´ìŠˆê°€ ì—†ìœ¼ë©´ true</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì½”ë“œ:</span>
<span class="s">                ```</span>
<span class="s">                </span><span class="si">${</span><span class="n">code</span><span class="p">.</span><span class="na">mainCode</span><span class="si">}</span>
<span class="s">                ```</span>

<span class="s">                í…ŒìŠ¤íŠ¸:</span>
<span class="s">                ```</span>
<span class="s">                </span><span class="si">${</span><span class="n">code</span><span class="p">.</span><span class="na">tests</span><span class="si">}</span>
<span class="s">                ```</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">ValidationResult</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">fixIssues</span><span class="p">(</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">IntegratedCode</span><span class="p">,</span><span class="w"> </span><span class="n">issues</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">IntegratedCode</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">fixedCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë‹¤ìŒ ì´ìŠˆë“¤ì„ ìˆ˜ì •í•œ ì½”ë“œë¥¼ ì œê³µí•˜ì„¸ìš”:</span>
<span class="s">                </span><span class="si">${</span><span class="n">issues</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;- </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="w"> </span><span class="p">}</span><span class="si">}</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">code</span><span class="p">.</span><span class="na">mainCode</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">code</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">mainCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixedCode</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-45-evaluator-optimizer-">Module 4.5: Evaluator-Optimizer (í‰ê°€ì-ìµœì í™”)</h2>
<h3 id="451">4.5.1 ë°˜ë³µì  ê°œì„  íŒ¨í„´</h3>
<p><strong>í‰ê°€ì-ìµœì í™”</strong> íŒ¨í„´ì€ ê²°ê³¼ë¬¼ì„ í‰ê°€í•˜ê³ , ê¸°ì¤€ì— ë¯¸ë‹¬í•˜ë©´ í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì—¬ ê°œì„ í•˜ëŠ” ê³¼ì •ì„ ë°˜ë³µí•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="w">         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="w">         </span><span class="err">â†“</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="o">[</span><span class="n">Input</span><span class="o">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Generator</span><span class="o">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Evaluator</span><span class="o">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Pass</span><span class="vm">?</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Output</span><span class="o">]</span>
<span class="w">                              </span><span class="err">â”‚</span>
<span class="w">                              </span><span class="err">â†“</span><span class="w"> </span><span class="k">No</span>
<span class="w">                          </span><span class="o">[</span><span class="n">Feedback</span><span class="o">]</span>
</code></pre></div>

<h3 id="452">4.5.2 êµ¬í˜„</h3>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Evaluation</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">score</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span><span class="w">  </span><span class="c1">// 0.0 ~ 1.0</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">completeness</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">accuracy</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">quality</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">relevance</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">feedback</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">specificIssues</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Iteration</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">number</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">output</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">evaluation</span><span class="p">:</span><span class="w"> </span><span class="n">Evaluation</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">OptimizationResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalOutput</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">iterations</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Iteration</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">success</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">totalIterations</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">success</span><span class="p">(</span><span class="n">output</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Iteration</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">OptimizationResult</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="p">.</span><span class="na">size</span><span class="p">)</span>

<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">maxIterationsReached</span><span class="p">(</span><span class="n">output</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Iteration</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">OptimizationResult</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="p">.</span><span class="na">size</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">EvaluatorOptimizerWorkflow</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">MAX_ITERATIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">PASS_THRESHOLD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">optimize</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">OptimizationResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">currentOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateInitial</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableListOf</span><span class="o">&lt;</span><span class="n">Iteration</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1.</span><span class="p">.</span><span class="na">MAX_ITERATIONS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// í‰ê°€</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">evaluation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluate</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">currentOutput</span><span class="p">)</span>
<span class="w">            </span><span class="n">iterations</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">Iteration</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">currentOutput</span><span class="p">,</span><span class="w"> </span><span class="n">evaluation</span><span class="p">))</span>

<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ“Š ë°˜ë³µ </span><span class="si">$</span><span class="n">i</span><span class="s">: ì ìˆ˜ </span><span class="si">${</span><span class="kt">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;</span><span class="o">%</span><span class="p">.</span><span class="m">2f</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">evaluation</span><span class="p">.</span><span class="na">score</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="c1">// í†µê³¼ ì—¬ë¶€ í™•ì¸</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">evaluation</span><span class="p">.</span><span class="na">score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">PASS_THRESHOLD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… í’ˆì§ˆ ê¸°ì¤€ í†µê³¼!&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">OptimizationResult</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">currentOutput</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// ê°œì„ </span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ”„ í”¼ë“œë°± ë°˜ì˜ ì¤‘...&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">currentOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">improve</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">currentOutput</span><span class="p">,</span><span class="w"> </span><span class="n">evaluation</span><span class="p">.</span><span class="na">feedback</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âš ï¸ ìµœëŒ€ ë°˜ë³µ íšŸìˆ˜ ë„ë‹¬&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">OptimizationResult</span><span class="p">.</span><span class="na">maxIterationsReached</span><span class="p">(</span><span class="n">currentOutput</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateInitial</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;ì£¼ì–´ì§„ ì‘ì—…ì— ëŒ€í•œ ì´ˆê¸° ê²°ê³¼ë¬¼ì„ ìƒì„±í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Evaluation</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ê²°ê³¼ë¬¼ì„ ì›ë˜ ì‘ì—… ìš”êµ¬ì‚¬í•­ê³¼ ë¹„êµí•˜ì—¬ í‰ê°€í•˜ì„¸ìš”.</span>

<span class="s">                ê° í•­ëª©ì„ 0.0 ~ 1.0ìœ¼ë¡œ í‰ê°€:</span>
<span class="s">                - completeness: ì‘ì—…ì„ ì™„ì „íˆ ìˆ˜í–‰í–ˆëŠ”ê°€?</span>
<span class="s">                - accuracy: ì •ë³´ê°€ ì •í™•í•œê°€?</span>
<span class="s">                - quality: í’ˆì§ˆì´ ì¢‹ì€ê°€ (ë¬¸ì²´, êµ¬ì¡° ë“±)?</span>
<span class="s">                - relevance: ì£¼ì œì—ì„œ ë²—ì–´ë‚˜ì§€ ì•Šì•˜ëŠ”ê°€?</span>

<span class="s">                scoreëŠ” ìœ„ í•­ëª©ì˜ ê°€ì¤‘ í‰ê·  (completeness 30%, accuracy 30%, quality 20%, relevance 20%)</span>

<span class="s">                êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ í”¼ë“œë°±ì„ ì œê³µí•˜ì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì‘ì—…: </span><span class="si">$</span><span class="n">task</span>

<span class="s">                í‰ê°€í•  ê²°ê³¼ë¬¼:</span>
<span class="s">                </span><span class="si">$</span><span class="n">output</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">Evaluation</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">improve</span><span class="p">(</span>
<span class="w">        </span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">currentOutput</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">feedback</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì—¬ ê²°ê³¼ë¬¼ì„ ê°œì„ í•˜ì„¸ìš”.</span>
<span class="s">                ì˜ ëœ ë¶€ë¶„ì€ ìœ ì§€í•˜ê³ , í”¼ë“œë°±ì˜ ê° í¬ì¸íŠ¸ë¥¼ í•´ê²°í•˜ì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì›ë˜ ì‘ì—…: </span><span class="si">$</span><span class="n">task</span>

<span class="s">                í˜„ì¬ ê²°ê³¼ë¬¼:</span>
<span class="s">                </span><span class="si">$</span><span class="n">currentOutput</span>

<span class="s">                ê°œì„ í•  í”¼ë“œë°±:</span>
<span class="s">                </span><span class="si">$</span><span class="n">feedback</span>

<span class="s">                ê°œì„ ëœ ë²„ì „:</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="453">4.5.3 ì‹¤ìŠµ: ì½”ë“œ ë¦¬ë·° ë° ê°œì„  ì—ì´ì „íŠ¸</h3>
<p>ì½”ë“œë¥¼ ë¦¬ë·°í•˜ê³  ìë™ìœ¼ë¡œ ê°œì„ í•˜ëŠ” ì—ì´ì „íŠ¸ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CodeIssue</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">severity</span><span class="p">:</span><span class="w"> </span><span class="n">Severity</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">suggestion</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Severity</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CRITICAL</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">,</span><span class="w"> </span><span class="n">MEDIUM</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="w"> </span><span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CodeReview</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">issues</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">CodeIssue</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">overallQuality</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">strengths</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">suggestions</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ReviewCycle</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cycleNumber</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">code</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">review</span><span class="p">:</span><span class="w"> </span><span class="n">CodeReview</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CodeOptimizationResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalCode</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cycles</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ReviewCycle</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">totalIssuesFixed</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">CodeReviewOptimizer</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">optimizeCode</span><span class="p">(</span>
<span class="w">        </span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">requirements</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">CodeOptimizationResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">currentCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">code</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableListOf</span><span class="o">&lt;</span><span class="n">ReviewCycle</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">totalFixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>

<span class="w">        </span><span class="n">repeat</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="c1">// ì½”ë“œ ë¦¬ë·°</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">review</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reviewCode</span><span class="p">(</span><span class="n">currentCode</span><span class="p">,</span><span class="w"> </span><span class="n">requirements</span><span class="p">)</span>
<span class="w">            </span><span class="n">cycles</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ReviewCycle</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">currentCode</span><span class="p">,</span><span class="w"> </span><span class="n">review</span><span class="p">))</span>

<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ“ ë¦¬ë·° ì‚¬ì´í´ </span><span class="si">${</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="si">}</span><span class="s">: </span><span class="si">${</span><span class="n">review</span><span class="p">.</span><span class="na">issues</span><span class="p">.</span><span class="na">size</span><span class="si">}</span><span class="s">ê°œ ì´ìŠˆ ë°œê²¬&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="c1">// ëª¨ë“  ì´ìŠˆ í•´ê²°ë¨</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">review</span><span class="p">.</span><span class="na">issues</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… ì½”ë“œ í’ˆì§ˆ ê²€ì¦ ì™„ë£Œ!&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">CodeOptimizationResult</span><span class="p">(</span><span class="n">currentCode</span><span class="p">,</span><span class="w"> </span><span class="n">cycles</span><span class="p">,</span><span class="w"> </span><span class="n">totalFixed</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// ì´ìŠˆë³„ë¡œ ì •ë ¬ (ì‹¬ê°ë„ ë†’ì€ ìˆœ)</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">sortedIssues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">review</span><span class="p">.</span><span class="na">issues</span><span class="p">.</span><span class="na">sortedBy</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">severity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Severity</span><span class="p">.</span><span class="na">CRITICAL</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="m">0</span>
<span class="w">                    </span><span class="n">Severity</span><span class="p">.</span><span class="na">HIGH</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="m">1</span>
<span class="w">                    </span><span class="n">Severity</span><span class="p">.</span><span class="na">MEDIUM</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="m">2</span>
<span class="w">                    </span><span class="n">Severity</span><span class="p">.</span><span class="na">LOW</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="m">3</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;  - CRITICAL: </span><span class="si">${</span><span class="n">sortedIssues</span><span class="p">.</span><span class="na">count</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">severity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Severity</span><span class="p">.</span><span class="na">CRITICAL</span><span class="w"> </span><span class="p">}</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;  - HIGH: </span><span class="si">${</span><span class="n">sortedIssues</span><span class="p">.</span><span class="na">count</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">severity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Severity</span><span class="p">.</span><span class="na">HIGH</span><span class="w"> </span><span class="p">}</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;  - MEDIUM: </span><span class="si">${</span><span class="n">sortedIssues</span><span class="p">.</span><span class="na">count</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">severity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Severity</span><span class="p">.</span><span class="na">MEDIUM</span><span class="w"> </span><span class="p">}</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;  - LOW: </span><span class="si">${</span><span class="n">sortedIssues</span><span class="p">.</span><span class="na">count</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">severity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Severity</span><span class="p">.</span><span class="na">LOW</span><span class="w"> </span><span class="p">}</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="c1">// ì½”ë“œ ê°œì„ </span>
<span class="w">            </span><span class="n">currentCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">improveCode</span><span class="p">(</span><span class="n">currentCode</span><span class="p">,</span><span class="w"> </span><span class="n">review</span><span class="p">)</span>
<span class="w">            </span><span class="n">totalFixed</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">review</span><span class="p">.</span><span class="na">issues</span><span class="p">.</span><span class="na">size</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CodeOptimizationResult</span><span class="p">(</span><span class="n">currentCode</span><span class="p">,</span><span class="w"> </span><span class="n">cycles</span><span class="p">,</span><span class="w"> </span><span class="n">totalFixed</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">reviewCode</span><span class="p">(</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">requirements</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">CodeReview</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì½”ë“œë¥¼ ë‹¤ìŒ ê´€ì ì—ì„œ ë¦¬ë·°í•˜ì„¸ìš”:</span>

<span class="s">                1. ì •í™•ì„± - ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ”ê°€?</span>
<span class="s">                2. ì„±ëŠ¥ - ë¹„íš¨ìœ¨ì ì¸ ë¶€ë¶„ì´ ìˆëŠ”ê°€?</span>
<span class="s">                3. ë³´ì•ˆ - ì·¨ì•½ì ì´ ìˆëŠ”ê°€?</span>
<span class="s">                4. ìœ ì§€ë³´ìˆ˜ì„± - ê¹”ë”í•˜ê³  ì½ê¸° ì‰¬ìš´ê°€?</span>
<span class="s">                5. ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ - ì»¨ë²¤ì…˜ì„ ë”°ë¥´ëŠ”ê°€?</span>

<span class="s">                ê° ì´ìŠˆì— ëŒ€í•´:</span>
<span class="s">                - severity: CRITICAL, HIGH, MEDIUM, LOW</span>
<span class="s">                - location: íŒŒì¼/ì¤„ ë²ˆí˜¸ ë˜ëŠ” ì„¹ì…˜</span>
<span class="s">                - description: ë¬´ì—‡ì´ ë¬¸ì œì¸ê°€</span>
<span class="s">                - suggestion: ì–´ë–»ê²Œ ìˆ˜ì •í•˜ë©´ ì¢‹ì€ê°€</span>

<span class="s">                strengthsì— ì˜ ëœ ë¶€ë¶„ë„ ì–¸ê¸‰í•˜ì„¸ìš”.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ìš”êµ¬ì‚¬í•­:</span>
<span class="s">                </span><span class="si">$</span><span class="n">requirements</span>

<span class="s">                ì½”ë“œ:</span>
<span class="s">                ```</span>
<span class="s">                </span><span class="si">$</span><span class="n">code</span>
<span class="s">                ```</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">CodeReview</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">improveCode</span><span class="p">(</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">review</span><span class="p">:</span><span class="w"> </span><span class="n">CodeReview</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">issuesSummary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">review</span><span class="p">.</span><span class="na">issues</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="s">&quot;[</span><span class="si">${</span><span class="n">issue</span><span class="p">.</span><span class="na">severity</span><span class="si">}</span><span class="s">] </span><span class="si">${</span><span class="n">issue</span><span class="p">.</span><span class="na">location</span><span class="si">}</span><span class="s">: </span><span class="si">${</span><span class="n">issue</span><span class="p">.</span><span class="na">description</span><span class="si">}</span><span class="s">\n  â†’ </span><span class="si">${</span><span class="n">issue</span><span class="p">.</span><span class="na">suggestion</span><span class="si">}</span><span class="s">&quot;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ë¦¬ë·° ê²°ê³¼ë¥¼ ë°˜ì˜í•˜ì—¬ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.</span>
<span class="s">                ê° ì´ìŠˆë¥¼ í•´ê²°í•˜ë˜, ì½”ë“œì˜ ì¥ì ì€ ìœ ì§€í•˜ì„¸ìš”.</span>

<span class="s">                ì¥ì  (ìœ ì§€í•  ê²ƒ):</span>
<span class="s">                </span><span class="si">${</span><span class="n">review</span><span class="p">.</span><span class="na">strengths</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;- </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="w"> </span><span class="p">}</span><span class="si">}</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì›ë³¸ ì½”ë“œ:</span>
<span class="s">                ```</span>
<span class="s">                </span><span class="si">$</span><span class="n">code</span>
<span class="s">                ```</span>

<span class="s">                ìˆ˜ì •í•  ì´ìŠˆë“¤:</span>
<span class="s">                </span><span class="si">$</span><span class="n">issuesSummary</span>

<span class="s">                ìˆ˜ì •ëœ ì½”ë“œ:</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-46-reflection-agent">Module 4.6: Reflection Agent (ë°˜ì„± ì—ì´ì „íŠ¸)</h2>
<h3 id="461">4.6.1 ìê¸° ë°˜ì„± íŒ¨í„´</h3>
<p><strong>ë°˜ì„± ì—ì´ì „íŠ¸</strong>ëŠ” ìì‹ ì˜ ì‘ë‹µì„ ìŠ¤ìŠ¤ë¡œ ë¹„íŒì ìœ¼ë¡œ ê²€í† í•˜ê³  ê°œì„ í•©ë‹ˆë‹¤. ë§ˆì¹˜ ê¸€ì„ ì“°ê³  ë‚˜ì„œ ë‹¤ì‹œ ì½ì–´ë³´ë©° ê³ ì¹˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<h3 id="462">4.6.2 êµ¬í˜„</h3>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Reflection</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">strengths</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">weaknesses</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">assumptions</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">improvementAreas</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">needsImprovement</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">selfConfidence</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="w">  </span><span class="c1">// 0.0 ~ 1.0</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Verification</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">factuallyCorrect</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">logicallySound</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">complete</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">overallAssessment</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ReflectionResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">finalResponse</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">initialResponse</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">reflection</span><span class="p">:</span><span class="w"> </span><span class="n">Reflection</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">verification</span><span class="p">:</span><span class="w"> </span><span class="n">Verification</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">wasImproved</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ReflectionAgent</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateWithReflection</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">ReflectionResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. ì´ˆê¸° ì‘ë‹µ ìƒì„±</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">initialResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generate</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ“ ì´ˆê¸° ì‘ë‹µ ìƒì„± ì™„ë£Œ&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 2. ìê¸° ë°˜ì„±</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">reflection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflect</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">initialResponse</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ¤” ìê¸° ë°˜ì„± ì™„ë£Œ&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;  - ê°•ì : </span><span class="si">${</span><span class="n">reflection</span><span class="p">.</span><span class="na">strengths</span><span class="p">.</span><span class="na">size</span><span class="si">}</span><span class="s">ê°œ&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;  - ì•½ì : </span><span class="si">${</span><span class="n">reflection</span><span class="p">.</span><span class="na">weaknesses</span><span class="p">.</span><span class="na">size</span><span class="si">}</span><span class="s">ê°œ&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;  - ìì‹ ê°: </span><span class="si">${</span><span class="kt">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;</span><span class="o">%</span><span class="p">.</span><span class="m">0f</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">reflection</span><span class="p">.</span><span class="na">selfConfidence</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="si">}</span><span class="s">%&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 3. ë°˜ì„± ê¸°ë°˜ ê°œì„ </span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">improvedResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reflection</span><span class="p">.</span><span class="na">needsImprovement</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ”„ ì‘ë‹µ ê°œì„  ì¤‘...&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">improveBasedOnReflection</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">initialResponse</span><span class="p">,</span><span class="w"> </span><span class="n">reflection</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… ê°œì„  ë¶ˆí•„ìš”&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">initialResponse</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 4. ìµœì¢… ê²€ì¦</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">verification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verify</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">improvedResponse</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ”ï¸ ê²€ì¦ ì™„ë£Œ: </span><span class="si">${</span><span class="n">verification</span><span class="p">.</span><span class="na">overallAssessment</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ReflectionResult</span><span class="p">(</span>
<span class="w">            </span><span class="n">finalResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">improvedResponse</span><span class="p">,</span>
<span class="w">            </span><span class="n">initialResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initialResponse</span><span class="p">,</span>
<span class="w">            </span><span class="n">reflection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflection</span><span class="p">,</span>
<span class="w">            </span><span class="n">verification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verification</span><span class="p">,</span>
<span class="w">            </span><span class="n">wasImproved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflection</span><span class="p">.</span><span class="na">needsImprovement</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;ì£¼ì–´ì§„ ì‘ì—…ì— ëŒ€í•´ ìµœì„ ì˜ ì‘ë‹µì„ ìƒì„±í•˜ì„¸ìš”.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">reflect</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Reflection</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ìì‹ ì˜ ì‘ë‹µì„ ë¹„íŒì ìœ¼ë¡œ ë¶„ì„í•˜ì„¸ìš”.</span>

<span class="s">                ë‹¤ìŒì„ ê³ ë ¤í•˜ì„¸ìš”:</span>
<span class="s">                1. ì‘ì—…ì„ ì™„ì „íˆ ì´í•´í–ˆëŠ”ê°€?</span>
<span class="s">                2. ëª¨ë“  ìš”êµ¬ì‚¬í•­ì„ ë‹¤ë¤˜ëŠ”ê°€?</span>
<span class="s">                3. ë…¼ë¦¬ì  ì˜¤ë¥˜ë‚˜ ë¹ˆí‹ˆì´ ìˆëŠ”ê°€?</span>
<span class="s">                4. ì‘ë‹µì´ ì˜¤í•´ë  ì†Œì§€ê°€ ìˆëŠ”ê°€?</span>
<span class="s">                5. ì–´ë–¤ ê°€ì •ì„ í–ˆëŠ”ê°€?</span>
<span class="s">                6. ë¬´ì—‡ì„ ë” ì˜ í•  ìˆ˜ ìˆì—ˆëŠ”ê°€?</span>

<span class="s">                ì†”ì§í•˜ê³  ì² ì €í•˜ê²Œ ìê¸° í‰ê°€ë¥¼ í•˜ì„¸ìš”.</span>
<span class="s">                needsImprovementëŠ” ê°œì„ ì´ í•„ìš”í•˜ë©´ true, ì¶©ë¶„íˆ ì¢‹ìœ¼ë©´ false.</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì‘ì—…: </span><span class="si">$</span><span class="n">task</span>

<span class="s">                ë‚´ ì‘ë‹µ:</span>
<span class="s">                </span><span class="si">$</span><span class="n">response</span>

<span class="s">                ìê¸° ë°˜ì„±:</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">Reflection</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">improveBasedOnReflection</span><span class="p">(</span>
<span class="w">        </span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">originalResponse</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">reflection</span><span class="p">:</span><span class="w"> </span><span class="n">Reflection</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ìê¸° ë°˜ì„± ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‘ë‹µì„ ê°œì„ í•˜ì„¸ìš”.</span>

<span class="s">                ê°•ì  (ìœ ì§€í•  ê²ƒ):</span>
<span class="s">                </span><span class="si">${</span><span class="n">reflection</span><span class="p">.</span><span class="na">strengths</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;- </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="w"> </span><span class="p">}</span><span class="si">}</span>

<span class="s">                ì•½ì  (ê°œì„ í•  ê²ƒ):</span>
<span class="s">                </span><span class="si">${</span><span class="n">reflection</span><span class="p">.</span><span class="na">weaknesses</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;- </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="w"> </span><span class="p">}</span><span class="si">}</span>

<span class="s">                ê°œì„  ì˜ì—­:</span>
<span class="s">                </span><span class="si">${</span><span class="n">reflection</span><span class="p">.</span><span class="na">improvementAreas</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="s">&quot;</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;- </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="w"> </span><span class="p">}</span><span class="si">}</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì›ë˜ ì‘ì—…: </span><span class="si">$</span><span class="n">task</span>

<span class="s">                ì›ë˜ ì‘ë‹µ:</span>
<span class="s">                </span><span class="si">$</span><span class="n">originalResponse</span>

<span class="s">                ê°œì„ ëœ ì‘ë‹µ:</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">verify</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Verification</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì‘ë‹µì„ ìµœì¢… ê²€ì¦í•˜ì„¸ìš”:</span>

<span class="s">                - factuallyCorrect: ì‚¬ì‹¤ì ìœ¼ë¡œ ì •í™•í•œê°€?</span>
<span class="s">                - logicallySound: ë…¼ë¦¬ì ìœ¼ë¡œ íƒ€ë‹¹í•œê°€?</span>
<span class="s">                - complete: ì™„ì „í•œê°€ (ë¹ ì§„ ê²ƒì´ ì—†ëŠ”ê°€)?</span>
<span class="s">                - overallAssessment: ì¢…í•© í‰ê°€ (í•œ ë¬¸ì¥)</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                ì‘ì—…: </span><span class="si">$</span><span class="n">task</span>

<span class="s">                ì‘ë‹µ:</span>
<span class="s">                </span><span class="si">$</span><span class="n">response</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="n">Verification</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="463-multi-turn-reflection">4.6.3 ë‹¤ì¤‘ ë°˜ì„± (Multi-turn Reflection)</h3>
<p>ë” ë†’ì€ í’ˆì§ˆì„ ìœ„í•´ ì—¬ëŸ¬ ë²ˆ ë°˜ì„±ì„ ë°˜ë³µí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MultiTurnReflectionAgent</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">MAX_REFLECTION_TURNS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">CONFIDENCE_THRESHOLD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.85</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateWithMultipleReflections</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">ReflectionResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">currentResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generate</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">bestReflection</span><span class="p">:</span><span class="w"> </span><span class="n">Reflection? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">turn</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1.</span><span class="p">.</span><span class="na">MAX_REFLECTION_TURNS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ”„ ë°˜ì„± í„´ </span><span class="si">$</span><span class="n">turn</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">reflection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflect</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">currentResponse</span><span class="p">)</span>
<span class="w">            </span><span class="n">bestReflection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflection</span>

<span class="w">            </span><span class="c1">// ì¶©ë¶„íˆ ì¢‹ìœ¼ë©´ ì¢…ë£Œ</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reflection</span><span class="p">.</span><span class="na">selfConfidence</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">CONFIDENCE_THRESHOLD</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                </span><span class="o">!</span><span class="n">reflection</span><span class="p">.</span><span class="na">needsImprovement</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;âœ… ì¶©ë¶„í•œ í’ˆì§ˆ ë‹¬ì„± (ìì‹ ê°: </span><span class="si">${</span><span class="n">reflection</span><span class="p">.</span><span class="na">selfConfidence</span><span class="si">}</span><span class="s">)&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="k">break</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// ê°œì„ </span>
<span class="w">            </span><span class="n">currentResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">improveBasedOnReflection</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">currentResponse</span><span class="p">,</span><span class="w"> </span><span class="n">reflection</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">verification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verify</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">currentResponse</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ReflectionResult</span><span class="p">(</span>
<span class="w">            </span><span class="n">finalResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentResponse</span><span class="p">,</span>
<span class="w">            </span><span class="n">initialResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentResponse</span><span class="p">,</span><span class="w">  </span><span class="c1">// ì²« ì‘ë‹µ ì €ì¥ í•„ìš” ì‹œ ìˆ˜ì •</span>
<span class="w">            </span><span class="n">reflection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bestReflection</span><span class="o">!!</span><span class="p">,</span>
<span class="w">            </span><span class="n">verification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verification</span><span class="p">,</span>
<span class="w">            </span><span class="n">wasImproved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// generate, reflect, improve, verify ë©”ì„œë“œëŠ” ìœ„ì™€ ë™ì¼...</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="part-4">Part 4 ìš”ì•½</h2>
<h3 id="_7">ì´ íŒŒíŠ¸ì—ì„œ ë°°ìš´ ê²ƒ</h3>
<h4 id="agentic-ai">Agentic AI: ì§€ì‹œ ì‹¤í–‰ì—ì„œ ììœ¨ í–‰ë™ìœ¼ë¡œ</h4>
<p>ì „í†µì ì¸ AI ì• í”Œë¦¬ì¼€ì´ì…˜ì´ "ì§ˆë¬¸-ì‘ë‹µ" íŒ¨ëŸ¬ë‹¤ì„ì— ë¨¸ë¬¼ë €ë‹¤ë©´, Agentic Patternì€ AIê°€ <strong>ëª©í‘œë¥¼ ì´í•´í•˜ê³  ìŠ¤ìŠ¤ë¡œ ê³„íšì„ ìˆ˜ë¦½í•˜ì—¬ ì‹¤í–‰</strong>í•˜ëŠ” íŒ¨ëŸ¬ë‹¤ì„ìœ¼ë¡œì˜ ì „í™˜ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ëŠ” ë‹¨ìˆœíˆ ë” ë§ì€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì‘ì—…ì„ ë¶„í•´í•˜ê³ , ì ì ˆí•œ ë„êµ¬ë¥¼ ì„ íƒí•˜ê³ , ê²°ê³¼ë¥¼ í‰ê°€í•˜ì—¬ ë‹¤ìŒ í–‰ë™ì„ ê²°ì •í•˜ëŠ” <strong>ììœ¨ì  ì˜ì‚¬ê²°ì • ëŠ¥ë ¥</strong>ì„ ë¶€ì—¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<h4 id="_8">íŒ¨í„´ì€ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì„¤ê³„ ì§€ì‹</h4>
<p>6ê°€ì§€ í•µì‹¬ íŒ¨í„´(Chain, Parallelization, Routing, Orchestrator-Workers, Evaluator-Optimizer, Reflection)ì€ AI ì‹œìŠ¤í…œ ì„¤ê³„ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ë“±ì¥í•˜ëŠ” ë¬¸ì œì— ëŒ€í•œ <strong>ê²€ì¦ëœ í•´ê²°ì±…</strong>ì…ë‹ˆë‹¤. ê° íŒ¨í„´ì€ íŠ¹ì • ìƒí™©ì—ì„œì˜ íŠ¸ë ˆì´ë“œì˜¤í”„ë¥¼ ëª…í™•íˆ í•˜ë©°, ì‹¤ë¬´ì—ì„œëŠ” ì´ë“¤ì„ ì¡°í•©í•˜ì—¬ ë³µì¡í•œ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±ì‹œí‚µë‹ˆë‹¤. íŒ¨í„´ì„ ì´í•´í•˜ë©´ ë¬¸ì œë¥¼ ë³´ëŠ” ê´€ì ì´ ë‹¬ë¼ì§€ê³ , ì„¤ê³„ ê²°ì •ì˜ ê·¼ê±°ê°€ ëª…í™•í•´ì§‘ë‹ˆë‹¤.</p>
<h4 id="_9">ë³µì¡ì„± ê´€ë¦¬ì™€ ì‹ ë¢°ì„± í™•ë³´</h4>
<p>Agentic ì‹œìŠ¤í…œì€ ê°•ë ¥í•˜ì§€ë§Œ, ì œì–´ë˜ì§€ ì•Šìœ¼ë©´ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Evaluator-Optimizer íŒ¨í„´ì€ ì¶œë ¥ í’ˆì§ˆì„ ë³´ì¥í•˜ê³ , Reflection íŒ¨í„´ì€ AIê°€ ìŠ¤ìŠ¤ë¡œ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•˜ê³  ìˆ˜ì •í•˜ë„ë¡ í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ <strong>ìê¸° ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜</strong>ì€ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ AI ì‹œìŠ¤í…œì˜ ì‹ ë¢°ì„±ì„ í™•ë³´í•˜ëŠ” í•µì‹¬ ìš”ì†Œì…ë‹ˆë‹¤. ë¹„ìš©ê³¼ ì •í™•ë„, ì†ë„ì™€ í’ˆì§ˆ ì‚¬ì´ì˜ ê· í˜•ì ì„ ì°¾ëŠ” ê²ƒì´ Agentic ì‹œìŠ¤í…œ ì„¤ê³„ì˜ í•µì‹¬ ê³¼ì œì…ë‹ˆë‹¤.</p>
<h3 id="_10">íŒ¨í„´ ë¹„êµí‘œ</h3>
<table>
<thead>
<tr>
<th>íŒ¨í„´</th>
<th>ì‚¬ìš© ì‹œì </th>
<th>íŠ¹ì§•</th>
<th>ì¥ì </th>
<th>ë‹¨ì </th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Chain</strong></td>
<td>ìˆœì°¨ì  ë‹¨ê³„ í•„ìš”</td>
<td>ë‹¨ê³„ë³„ ì²˜ë¦¬</td>
<td>ë‹¨ìˆœ, ì˜ˆì¸¡ ê°€ëŠ¥</td>
<td>ëŠë¦´ ìˆ˜ ìˆìŒ</td>
</tr>
<tr>
<td><strong>Parallelization</strong></td>
<td>ë…ë¦½ì  ì‘ì—…</td>
<td>ë™ì‹œ ì‹¤í–‰</td>
<td>ë¹ ë¦„</td>
<td>ë³µì¡í•œ ì§‘ê³„</td>
</tr>
<tr>
<td><strong>Routing</strong></td>
<td>ìœ í˜•ë³„ ì²˜ë¦¬</td>
<td>ë¶„ë¥˜ í›„ ì „ë‹¬</td>
<td>ì „ë¬¸í™”</td>
<td>ë¶„ë¥˜ ì •í™•ë„ ì˜ì¡´</td>
</tr>
<tr>
<td><strong>Orchestrator</strong></td>
<td>ë³µì¡í•œ ë™ì  ì‘ì—…</td>
<td>ë™ì  ë¶„í•´/í• ë‹¹</td>
<td>ìœ ì—°, ì ì‘ì </td>
<td>ì˜¤ë²„í—¤ë“œ</td>
</tr>
<tr>
<td><strong>Evaluator</strong></td>
<td>í’ˆì§ˆ ì¤‘ìš”</td>
<td>ë°˜ë³µ ê°œì„ </td>
<td>í’ˆì§ˆ ë³´ì¥</td>
<td>ì‹œê°„ ì†Œìš”</td>
</tr>
<tr>
<td><strong>Reflection</strong></td>
<td>ì •í™•ë„ ì¤‘ìš”</td>
<td>ìê¸° ê²€ì¦</td>
<td>ì‹ ë¢°ì„±</td>
<td>ë¹„ìš©</td>
</tr>
</tbody>
</table>
<h3 id="_11">íŒ¨í„´ ì„ íƒ ê°€ì´ë“œ</h3>
<div class="codehilite"><pre><span></span><code><span class="err">ì§ˆë¬¸</span><span class="o">:</span><span class="w"> </span><span class="err">ì‘ì—…ì´</span><span class="w"> </span><span class="err">ì–´ë–¤</span><span class="w"> </span><span class="err">íŠ¹ì„±ì„</span><span class="w"> </span><span class="err">ê°€ì§€ê³ </span><span class="w"> </span><span class="err">ìˆë‚˜ìš”</span><span class="o">?</span>

<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">ìˆœì„œê°€</span><span class="w"> </span><span class="err">ì¤‘ìš”í•˜ë‹¤</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Chain</span><span class="w"> </span><span class="n">Workflow</span>
<span class="err">â”‚</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">ë…ë¦½ì ì¸</span><span class="w"> </span><span class="err">ì‘ì—…ë“¤ì´ë‹¤</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Parallelization</span>
<span class="err">â”‚</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">ì…ë ¥</span><span class="w"> </span><span class="err">ìœ í˜•ì—</span><span class="w"> </span><span class="err">ë”°ë¼</span><span class="w"> </span><span class="err">ì²˜ë¦¬ê°€</span><span class="w"> </span><span class="err">ë‹¤ë¥´ë‹¤</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Routing</span>
<span class="err">â”‚</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">ë³µì¡í•˜ê³ </span><span class="w"> </span><span class="err">ë™ì ì´ë‹¤</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Orchestrator</span><span class="o">-</span><span class="n">Workers</span>
<span class="err">â”‚</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">í’ˆì§ˆì´</span><span class="w"> </span><span class="err">ì¤‘ìš”í•˜ë‹¤</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Evaluator</span><span class="o">-</span><span class="n">Optimizer</span>
<span class="err">â”‚</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">ì •í™•ë„ê°€</span><span class="w"> </span><span class="err">ë§¤ìš°</span><span class="w"> </span><span class="err">ì¤‘ìš”í•˜ë‹¤</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Reflection</span><span class="w"> </span><span class="n">Agent</span>
</code></pre></div>

<h3 id="_12">íŒ¨í„´ ì¡°í•©</h3>
<p>ì‹¤ì œ ì‹œìŠ¤í…œì—ì„œëŠ” ì—¬ëŸ¬ íŒ¨í„´ì„ ì¡°í•©í•´ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ì˜ˆ: Routing + Chain + Evaluator ì¡°í•©</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HybridWorkflow</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. ë¼ìš°íŒ…ìœ¼ë¡œ ì‘ì—… ìœ í˜• ê²°ì •</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">router</span><span class="p">.</span><span class="na">classify</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 2. ì²´ì¸ìœ¼ë¡œ ë‹¨ê³„ë³„ ì²˜ë¦¬</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Type</span><span class="p">.</span><span class="na">SIMPLE</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">simpleChain</span><span class="p">.</span><span class="na">process</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">            </span><span class="n">Type</span><span class="p">.</span><span class="na">COMPLEX</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">complexChain</span><span class="p">.</span><span class="na">process</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 3. í‰ê°€ìë¡œ í’ˆì§ˆ ê²€ì¦ ë° ê°œì„ </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">evaluator</span><span class="p">.</span><span class="na">optimize</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="_13">ì‹¤ì „ í™œìš© íŒ</h3>
<h4 id="_14">íŒ¨í„´ ì„ íƒ ê¸°ì¤€</h4>
<ul>
<li><strong>ë‹¨ìˆœí•¨ ìš°ì„ </strong>: ë³µì¡í•œ íŒ¨í„´ì´ í•­ìƒ ì¢‹ì€ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. Chainìœ¼ë¡œ ì¶©ë¶„í•˜ë©´ Orchestratorë¥¼ ì“°ì§€ ë§ˆì„¸ìš”</li>
<li><strong>ì ì§„ì  ë³µì¡í™”</strong>: ë‹¨ìˆœí•œ íŒ¨í„´ìœ¼ë¡œ ì‹œì‘í•˜ê³ , í•„ìš”ì— ë”°ë¼ ë³µì¡í•œ íŒ¨í„´ìœ¼ë¡œ ë°œì „ì‹œí‚¤ì„¸ìš”</li>
<li><strong>ì¸¡ì • ê¸°ë°˜ ê²°ì •</strong>: ì„±ëŠ¥, ë¹„ìš©, í’ˆì§ˆ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ì—¬ íŒ¨í„´ ì„ íƒì˜ ê·¼ê±°ë¡œ ì‚¼ìœ¼ì„¸ìš”</li>
</ul>
<h4 id="_15">í”„ë¡œë•ì…˜ ê³ ë ¤ì‚¬í•­</h4>
<ul>
<li><strong>íƒ€ì„ì•„ì›ƒ ì„¤ì •</strong>: ê° ë‹¨ê³„ë³„ íƒ€ì„ì•„ì›ƒê³¼ ì „ì²´ ì›Œí¬í”Œë¡œìš° íƒ€ì„ì•„ì›ƒì„ ë³„ë„ë¡œ ê´€ë¦¬í•˜ì„¸ìš”</li>
<li><strong>ë¶€ë¶„ ì‹¤íŒ¨ ì²˜ë¦¬</strong>: Parallelizationì—ì„œ ì¼ë¶€ ì‘ì—…ì´ ì‹¤íŒ¨í•´ë„ ì „ì²´ê°€ ì‹¤íŒ¨í•˜ì§€ ì•Šë„ë¡ ì„¤ê³„í•˜ì„¸ìš”</li>
<li><strong>ë¹„ìš© ì œì–´</strong>: Evaluatorë‚˜ Reflectionì˜ ë°˜ë³µ íšŸìˆ˜ì— ìƒí•œì„ ë‘ì–´ ë¹„ìš© í­ì£¼ë¥¼ ë°©ì§€í•˜ì„¸ìš”</li>
</ul>
<h4 id="_16">ë””ë²„ê¹…ê³¼ ëª¨ë‹ˆí„°ë§</h4>
<ul>
<li><strong>ì¤‘ê°„ ìƒíƒœ ë¡œê¹…</strong>: ê° ë‹¨ê³„ì˜ ì…ë ¥/ì¶œë ¥ì„ ê¸°ë¡í•˜ì—¬ ë¬¸ì œ ë°œìƒ ì‹œ ì¶”ì  ê°€ëŠ¥í•˜ê²Œ í•˜ì„¸ìš”</li>
<li><strong>ë©”íŠ¸ë¦­ ìˆ˜ì§‘</strong>: ë‹¨ê³„ë³„ ì†Œìš” ì‹œê°„, í† í° ì‚¬ìš©ëŸ‰, ì„±ê³µ/ì‹¤íŒ¨ìœ¨ì„ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”</li>
<li><strong>ì¬í˜„ ê°€ëŠ¥ì„±</strong>: ë™ì¼ ì…ë ¥ì— ëŒ€í•´ ë™ì¼ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë„ë¡ ì‹œë“œ ê°’ì„ ê´€ë¦¬í•˜ì„¸ìš”</li>
</ul>
<h3 id="_17">ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜</h3>
<table>
<thead>
<tr>
<th>ì‹¤ìˆ˜</th>
<th>ë¬¸ì œì </th>
<th>í•´ê²° ë°©ë²•</th>
</tr>
</thead>
<tbody>
<tr>
<td>ê³¼ë„í•œ íŒ¨í„´ ë³µì¡ì„±</td>
<td>ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€, ë””ë²„ê¹… ë‚œì´ë„ ì¦ê°€</td>
<td>ë‹¨ìˆœí•œ íŒ¨í„´ìœ¼ë¡œ ì‹œì‘, í•„ìš”ì‹œ í™•ì¥</td>
</tr>
<tr>
<td>ë¬´í•œ ë£¨í”„ ë¯¸ë°©ì§€</td>
<td>Evaluator/Reflectionì˜ ì¢…ë£Œ ì¡°ê±´ ì—†ìŒ</td>
<td>ìµœëŒ€ ë°˜ë³µ íšŸìˆ˜ ì„¤ì •, ê°œì„ ìœ¨ ì„ê³„ê°’ ì ìš©</td>
</tr>
<tr>
<td>ì—ëŸ¬ ì „íŒŒ ë¯¸ì²˜ë¦¬</td>
<td>ì¤‘ê°„ ë‹¨ê³„ ì‹¤íŒ¨ ì‹œ ì „ì²´ ì‹œìŠ¤í…œ ì¤‘ë‹¨</td>
<td>í´ë°± ì „ëµ, ë¶€ë¶„ ê²°ê³¼ ë°˜í™˜, ì¬ì‹œë„ ë¡œì§</td>
</tr>
<tr>
<td>ì»¨í…ìŠ¤íŠ¸ ì†ì‹¤</td>
<td>ë‹¨ê³„ ê°„ í•„ìš”í•œ ì •ë³´ê°€ ì „ë‹¬ë˜ì§€ ì•ŠìŒ</td>
<td>ëª…ì‹œì  ì»¨í…ìŠ¤íŠ¸ ê°ì²´ ì„¤ê³„, ìƒíƒœ ê´€ë¦¬</td>
</tr>
<tr>
<td>ë¹„ìš© í†µì œ ì‹¤íŒ¨</td>
<td>ì˜ˆìƒì¹˜ ëª»í•œ API ë¹„ìš© í­ì£¼</td>
<td>ë‹¨ê³„ë³„/ì „ì²´ í† í° í•œë„, ë¹„ìš© ì•Œë¦¼ ì„¤ì •</td>
</tr>
</tbody>
</table>
<h3 id="_18">í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
<ul>
<li>[ ] Chain Workflowë¡œ ìˆœì°¨ì  íŒŒì´í”„ë¼ì¸ êµ¬í˜„</li>
<li>[ ] Parallelizationìœ¼ë¡œ ë™ì‹œ ì²˜ë¦¬ êµ¬í˜„</li>
<li>[ ] Routingìœ¼ë¡œ ì…ë ¥ ë¶„ë¥˜ ë° ë¶„ê¸° ì²˜ë¦¬</li>
<li>[ ] Orchestrator-Workersë¡œ ë™ì  ì‘ì—… ë¶„ë°°</li>
<li>[ ] Evaluator-Optimizerë¡œ í’ˆì§ˆ ê°œì„  ë£¨í”„ êµ¬í˜„</li>
<li>[ ] Reflection Agentë¡œ ìê¸° ê²€ì¦ ì‹œìŠ¤í…œ êµ¬í˜„</li>
<li>[ ] ì—¬ëŸ¬ íŒ¨í„´ì˜ ì¡°í•© ì„¤ê³„ ë° êµ¬í˜„</li>
</ul>
<hr />
<h2 id="_19">ë‹¤ìŒ ë‹¨ê³„</h2>
<p>Part 4ì—ì„œ ììœ¨ì ì¸ AI ì—ì´ì „íŠ¸ íŒ¨í„´ì„ ìµí˜”ë‹¤ë©´, ì´ì œ ì´ ë„êµ¬ë“¤ì„ <strong>í‘œì¤€í™”ëœ ë°©ì‹ìœ¼ë¡œ ê³µìœ í•˜ê³  ì¬ì‚¬ìš©</strong>í•˜ëŠ” ë°©ë²•ì„ ë°°ìš¸ ì°¨ë¡€ì…ë‹ˆë‹¤.</p>
<p><strong>Part 5: Model Context Protocol (MCP)</strong>ì—ì„œ ë°°ìš¸ ë‚´ìš©:</p>
<table>
<thead>
<tr>
<th>ì£¼ì œ</th>
<th>ì„¤ëª…</th>
<th>í™œìš© ì˜ˆì‹œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>MCP ì•„í‚¤í…ì²˜</strong></td>
<td>í‘œì¤€í™”ëœ AI ë„êµ¬ í†µí•© í”„ë¡œí† ì½œ ì´í•´</td>
<td>ë‹¤ì–‘í•œ AI í´ë¼ì´ì–¸íŠ¸ ì§€ì›</td>
</tr>
<tr>
<td><strong>MCP Server êµ¬ì¶•</strong></td>
<td>WebMVC, WebFlux, STDIO ê¸°ë°˜ ì„œë²„ êµ¬í˜„</td>
<td>ì‚¬ë‚´ ë„êµ¬ MCPí™”, ë ˆê±°ì‹œ ì‹œìŠ¤í…œ ì—°ë™</td>
</tr>
<tr>
<td><strong>MCP Client</strong></td>
<td>ì™¸ë¶€ MCP ì„œë²„ì™€ì˜ ì—°ë™</td>
<td>Claude Desktop, VS Code ë“±ê³¼ í†µí•©</td>
</tr>
<tr>
<td><strong>Dynamic Tool Update</strong></td>
<td>ëŸ°íƒ€ì„ ë„êµ¬ ì¶”ê°€/ì œê±°</td>
<td>í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ, ë™ì  ê¸°ëŠ¥ í™•ì¥</td>
</tr>
<tr>
<td><strong>Sampling</strong></td>
<td>MCPë¥¼ í†µí•œ AI í˜¸ì¶œ</td>
<td>ì„œë²„ ì¸¡ AI ì‘ë‹µ ìƒì„±</td>
</tr>
</tbody>
</table>
<p>MCPëŠ” AI ë„êµ¬ ìƒíƒœê³„ì˜ <strong>USB í¬íŠ¸</strong>ì™€ ê°™ìŠµë‹ˆë‹¤ - í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤ë¡œ ì–´ë–¤ ë„êµ¬ë“  ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
<hr />
<h2 id="_20">ì—°ìŠµ ë¬¸ì œ</h2>
<ol>
<li><strong>Chain Workflow</strong>: ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ìƒì„± íŒŒì´í”„ë¼ì¸ì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</li>
<li>
<p>ì£¼ì œ â†’ ì•„ì›ƒë¼ì¸ â†’ ë³¸ë¬¸ â†’ SEO ìµœì í™” â†’ ìµœì¢…ë³¸</p>
</li>
<li>
<p><strong>Parallelization</strong>: ë‰´ìŠ¤ ê¸°ì‚¬ë¥¼ ì—¬ëŸ¬ ì–¸ì–´ë¡œ ë™ì‹œì— ë²ˆì—­í•˜ëŠ” ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</p>
</li>
<li>
<p><strong>Routing</strong>: FAQ ë´‡ì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</p>
</li>
<li>
<p>ê¸°ìˆ /ê²°ì œ/ë°°ì†¡/ì¼ë°˜ ë¬¸ì˜ë¥¼ ë¶„ë¥˜í•˜ê³  ì ì ˆíˆ ì‘ë‹µ</p>
</li>
<li>
<p><strong>Orchestrator</strong>: ê°„ë‹¨í•œ í”„ë¡œì íŠ¸ ê´€ë¦¬ ì—ì´ì „íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</p>
</li>
<li>
<p>ìš”êµ¬ì‚¬í•­ì„ ë°›ì•„ íƒœìŠ¤í¬ ë¶„í•´ ë° í• ë‹¹</p>
</li>
<li>
<p><strong>Evaluator</strong>: ì—ì„¸ì´ ì‘ì„± ë° ìë™ í‰ê°€/ê°œì„  ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</p>
</li>
<li>
<p><strong>Reflection</strong>: ë©´ì ‘ ì§ˆë¬¸ ë‹µë³€ ì—°ìŠµ ì—ì´ì „íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</p>
</li>
<li>ë‹µë³€ í›„ ìê¸° í‰ê°€ ë° ê°œì„  ì œì•ˆ</li>
</ol>
<hr />
<h2 id="_21">ì°¸ê³  ì˜ˆì œ ì½”ë“œ</h2>
<p>ì´ ì±…ì˜ ì˜ˆì œ ì½”ë“œëŠ” ë‹¤ìŒ ë””ë ‰í† ë¦¬ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code>spring-ai-examples/
â”œâ”€â”€ agentic-patterns/
â”‚   â”œâ”€â”€ chain-workflow/          # Chain íŒ¨í„´
â”‚   â”œâ”€â”€ parallelization-workflow/ # ë³‘ë ¬í™” íŒ¨í„´
â”‚   â”œâ”€â”€ routing-workflow/        # ë¼ìš°íŒ… íŒ¨í„´
â”‚   â”œâ”€â”€ orchestrator-workers/    # ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° íŒ¨í„´
â”‚   â””â”€â”€ evaluator-optimizer/     # í‰ê°€-ìµœì í™” íŒ¨í„´
â””â”€â”€ agents/
    â””â”€â”€ reflection/              # Reflection ì—ì´ì „íŠ¸
</code></pre></div></div>
<div class="chapter" id="part5-mcp.md"><h1 id="part-5-model-context-protocol-mcp">Part 5: Model Context Protocol (MCP)</h1>
<blockquote>
<p>í‘œì¤€í™”ëœ AI ë„êµ¬ í†µí•© í”„ë¡œí† ì½œ</p>
</blockquote>
<p><strong>í•™ìŠµ ê¸°ê°„:</strong> 3ì£¼
<strong>ë‚œì´ë„:</strong> ê³ ê¸‰
<strong>ì‚¬ì „ ìš”êµ¬ì‚¬í•­:</strong> Part 1, 2, 3, 4 ì™„ë£Œ</p>
<hr />
<h2 id="_1">ë“¤ì–´ê°€ë©°</h2>
<p>Part 3ì—ì„œ ìš°ë¦¬ëŠ” Function Callingì„ ë°°ì› ìŠµë‹ˆë‹¤. AIê°€ ì™¸ë¶€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì‹¤ì œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê°•ë ¥í•œ ê¸°ëŠ¥ì´ì—ˆì£ . í•˜ì§€ë§Œ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ê° ì• í”Œë¦¬ì¼€ì´ì…˜ë§ˆë‹¤ ë„êµ¬ë¥¼ ë”°ë¡œ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<p><strong>MCP(Model Context Protocol)</strong>ëŠ” ì´ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤. Anthropicì´ ê°œë°œí•œ ì´ ì˜¤í”ˆ í”„ë¡œí† ì½œì€ AIì™€ ì™¸ë¶€ ë„êµ¬ ì‚¬ì´ì˜ <strong>í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤</strong>ë¥¼ ì œê³µí•©ë‹ˆë‹¤. í•œ ë²ˆ MCP ì„œë²„ë¥¼ ë§Œë“¤ë©´, ì–´ë–¤ MCP í´ë¼ì´ì–¸íŠ¸ì—ì„œë“  ê·¸ ë„êµ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ë§ˆì¹˜ <strong>USB</strong>ì™€ ê°™ìŠµë‹ˆë‹¤. USB í‘œì¤€ ë•ë¶„ì— ì–´ë–¤ ì œì¡°ì‚¬ì˜ ê¸°ê¸°ë“  ì–´ë–¤ ì»´í“¨í„°ì—ë“  ì—°ê²°í•  ìˆ˜ ìˆë“¯ì´, MCP ë•ë¶„ì— ì–´ë–¤ AI ë„êµ¬ë“  ì–´ë–¤ AI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œë“  ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><img alt="MCP Architecture" src="file:///Users/robin/Downloads/spring-ai-examples/book/images/mcp-architecture.png" /></p>
<hr />
<h2 id="module-51-mcp">Module 5.1: MCP ê°œìš”ì™€ ì•„í‚¤í…ì²˜</h2>
<h3 id="511-mcp">5.1.1 MCPë€?</h3>
<h4 id="_2">ì •ì˜</h4>
<ul>
<li><strong>Model Context Protocol</strong>: Anthropicì´ ê°œë°œí•œ ì˜¤í”ˆ í”„ë¡œí† ì½œ</li>
<li>AI ëª¨ë¸ê³¼ ì™¸ë¶€ ë„êµ¬/ë°ì´í„° ì†ŒìŠ¤ ê°„ì˜ <strong>í‘œì¤€í™”ëœ í†µì‹  ê·œê²©</strong></li>
<li>"AIë¥¼ ìœ„í•œ USB" - í”ŒëŸ¬ê·¸ì•¤í”Œë ˆì´ ë„êµ¬ í†µí•©</li>
</ul>
<h4 id="mcp">ì™œ MCPê°€ í•„ìš”í• ê¹Œìš”?</h4>
<table>
<thead>
<tr>
<th>ê¸°ì¡´ ë°©ì‹</th>
<th>MCP ë°©ì‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>ê° ë„êµ¬ë§ˆë‹¤ ê°œë³„ êµ¬í˜„</td>
<td>í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤</td>
</tr>
<tr>
<td>ê°•í•œ ê²°í•© (tight coupling)</td>
<td>ëŠìŠ¨í•œ ê²°í•© (loose coupling)</td>
</tr>
<tr>
<td>ì¬ì‚¬ìš© ì–´ë ¤ì›€</td>
<td>ë†’ì€ ì¬ì‚¬ìš©ì„±</td>
</tr>
<tr>
<td>ë³´ì•ˆ ëª¨ë¸ ë¶ˆì¼ì¹˜</td>
<td>ì¼ê´€ëœ ë³´ì•ˆ ëª¨ë¸</td>
</tr>
</tbody>
</table>
<h3 id="512">5.1.2 ì•„í‚¤í…ì²˜ ê°œìš”</h3>
<p>MCP ì•„í‚¤í…ì²˜ëŠ” ë„¤ ê°œì˜ ì£¼ìš” ë ˆì´ì–´ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:</p>
<p><img alt="MCP Architecture Detail" src="file:///Users/robin/Downloads/spring-ai-examples/book/images/mcp-architecture-detail.png" /></p>
<table>
<thead>
<tr>
<th>ë ˆì´ì–´</th>
<th>ì—­í• </th>
<th>êµ¬ì„± ìš”ì†Œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>MCP Host</strong></td>
<td>AI ì• í”Œë¦¬ì¼€ì´ì…˜ í˜¸ìŠ¤íŠ¸</td>
<td>Claude Desktop, IDE, ì»¤ìŠ¤í…€ ì•±</td>
</tr>
<tr>
<td><strong>MCP Client</strong></td>
<td>ì„œë²„ ì—°ê²° ë° í†µì‹  ê´€ë¦¬</td>
<td>ì—°ê²° ê´€ë¦¬, ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬, ë„êµ¬ íƒìƒ‰</td>
</tr>
<tr>
<td><strong>Transport</strong></td>
<td>í†µì‹  í”„ë¡œí† ì½œ ì¶”ìƒí™”</td>
<td>STDIO, HTTP/SSE, WebSocket</td>
</tr>
<tr>
<td><strong>MCP Server</strong></td>
<td>ë„êµ¬ì™€ ë¦¬ì†ŒìŠ¤ ì œê³µ</td>
<td>Tools, Resources, Prompts</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>í•µì‹¬ í¬ì¸íŠ¸</strong>: ê° ë ˆì´ì–´ëŠ” ë…ë¦½ì ìœ¼ë¡œ êµì²´ ê°€ëŠ¥í•˜ë©°, Transport ë ˆì´ì–´ ë•ë¶„ì— ë™ì¼í•œ ì„œë²„ ë¡œì§ì„ ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</blockquote>
<h3 id="513">5.1.3 í•µì‹¬ ê°œë…</h3>
<h4 id="tools">Tools (ë„êµ¬)</h4>
<p><strong>Tools</strong>ëŠ” AIê°€ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” <strong>í•¨ìˆ˜ ë˜ëŠ” ì•¡ì…˜</strong>ì…ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ë„êµ¬ì˜ ì˜ˆì‹œ</span>
<span class="o">-</span><span class="w"> </span><span class="err">ë‚ ì”¨</span><span class="w"> </span><span class="err">ì¡°íšŒ</span><span class="p">:</span><span class="w"> </span><span class="err">ë„ì‹œ</span><span class="w"> </span><span class="err">ì´ë¦„ì„</span><span class="w"> </span><span class="err">ë°›ì•„</span><span class="w"> </span><span class="err">í˜„ì¬</span><span class="w"> </span><span class="err">ë‚ ì”¨</span><span class="w"> </span><span class="err">ë°˜í™˜</span>
<span class="o">-</span><span class="w"> </span><span class="err">ë°ì´í„°ë² ì´ìŠ¤</span><span class="w"> </span><span class="err">ì¿¼ë¦¬</span><span class="p">:</span><span class="w"> </span><span class="n">SQL</span><span class="err">ì„</span><span class="w"> </span><span class="err">ë°›ì•„</span><span class="w"> </span><span class="err">ê²°ê³¼</span><span class="w"> </span><span class="err">ë°˜í™˜</span>
<span class="o">-</span><span class="w"> </span><span class="err">íŒŒì¼</span><span class="w"> </span><span class="err">ìƒì„±</span><span class="p">:</span><span class="w"> </span><span class="err">ê²½ë¡œì™€</span><span class="w"> </span><span class="err">ë‚´ìš©ì„</span><span class="w"> </span><span class="err">ë°›ì•„</span><span class="w"> </span><span class="err">íŒŒì¼</span><span class="w"> </span><span class="err">ìƒì„±</span>
<span class="o">-</span><span class="w"> </span><span class="err">ì´ë©”ì¼</span><span class="w"> </span><span class="err">ì „ì†¡</span><span class="p">:</span><span class="w"> </span><span class="err">ìˆ˜ì‹ ì</span><span class="p">,</span><span class="w"> </span><span class="err">ì œëª©</span><span class="p">,</span><span class="w"> </span><span class="err">ë³¸ë¬¸ì„</span><span class="w"> </span><span class="err">ë°›ì•„</span><span class="w"> </span><span class="err">ì´ë©”ì¼</span><span class="w"> </span><span class="err">ë°œì†¡</span>
</code></pre></div>

<p>ê° ë„êµ¬ëŠ” ë‹¤ìŒì„ ì •ì˜í•©ë‹ˆë‹¤:
- <strong>ì´ë¦„</strong>: ê³ ìœ í•œ ì‹ë³„ì
- <strong>ì„¤ëª…</strong>: AIê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ë„êµ¬ì˜ ëª©ì 
- <strong>ì…ë ¥ ìŠ¤í‚¤ë§ˆ</strong>: í•„ìš”í•œ íŒŒë¼ë¯¸í„°ì™€ íƒ€ì…
- <strong>ì¶œë ¥</strong>: ë°˜í™˜ë˜ëŠ” ê²°ê³¼</p>
<h4 id="resources">Resources (ë¦¬ì†ŒìŠ¤)</h4>
<p><strong>Resources</strong>ëŠ” AIê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” <strong>ë°ì´í„°</strong>ì…ë‹ˆë‹¤. URI í˜•ì‹ìœ¼ë¡œ ì‹ë³„ë©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ë¦¬ì†ŒìŠ¤ì˜ ì˜ˆì‹œ</span>
<span class="o">-</span><span class="w"> </span><span class="n">file</span><span class="p">:</span><span class="c1">///docs/readme.md      â†’ íŒŒì¼ ë‚´ìš©</span>
<span class="o">-</span><span class="w"> </span><span class="n">db</span><span class="p">:</span><span class="c1">//users/profile/123      â†’ ì‚¬ìš©ì í”„ë¡œí•„</span>
<span class="o">-</span><span class="w"> </span><span class="n">config</span><span class="p">:</span><span class="c1">//app/settings       â†’ ì•± ì„¤ì •</span>
<span class="o">-</span><span class="w"> </span><span class="n">weather</span><span class="p">:</span><span class="c1">//alerts/seoul      â†’ ë‚ ì”¨ ê²½ë³´</span>
</code></pre></div>

<h4 id="prompts">Prompts (í”„ë¡¬í”„íŠ¸)</h4>
<p><strong>Prompts</strong>ëŠ” ì„œë²„ê°€ ì œê³µí•˜ëŠ” <strong>ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</strong>ì…ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// í”„ë¡¬í”„íŠ¸ì˜ ì˜ˆì‹œ</span>
<span class="o">-</span><span class="w"> </span><span class="n">code</span><span class="o">-</span><span class="n">review</span><span class="p">:</span><span class="w"> </span><span class="err">ì½”ë“œ</span><span class="w"> </span><span class="err">ë¦¬ë·°ë¥¼</span><span class="w"> </span><span class="err">ìœ„í•œ</span><span class="w"> </span><span class="err">ìµœì í™”ëœ</span><span class="w"> </span><span class="err">í”„ë¡¬í”„íŠ¸</span>
<span class="o">-</span><span class="w"> </span><span class="n">translate</span><span class="p">:</span><span class="w"> </span><span class="err">ë²ˆì—­</span><span class="w"> </span><span class="err">ì‘ì—…ì„</span><span class="w"> </span><span class="err">ìœ„í•œ</span><span class="w"> </span><span class="err">í”„ë¡¬í”„íŠ¸</span>
<span class="o">-</span><span class="w"> </span><span class="n">summarize</span><span class="p">:</span><span class="w"> </span><span class="err">ìš”ì•½</span><span class="w"> </span><span class="err">ì‘ì—…ì„</span><span class="w"> </span><span class="err">ìœ„í•œ</span><span class="w"> </span><span class="err">í”„ë¡¬í”„íŠ¸</span>
</code></pre></div>

<h3 id="514-transport">5.1.4 Transport ë ˆì´ì–´</h3>
<p>MCPëŠ” ë‹¤ì–‘í•œ ì „ì†¡ ë°©ì‹ì„ ì§€ì›í•©ë‹ˆë‹¤.</p>
<h4 id="stdio-transport">STDIO Transport</h4>
<p>í‘œì¤€ ì…ì¶œë ¥ì„ ì‚¬ìš©í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ë°©ì‹ì…ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">Client</span><span class="w"> </span><span class="n">Process</span><span class="p">]</span><span class="w"> </span><span class="err">â†â”€â”€</span><span class="w"> </span><span class="n">stdin</span><span class="o">/</span><span class="n">stdout</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Server</span><span class="w"> </span><span class="n">Process</span><span class="p">]</span>
</code></pre></div>

<ul>
<li><strong>ì¥ì </strong>: ë‹¨ìˆœí•¨, í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬</li>
<li><strong>ì‚¬ìš© ì‚¬ë¡€</strong>: Claude Desktop, ë¡œì»¬ ë„êµ¬</li>
<li><strong>ë‹¨ì </strong>: ì›ê²© ì—°ê²° ë¶ˆê°€</li>
</ul>
<h4 id="httpsse-transport">HTTP/SSE Transport</h4>
<p>HTTP ìš”ì²­ê³¼ Server-Sent Eventsë¥¼ ì¡°í•©í•œ ë°©ì‹ì…ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="k">[Client] â”€â”€â”€â”€ HTTP POST (ìš”ì²­) â”€â”€â”€â”€â†’ [Server]</span>
<span class="k">[Client] â†â”€â”€â”€â”€ SSE (ì‘ë‹µ/ì´ë²¤íŠ¸) â”€â”€â”€â”€â”€ [Server]</span>
</code></pre></div>

<ul>
<li><strong>ì¥ì </strong>: ì›¹ í‘œì¤€, ì›ê²© ì—°ê²° ê°€ëŠ¥</li>
<li><strong>ì‚¬ìš© ì‚¬ë¡€</strong>: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜, í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤</li>
<li><strong>ë‹¨ì </strong>: ë‹¨ë°©í–¥ ìŠ¤íŠ¸ë¦¬ë°ë§Œ ê°€ëŠ¥</li>
</ul>
<h4 id="websocket-transport">WebSocket Transport</h4>
<p>ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹ ì„ ìœ„í•œ ë°©ì‹ì…ë‹ˆë‹¤.</p>
<ul>
<li><strong>ì¥ì </strong>: ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹ , íš¨ìœ¨ì </li>
<li><strong>ì‚¬ìš© ì‚¬ë¡€</strong>: ì‹¤ì‹œê°„ í˜‘ì—… ë„êµ¬</li>
<li><strong>ë‹¨ì </strong>: êµ¬í˜„ ë³µì¡ì„±</li>
</ul>
<h3 id="515">5.1.5 ë©”ì‹œì§€ í˜•ì‹</h3>
<p>MCPëŠ” <strong>JSON-RPC 2.0</strong>ì„ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ìš”ì²­ (Request)</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tools/call&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;get_weather&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Seoul&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ì‘ë‹µ (Response)</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Seoul: 5Â°C, Cloudy&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-52-mcp-server-webmvc">Module 5.2: MCP Server êµ¬ì¶• - WebMVC</h2>
<h3 id="521">5.2.1 í”„ë¡œì íŠ¸ ì„¤ì •</h3>
<p>Spring AIëŠ” MCP ì„œë²„ë¥¼ ì‰½ê²Œ êµ¬ì¶•í•  ìˆ˜ ìˆëŠ” ìŠ¤íƒ€í„°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
<h4 id="gradle-kotlin-dsl">Gradle ì˜ì¡´ì„± (Kotlin DSL)</h4>
<div class="codehilite"><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.ai:spring-ai-mcp-server-webmvc-spring-boot-starter&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="applicationyml">application.yml</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ai</span><span class="p">:</span>
<span class="w">    </span><span class="nt">mcp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">server</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">weather-server</span>
<span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class="w">        </span><span class="nt">sse-message-endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/mcp/message</span>
<span class="w">        </span><span class="nt">sse-endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/mcp/sse</span>
</code></pre></div>

<h3 id="522-tool">5.2.2 Tool ì •ì˜</h3>
<h4 id="tool">ê¸°ë³¸ Tool êµ¬í˜„</h4>
<p>Kotlinìœ¼ë¡œ MCP Toolì„ êµ¬í˜„í•´ ë´…ì‹œë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ìš”ì²­ ë°ì´í„° í´ë˜ìŠ¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WeatherRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@JsonProperty</span><span class="p">(</span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;ë„ì‹œ ì´ë¦„, ì˜ˆ: &#39;Seoul&#39;, &#39;Tokyo&#39;&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;ì˜¨ë„ ë‹¨ìœ„: &#39;celsius&#39; ë˜ëŠ” &#39;fahrenheit&#39;&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">unit</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;celsius&quot;</span>
<span class="p">)</span>

<span class="c1">// ì‘ë‹µ ë°ì´í„° í´ë˜ìŠ¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WeatherResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">temperature</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">unit</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">condition</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">humidity</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="c1">// Tool ì„¤ì •</span>
<span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherToolConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeatherTool</span><span class="p">(</span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherService</span><span class="p">):</span><span class="w"> </span><span class="n">ToolCallback</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;get_weather&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">weatherService</span><span class="o">::</span><span class="n">getWeather</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;íŠ¹ì • ìœ„ì¹˜ì˜ í˜„ì¬ ë‚ ì”¨ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">inputType</span><span class="p">(</span><span class="n">WeatherRequest</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="_3">ì„œë¹„ìŠ¤ êµ¬í˜„</h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherService</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">restTemplate</span><span class="p">:</span><span class="w"> </span><span class="n">RestTemplate</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;\</span><span class="si">${</span><span class="n">weather</span><span class="p">.</span><span class="na">api</span><span class="p">.</span><span class="na">key</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">apiKey</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherRequest</span><span class="p">):</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">unit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;fahrenheit&quot;</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;imperial&quot;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&quot;metric&quot;</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://api.openweathermap.org/data/2.5/weather&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;?q=</span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="si">}</span><span class="s">&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;&amp;appid=</span><span class="si">$</span><span class="n">apiKey</span><span class="s">&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;&amp;units=</span><span class="si">$</span><span class="n">units</span><span class="s">&quot;</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">getForObject</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">OpenWeatherResponse</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span><span class="o">!!</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="p">(</span>
<span class="w">            </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="p">,</span>
<span class="w">            </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">main</span><span class="p">.</span><span class="na">temp</span><span class="p">,</span>
<span class="w">            </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">unit</span><span class="p">,</span>
<span class="w">            </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">weather</span><span class="p">.</span><span class="na">first</span><span class="p">().</span><span class="na">description</span><span class="p">,</span>
<span class="w">            </span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">main</span><span class="p">.</span><span class="na">humidity</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// OpenWeatherMap API ì‘ë‹µ êµ¬ì¡°</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">OpenWeatherResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">main</span><span class="p">:</span><span class="w"> </span><span class="n">MainData</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">weather</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WeatherData</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MainData</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">temp</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">humidity</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WeatherData</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="tool_1">ë³µìˆ˜ Tool ë“±ë¡</h4>
<p>ì—¬ëŸ¬ ë„êµ¬ë¥¼ í•œ ë²ˆì— ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ToolsConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">mcpTools</span><span class="p">(</span>
<span class="w">        </span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherService</span><span class="p">,</span>
<span class="w">        </span><span class="n">geocodingService</span><span class="p">:</span><span class="w"> </span><span class="n">GeocodingService</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ToolCallback</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span>
<span class="w">        </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;get_weather&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">weatherService</span><span class="o">::</span><span class="n">getWeather</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;í˜„ì¬ ë‚ ì”¨ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">inputType</span><span class="p">(</span><span class="n">WeatherRequest</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">(),</span>

<span class="w">        </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;get_forecast&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">weatherService</span><span class="o">::</span><span class="n">getForecast</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;5ì¼ê°„ì˜ ë‚ ì”¨ ì˜ˆë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">inputType</span><span class="p">(</span><span class="n">ForecastRequest</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">(),</span>

<span class="w">        </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;geocode&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">geocodingService</span><span class="o">::</span><span class="n">geocode</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;ì£¼ì†Œë¥¼ ì¢Œí‘œë¡œ ë³€í™˜í•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">inputType</span><span class="p">(</span><span class="n">GeocodeRequest</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="523-resource">5.2.3 Resource ì •ì˜</h3>
<p>ResourceëŠ” AIê°€ ì½ì„ ìˆ˜ ìˆëŠ” ë°ì´í„°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ResourceConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">weatherAlertsResource</span><span class="p">():</span><span class="w"> </span><span class="n">McpResource</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">McpResource</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;weather://alerts/active&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">name</span><span class="p">(</span><span class="s">&quot;í™œì„± ë‚ ì”¨ ê²½ë³´&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;í˜„ì¬ í™œì„±í™”ëœ ë‚ ì”¨ ê²½ë³´ ëª©ë¡&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">mimeType</span><span class="p">(</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">weatherResourceProvider</span><span class="p">(</span>
<span class="w">        </span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherService</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">ResourceProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceProvider</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getResource</span><span class="p">(</span><span class="n">uri</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">McpResource? </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;weather://alerts/&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uri</span><span class="p">.</span><span class="na">removePrefix</span><span class="p">(</span><span class="s">&quot;weather://alerts/&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">createAlertResource</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listResources</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">McpResource</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="n">weatherAlertsResource</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createAlertResource</span><span class="p">(</span><span class="n">region</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">McpResource</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">alerts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getAlerts</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">McpResource</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;weather://alerts/</span><span class="si">$</span><span class="n">region</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">name</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">region</span><span class="s"> ì§€ì—­ ë‚ ì”¨ ê²½ë³´&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">region</span><span class="s"> ì§€ì—­ì˜ í™œì„± ë‚ ì”¨ ê²½ë³´&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">mimeType</span><span class="p">(</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="524">5.2.4 ì—ëŸ¬ ì²˜ë¦¬</h3>
<p>MCP ì—ëŸ¬ë¥¼ ì ì ˆíˆ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">McpError</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">code</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">)</span>

<span class="nd">@ControllerAdvice</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">McpErrorHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">javaClass</span><span class="p">)</span>

<span class="w">    </span><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">McpException</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handleMcpError</span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">McpException</span><span class="p">):</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">McpError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;MCP Error: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">McpError</span><span class="p">(</span>
<span class="w">            </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">code</span><span class="p">,</span>
<span class="w">            </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;Unknown error&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">data</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">badRequest</span><span class="p">().</span><span class="na">body</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">Exception</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handleGenericError</span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">):</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">McpError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unexpected error&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">McpError</span><span class="p">(</span>
<span class="w">            </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m">32603</span><span class="p">,</span><span class="w">  </span><span class="c1">// Internal error (JSON-RPC í‘œì¤€)</span>
<span class="w">            </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Internal server error&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span><span class="s">&quot;detail&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;Unknown&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">internalServerError</span><span class="p">().</span><span class="na">body</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="525-mcp">5.2.5 ì‹¤ìŠµ: ì™„ì „í•œ ë‚ ì”¨ MCP ì„œë²„</h3>
<div class="codehilite"><pre><span></span><code><span class="nd">@SpringBootApplication</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherMcpServerApplication</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">runApplication</span><span class="o">&lt;</span><span class="n">WeatherMcpServerApplication</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// application.yml</span>
<span class="cm">/*</span>
<span class="cm">spring:</span>
<span class="cm">  ai:</span>
<span class="cm">    mcp:</span>
<span class="cm">      server:</span>
<span class="cm">        name: weather-mcp-server</span>
<span class="cm">        version: 1.0.0</span>

<span class="cm">weather:</span>
<span class="cm">  api:</span>
<span class="cm">    key: ${OPENWEATHER_API_KEY}</span>
<span class="cm">*/</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherService</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">webClient</span><span class="p">:</span><span class="w"> </span><span class="n">WebClient</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;\</span><span class="si">${</span><span class="n">weather</span><span class="p">.</span><span class="na">api</span><span class="p">.</span><span class="na">key</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">apiKey</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherRequest</span><span class="p">):</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">unit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;fahrenheit&quot;</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;imperial&quot;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&quot;metric&quot;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">webClient</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">uriBuilder</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">uriBuilder</span>
<span class="w">                    </span><span class="p">.</span><span class="na">scheme</span><span class="p">(</span><span class="s">&quot;https&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">host</span><span class="p">(</span><span class="s">&quot;api.openweathermap.org&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;/data/2.5/weather&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;q&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;appid&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">apiKey</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;units&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">retrieve</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">bodyToMono</span><span class="p">(</span><span class="n">OpenWeatherResponse</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">WeatherResponse</span><span class="p">(</span>
<span class="w">                    </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="p">,</span>
<span class="w">                    </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">main</span><span class="p">.</span><span class="na">temp</span><span class="p">,</span>
<span class="w">                    </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">unit</span><span class="p">,</span>
<span class="w">                    </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">weather</span><span class="p">.</span><span class="na">first</span><span class="p">().</span><span class="na">description</span><span class="p">,</span>
<span class="w">                    </span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">main</span><span class="p">.</span><span class="na">humidity</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">block</span><span class="p">()</span><span class="o">!!</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getForecast</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ForecastRequest</span><span class="p">):</span><span class="w"> </span><span class="n">ForecastResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">days</span><span class="p">.</span><span class="na">coerceIn</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">8</span><span class="w">  </span><span class="c1">// 3ì‹œê°„ ê°„ê²©</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">webClient</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">uriBuilder</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">uriBuilder</span>
<span class="w">                    </span><span class="p">.</span><span class="na">scheme</span><span class="p">(</span><span class="s">&quot;https&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">host</span><span class="p">(</span><span class="s">&quot;api.openweathermap.org&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;/data/2.5/forecast&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;q&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;appid&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">apiKey</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;units&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;metric&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;cnt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">retrieve</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">bodyToMono</span><span class="p">(</span><span class="n">OpenWeatherForecastResponse</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">toForecastResponse</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">block</span><span class="p">()</span><span class="o">!!</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-53-mcp-server-webflux">Module 5.3: MCP Server êµ¬ì¶• - WebFlux</h2>
<h3 id="531-reactive-mcp">5.3.1 Reactive MCP ì„œë²„</h3>
<p>WebFluxë¥¼ ì‚¬ìš©í•˜ë©´ ë¹„ë™ê¸°/ë…¼ë¸”ë¡œí‚¹ MCP ì„œë²„ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h4 id="gradle">Gradle ì˜ì¡´ì„±</h4>
<div class="codehilite"><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.ai:spring-ai-mcp-server-webflux-spring-boot-starter&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="reactive-service">Reactive Service êµ¬í˜„</h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ReactiveWeatherService</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">webClient</span><span class="p">:</span><span class="w"> </span><span class="n">WebClient</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;\</span><span class="si">${</span><span class="n">weather</span><span class="p">.</span><span class="na">api</span><span class="p">.</span><span class="na">key</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">apiKey</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherRequest</span><span class="p">):</span><span class="w"> </span><span class="n">Mono</span><span class="o">&lt;</span><span class="n">WeatherResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">webClient</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">uriBuilder</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">uriBuilder</span>
<span class="w">                    </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;/data/2.5/weather&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;q&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;appid&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">apiKey</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;units&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;metric&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">retrieve</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">bodyToMono</span><span class="p">(</span><span class="n">OpenWeatherResponse</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">WeatherResponse</span><span class="p">(</span>
<span class="w">                    </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="p">,</span>
<span class="w">                    </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">main</span><span class="p">.</span><span class="na">temp</span><span class="p">,</span>
<span class="w">                    </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">unit</span><span class="p">,</span>
<span class="w">                    </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">weather</span><span class="p">.</span><span class="na">first</span><span class="p">().</span><span class="na">description</span><span class="p">,</span>
<span class="w">                    </span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">main</span><span class="p">.</span><span class="na">humidity</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">timeout</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofSeconds</span><span class="p">(</span><span class="m">10</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">onErrorResume</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">Mono</span><span class="p">.</span><span class="na">just</span><span class="p">(</span>
<span class="w">                    </span><span class="n">WeatherResponse</span><span class="p">(</span>
<span class="w">                        </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">location</span><span class="p">,</span>
<span class="w">                        </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0</span><span class="p">,</span>
<span class="w">                        </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">unit</span><span class="p">,</span>
<span class="w">                        </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Error: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ì—¬ëŸ¬ ë„ì‹œì˜ ë‚ ì”¨ë¥¼ ë™ì‹œì— ì¡°íšŒ</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeatherBatch</span><span class="p">(</span><span class="n">locations</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">WeatherResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Flux</span><span class="p">.</span><span class="na">fromIterable</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span>
<span class="w">                </span><span class="p">{</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">getWeather</span><span class="p">(</span><span class="n">WeatherRequest</span><span class="p">(</span><span class="n">location</span><span class="p">))</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="m">5</span><span class="w">  </span><span class="c1">// ìµœëŒ€ ë™ì‹œì„±</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="reactive-tool">Reactive Tool ì„¤ì •</h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ReactiveToolConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">asyncWeatherTool</span><span class="p">(</span>
<span class="w">        </span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">ReactiveWeatherService</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">ToolCallback</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;get_weather_async&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherRequest</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="na">block</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;ë¹„ë™ê¸°ë¡œ ë‚ ì”¨ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">inputType</span><span class="p">(</span><span class="n">WeatherRequest</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">batchWeatherTool</span><span class="p">(</span>
<span class="w">        </span><span class="n">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">ReactiveWeatherService</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">ToolCallback</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;get_weather_batch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">BatchWeatherRequest</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeatherBatch</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">locations</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">collectList</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">block</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;ì—¬ëŸ¬ ë„ì‹œì˜ ë‚ ì”¨ë¥¼ ë™ì‹œì— ì¡°íšŒí•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">inputType</span><span class="p">(</span><span class="n">BatchWeatherRequest</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">BatchWeatherRequest</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">locations</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="module-54-mcp-server-stdio">Module 5.4: MCP Server êµ¬ì¶• - STDIO</h2>
<h3 id="541-stdio">5.4.1 STDIO ì„œë²„ ì„¤ì •</h3>
<p>STDIO ë°©ì‹ì€ <strong>Claude Desktop</strong>ê³¼ ê°™ì€ ë°ìŠ¤í¬í†± ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì—°ë™í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.</p>
<h4 id="gradle_1">Gradle ì˜ì¡´ì„±</h4>
<div class="codehilite"><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.ai:spring-ai-mcp-server-stdio-spring-boot-starter&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="applicationyml_1">application.yml</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">main</span><span class="p">:</span>
<span class="w">    </span><span class="nt">web-application-type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span><span class="w">  </span><span class="c1"># ì›¹ ì„œë²„ ë¹„í™œì„±í™”</span>
<span class="w">  </span><span class="nt">ai</span><span class="p">:</span>
<span class="w">    </span><span class="nt">mcp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">server</span><span class="p">:</span>
<span class="w">        </span><span class="nt">stdio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local-tools-server</span>
</code></pre></div>

<h3 id="542-claude-desktop">5.4.2 Claude Desktop ì—°ë™</h3>
<p>Claude Desktopì˜ ì„¤ì • íŒŒì¼ì— MCP ì„œë²„ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.</p>
<h4 id="macos-libraryapplication-supportclaudeclaude_desktop_configjson">macOS: <code>~/Library/Application Support/Claude/claude_desktop_config.json</code></h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;weather&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;java&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;-jar&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;/path/to/weather-mcp-server.jar&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;WEATHER_API_KEY&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your-api-key&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="windows-appdataclaudeclaude_desktop_configjson">Windows: <code>%APPDATA%\Claude\claude_desktop_config.json</code></h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;weather&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;java&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;-jar&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;C:\\path\\to\\weather-mcp-server.jar&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;WEATHER_API_KEY&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your-api-key&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="543-mcp">5.4.3 ì‹¤ìŠµ: íŒŒì¼ ì‹œìŠ¤í…œ MCP ì„œë²„</h3>
<p>ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” MCP ì„œë²„ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@SpringBootApplication</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">FilesystemMcpServer</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">runApplication</span><span class="o">&lt;</span><span class="n">FilesystemMcpServer</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// ìš”ì²­/ì‘ë‹µ ë°ì´í„° í´ë˜ìŠ¤</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ReadFileRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;ì½ì„ íŒŒì¼ì˜ ì ˆëŒ€ ê²½ë¡œ&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WriteFileRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;ì“¸ íŒŒì¼ì˜ ì ˆëŒ€ ê²½ë¡œ&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;íŒŒì¼ì— ì“¸ ë‚´ìš©&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ListDirRequest</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@JsonPropertyDescription</span><span class="p">(</span><span class="s">&quot;ë””ë ‰í† ë¦¬ ê²½ë¡œ&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">FileContent</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">success</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">DirectoryListing</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">entries</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">FileEntry</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">success</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">FileEntry</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isDirectory</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">size</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">lastModified</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">FilesystemToolConfig</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;\</span><span class="si">${</span><span class="n">mcp</span><span class="p">.</span><span class="na">filesystem</span><span class="p">.</span><span class="na">allowed</span><span class="o">-</span><span class="n">paths</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">allowedPaths</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">javaClass</span><span class="p">)</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">filesystemTools</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ToolCallback</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span>
<span class="w">        </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;read_file&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="n">readFile</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;íŒŒì¼ì˜ ë‚´ìš©ì„ ì½ìŠµë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">inputType</span><span class="p">(</span><span class="n">ReadFileRequest</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">(),</span>

<span class="w">        </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;write_file&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="n">writeFile</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;íŒŒì¼ì— ë‚´ìš©ì„ ì”ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">inputType</span><span class="p">(</span><span class="n">WriteFileRequest</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">(),</span>

<span class="w">        </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;list_directory&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="n">listDirectory</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;ë””ë ‰í† ë¦¬ì˜ ë‚´ìš©ì„ ë‚˜ì—´í•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">inputType</span><span class="p">(</span><span class="n">ListDirRequest</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">readFile</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ReadFileRequest</span><span class="p">):</span><span class="w"> </span><span class="n">FileContent</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">validatePath</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Files</span><span class="p">.</span><span class="na">readString</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">))</span>
<span class="w">            </span><span class="n">FileContent</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">IOException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">            </span><span class="n">FileContent</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">writeFile</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">WriteFileRequest</span><span class="p">):</span><span class="w"> </span><span class="n">FileContent</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">validatePath</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Files</span><span class="p">.</span><span class="na">writeString</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">content</span><span class="p">)</span>
<span class="w">            </span><span class="n">FileContent</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">IOException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;íŒŒì¼ ì“°ê¸° ì‹¤íŒ¨: </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">            </span><span class="n">FileContent</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listDirectory</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ListDirRequest</span><span class="p">):</span><span class="w"> </span><span class="n">DirectoryListing</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">validatePath</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Files</span><span class="p">.</span><span class="na">list</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="kd">val</span><span class="w"> </span><span class="nv">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Files</span><span class="p">.</span><span class="na">readAttributes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">BasicFileAttributes</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">                    </span><span class="n">FileEntry</span><span class="p">(</span>
<span class="w">                        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">fileName</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">isDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrs</span><span class="p">.</span><span class="na">isDirectory</span><span class="p">,</span>
<span class="w">                        </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrs</span><span class="p">.</span><span class="na">size</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">lastModified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrs</span><span class="p">.</span><span class="na">lastModifiedTime</span><span class="p">().</span><span class="na">toString</span><span class="p">()</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">()</span>

<span class="w">            </span><span class="n">DirectoryListing</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">,</span><span class="w"> </span><span class="n">entries</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">IOException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;ë””ë ‰í† ë¦¬ ì½ê¸° ì‹¤íŒ¨: </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">            </span><span class="n">DirectoryListing</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">,</span><span class="w"> </span><span class="n">emptyList</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">validatePath</span><span class="p">(</span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">normalizedPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="na">normalize</span><span class="p">().</span><span class="na">toAbsolutePath</span><span class="p">()</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">isAllowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">allowedPaths</span><span class="p">.</span><span class="na">any</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">allowedPath</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">normalizedPath</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">allowedPath</span><span class="p">).</span><span class="na">normalize</span><span class="p">().</span><span class="na">toAbsolutePath</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isAllowed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">SecurityException</span><span class="p">(</span><span class="s">&quot;í—ˆìš©ë˜ì§€ ì•Šì€ ê²½ë¡œì…ë‹ˆë‹¤: </span><span class="si">$</span><span class="n">path</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="applicationyml_2">application.yml</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">main</span><span class="p">:</span>
<span class="w">    </span><span class="nt">web-application-type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">  </span><span class="nt">ai</span><span class="p">:</span>
<span class="w">    </span><span class="nt">mcp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">server</span><span class="p">:</span>
<span class="w">        </span><span class="nt">stdio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filesystem-server</span>

<span class="nt">mcp</span><span class="p">:</span>
<span class="w">  </span><span class="nt">filesystem</span><span class="p">:</span>
<span class="w">    </span><span class="nt">allowed-paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/Users/username/Documents</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/Users/username/Projects</span>
</code></pre></div>

<blockquote>
<p><strong>ë³´ì•ˆ ì£¼ì˜</strong>: íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ì€ ë³´ì•ˆì— ë¯¼ê°í•©ë‹ˆë‹¤. ë°˜ë“œì‹œ <code>allowed-paths</code>ë¥¼ ì„¤ì •í•˜ì—¬ ì ‘ê·¼ ê°€ëŠ¥í•œ ê²½ë¡œë¥¼ ì œí•œí•˜ì„¸ìš”.</p>
</blockquote>
<hr />
<h2 id="module-55-mcp-client">Module 5.5: MCP Client êµ¬í˜„</h2>
<h3 id="551-client">5.5.1 Client ì„¤ì •</h3>
<p>ì´ì œ MCP ì„œë²„ì— ì—°ê²°í•˜ëŠ” <strong>í´ë¼ì´ì–¸íŠ¸</strong>ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<h4 id="gradle_2">Gradle ì˜ì¡´ì„±</h4>
<div class="codehilite"><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.ai:spring-ai-mcp-client-spring-boot-starter&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="applicationyml-sse">application.yml (SSE ë°©ì‹)</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ai</span><span class="p">:</span>
<span class="w">    </span><span class="nt">mcp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">client</span><span class="p">:</span>
<span class="w">        </span><span class="nt">transport</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sse</span>
<span class="w">        </span><span class="nt">sse</span><span class="p">:</span>
<span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8080/mcp/sse</span>
</code></pre></div>

<h4 id="applicationyml-stdio">application.yml (STDIO ë°©ì‹)</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ai</span><span class="p">:</span>
<span class="w">    </span><span class="nt">mcp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">client</span><span class="p">:</span>
<span class="w">        </span><span class="nt">transport</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stdio</span>
<span class="w">        </span><span class="nt">stdio</span><span class="p">:</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">java</span>
<span class="w">          </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-jar,/path/to/server.jar</span>
</code></pre></div>

<h3 id="552">5.5.2 ë„êµ¬ ì‚¬ìš©</h3>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">McpClientService</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">mcpClient</span><span class="p">:</span><span class="w"> </span><span class="n">McpSyncClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chatWithTools</span><span class="p">(</span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. MCP ì„œë²„ì˜ ë„êµ¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">tools</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mcpClient</span><span class="p">.</span><span class="na">listTools</span><span class="p">().</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tool</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">toToolCallback</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 2. ChatClientì— ë„êµ¬ ì—°ê²°</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">functions</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// MCP Toolì„ Spring AI ToolCallbackìœ¼ë¡œ ë³€í™˜</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">toToolCallback</span><span class="p">(</span><span class="n">tool</span><span class="p">:</span><span class="w"> </span><span class="n">McpTool</span><span class="p">):</span><span class="w"> </span><span class="n">ToolCallback</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">McpToolCallback</span><span class="p">(</span><span class="n">mcpClient</span><span class="p">,</span><span class="w"> </span><span class="n">tool</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ë„êµ¬ ì§ì ‘ í˜¸ì¶œ</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">callTool</span><span class="p">(</span><span class="n">toolName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">arguments</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">ToolResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mcpClient</span><span class="p">.</span><span class="na">callTool</span><span class="p">(</span><span class="n">toolName</span><span class="p">,</span><span class="w"> </span><span class="n">arguments</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ ëª©ë¡ í™•ì¸</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listAvailableTools</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mcpClient</span><span class="p">.</span><span class="na">listTools</span><span class="p">().</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="553">5.5.3 ë‹¤ì¤‘ ì„œë²„ ì—°ê²°</h3>
<p>ì—¬ëŸ¬ MCP ì„œë²„ì— ë™ì‹œì— ì—°ê²°í•˜ì—¬ ë‹¤ì–‘í•œ ë„êµ¬ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@ConfigurationProperties</span><span class="p">(</span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mcp.servers&quot;</span><span class="p">)</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">McpServersProperties</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">servers</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">McpServerConfig</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">emptyMap</span><span class="p">()</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">McpServerConfig</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">type</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w">  </span><span class="c1">// &quot;sse&quot; or &quot;stdio&quot;</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">url</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">command</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">args</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">emptyList</span><span class="p">()</span>
<span class="p">)</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableConfigurationProperties</span><span class="p">(</span><span class="n">McpServersProperties</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MultiServerConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">mcpClients</span><span class="p">(</span><span class="n">properties</span><span class="p">:</span><span class="w"> </span><span class="n">McpServersProperties</span><span class="p">):</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">McpSyncClient</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">properties</span><span class="p">.</span><span class="na">servers</span><span class="p">.</span><span class="na">mapValues</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">createClient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createClient</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">:</span><span class="w"> </span><span class="n">McpServerConfig</span><span class="p">):</span><span class="w"> </span><span class="n">McpSyncClient</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="na">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;sse&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">McpSyncClient</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">transport</span><span class="p">(</span><span class="n">SseClientTransport</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="na">url</span><span class="o">!!</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="s">&quot;stdio&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">McpSyncClient</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">transport</span><span class="p">(</span><span class="n">StdioClientTransport</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="na">command</span><span class="o">!!</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="na">args</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Unknown transport type: </span><span class="si">${</span><span class="n">config</span><span class="p">.</span><span class="na">type</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ì§‘ê³„ëœ ë„êµ¬ ì œê³µì</span>
<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AggregatedToolProvider</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">clients</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">McpSyncClient</span><span class="o">&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">toolToServer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">String</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllTools</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ToolCallback</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">allTools</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableListOf</span><span class="o">&lt;</span><span class="n">ToolCallback</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">        </span><span class="n">clients</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="n">serverName</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">client</span><span class="p">.</span><span class="na">listTools</span><span class="p">().</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tool</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">toolToServer</span><span class="o">[</span><span class="n">tool</span><span class="p">.</span><span class="na">name</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serverName</span>
<span class="w">                </span><span class="n">allTools</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">McpToolCallback</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">tool</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">allTools</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">callTool</span><span class="p">(</span><span class="n">toolName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">ToolResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">serverName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolToServer</span><span class="o">[</span><span class="n">toolName</span><span class="o">]</span>
<span class="w">            </span><span class="o">?:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Unknown tool: </span><span class="si">$</span><span class="n">toolName</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clients</span><span class="o">[</span><span class="n">serverName</span><span class="o">]</span>
<span class="w">            </span><span class="o">?:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Server not found: </span><span class="si">$</span><span class="n">serverName</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">callTool</span><span class="p">(</span><span class="n">toolName</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getToolsByServer</span><span class="p">(</span><span class="n">serverName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">toolToServer</span><span class="p">.</span><span class="na">filterValues</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">serverName</span><span class="w"> </span><span class="p">}.</span><span class="na">keys</span><span class="p">.</span><span class="na">toList</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="applicationyml_3">application.yml</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">mcp</span><span class="p">:</span>
<span class="w">  </span><span class="nt">servers</span><span class="p">:</span>
<span class="w">    </span><span class="nt">servers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">weather</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sse</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8081/mcp/sse</span>
<span class="w">      </span><span class="nt">database</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sse</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8082/mcp/sse</span>
<span class="w">      </span><span class="nt">filesystem</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stdio</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">java</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-jar</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/filesystem-server.jar</span>
</code></pre></div>

<hr />
<h2 id="module-56-mcp-annotations">Module 5.6: MCP Annotations ê¸°ë°˜ ê°œë°œ</h2>
<h3 id="561-tool">5.6.1 ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ Tool</h3>
<p>Spring AIëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•œ ê°„í¸í•œ MCP ê°œë°œì„ ì§€ì›í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@McpServer</span>
<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AnnotatedWeatherServer</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherService</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@McpTool</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;í˜„ì¬ ë‚ ì”¨ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ë„ì‹œ ì´ë¦„&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì˜¨ë„ ë‹¨ìœ„: celsius ë˜ëŠ” fahrenheit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">        </span><span class="n">unit</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span>
<span class="w">            </span><span class="n">location</span><span class="p">,</span>
<span class="w">            </span><span class="n">unit</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;celsius&quot;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@McpTool</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ë‚ ì”¨ ì˜ˆë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getForecast</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ë„ì‹œ ì´ë¦„&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì˜ˆë³´ ì¼ìˆ˜ (1-7)&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">days</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">ForecastResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getForecast</span><span class="p">(</span>
<span class="w">            </span><span class="n">location</span><span class="p">,</span>
<span class="w">            </span><span class="n">days</span><span class="p">.</span><span class="na">coerceIn</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="562-resource">5.6.2 ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ Resource</h3>
<div class="codehilite"><pre><span></span><code><span class="nd">@McpServer</span>
<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AnnotatedResourceServer</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">configService</span><span class="p">:</span><span class="w"> </span><span class="n">ConfigService</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">userService</span><span class="p">:</span><span class="w"> </span><span class="n">UserService</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@McpResource</span><span class="p">(</span>
<span class="w">        </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;config://app/settings&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;í˜„ì¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ì •ë³´&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAppSettings</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">configService</span><span class="p">.</span><span class="na">getSettings</span><span class="p">().</span><span class="na">toJson</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@McpResourceTemplate</span><span class="p">(</span>
<span class="w">        </span><span class="n">uriTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;user://{userId}/profile&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì‚¬ìš©ì í”„ë¡œí•„&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;IDë¡œ ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getUserProfile</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="s">&quot;userId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">getProfile</span><span class="p">(</span><span class="n">userId</span><span class="p">).</span><span class="na">toJson</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="563">5.6.3 ì‹¤ìŠµ: ë¹„ì¦ˆë‹ˆìŠ¤ ë„êµ¬ ì„œë²„</h3>
<div class="codehilite"><pre><span></span><code><span class="nd">@McpServer</span>
<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">BusinessToolsServer</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">customerRepository</span><span class="p">:</span><span class="w"> </span><span class="n">CustomerRepository</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">orderRepository</span><span class="p">:</span><span class="w"> </span><span class="n">OrderRepository</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">ticketService</span><span class="p">:</span><span class="w"> </span><span class="n">TicketService</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@McpTool</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼ë¡œ ê³ ê°ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">searchCustomers</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ê²€ìƒ‰ì–´&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ìµœëŒ€ ê²°ê³¼ ìˆ˜&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">        </span><span class="n">limit</span><span class="p">:</span><span class="w"> </span><span class="kt">Int?</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">CustomerSummary</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">10</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CustomerSummary</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@McpTool</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ê³ ê°ì˜ ì£¼ë¬¸ ë‚´ì—­ì„ ì¡°íšŒí•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getOrderHistory</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ê³ ê° ID&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">customerId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì·¨ì†Œëœ ì£¼ë¬¸ í¬í•¨ ì—¬ë¶€&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">        </span><span class="n">includeCancelled</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean?</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">OrderHistory</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">findByCustomerId</span><span class="p">(</span>
<span class="w">            </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">            </span><span class="n">includeCancelled</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">OrderHistory</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@McpTool</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì§€ì› í‹°ì¼“ì„ ìƒì„±í•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createTicket</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ê³ ê° ID&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">customerId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì´ìŠˆ ì¹´í…Œê³ ë¦¬&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì´ìŠˆ ì„¤ëª…&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ìš°ì„ ìˆœìœ„: LOW, MEDIUM, HIGH&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">        </span><span class="n">priority</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">TicketResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">ticket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ticketService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">customerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">            </span><span class="n">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">category</span><span class="p">,</span>
<span class="w">            </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">            </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">priority</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Priority</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">Priority</span><span class="p">.</span><span class="na">MEDIUM</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TicketResult</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">ticket</span><span class="p">.</span><span class="na">id</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@McpResource</span><span class="p">(</span>
<span class="w">        </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;stats://daily/summary&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì¼ì¼ í†µê³„&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì˜¤ëŠ˜ì˜ ì£¼ë¬¸ ë° ê³ ê° í†µê³„&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getDailySummary</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailySummary</span><span class="p">(</span>
<span class="w">            </span><span class="n">newCustomers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">countTodayNew</span><span class="p">(),</span>
<span class="w">            </span><span class="n">totalOrders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">countToday</span><span class="p">(),</span>
<span class="w">            </span><span class="n">totalRevenue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">sumTodayRevenue</span><span class="p">(),</span>
<span class="w">            </span><span class="n">openTickets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ticketService</span><span class="p">.</span><span class="na">countOpen</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">summary</span><span class="p">.</span><span class="na">toJson</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CustomerSummary</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">totalOrders</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">customer</span><span class="p">:</span><span class="w"> </span><span class="n">Customer</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CustomerSummary</span><span class="p">(</span>
<span class="w">            </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">            </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">email</span><span class="p">,</span>
<span class="w">            </span><span class="n">totalOrders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">orderCount</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">OrderHistory</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">customerId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">orders</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderSummary</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">totalSpent</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">orders</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderHistory</span><span class="p">(</span>
<span class="w">            </span><span class="n">customerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="na">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="na">customerId</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">OrderSummary</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">totalSpent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="na">sumOf</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">total</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-57-mcp-sampling">Module 5.7: MCP Sampling</h2>
<h3 id="571-sampling">5.7.1 Sampling ê°œë…</h3>
<p><strong>Sampling</strong>ì€ MCPì˜ ê³ ê¸‰ ê¸°ëŠ¥ìœ¼ë¡œ, <strong>ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ LLM ê¸°ëŠ¥ì„ í™œìš©</strong>í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code>ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸: &quot;ì´ í…ìŠ¤íŠ¸ë¥¼ ì‹œë¡œ ë°”ê¿”ì¤˜&quot;
í´ë¼ì´ì–¸íŠ¸ â†’ LLM: &quot;ì´ í…ìŠ¤íŠ¸ë¥¼ ì‹œë¡œ ë°”ê¿”ì¤˜&quot;
LLM â†’ í´ë¼ì´ì–¸íŠ¸: &quot;ì‹œ ê²°ê³¼...&quot;
í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„: &quot;ì‹œ ê²°ê³¼...&quot;
</code></pre></div>

<p>ì´ë¥¼ í†µí•´ í•˜ë‚˜ì˜ ë„êµ¬ í˜¸ì¶œ ì•ˆì—ì„œ <strong>ë‹¤ì¤‘ ëª¨ë¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜</strong>ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.</p>
<h3 id="572-sampling">5.7.2 ì„œë²„ ì¸¡ Sampling</h3>
<div class="codehilite"><pre><span></span><code><span class="nd">@McpServer</span>
<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">SamplingWeatherServer</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">weatherService</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherService</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@McpTool</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì°½ì‘ ë‚ ì”¨ ì„¤ëª…ê³¼ í•¨ê»˜ ë‚ ì”¨ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getCreativeWeather</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ìœ„ì¹˜&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">location</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">toolContext</span><span class="p">:</span><span class="w"> </span><span class="n">ToolContext</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">CreativeWeatherResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. ë‚ ì”¨ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">weather</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherService</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 2. MCP Samplingìœ¼ë¡œ ì°½ì‘ ì„¤ëª… ìš”ì²­</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">poem</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">analysis</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">        </span><span class="n">McpToolUtils</span><span class="p">.</span><span class="na">getMcpExchange</span><span class="p">(</span><span class="n">toolContext</span><span class="p">).</span><span class="na">ifPresent</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">exchange</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">clientCapabilities</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">capabilities</span><span class="p">.</span><span class="na">sampling</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// OpenAIì— ì‹œ ìš”ì²­</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">poemRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateMessageRequest</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">systemPrompt</span><span class="p">(</span><span class="s">&quot;ë‹¹ì‹ ì€ ì‹œì¸ì…ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">messages</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span>
<span class="w">                        </span><span class="n">SamplingMessage</span><span class="p">(</span>
<span class="w">                            </span><span class="n">Role</span><span class="p">.</span><span class="na">USER</span><span class="p">,</span>
<span class="w">                            </span><span class="n">TextContent</span><span class="p">(</span><span class="s">&quot;ì´ ë‚ ì”¨ì— ëŒ€í•œ í•˜ì´ì¿ ë¥¼ ì¨ì£¼ì„¸ìš”: </span><span class="si">$</span><span class="n">weather</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">modelPreferences</span><span class="p">(</span>
<span class="w">                        </span><span class="n">ModelPreferences</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="na">addHint</span><span class="p">(</span><span class="s">&quot;openai&quot;</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">poemResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">createMessage</span><span class="p">(</span><span class="n">poemRequest</span><span class="p">)</span>
<span class="w">                </span><span class="n">poem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">poemResult</span><span class="p">.</span><span class="na">content</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TextContent</span><span class="p">).</span><span class="na">text</span>

<span class="w">                </span><span class="c1">// Anthropicì— ë¶„ì„ ìš”ì²­</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">analysisRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateMessageRequest</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">systemPrompt</span><span class="p">(</span><span class="s">&quot;ë‹¹ì‹ ì€ ê¸°ìƒ ë¶„ì„ê°€ì…ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">messages</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span>
<span class="w">                        </span><span class="n">SamplingMessage</span><span class="p">(</span>
<span class="w">                            </span><span class="n">Role</span><span class="p">.</span><span class="na">USER</span><span class="p">,</span>
<span class="w">                            </span><span class="n">TextContent</span><span class="p">(</span><span class="s">&quot;ì´ ë‚ ì”¨ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”: </span><span class="si">$</span><span class="n">weather</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">modelPreferences</span><span class="p">(</span>
<span class="w">                        </span><span class="n">ModelPreferences</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="na">addHint</span><span class="p">(</span><span class="s">&quot;anthropic&quot;</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>

<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">analysisResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">createMessage</span><span class="p">(</span><span class="n">analysisRequest</span><span class="p">)</span>
<span class="w">                </span><span class="n">analysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">analysisResult</span><span class="p">.</span><span class="na">content</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TextContent</span><span class="p">).</span><span class="na">text</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CreativeWeatherResponse</span><span class="p">(</span>
<span class="w">            </span><span class="n">weather</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weather</span><span class="p">,</span>
<span class="w">            </span><span class="n">poem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poem</span><span class="p">,</span>
<span class="w">            </span><span class="n">analysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CreativeWeatherResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">weather</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherResponse</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">poem</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">analysis</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="573-sampling">5.7.3 í´ë¼ì´ì–¸íŠ¸ ì¸¡ Sampling í•¸ë“¤ëŸ¬</h3>
<p>í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ì˜ Sampling ìš”ì²­ì„ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">SamplingConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">samplingCustomizer</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;openaiChatClient&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">openai</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;anthropicChatClient&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">anthropic</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">McpSyncClientCustomizer</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">McpSyncClientCustomizer</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">spec</span><span class="p">.</span><span class="na">sampling</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="c1">// ëª¨ë¸ íŒíŠ¸ í™•ì¸</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">modelHint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">modelPreferences</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">hints</span>
<span class="w">                    </span><span class="p">.</span><span class="na">firstOrNull</span><span class="p">()</span>
<span class="w">                    </span><span class="o">?.</span><span class="na">name</span>
<span class="w">                    </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;openai&quot;</span>

<span class="w">                </span><span class="c1">// ì ì ˆí•œ ChatClient ì„ íƒ</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">modelHint</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;anthropic&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">anthropic</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">openai</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="c1">// í”„ë¡¬í”„íŠ¸ ì¶”ì¶œ</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">userPrompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">messages</span><span class="p">.</span><span class="na">first</span><span class="p">().</span><span class="na">content</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TextContent</span><span class="p">).</span><span class="na">text</span>

<span class="w">                </span><span class="c1">// LLM í˜¸ì¶œ</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">systemPrompt</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">userPrompt</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">content</span><span class="p">()</span>

<span class="w">                </span><span class="n">CreateMessageResult</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">content</span><span class="p">(</span><span class="n">TextContent</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-58-dynamic-tool-update">Module 5.8: Dynamic Tool Update</h2>
<h3 id="581">5.8.1 ë™ì  ë„êµ¬ ë“±ë¡</h3>
<p>ìš´ì˜ ì¤‘ì¸ ì„œë²„ì—ì„œ ë„êµ¬ë¥¼ ë™ì ìœ¼ë¡œ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">DynamicToolManager</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">mcpServer</span><span class="p">:</span><span class="w"> </span><span class="n">McpServer</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">dynamicTools</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">ToolCallback</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">javaClass</span><span class="p">)</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">registerTool</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">tool</span><span class="p">:</span><span class="w"> </span><span class="n">ToolCallback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">dynamicTools</span><span class="o">[</span><span class="n">name</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tool</span>
<span class="w">        </span><span class="n">mcpServer</span><span class="p">.</span><span class="na">notifyToolsChanged</span><span class="p">()</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;ë„êµ¬ ë“±ë¡ë¨: </span><span class="si">$</span><span class="n">name</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">unregisterTool</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">dynamicTools</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="w">        </span><span class="n">mcpServer</span><span class="p">.</span><span class="na">notifyToolsChanged</span><span class="p">()</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;ë„êµ¬ ì œê±°ë¨: </span><span class="si">$</span><span class="n">name</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listTools</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dynamicTools</span><span class="p">.</span><span class="na">keys</span><span class="p">.</span><span class="na">toList</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">dynamicToolProvider</span><span class="p">():</span><span class="w"> </span><span class="n">ToolProvider</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ToolProvider</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ArrayList</span><span class="p">(</span><span class="n">dynamicTools</span><span class="p">.</span><span class="na">values</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// REST APIë¡œ ë™ì  ë“±ë¡</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/tools&quot;</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ToolManagementController</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">toolManager</span><span class="p">:</span><span class="w"> </span><span class="n">DynamicToolManager</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@PostMapping</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">registerTool</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">definition</span><span class="p">:</span><span class="w"> </span><span class="n">ToolDefinition</span><span class="p">):</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">tool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createToolFromDefinition</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span>
<span class="w">        </span><span class="n">toolManager</span><span class="p">.</span><span class="na">registerTool</span><span class="p">(</span><span class="n">definition</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="n">tool</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@DeleteMapping</span><span class="p">(</span><span class="s">&quot;/{name}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">unregisterTool</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">toolManager</span><span class="p">.</span><span class="na">unregisterTool</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listTools</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">toolManager</span><span class="p">.</span><span class="na">listTools</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createToolFromDefinition</span><span class="p">(</span><span class="n">definition</span><span class="p">:</span><span class="w"> </span><span class="n">ToolDefinition</span><span class="p">):</span><span class="w"> </span><span class="n">ToolCallback</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ë™ì  ë„êµ¬ ìƒì„± ë¡œì§</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FunctionToolCallback</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span>
<span class="w">            </span><span class="n">definition</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">            </span><span class="n">definition</span><span class="p">.</span><span class="na">handler</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="n">definition</span><span class="p">.</span><span class="na">description</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ToolDefinition</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">handler</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Any</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="582">5.8.2 í´ë¼ì´ì–¸íŠ¸ ìºì‹œ ê°±ì‹ </h3>
<p>ë„êµ¬ ë³€ê²½ ì•Œë¦¼ì„ ë°›ì•„ í´ë¼ì´ì–¸íŠ¸ì˜ ìºì‹œë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ToolChangeListener</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">mcpClient</span><span class="p">:</span><span class="w"> </span><span class="n">McpAsyncClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">localRegistry</span><span class="p">:</span><span class="w"> </span><span class="n">ToolRegistry</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">javaClass</span><span class="p">)</span>

<span class="w">    </span><span class="nd">@PostConstruct</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">subscribe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mcpClient</span><span class="p">.</span><span class="na">onToolsChanged</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="c1">// ë„êµ¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</span>
<span class="w">            </span><span class="n">mcpClient</span><span class="p">.</span><span class="na">listTools</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">subscribe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tools</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">localRegistry</span><span class="p">.</span><span class="na">updateTools</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>
<span class="w">                    </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;ë„êµ¬ ëª©ë¡ ê°±ì‹ ë¨: </span><span class="si">${</span><span class="n">tools</span><span class="p">.</span><span class="na">size</span><span class="si">}</span><span class="s">ê°œ&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ToolRegistry</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">tools</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">McpTool</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">updateTools</span><span class="p">(</span><span class="n">newTools</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">McpTool</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">tools</span><span class="p">.</span><span class="na">clear</span><span class="p">()</span>
<span class="w">        </span><span class="n">newTools</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tools</span><span class="o">[</span><span class="nb">it</span><span class="p">.</span><span class="na">name</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getTool</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">McpTool? </span><span class="o">=</span><span class="w"> </span><span class="n">tools</span><span class="o">[</span><span class="n">name</span><span class="o">]</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllTools</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">McpTool</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tools</span><span class="p">.</span><span class="na">values</span><span class="p">.</span><span class="na">toList</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="module-59-mcp">Module 5.9: ì‹¤ì „ MCP í†µí•©</h2>
<h3 id="591-sqlite">5.9.1 SQLite ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„</h3>
<div class="codehilite"><pre><span></span><code><span class="nd">@McpServer</span>
<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">SqliteMcpServer</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">jdbcTemplate</span><span class="p">:</span><span class="w"> </span><span class="n">JdbcTemplate</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">javaClass</span><span class="p">)</span>

<span class="w">    </span><span class="nd">@McpTool</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì½ê¸° ì „ìš© SQL ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">executeQuery</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SQL SELECT ì¿¼ë¦¬&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">QueryResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ì½ê¸° ì „ìš© ê²€ì¦</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">trimmedQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">trim</span><span class="p">().</span><span class="na">uppercase</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">trimmedQuery</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;SELECT&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">McpException</span><span class="p">(</span><span class="o">-</span><span class="m">32600</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SELECT ì¿¼ë¦¬ë§Œ í—ˆìš©ë©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ìœ„í—˜í•œ í‚¤ì›Œë“œ ê²€ì‚¬</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">dangerousKeywords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="s">&quot;DROP&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DELETE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UPDATE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;INSERT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ALTER&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TRUNCATE&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dangerousKeywords</span><span class="p">.</span><span class="na">any</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">trimmedQuery</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">McpException</span><span class="p">(</span><span class="o">-</span><span class="m">32600</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;í—ˆìš©ë˜ì§€ ì•ŠëŠ” SQL í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jdbcTemplate</span><span class="p">.</span><span class="na">queryForList</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="w">            </span><span class="n">QueryResult</span><span class="p">(</span>
<span class="w">                </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">,</span>
<span class="w">                </span><span class="n">rowCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="na">size</span><span class="p">,</span>
<span class="w">                </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;ì¿¼ë¦¬ ì‹¤í–‰ ì‹¤íŒ¨: </span><span class="si">$</span><span class="n">query</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">            </span><span class="n">QueryResult</span><span class="p">(</span>
<span class="w">                </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">emptyList</span><span class="p">(),</span>
<span class="w">                </span><span class="n">rowCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">                </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">message</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@McpTool</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getSchema</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;í…Œì´ë¸” ì´ë¦„ (ì„ íƒ)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">        </span><span class="n">tableName</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">SchemaInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tableName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">getTableSchema</span><span class="p">(</span><span class="n">tableName</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">getAllTablesSchema</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@McpResource</span><span class="p">(</span>
<span class="w">        </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;db://schema&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë¬¸ì„œ&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getDatabaseSchema</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">generateSchemaDocumentation</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getTableSchema</span><span class="p">(</span><span class="n">tableName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">SchemaInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jdbcTemplate</span><span class="p">.</span><span class="na">queryForList</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;PRAGMA table_info(</span><span class="si">$</span><span class="n">tableName</span><span class="s">)&quot;</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">SchemaInfo</span><span class="p">(</span>
<span class="w">            </span><span class="n">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span>
<span class="w">                </span><span class="n">TableInfo</span><span class="p">(</span>
<span class="w">                    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tableName</span><span class="p">,</span>
<span class="w">                    </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">columns</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                        </span><span class="n">ColumnInfo</span><span class="p">(</span>
<span class="w">                            </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col</span><span class="o">[</span><span class="s">&quot;name&quot;</span><span class="o">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">                            </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col</span><span class="o">[</span><span class="s">&quot;type&quot;</span><span class="o">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">                            </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">col</span><span class="o">[</span><span class="s">&quot;notnull&quot;</span><span class="o">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">                            </span><span class="n">primaryKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">col</span><span class="o">[</span><span class="s">&quot;pk&quot;</span><span class="o">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllTablesSchema</span><span class="p">():</span><span class="w"> </span><span class="n">SchemaInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jdbcTemplate</span><span class="p">.</span><span class="na">queryForList</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39; AND name NOT LIKE &#39;sqlite_%&#39;&quot;</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">SchemaInfo</span><span class="p">(</span>
<span class="w">            </span><span class="n">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tables</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">getTableSchema</span><span class="p">(</span><span class="n">table</span><span class="o">[</span><span class="s">&quot;name&quot;</span><span class="o">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">String</span><span class="p">).</span><span class="na">tables</span><span class="p">.</span><span class="na">first</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateSchemaDocumentation</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getAllTablesSchema</span><span class="p">()</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">sb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="s">&quot;# Database Schema\n\n&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">schema</span><span class="p">.</span><span class="na">tables</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;## </span><span class="si">${</span><span class="n">table</span><span class="p">.</span><span class="na">name</span><span class="si">}</span><span class="s">\n\n&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;| Column | Type | Nullable | Primary Key |\n&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;|--------|------|----------|-------------|\n&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="n">table</span><span class="p">.</span><span class="na">columns</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;| </span><span class="si">${</span><span class="n">col</span><span class="p">.</span><span class="na">name</span><span class="si">}</span><span class="s"> | </span><span class="si">${</span><span class="n">col</span><span class="p">.</span><span class="na">type</span><span class="si">}</span><span class="s"> | </span><span class="si">${</span><span class="n">col</span><span class="p">.</span><span class="na">nullable</span><span class="si">}</span><span class="s"> | </span><span class="si">${</span><span class="n">col</span><span class="p">.</span><span class="na">primaryKey</span><span class="si">}</span><span class="s"> |\n&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sb</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">QueryResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">rowCount</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">success</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SchemaInfo</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tables</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">TableInfo</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">TableInfo</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">columns</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ColumnInfo</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ColumnInfo</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">type</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">nullable</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">primaryKey</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="592-brave">5.9.2 ì›¹ ê²€ìƒ‰ ì„œë²„ (Brave)</h3>
<div class="codehilite"><pre><span></span><code><span class="nd">@McpServer</span>
<span class="nd">@Component</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">BraveSearchServer</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">webClient</span><span class="p">:</span><span class="w"> </span><span class="n">WebClient</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;\</span><span class="si">${</span><span class="n">brave</span><span class="p">.</span><span class="na">api</span><span class="p">.</span><span class="na">key</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">apiKey</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@McpTool</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Brave ê²€ìƒ‰ìœ¼ë¡œ ì›¹ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">webSearch</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ê²€ìƒ‰ ì¿¼ë¦¬&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ê²°ê³¼ ìˆ˜ (ìµœëŒ€ 20)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">        </span><span class="n">count</span><span class="p">:</span><span class="w"> </span><span class="kt">Int?</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">SearchResults</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">webClient</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">uriBuilder</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">uriBuilder</span>
<span class="w">                    </span><span class="p">.</span><span class="na">scheme</span><span class="p">(</span><span class="s">&quot;https&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">host</span><span class="p">(</span><span class="s">&quot;api.search.brave.com&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;/res/v1/web/search&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;q&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="s">&quot;count&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">10</span><span class="p">).</span><span class="na">coerceIn</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">&quot;X-Subscription-Token&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">apiKey</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">retrieve</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">bodyToMono</span><span class="p">(</span><span class="n">BraveSearchResponse</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">toSearchResults</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">block</span><span class="p">()</span><span class="o">!!</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@McpTool</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ì›¹í˜ì´ì§€ì˜ ìš”ì•½ì„ ê°€ì ¸ì˜µë‹ˆë‹¤&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">summarizePage</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@McpParam</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ìš”ì•½í•  URL&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">PageSummary</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fetchPageContent</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PageSummary</span><span class="p">(</span>
<span class="w">            </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">,</span>
<span class="w">            </span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="na">take</span><span class="p">(</span><span class="m">500</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="w">  </span><span class="c1">// ì‹¤ì œë¡œëŠ” AI ìš”ì•½ ì‚¬ìš©</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">fetchPageContent</span><span class="p">(</span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">webClient</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">retrieve</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">bodyToMono</span><span class="p">(</span><span class="kt">String</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">html</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="c1">// HTMLì—ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œ (ì‹¤ì œë¡œëŠ” Jsoup ë“± ì‚¬ìš©)</span>
<span class="w">                </span><span class="n">html</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="n">Regex</span><span class="p">(</span><span class="s">&quot;&lt;[^&gt;]+&gt;&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="n">Regex</span><span class="p">(</span><span class="s">&quot;\\s+&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">trim</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">block</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SearchResults</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">query</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">results</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SearchResult</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">totalResults</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SearchResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">url</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">PageSummary</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">url</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">summary</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">BraveSearchResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">web</span><span class="p">:</span><span class="w"> </span><span class="n">WebResults?</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">toSearchResults</span><span class="p">():</span><span class="w"> </span><span class="n">SearchResults</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">SearchResults</span><span class="p">(</span>
<span class="w">            </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">web</span><span class="o">?.</span><span class="na">results</span><span class="o">?.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">SearchResult</span><span class="p">(</span>
<span class="w">                    </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">title</span><span class="p">,</span>
<span class="w">                    </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">url</span><span class="p">,</span>
<span class="w">                    </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">description</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">emptyList</span><span class="p">(),</span>
<span class="w">            </span><span class="n">totalResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">web</span><span class="o">?.</span><span class="na">results</span><span class="o">?.</span><span class="na">size</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WebResults</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">results</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WebResult</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WebResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">url</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="593-docker">5.9.3 Docker ë°°í¬</h3>
<h4 id="dockerfile">Dockerfile</h4>
<div class="codehilite"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">eclipse-temurin:17-jre-alpine</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="k">COPY</span><span class="w"> </span>build/libs/mcp-server.jar<span class="w"> </span>app.jar

<span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>

<span class="k">ENV</span><span class="w"> </span><span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">&quot;-Xmx512m&quot;</span>

<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;java $JAVA_OPTS -jar app.jar&quot;</span><span class="p">]</span>
</code></pre></div>

<h4 id="docker-composeyml">docker-compose.yml</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mcp-weather</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./weather-server</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8081:8080&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WEATHER_API_KEY=${WEATHER_API_KEY}</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:8080/actuator/health&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">  </span><span class="nt">mcp-database</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./database-server</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8082:8080&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data:/data</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_PATH=/data/app.db</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:8080/actuator/health&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">  </span><span class="nt">mcp-search</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./search-server</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8083:8080&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BRAVE_API_KEY=${BRAVE_API_KEY}</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:8080/actuator/health&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">  </span><span class="nt">mcp-gateway</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./gateway</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mcp-weather</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
<span class="w">      </span><span class="nt">mcp-database</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
<span class="w">      </span><span class="nt">mcp-search</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MCP_SERVERS=weather:8081,database:8082,search:8083</span>
</code></pre></div>

<h3 id="594-ai">5.9.4 ì‹¤ìŠµ: ê¸°ì—…ìš© ë°ì´í„° ë¶„ì„ AI ë¹„ì„œ</h3>
<p>ëª¨ë“  ê²ƒì„ í†µí•©í•œ ì™„ì „í•œ AI ë¹„ì„œë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">UserContext</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">role</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">department</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">permissions</span><span class="p">:</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">AssistantResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">toolsUsed</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ToolCallInfo</span><span class="o">&gt;</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ToolCallInfo</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">toolName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">arguments</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">EnterpriseAiAssistant</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">chatClient</span><span class="p">:</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">mcpClients</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">McpSyncClient</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">aggregatedToolProvider</span><span class="p">:</span><span class="w"> </span><span class="n">AggregatedToolProvider</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">javaClass</span><span class="p">)</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">UserContext</span><span class="p">):</span><span class="w"> </span><span class="n">AssistantResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. ê¶Œí•œì— ë”°ë¥¸ ë„êµ¬ í•„í„°ë§</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">allowedTools</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aggregatedToolProvider</span><span class="p">.</span><span class="na">getAllTools</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">filter</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tool</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">hasPermission</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">tool</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬: </span><span class="si">${</span><span class="n">allowedTools</span><span class="p">.</span><span class="na">size</span><span class="si">}</span><span class="s">ê°œ&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 2. ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">systemPrompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buildSystemPrompt</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 3. AI ì‘ë‹µ ìƒì„± (ë„êµ¬ ìë™ í˜¸ì¶œ)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="n">systemPrompt</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">functions</span><span class="p">(</span><span class="n">allowedTools</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">call</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">chatResponse</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// 4. ë„êµ¬ í˜¸ì¶œ ë¡œê¹…</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">toolCalls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractToolCallInfo</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="w">        </span><span class="n">toolCalls</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;ë„êµ¬ í˜¸ì¶œ: </span><span class="si">${</span><span class="n">call</span><span class="p">.</span><span class="na">toolName</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 5. ì‘ë‹µ ë°˜í™˜</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">AssistantResponse</span><span class="p">(</span>
<span class="w">            </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">result</span><span class="p">.</span><span class="na">output</span><span class="p">.</span><span class="na">content</span><span class="p">,</span>
<span class="w">            </span><span class="n">toolsUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolCalls</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">buildSystemPrompt</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">UserContext</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            ë‹¹ì‹ ì€ ê¸°ì—…ìš© AI ë¹„ì„œì…ë‹ˆë‹¤. ë‹¤ìŒ ë„êµ¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</span>
<span class="s">            - íšŒì‚¬ ë°ì´í„°ë² ì´ìŠ¤ (ê³ ê°, ì£¼ë¬¸, ì œí’ˆ)</span>
<span class="s">            - ë‚ ì”¨ ì •ë³´</span>
<span class="s">            - ì›¹ ê²€ìƒ‰</span>
<span class="s">            - íŒŒì¼ ì‹œìŠ¤í…œ (ë¬¸ì„œ í´ë”)</span>

<span class="s">            ì‚¬ìš©ì ì •ë³´:</span>
<span class="s">            - ì´ë¦„: </span><span class="si">${</span><span class="n">context</span><span class="p">.</span><span class="na">name</span><span class="si">}</span>
<span class="s">            - ì—­í• : </span><span class="si">${</span><span class="n">context</span><span class="p">.</span><span class="na">role</span><span class="si">}</span>
<span class="s">            - ë¶€ì„œ: </span><span class="si">${</span><span class="n">context</span><span class="p">.</span><span class="na">department</span><span class="si">}</span>

<span class="s">            ê°€ì´ë“œë¼ì¸:</span>
<span class="s">            - ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •í™•í•˜ê³  ì‹¤ì‹œê°„ ì •ë³´ë¥¼ ì œê³µí•˜ì„¸ìš”</span>
<span class="s">            - ë°ì´í„°ë¥¼ ì œì‹œí•˜ê¸° ì „ì— í•­ìƒ í™•ì¸í•˜ì„¸ìš”</span>
<span class="s">            - ë°ì´í„° ì ‘ê·¼ ê¶Œí•œì„ ì¡´ì¤‘í•˜ì„¸ìš”</span>
<span class="s">            - ëª…í™•í•˜ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•˜ì„¸ìš”</span>
<span class="s">            - í•œêµ­ì–´ë¡œ ì‘ë‹µí•˜ì„¸ìš”</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">.</span><span class="na">trimIndent</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">hasPermission</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">UserContext</span><span class="p">,</span><span class="w"> </span><span class="n">tool</span><span class="p">:</span><span class="w"> </span><span class="n">ToolCallback</span><span class="p">):</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">toolPermissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;execute_query&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">setOf</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;analyst&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="s">&quot;create_ticket&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">setOf</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;support&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="s">&quot;write_file&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">setOf</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">requiredPermissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolPermissions</span><span class="o">[</span><span class="n">tool</span><span class="p">.</span><span class="na">name</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">permissions</span><span class="p">.</span><span class="na">any</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">requiredPermissions</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">extractToolCallInfo</span><span class="p">(</span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="n">ChatResponse</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ToolCallInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ChatResponseì—ì„œ ë„êµ¬ í˜¸ì¶œ ì •ë³´ ì¶”ì¶œ</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">result</span><span class="p">.</span><span class="na">output</span><span class="p">.</span><span class="na">toolCalls</span><span class="o">?.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">ToolCallInfo</span><span class="p">(</span>
<span class="w">                </span><span class="n">toolName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">                </span><span class="n">arguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call</span><span class="p">.</span><span class="na">arguments</span><span class="p">,</span>
<span class="w">                </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call</span><span class="p">.</span><span class="na">result</span><span class="o">?.</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">emptyList</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// REST Controller</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/assistant&quot;</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AssistantController</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">assistant</span><span class="p">:</span><span class="w"> </span><span class="n">EnterpriseAiAssistant</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/chat&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ChatRequest</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@RequestHeader</span><span class="p">(</span><span class="s">&quot;X-User-Context&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">userContextJson</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">AssistantResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">().</span><span class="na">readValue</span><span class="p">(</span><span class="n">userContextJson</span><span class="p">,</span><span class="w"> </span><span class="n">UserContext</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">assistant</span><span class="p">.</span><span class="na">chat</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">message</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ChatRequest</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="part-5">Part 5 ìš”ì•½</h2>
<h3 id="_4">ì´ íŒŒíŠ¸ì—ì„œ ë°°ìš´ ê²ƒ</h3>
<h4 id="mcp-ai">MCP: AI ë„êµ¬ ìƒíƒœê³„ì˜ í‘œì¤€í™”</h4>
<p>Model Context Protocol(MCP)ì€ AI ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì™¸ë¶€ ë„êµ¬ ê°„ì˜ <strong>í‘œì¤€í™”ëœ í†µì‹  ê·œì•½</strong>ì…ë‹ˆë‹¤. USBê°€ ë‹¤ì–‘í•œ ê¸°ê¸°ë¥¼ ë‹¨ì¼ ì¸í„°í˜ì´ìŠ¤ë¡œ ì—°ê²°í•˜ë“¯, MCPëŠ” AI ëª¨ë¸ì´ ë°ì´í„°ë² ì´ìŠ¤, íŒŒì¼ ì‹œìŠ¤í…œ, ì™¸ë¶€ API ë“± ë‹¤ì–‘í•œ ë¦¬ì†ŒìŠ¤ì— ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ í‘œì¤€í™”ëŠ” ë„êµ¬ì˜ ì¬ì‚¬ìš©ì„±ì„ ê·¹ëŒ€í™”í•˜ê³ , ë‹¤ì–‘í•œ AI í´ë¼ì´ì–¸íŠ¸(Claude Desktop, VS Code, ì»¤ìŠ¤í…€ ì•±)ì—ì„œ ë™ì¼í•œ ë„êµ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</p>
<h4 id="_5">ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì˜ ì—­í•  ë¶„ë¦¬</h4>
<p>MCPëŠ” <strong>ì„œë²„-í´ë¼ì´ì–¸íŠ¸ ì•„í‚¤í…ì²˜</strong>ë¥¼ ì±„íƒí•©ë‹ˆë‹¤. ì„œë²„ëŠ” ë„êµ¬(Tools)ì™€ ë¦¬ì†ŒìŠ¤(Resources)ë¥¼ ë…¸ì¶œí•˜ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ë¥¼ ë°œê²¬í•˜ê³  í˜¸ì¶œí•©ë‹ˆë‹¤. ì´ ë¶„ë¦¬ëŠ” ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•˜ë©°, ì„œë²„ëŠ” íŠ¹ì • ë„ë©”ì¸ì˜ ì „ë¬¸ì„±ì— ì§‘ì¤‘í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” AI ëª¨ë¸ê³¼ì˜ í†µí•©ì— ì§‘ì¤‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Transport ê³„ì¸µ(STDIO, HTTP/SSE, WebSocket)ì˜ ì¶”ìƒí™”ë¡œ ë™ì¼í•œ ë¡œì§ì„ ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h4 id="_6">ì„ ì–¸ì  ê°œë°œê³¼ ë™ì  í™•ì¥</h4>
<p><code>@McpTool</code>, <code>@McpResource</code> ì–´ë…¸í…Œì´ì…˜ì„ í†µí•œ <strong>ì„ ì–¸ì  ê°œë°œ ë°©ì‹</strong>ì€ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ë¥¼ ìµœì†Œí™”í•˜ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì§‘ì¤‘í•˜ê²Œ í•©ë‹ˆë‹¤. Dynamic Tool UpdateëŠ” ëŸ°íƒ€ì„ì— ë„êµ¬ë¥¼ ì¶”ê°€/ì œê±°í•  ìˆ˜ ìˆì–´ <strong>í”ŒëŸ¬ê·¸ì¸ ì•„í‚¤í…ì²˜</strong>ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. Sampling ê¸°ëŠ¥ì€ MCP ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ LLMì„ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ í•˜ì—¬, ë„êµ¬ ì‹¤í–‰ ì¤‘ì—ë„ AIì˜ íŒë‹¨ì„ í™œìš©í•  ìˆ˜ ìˆëŠ” ì–‘ë°©í–¥ í˜‘ë ¥ êµ¬ì¡°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
<h3 id="mcp_1">MCP êµ¬ì„±ìš”ì†Œ ì •ë¦¬</h3>
<table>
<thead>
<tr>
<th>êµ¬ì„±ìš”ì†Œ</th>
<th>ì„¤ëª…</th>
<th>Spring AI ì§€ì›</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Server</strong></td>
<td>ë„êµ¬ì™€ ë¦¬ì†ŒìŠ¤ë¥¼ ë…¸ì¶œí•˜ëŠ” ì œê³µì. íŠ¹ì • ë„ë©”ì¸ì˜ ê¸°ëŠ¥ì„ ìº¡ìŠí™”</td>
<td>WebMVC, WebFlux, STDIO</td>
</tr>
<tr>
<td><strong>Client</strong></td>
<td>ì„œë²„ì— ì—°ê²°í•˜ì—¬ ë„êµ¬ë¥¼ ë°œê²¬í•˜ê³  í˜¸ì¶œí•˜ëŠ” ì†Œë¹„ì</td>
<td>Sync, Async, Multi-server</td>
</tr>
<tr>
<td><strong>Tools</strong></td>
<td>ì‹¤í–‰ ê°€ëŠ¥í•œ í•¨ìˆ˜. AIê°€ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ë™ì‘ ì •ì˜</td>
<td>@McpTool, FunctionToolCallback</td>
</tr>
<tr>
<td><strong>Resources</strong></td>
<td>ì½ê¸° ì „ìš© ë°ì´í„° ì ‘ê·¼ì . ì»¨í…ìŠ¤íŠ¸ ì œê³µìš©</td>
<td>@McpResource, URI ê¸°ë°˜</td>
</tr>
<tr>
<td><strong>Sampling</strong></td>
<td>ì„œë²„â†’í´ë¼ì´ì–¸íŠ¸ ë°©í–¥ LLM í˜¸ì¶œ. ë„êµ¬ ë‚´ AI í™œìš©</td>
<td>McpSyncClientCustomizer</td>
</tr>
</tbody>
</table>
<h3 id="transport">Transport ë¹„êµ</h3>
<table>
<thead>
<tr>
<th>Transport</th>
<th>ì‚¬ìš© ì‚¬ë¡€</th>
<th>ì¥ì </th>
<th>ë‹¨ì </th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>STDIO</strong></td>
<td>ë¡œì»¬ ì‹¤í–‰, Claude Desktop í†µí•©</td>
<td>ë‹¨ìˆœí•œ ì„¤ì •, í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬, ë³´ì•ˆ</td>
<td>ì›ê²© ì—°ê²° ë¶ˆê°€, ë‹¨ì¼ í´ë¼ì´ì–¸íŠ¸</td>
</tr>
<tr>
<td><strong>HTTP/SSE</strong></td>
<td>ì›¹ ì„œë²„, ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤</td>
<td>HTTP í‘œì¤€, ì›ê²© ì—°ê²°, ë°©í™”ë²½ ì¹œí™”ì </td>
<td>ë‹¨ë°©í–¥ ìŠ¤íŠ¸ë¦¬ë°, ì—°ê²° ìœ ì§€ í•„ìš”</td>
</tr>
<tr>
<td><strong>WebSocket</strong></td>
<td>ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ </td>
<td>íš¨ìœ¨ì , ì–‘ë°©í–¥, ë‚®ì€ ì§€ì—°</td>
<td>êµ¬í˜„ ë³µì¡, ìƒíƒœ ê´€ë¦¬ í•„ìš”</td>
</tr>
</tbody>
</table>
<h3 id="_7">ì‹¤ì „ í™œìš© íŒ</h3>
<h4 id="mcp-server">MCP Server ì„¤ê³„ ì‹œ</h4>
<ul>
<li><strong>ë‹¨ì¼ ì±…ì„</strong>: í•˜ë‚˜ì˜ ì„œë²„ëŠ” í•˜ë‚˜ì˜ ë„ë©”ì¸(ë‚ ì”¨, DB, íŒŒì¼)ì— ì§‘ì¤‘í•˜ì„¸ìš”</li>
<li><strong>ë„êµ¬ ë„¤ì´ë°</strong>: ëª…í™•í•˜ê³  ì¼ê´€ëœ ë„¤ì´ë° ì»¨ë²¤ì…˜ì„ ìœ ì§€í•˜ì„¸ìš” (<code>weather_getCurrent</code>, <code>weather_getForecast</code>)</li>
<li><strong>ì—ëŸ¬ ë©”ì‹œì§€</strong>: AIê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•˜ì„¸ìš”</li>
</ul>
<h4 id="transport_1">Transport ì„ íƒ ê¸°ì¤€</h4>
<ul>
<li><strong>ë¡œì»¬ ê°œë°œ/Claude Desktop</strong>: STDIOê°€ ê°€ì¥ ê°„ë‹¨í•©ë‹ˆë‹¤</li>
<li><strong>í”„ë¡œë•ì…˜ ì›¹ ì„œë¹„ìŠ¤</strong>: HTTP/SSEë¡œ ì›ê²© ì ‘ê·¼ì„ ì§€ì›í•˜ì„¸ìš”</li>
<li><strong>ì‹¤ì‹œê°„ í˜‘ì—…</strong>: WebSocketìœ¼ë¡œ ì–‘ë°©í–¥ í†µì‹ ì„ êµ¬í˜„í•˜ì„¸ìš”</li>
</ul>
<h4 id="_8">ë³´ì•ˆ ê³ ë ¤ì‚¬í•­</h4>
<ul>
<li><strong>ì¸ì¦/ì¸ê°€</strong>: OAuth2, API í‚¤ ë“± ì ì ˆí•œ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜ì„ êµ¬í˜„í•˜ì„¸ìš”</li>
<li><strong>ì…ë ¥ ê²€ì¦</strong>: ëª¨ë“  ë„êµ¬ íŒŒë¼ë¯¸í„°ë¥¼ ì„œë²„ ì¸¡ì—ì„œ ê²€ì¦í•˜ì„¸ìš”</li>
<li><strong>ê¶Œí•œ ìµœì†Œí™”</strong>: ë„êµ¬ì— í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ë¶€ì—¬í•˜ì„¸ìš”</li>
</ul>
<h3 id="_9">ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜</h3>
<table>
<thead>
<tr>
<th>ì‹¤ìˆ˜</th>
<th>ë¬¸ì œì </th>
<th>í•´ê²° ë°©ë²•</th>
</tr>
</thead>
<tbody>
<tr>
<td>ê³¼ë„í•œ ë„êµ¬ ì„¸ë¶„í™”</td>
<td>í´ë¼ì´ì–¸íŠ¸ ë³µì¡ì„± ì¦ê°€, AI ì„ íƒ í˜¼ë€</td>
<td>ê´€ë ¨ ê¸°ëŠ¥ ê·¸ë£¹í™”, ê³„ì¸µì  êµ¬ì¡°í™”</td>
</tr>
<tr>
<td>Transport ë¶ˆì¼ì¹˜</td>
<td>í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ì—°ê²° ì‹¤íŒ¨</td>
<td>í™˜ê²½ì— ë§ëŠ” Transport ì„ íƒ, ì„¤ì • ë¬¸ì„œí™”</td>
</tr>
<tr>
<td>Sampling ë¬´í•œ ë£¨í”„</td>
<td>ì„œë²„â†”í´ë¼ì´ì–¸íŠ¸ ê°„ ë¬´í•œ í˜¸ì¶œ</td>
<td>í˜¸ì¶œ ê¹Šì´ ì œí•œ, ì¢…ë£Œ ì¡°ê±´ ëª…í™•í™”</td>
</tr>
<tr>
<td>ë¦¬ì†ŒìŠ¤ ë¯¸ì •ë¦¬</td>
<td>ë©”ëª¨ë¦¬ ëˆ„ìˆ˜, ì—°ê²° ê³ ê°ˆ</td>
<td>ì—°ê²° í’€ë§, ì ì ˆí•œ íƒ€ì„ì•„ì›ƒ, graceful shutdown</td>
</tr>
<tr>
<td>ë²„ì „ í˜¸í™˜ì„± ë¬´ì‹œ</td>
<td>í´ë¼ì´ì–¸íŠ¸-ì„œë²„ í”„ë¡œí† ì½œ ë¶ˆì¼ì¹˜</td>
<td>ë²„ì „ í˜‘ìƒ, í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€</td>
</tr>
</tbody>
</table>
<h3 id="_10">í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
<ul>
<li>[ ] MCP ì•„í‚¤í…ì²˜ì™€ í•µì‹¬ ê°œë… ì´í•´</li>
<li>[ ] MCP Server êµ¬í˜„ (WebMVC/WebFlux/STDIO)</li>
<li>[ ] Tool ì •ì˜ ë° ë“±ë¡</li>
<li>[ ] Resource ì •ì˜</li>
<li>[ ] MCP Client êµ¬í˜„</li>
<li>[ ] ë‹¤ì¤‘ ì„œë²„ ì—°ê²°</li>
<li>[ ] Annotation ê¸°ë°˜ ê°œë°œ</li>
<li>[ ] Sampling êµ¬í˜„</li>
<li>[ ] Dynamic Tool Update</li>
<li>[ ] Docker ë°°í¬</li>
</ul>
<hr />
<h2 id="_11">ë§ˆë¬´ë¦¬</h2>
<h3 id="_12">í•™ìŠµ ì—¬ì • ìš”ì•½</h3>
<p>ì´ ì±…ì„ í†µí•´ Spring AIì˜ í•µì‹¬ ê°œë…ë¶€í„° ê³ ê¸‰ ì•„í‚¤í…ì²˜ íŒ¨í„´ê¹Œì§€ ì²´ê³„ì ìœ¼ë¡œ í•™ìŠµí–ˆìŠµë‹ˆë‹¤.</p>
<table>
<thead>
<tr>
<th>Part</th>
<th>í•µì‹¬ ì—­ëŸ‰</th>
<th>ë‹¬ì„±í•œ ëŠ¥ë ¥</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Part 1</strong></td>
<td>AI í†µí•© ê¸°ì´ˆ</td>
<td>ChatClientë¡œ AI ëª¨ë¸ê³¼ ìƒí˜¸ì‘ìš©, ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬</td>
</tr>
<tr>
<td><strong>Part 2</strong></td>
<td>í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§</td>
<td>êµ¬ì¡°í™”ëœ ì¶œë ¥, ê³ ê¸‰ í”„ë¡¬í”„íŒ… ê¸°ë²•ìœ¼ë¡œ ì‘ë‹µ í’ˆì§ˆ ì œì–´</td>
</tr>
<tr>
<td><strong>Part 3</strong></td>
<td>ë„êµ¬ í†µí•©</td>
<td>Function Callingê³¼ Advisorë¡œ AIì— ì‹¤í–‰ ëŠ¥ë ¥ ë¶€ì—¬</td>
</tr>
<tr>
<td><strong>Part 4</strong></td>
<td>ì—ì´ì „íŠ¸ ì„¤ê³„</td>
<td>6ê°€ì§€ Agentic Patternìœ¼ë¡œ ììœ¨ì  AI ì‹œìŠ¤í…œ êµ¬ì¶•</td>
</tr>
<tr>
<td><strong>Part 5</strong></td>
<td>í‘œì¤€í™”ëœ í†µí•©</td>
<td>MCPë¡œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ ìƒíƒœê³„ êµ¬ì¶•</td>
</tr>
</tbody>
</table>
<h3 id="_13">ë‹¤ìŒ ë‹¨ê³„ë¥¼ ìœ„í•œ ì¡°ì–¸</h3>
<p><strong>ê¸°ìˆ ì  ê¹Šì´ í™•ì¥</strong>: ê° Partì—ì„œ ë‹¤ë£¬ ê°œë…ë“¤ì€ ì‹œì‘ì ì…ë‹ˆë‹¤. ê³µì‹ ë¬¸ì„œì™€ ì†ŒìŠ¤ ì½”ë“œë¥¼ íƒêµ¬í•˜ë©° ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¥¼ ì´í•´í•˜ì„¸ìš”.</p>
<p><strong>ì‹¤ì „ ê²½í—˜ ì¶•ì </strong>: ì´ë¡ ì  ì§€ì‹ì€ ì‹¤ì œ í”„ë¡œì íŠ¸ì— ì ìš©í•´ì•¼ ì²´í™”ë©ë‹ˆë‹¤. ì‘ì€ í”„ë¡œì íŠ¸ë¶€í„° ì‹œì‘í•˜ì—¬ ì ì§„ì ìœ¼ë¡œ ë³µì¡ë„ë¥¼ ë†’ì—¬ê°€ì„¸ìš”.</p>
<p><strong>ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬</strong>: Spring AIëŠ” ë¹ ë¥´ê²Œ ë°œì „í•˜ëŠ” ìƒíƒœê³„ì…ë‹ˆë‹¤. GitHub Issues, Stack Overflow, ì»¤ë®¤ë‹ˆí‹° í¬ëŸ¼ì„ í†µí•´ ìµœì‹  ë™í–¥ì„ íŒŒì•…í•˜ê³  ê¸°ì—¬í•˜ì„¸ìš”.</p>
<p>ì´ì œ ì—¬ëŸ¬ë¶„ì€ <strong>í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ AI ì• í”Œë¦¬ì¼€ì´ì…˜</strong>ì„ ì„¤ê³„í•˜ê³  êµ¬í˜„í•  ìˆ˜ ìˆëŠ” ì—­ëŸ‰ì„ ê°–ì¶”ì—ˆìŠµë‹ˆë‹¤.</p>
<hr />
<h2 id="_14">ì—°ìŠµ ë¬¸ì œ</h2>
<ol>
<li>
<p><strong>ë‚ ì”¨ MCP ì„œë²„</strong>: í˜„ì¬ ë‚ ì”¨ì™€ ì˜ˆë³´ë¥¼ ì œê³µí•˜ëŠ” MCP ì„œë²„ë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</p>
</li>
<li>
<p><strong>SQLite MCP ì„œë²„</strong>: ë¡œì»¬ SQLite ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¿¼ë¦¬í•  ìˆ˜ ìˆëŠ” MCP ì„œë²„ë¥¼ êµ¬í˜„í•˜ì„¸ìš”.</p>
</li>
<li>
<p><strong>ë‹¤ì¤‘ ì„œë²„ í´ë¼ì´ì–¸íŠ¸</strong>: ë‚ ì”¨ ì„œë²„ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì— ë™ì‹œì— ì—°ê²°í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</p>
</li>
<li>
<p><strong>Sampling í™œìš©</strong>: ë‚ ì”¨ ë°ì´í„°ë¥¼ ë°›ì•„ AIë¡œ ì°½ì‘ ì„¤ëª…ì„ ì¶”ê°€í•˜ëŠ” ë„êµ¬ë¥¼ êµ¬í˜„í•˜ì„¸ìš”.</p>
</li>
<li>
<p><strong>Docker ë°°í¬</strong>: ì—¬ëŸ¬ MCP ì„œë²„ë¥¼ Docker Composeë¡œ ë°°í¬í•´ ë³´ì„¸ìš”.</p>
</li>
</ol>
<hr />
<h2 id="_15">ì°¸ê³  ì˜ˆì œ ì½”ë“œ</h2>
<p>ì´ ì±…ì˜ ì˜ˆì œ ì½”ë“œëŠ” ë‹¤ìŒ ë””ë ‰í† ë¦¬ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="codehilite"><pre><span></span><code><span class="n">spring</span><span class="o">-</span><span class="n">ai</span><span class="o">-</span><span class="n">examples</span><span class="o">/</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">model</span><span class="o">-</span><span class="n">context</span><span class="o">-</span><span class="n">protocol</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">weather</span><span class="o">/</span><span class="w">                    </span><span class="c1"># ë‚ ì”¨ MCP ì„œë²„</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">sqlite</span><span class="o">/</span><span class="w">                     </span><span class="c1"># SQLite MCP ì„œë²„</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">filesystem</span><span class="o">/</span><span class="w">                 </span><span class="c1"># íŒŒì¼ì‹œìŠ¤í…œ MCP ì„œë²„</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">brave</span><span class="o">/</span><span class="w">                      </span><span class="c1"># Brave ê²€ìƒ‰ MCP</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">client</span><span class="o">-</span><span class="n">starter</span><span class="o">/</span><span class="w">             </span><span class="c1"># MCP í´ë¼ì´ì–¸íŠ¸</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">mcp</span><span class="o">-</span><span class="n">annotations</span><span class="o">/</span><span class="w">            </span><span class="c1"># ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">sampling</span><span class="o">/</span><span class="w">                   </span><span class="c1"># MCP Sampling</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">dynamic</span><span class="o">-</span><span class="k">tool</span><span class="o">-</span><span class="n">update</span><span class="o">/</span><span class="w">        </span><span class="c1"># ë™ì  ë„êµ¬ ì—…ë°ì´íŠ¸</span>
<span class="w">    </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">brave</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">agents</span><span class="o">-</span><span class="n">gateway</span><span class="o">/</span><span class="w"> </span><span class="c1"># Docker ê²Œì´íŠ¸ì›¨ì´</span>
</code></pre></div>

<hr />
<h2 id="capstone-project">ë‹¤ìŒ ë‹¨ê³„: Capstone Project</h2>
<p>ì´ì œ ë°°ìš´ ëª¨ë“  ê²ƒì„ í™œìš©í•˜ì—¬ <strong>ì‹¤ì „ í”„ë¡œì íŠ¸</strong>ë¥¼ ì§„í–‰í•´ ë³´ì„¸ìš”.</p>
<h3 id="_16">ì¶”ì²œ í”„ë¡œì íŠ¸ ì•„ì´ë””ì–´</h3>
<ol>
<li><strong>AI ê³ ê° ì§€ì› ì‹œìŠ¤í…œ</strong></li>
<li>ë¼ìš°íŒ…ìœ¼ë¡œ ë¬¸ì˜ ë¶„ë¥˜</li>
<li>MCPë¡œ ê³ ê° ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°</li>
<li>
<p>ìë™ í‹°ì¼“ ìƒì„±</p>
</li>
<li>
<p><strong>ì½”ë“œ ë¦¬ë·° ë„ìš°ë¯¸</strong></p>
</li>
<li>GitHub MCP ì„œë²„ë¡œ PR ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</li>
<li>Evaluator-Optimizerë¡œ ë¦¬ë·° í’ˆì§ˆ ê°œì„ </li>
<li>
<p>Reflectionìœ¼ë¡œ ìê¸° ê²€ì¦</p>
</li>
<li>
<p><strong>ë°ì´í„° ë¶„ì„ ëŒ€ì‹œë³´ë“œ</strong></p>
</li>
<li>SQLite MCPë¡œ ë°ì´í„° ì¡°íšŒ</li>
<li>ë³‘ë ¬ ì²˜ë¦¬ë¡œ ë‹¤ì¤‘ ë¶„ì„</li>
<li>
<p>ì²´ì¸ ì›Œí¬í”Œë¡œìš°ë¡œ ë¦¬í¬íŠ¸ ìƒì„±</p>
</li>
<li>
<p><strong>ë©€í‹°ëª¨ë‹¬ ì½˜í…ì¸  ìƒì„±ê¸°</strong></p>
</li>
<li>í…ìŠ¤íŠ¸ ìƒì„± (ChatClient)</li>
<li>ì´ë¯¸ì§€ ìƒì„± (ì™¸ë¶€ API ì—°ë™)</li>
<li>ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°ë¡œ ì „ì²´ ì¡°ìœ¨</li>
</ol>
<p>ë°°ìš´ ë‚´ìš©ì„ ì‹¤ì „ì— ì ìš©í•˜ë©° ë” ê¹Šì´ ì´í•´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. í™”ì´íŒ…!</p></div>
    </body>
    </html>
    